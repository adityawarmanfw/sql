import{ad as rw,ae as ow,L as ko,G as lw,s as dn,R as Dr,S as Ar,b as ze,f as ie,r as J,i as Xe,h as ve,n as at,l as ml,w as Us,e as Ae,c as Oe,V as Dh,A as aw,o as xp,Z as hw,a7 as cw,a as Vt,t as jc,af as Hs,g as Wt,d as Gc,j as qc,m as uw,ag as vr,v as wr,aa as dw,B as fw}from"../chunks/scheduler.hLwqlzEk.js";import{g as kp,b as Ai,e as Sp,t as Oi,S as fn,i as pn,c as Qs,a as Js,m as Xs,d as Zs,j as Cr}from"../chunks/index.jQBLQ83-.js";import{P as pw}from"../chunks/CopyCode.svelte_svelte_type_style_lang.mqPIhrbb.js";import"../chunks/Link.svelte_svelte_type_style_lang.jFfRB88c.js";import"../chunks/entry.pNqdRus1.js";function id(s,e){const t=e.token={};function i(n,r,o,l){if(e.token!==t)return;e.resolved=l;let a=e.ctx;o!==void 0&&(a=a.slice(),a[o]=l);const h=n&&(e.current=n)(a);let c=!1;e.block&&(e.blocks?e.blocks.forEach((u,d)=>{d!==r&&u&&(kp(),Ai(u,1,1,()=>{e.blocks[d]===u&&(e.blocks[d]=null)}),Sp())}):e.block.d(1),h.c(),Oi(h,1),h.m(e.mount(),e.anchor),c=!0),e.block=h,e.blocks&&(e.blocks[r]=h),c&&lw()}if(rw(s)){const n=ow();if(s.then(r=>{ko(n),i(e.then,1,e.value,r),ko(null)},r=>{if(ko(n),i(e.catch,2,e.error,r),ko(null),!e.hasCatch)throw r}),e.current!==e.pending)return i(e.pending,0),!0}else{if(e.current!==e.then)return i(e.then,1,e.value,s),!0;e.resolved=s}}function mw(s,e,t){const i=e.slice(),{resolved:n}=s;s.current===s.then&&(i[s.value]=n),s.current===s.catch&&(i[s.error]=n),s.block.p(i,t)}function gw(s){let e,t,i;return{c(){e=Dr("svg"),t=Dr("path"),i=Dr("path"),this.h()},l(n){e=Ar(n,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0});var r=ze(e);t=Ar(r,"path",{fill:!0,d:!0}),ze(t).forEach(ie),i=Ar(r,"path",{fill:!0,d:!0}),ze(i).forEach(ie),r.forEach(ie),this.h()},h(){J(t,"fill","currentColor"),J(t,"d","M7.024 3.75c0-.966.784-1.75 1.75-1.75H20.25c.966 0 1.75.784 1.75 1.75v11.498a1.75 1.75 0 0 1-1.75 1.75H8.774a1.75 1.75 0 0 1-1.75-1.75Zm1.75-.25a.25.25 0 0 0-.25.25v11.498c0 .139.112.25.25.25H20.25a.25.25 0 0 0 .25-.25V3.75a.25.25 0 0 0-.25-.25Z"),J(i,"fill","currentColor"),J(i,"d","M1.995 10.749a1.75 1.75 0 0 1 1.75-1.751H5.25a.75.75 0 1 1 0 1.5H3.745a.25.25 0 0 0-.25.25L3.5 20.25c0 .138.111.25.25.25h9.5a.25.25 0 0 0 .25-.25v-1.51a.75.75 0 1 1 1.5 0v1.51A1.75 1.75 0 0 1 13.25 22h-9.5A1.75 1.75 0 0 1 2 20.25l-.005-9.501Z"),J(e,"xmlns","http://www.w3.org/2000/svg"),J(e,"width","1em"),J(e,"height","1em"),J(e,"viewBox","0 0 24 24")},m(n,r){Xe(n,e,r),ve(e,t),ve(e,i)},p:at,i:at,o:at,d(n){n&&ie(e)}}}class bw extends fn{constructor(e){super(),pn(this,e,null,gw,dn,{})}}function yw(s){let e,t;return{c(){e=Dr("svg"),t=Dr("path"),this.h()},l(i){e=Ar(i,"svg",{xmlns:!0,width:!0,height:!0,viewBox:!0});var n=ze(e);t=Ar(n,"path",{fill:!0,d:!0}),ze(t).forEach(ie),n.forEach(ie),this.h()},h(){J(t,"fill","currentColor"),J(t,"d","M9 16.2L4.8 12l-1.4 1.4L9 19L21 7l-1.4-1.4L9 16.2z"),J(e,"xmlns","http://www.w3.org/2000/svg"),J(e,"width","1em"),J(e,"height","1em"),J(e,"viewBox","0 0 24 24")},m(i,n){Xe(i,e,n),ve(e,t)},p:at,i:at,o:at,d(i){i&&ie(e)}}}class vw extends fn{constructor(e){super(),pn(this,e,null,yw,dn,{})}}function ww(s){let e,t,i,n,r;return t=new bw({}),{c(){e=Ae("div"),Qs(t.$$.fragment),this.h()},l(o){e=Oe(o,"DIV",{class:!0,role:!0,tabindex:!0,"aria-label":!0});var l=ze(e);Js(t.$$.fragment,l),l.forEach(ie),this.h()},h(){J(e,"class","svp-code-bock--copy-code"),J(e,"role","button"),J(e,"tabindex","0"),J(e,"aria-label","Copy code")},m(o,l){Xe(o,e,l),Xs(t,e,null),s[3](e),i=!0,n||(r=[Dh(e,"click",s[2]),Dh(e,"keyup",s[2])],n=!0)},p:at,i(o){i||(Oi(t.$$.fragment,o),i=!0)},o(o){Ai(t.$$.fragment,o),i=!1},d(o){o&&ie(e),Zs(t),s[3](null),n=!1,aw(r)}}}function Cw(s){let e,t,i;return t=new vw({}),{c(){e=Ae("div"),Qs(t.$$.fragment),this.h()},l(n){e=Oe(n,"DIV",{class:!0});var r=ze(e);Js(t.$$.fragment,r),r.forEach(ie),this.h()},h(){J(e,"class","svp-code-bock--copy-code")},m(n,r){Xe(n,e,r),Xs(t,e,null),i=!0},p:at,i(n){i||(Oi(t.$$.fragment,n),i=!0)},o(n){Ai(t.$$.fragment,n),i=!1},d(n){n&&ie(e),Zs(t)}}}function Ew(s){let e,t,i,n;const r=[Cw,ww],o=[];function l(a,h){return a[1]?0:1}return e=l(s),t=o[e]=r[e](s),{c(){t.c(),i=ml()},l(a){t.l(a),i=ml()},m(a,h){o[e].m(a,h),Xe(a,i,h),n=!0},p(a,[h]){let c=e;e=l(a),e===c?o[e].p(a,h):(kp(),Ai(o[c],1,1,()=>{o[c]=null}),Sp(),t=o[e],t?t.p(a,h):(t=o[e]=r[e](a),t.c()),Oi(t,1),t.m(i.parentNode,i))},i(a){n||(Oi(t),n=!0)},o(a){Ai(t),n=!1},d(a){a&&ie(i),o[e].d(a)}}}function xw(s,e,t){let i,n=!1;function r(){var a,h;const l=((h=(a=i==null?void 0:i.parentElement)==null?void 0:a.querySelector(".shiki"))==null?void 0:h.textContent)||"";navigator.clipboard.writeText(l),t(1,n=!0),setTimeout(()=>{t(1,n=!1)},2e3)}function o(l){Us[l?"unshift":"push"](()=>{i=l,t(0,i)})}return[i,n,r,o]}class kw extends fn{constructor(e){super(),pn(this,e,xw,Ew,dn,{})}}function K(s,e,t,i){function n(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(c){try{h(i.next(c))}catch(u){o(u)}}function a(c){try{h(i.throw(c))}catch(u){o(u)}}function h(c){c.done?r(c.value):n(c.value).then(l,a)}h((i=i.apply(s,e||[])).next())})}function sd(s){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&s[e],i=0;if(t)return t.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&i>=s.length&&(s=void 0),{value:s&&s[i++],done:!s}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Z(s){return this instanceof Z?(this.v=s,this):new Z(s)}function Ri(s,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(s,e||[]),n,r=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(d){i[d]&&(n[d]=function(f){return new Promise(function(p,m){r.push([d,f,p,m])>1||l(d,f)})})}function l(d,f){try{a(i[d](f))}catch(p){u(r[0][3],p)}}function a(d){d.value instanceof Z?Promise.resolve(d.value.v).then(h,c):u(r[0][2],d)}function h(d){l("next",d)}function c(d){l("throw",d)}function u(d,f){d(f),r.shift(),r.length&&l(r[0][0],r[0][1])}}function Jo(s){var e,t;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,r){e[n]=s[n]?function(o){return(t=!t)?{value:Z(s[n](o)),done:!1}:r?r(o):o}:r}}function en(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=s[Symbol.asyncIterator],t;return e?e.call(s):(s=typeof sd=="function"?sd(s):s[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(r){t[r]=s[r]&&function(o){return new Promise(function(l,a){o=s[r](o),n(l,a,o.done,o.value)})}}function n(r,o,l,a){Promise.resolve(a).then(function(h){r({value:h,done:l})},o)}}const Sw=new TextDecoder("utf-8"),Ah=s=>Sw.decode(s),_w=new TextEncoder,$c=s=>_w.encode(s),Rw=s=>typeof s=="number",_p=s=>typeof s=="boolean",We=s=>typeof s=="function",St=s=>s!=null&&Object(s)===s,nn=s=>St(s)&&We(s.then),oo=s=>St(s)&&We(s[Symbol.iterator]),nr=s=>St(s)&&We(s[Symbol.asyncIterator]),Oh=s=>St(s)&&St(s.schema),Rp=s=>St(s)&&"done"in s&&"value"in s,Tp=s=>St(s)&&We(s.stat)&&Rw(s.fd),Mp=s=>St(s)&&Kc(s.body),wa=s=>"_getDOMStream"in s&&"_getNodeStream"in s,Tw=s=>St(s)&&We(s.abort)&&We(s.getWriter)&&!wa(s),Kc=s=>St(s)&&We(s.cancel)&&We(s.getReader)&&!wa(s),Mw=s=>St(s)&&We(s.end)&&We(s.write)&&_p(s.writable)&&!wa(s),Dp=s=>St(s)&&We(s.read)&&We(s.pipe)&&_p(s.readable)&&!wa(s),Dw=s=>St(s)&&We(s.clear)&&We(s.bytes)&&We(s.position)&&We(s.setPosition)&&We(s.capacity)&&We(s.getBufferIdentifier)&&We(s.createLong),Yc=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:ArrayBuffer;function Aw(s){const e=s[0]?[s[0]]:[];let t,i,n,r;for(let o,l,a=0,h=0,c=s.length;++a<c;){if(o=e[h],l=s[a],!o||!l||o.buffer!==l.buffer||l.byteOffset<o.byteOffset){l&&(e[++h]=l);continue}if({byteOffset:t,byteLength:n}=o,{byteOffset:i,byteLength:r}=l,t+n<i||i+r<t){l&&(e[++h]=l);continue}e[h]=new Uint8Array(o.buffer,t,i-t+r)}return e}function nd(s,e,t=0,i=e.byteLength){const n=s.byteLength,r=new Uint8Array(s.buffer,s.byteOffset,n),o=new Uint8Array(e.buffer,e.byteOffset,Math.min(i,n));return r.set(o,t),s}function Bi(s,e){const t=Aw(s),i=t.reduce((c,u)=>c+u.byteLength,0);let n,r,o,l=0,a=-1;const h=Math.min(e||Number.POSITIVE_INFINITY,i);for(const c=t.length;++a<c;){if(n=t[a],r=n.subarray(0,Math.min(n.length,h-l)),h<=l+r.length){r.length<n.length?t[a]=n.subarray(r.length):r.length===n.length&&a++,o?nd(o,r,l):o=r;break}nd(o||(o=new Uint8Array(h)),r,l),l+=r.length}return[o||new Uint8Array(0),t.slice(a),i-(o?o.byteLength:0)]}function ye(s,e){let t=Rp(e)?e.value:e;return t instanceof s?s===Uint8Array?new s(t.buffer,t.byteOffset,t.byteLength):t:t?(typeof t=="string"&&(t=$c(t)),t instanceof ArrayBuffer?new s(t):t instanceof Yc?new s(t):Dw(t)?ye(s,t.bytes()):ArrayBuffer.isView(t)?t.byteLength<=0?new s(0):new s(t.buffer,t.byteOffset,t.byteLength/s.BYTES_PER_ELEMENT):s.from(t)):new s(0)}const ur=s=>ye(Int32Array,s),ue=s=>ye(Uint8Array,s),Lh=s=>(s.next(),s);function*Ow(s,e){const t=function*(n){yield n},i=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Yc?t(e):oo(e)?e:t(e);return yield*Lh(function*(n){let r=null;do r=n.next(yield ye(s,r));while(!r.done)}(i[Symbol.iterator]())),new s}const Lw=s=>Ow(Uint8Array,s);function Ap(s,e){return Ri(this,arguments,function*(){if(nn(e))return yield Z(yield Z(yield*Jo(en(Ap(s,yield Z(e))))));const i=function(o){return Ri(this,arguments,function*(){yield yield Z(yield Z(o))})},n=function(o){return Ri(this,arguments,function*(){yield Z(yield*Jo(en(Lh(function*(l){let a=null;do a=l.next(yield a==null?void 0:a.value);while(!a.done)}(o[Symbol.iterator]())))))})},r=typeof e=="string"||ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof Yc?i(e):oo(e)?n(e):nr(e)?e:i(e);return yield Z(yield*Jo(en(Lh(function(o){return Ri(this,arguments,function*(){let l=null;do l=yield Z(o.next(yield yield Z(ye(s,l))));while(!l.done)})}(r[Symbol.asyncIterator]()))))),yield Z(new s)})}const Iw=s=>Ap(Uint8Array,s);function Op(s,e,t){if(s!==0){t=t.slice(0,e);for(let i=-1,n=t.length;++i<n;)t[i]+=s}return t.subarray(0,e)}function Bw(s,e){let t=0;const i=s.length;if(i!==e.length)return!1;if(i>0)do if(s[t]!==e[t])return!1;while(++t<i);return!0}const Ut={fromIterable(s){return So(Fw(s))},fromAsyncIterable(s){return So(Pw(s))},fromDOMStream(s){return So(Nw(s))},fromNodeStream(s){return So(Hw(s))},toDOMStream(s,e){throw new Error('"toDOMStream" not available in this environment')},toNodeStream(s,e){throw new Error('"toNodeStream" not available in this environment')}},So=s=>(s.next(),s);function*Fw(s){let e,t=!1,i=[],n,r,o,l=0;function a(){return r==="peek"?Bi(i,o)[0]:([n,i,l]=Bi(i,o),n)}({cmd:r,size:o}=yield null);const h=Lw(s)[Symbol.iterator]();try{do if({done:e,value:n}=Number.isNaN(o-l)?h.next():h.next(o-l),!e&&n.byteLength>0&&(i.push(n),l+=n.byteLength),e||o<=l)do({cmd:r,size:o}=yield a());while(o<l);while(!e)}catch(c){(t=!0)&&typeof h.throw=="function"&&h.throw(c)}finally{t===!1&&typeof h.return=="function"&&h.return(null)}return null}function Pw(s){return Ri(this,arguments,function*(){let t,i=!1,n=[],r,o,l,a=0;function h(){return o==="peek"?Bi(n,l)[0]:([r,n,a]=Bi(n,l),r)}({cmd:o,size:l}=yield yield Z(null));const c=Iw(s)[Symbol.asyncIterator]();try{do if({done:t,value:r}=Number.isNaN(l-a)?yield Z(c.next()):yield Z(c.next(l-a)),!t&&r.byteLength>0&&(n.push(r),a+=r.byteLength),t||l<=a)do({cmd:o,size:l}=yield yield Z(h()));while(l<a);while(!t)}catch(u){(i=!0)&&typeof c.throw=="function"&&(yield Z(c.throw(u)))}finally{i===!1&&typeof c.return=="function"&&(yield Z(c.return(new Uint8Array(0))))}return yield Z(null)})}function Nw(s){return Ri(this,arguments,function*(){let t=!1,i=!1,n=[],r,o,l,a=0;function h(){return o==="peek"?Bi(n,l)[0]:([r,n,a]=Bi(n,l),r)}({cmd:o,size:l}=yield yield Z(null));const c=new zw(s);try{do if({done:t,value:r}=Number.isNaN(l-a)?yield Z(c.read()):yield Z(c.read(l-a)),!t&&r.byteLength>0&&(n.push(ue(r)),a+=r.byteLength),t||l<=a)do({cmd:o,size:l}=yield yield Z(h()));while(l<a);while(!t)}catch(u){(i=!0)&&(yield Z(c.cancel(u)))}finally{i===!1?yield Z(c.cancel()):s.locked&&c.releaseLock()}return yield Z(null)})}class zw{constructor(e){this.source=e,this.reader=null,this.reader=this.source.getReader(),this.reader.closed.catch(()=>{})}get closed(){return this.reader?this.reader.closed.catch(()=>{}):Promise.resolve()}releaseLock(){this.reader&&this.reader.releaseLock(),this.reader=null}cancel(e){return K(this,void 0,void 0,function*(){const{reader:t,source:i}=this;t&&(yield t.cancel(e).catch(()=>{})),i&&i.locked&&this.releaseLock()})}read(e){return K(this,void 0,void 0,function*(){if(e===0)return{done:this.reader==null,value:new Uint8Array(0)};const t=yield this.reader.read();return!t.done&&(t.value=ue(t)),t})}}const Ga=(s,e)=>{const t=n=>i([e,n]);let i;return[e,t,new Promise(n=>(i=n)&&s.once(e,t))]};function Hw(s){return Ri(this,arguments,function*(){const t=[];let i="error",n=!1,r=null,o,l,a=0,h=[],c;function u(){return o==="peek"?Bi(h,l)[0]:([c,h,a]=Bi(h,l),c)}if({cmd:o,size:l}=yield yield Z(null),s.isTTY)return yield yield Z(new Uint8Array(0)),yield Z(null);try{t[0]=Ga(s,"end"),t[1]=Ga(s,"error");do{if(t[2]=Ga(s,"readable"),[i,r]=yield Z(Promise.race(t.map(f=>f[2]))),i==="error")break;if((n=i==="end")||(Number.isFinite(l-a)?(c=ue(s.read(l-a)),c.byteLength<l-a&&(c=ue(s.read()))):c=ue(s.read()),c.byteLength>0&&(h.push(c),a+=c.byteLength)),n||l<=a)do({cmd:o,size:l}=yield yield Z(u()));while(l<a)}while(!n)}finally{yield Z(d(t,i==="error"?r:null))}return yield Z(null);function d(f,p){return c=h=null,new Promise((m,g)=>{for(const[b,v]of f)s.off(b,v);try{const b=s.destroy;b&&b.call(s,p),p=void 0}catch(b){p=b||p}finally{p!=null?g(p):m()}})}})}var Ze;(function(s){s[s.V1=0]="V1",s[s.V2=1]="V2",s[s.V3=2]="V3",s[s.V4=3]="V4",s[s.V5=4]="V5"})(Ze||(Ze={}));var pt;(function(s){s[s.Sparse=0]="Sparse",s[s.Dense=1]="Dense"})(pt||(pt={}));var kt;(function(s){s[s.HALF=0]="HALF",s[s.SINGLE=1]="SINGLE",s[s.DOUBLE=2]="DOUBLE"})(kt||(kt={}));var Ki;(function(s){s[s.DAY=0]="DAY",s[s.MILLISECOND=1]="MILLISECOND"})(Ki||(Ki={}));var Y;(function(s){s[s.SECOND=0]="SECOND",s[s.MILLISECOND=1]="MILLISECOND",s[s.MICROSECOND=2]="MICROSECOND",s[s.NANOSECOND=3]="NANOSECOND"})(Y||(Y={}));var ws;(function(s){s[s.YEAR_MONTH=0]="YEAR_MONTH",s[s.DAY_TIME=1]="DAY_TIME",s[s.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(ws||(ws={}));var fe;(function(s){s[s.NONE=0]="NONE",s[s.Schema=1]="Schema",s[s.DictionaryBatch=2]="DictionaryBatch",s[s.RecordBatch=3]="RecordBatch",s[s.Tensor=4]="Tensor",s[s.SparseTensor=5]="SparseTensor"})(fe||(fe={}));var y;(function(s){s[s.NONE=0]="NONE",s[s.Null=1]="Null",s[s.Int=2]="Int",s[s.Float=3]="Float",s[s.Binary=4]="Binary",s[s.Utf8=5]="Utf8",s[s.Bool=6]="Bool",s[s.Decimal=7]="Decimal",s[s.Date=8]="Date",s[s.Time=9]="Time",s[s.Timestamp=10]="Timestamp",s[s.Interval=11]="Interval",s[s.List=12]="List",s[s.Struct=13]="Struct",s[s.Union=14]="Union",s[s.FixedSizeBinary=15]="FixedSizeBinary",s[s.FixedSizeList=16]="FixedSizeList",s[s.Map=17]="Map",s[s.Duration=18]="Duration",s[s.Dictionary=-1]="Dictionary",s[s.Int8=-2]="Int8",s[s.Int16=-3]="Int16",s[s.Int32=-4]="Int32",s[s.Int64=-5]="Int64",s[s.Uint8=-6]="Uint8",s[s.Uint16=-7]="Uint16",s[s.Uint32=-8]="Uint32",s[s.Uint64=-9]="Uint64",s[s.Float16=-10]="Float16",s[s.Float32=-11]="Float32",s[s.Float64=-12]="Float64",s[s.DateDay=-13]="DateDay",s[s.DateMillisecond=-14]="DateMillisecond",s[s.TimestampSecond=-15]="TimestampSecond",s[s.TimestampMillisecond=-16]="TimestampMillisecond",s[s.TimestampMicrosecond=-17]="TimestampMicrosecond",s[s.TimestampNanosecond=-18]="TimestampNanosecond",s[s.TimeSecond=-19]="TimeSecond",s[s.TimeMillisecond=-20]="TimeMillisecond",s[s.TimeMicrosecond=-21]="TimeMicrosecond",s[s.TimeNanosecond=-22]="TimeNanosecond",s[s.DenseUnion=-23]="DenseUnion",s[s.SparseUnion=-24]="SparseUnion",s[s.IntervalDayTime=-25]="IntervalDayTime",s[s.IntervalYearMonth=-26]="IntervalYearMonth",s[s.DurationSecond=-27]="DurationSecond",s[s.DurationMillisecond=-28]="DurationMillisecond",s[s.DurationMicrosecond=-29]="DurationMicrosecond",s[s.DurationNanosecond=-30]="DurationNanosecond"})(y||(y={}));var Vi;(function(s){s[s.OFFSET=0]="OFFSET",s[s.DATA=1]="DATA",s[s.VALIDITY=2]="VALIDITY",s[s.TYPE=3]="TYPE"})(Vi||(Vi={}));const Vw=void 0;function Nr(s){if(s===null)return"null";if(s===Vw)return"undefined";switch(typeof s){case"number":return`${s}`;case"bigint":return`${s}`;case"string":return`"${s}"`}return typeof s[Symbol.toPrimitive]=="function"?s[Symbol.toPrimitive]("string"):ArrayBuffer.isView(s)?s instanceof BigInt64Array||s instanceof BigUint64Array?`[${[...s].map(e=>Nr(e))}]`:`[${s}]`:ArrayBuffer.isView(s)?`[${s}]`:JSON.stringify(s,(e,t)=>typeof t=="bigint"?`${t}`:t)}const Ww=Symbol.for("isArrowBigNum");function li(s,...e){return e.length===0?Object.setPrototypeOf(ye(this.TypedArray,s),this.constructor.prototype):Object.setPrototypeOf(new this.TypedArray(s,...e),this.constructor.prototype)}li.prototype[Ww]=!0;li.prototype.toJSON=function(){return`"${Hr(this)}"`};li.prototype.valueOf=function(){return Lp(this)};li.prototype.toString=function(){return Hr(this)};li.prototype[Symbol.toPrimitive]=function(s="default"){switch(s){case"number":return Lp(this);case"string":return Hr(this);case"default":return Uw(this)}return Hr(this)};function Dn(...s){return li.apply(this,s)}function An(...s){return li.apply(this,s)}function zr(...s){return li.apply(this,s)}Object.setPrototypeOf(Dn.prototype,Object.create(Int32Array.prototype));Object.setPrototypeOf(An.prototype,Object.create(Uint32Array.prototype));Object.setPrototypeOf(zr.prototype,Object.create(Uint32Array.prototype));Object.assign(Dn.prototype,li.prototype,{constructor:Dn,signed:!0,TypedArray:Int32Array,BigIntArray:BigInt64Array});Object.assign(An.prototype,li.prototype,{constructor:An,signed:!1,TypedArray:Uint32Array,BigIntArray:BigUint64Array});Object.assign(zr.prototype,li.prototype,{constructor:zr,signed:!0,TypedArray:Uint32Array,BigIntArray:BigUint64Array});function Lp(s){const{buffer:e,byteOffset:t,length:i,signed:n}=s,r=new BigUint64Array(e,t,i),o=n&&r.at(-1)&BigInt(1)<<BigInt(63);let l=BigInt(o?1:0),a=BigInt(0);if(o){for(const h of r)l+=~h*(BigInt(1)<<BigInt(32)*a++);l*=BigInt(-1)}else for(const h of r)l+=h*(BigInt(1)<<BigInt(32)*a++);return l}const Hr=s=>{if(s.byteLength===8)return`${new s.BigIntArray(s.buffer,s.byteOffset,1)[0]}`;if(!s.signed)return qa(s);let e=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2);if(new Int16Array([e.at(-1)])[0]>=0)return qa(s);e=e.slice();let i=1;for(let r=0;r<e.length;r++){const o=e[r],l=~o+i;e[r]=l,i&=o===0?1:0}return`-${qa(e)}`},Uw=s=>s.byteLength===8?new s.BigIntArray(s.buffer,s.byteOffset,1)[0]:Hr(s);function qa(s){let e="";const t=new Uint32Array(2);let i=new Uint16Array(s.buffer,s.byteOffset,s.byteLength/2);const n=new Uint32Array((i=new Uint16Array(i).reverse()).buffer);let r=-1;const o=i.length-1;do{for(t[0]=i[r=0];r<o;)i[r++]=t[1]=t[0]/10,t[0]=(t[0]-t[1]*10<<16)+i[r];i[r]=t[1]=t[0]/10,t[0]=t[0]-t[1]*10,e=`${t[0]}${e}`}while(n[0]||n[1]||n[2]||n[3]);return e??"0"}class Qc{static new(e,t){switch(t){case!0:return new Dn(e);case!1:return new An(e)}switch(e.constructor){case Int8Array:case Int16Array:case Int32Array:case BigInt64Array:return new Dn(e)}return e.byteLength===16?new zr(e):new An(e)}static signed(e){return new Dn(e)}static unsigned(e){return new An(e)}static decimal(e){return new zr(e)}constructor(e,t){return Qc.new(e,t)}}function ni(s){if(typeof s=="bigint"&&(s<Number.MIN_SAFE_INTEGER||s>Number.MAX_SAFE_INTEGER))throw new TypeError(`${s} is not safe to convert to a number.`);return Number(s)}var Ip,Bp,Fp,Pp,Np,zp,Hp,Vp,Wp,Up,jp,Gp,qp,$p,Kp,Yp,Qp,Jp,Xp,Zp;class B{static isNull(e){return(e==null?void 0:e.typeId)===y.Null}static isInt(e){return(e==null?void 0:e.typeId)===y.Int}static isFloat(e){return(e==null?void 0:e.typeId)===y.Float}static isBinary(e){return(e==null?void 0:e.typeId)===y.Binary}static isUtf8(e){return(e==null?void 0:e.typeId)===y.Utf8}static isBool(e){return(e==null?void 0:e.typeId)===y.Bool}static isDecimal(e){return(e==null?void 0:e.typeId)===y.Decimal}static isDate(e){return(e==null?void 0:e.typeId)===y.Date}static isTime(e){return(e==null?void 0:e.typeId)===y.Time}static isTimestamp(e){return(e==null?void 0:e.typeId)===y.Timestamp}static isInterval(e){return(e==null?void 0:e.typeId)===y.Interval}static isDuration(e){return(e==null?void 0:e.typeId)===y.Duration}static isList(e){return(e==null?void 0:e.typeId)===y.List}static isStruct(e){return(e==null?void 0:e.typeId)===y.Struct}static isUnion(e){return(e==null?void 0:e.typeId)===y.Union}static isFixedSizeBinary(e){return(e==null?void 0:e.typeId)===y.FixedSizeBinary}static isFixedSizeList(e){return(e==null?void 0:e.typeId)===y.FixedSizeList}static isMap(e){return(e==null?void 0:e.typeId)===y.Map}static isDictionary(e){return(e==null?void 0:e.typeId)===y.Dictionary}static isDenseUnion(e){return B.isUnion(e)&&e.mode===pt.Dense}static isSparseUnion(e){return B.isUnion(e)&&e.mode===pt.Sparse}get typeId(){return y.NONE}}Ip=Symbol.toStringTag;B[Ip]=(s=>(s.children=null,s.ArrayType=Array,s[Symbol.toStringTag]="DataType"))(B.prototype);let Cs=class extends B{toString(){return"Null"}get typeId(){return y.Null}};Bp=Symbol.toStringTag;Cs[Bp]=(s=>s[Symbol.toStringTag]="Null")(Cs.prototype);class Es extends B{constructor(e,t){super(),this.isSigned=e,this.bitWidth=t}get typeId(){return y.Int}get ArrayType(){switch(this.bitWidth){case 8:return this.isSigned?Int8Array:Uint8Array;case 16:return this.isSigned?Int16Array:Uint16Array;case 32:return this.isSigned?Int32Array:Uint32Array;case 64:return this.isSigned?BigInt64Array:BigUint64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}Fp=Symbol.toStringTag;Es[Fp]=(s=>(s.isSigned=null,s.bitWidth=null,s[Symbol.toStringTag]="Int"))(Es.prototype);class Vr extends Es{constructor(){super(!0,32)}get ArrayType(){return Int32Array}}Object.defineProperty(Vr.prototype,"ArrayType",{value:Int32Array});class Wr extends B{constructor(e){super(),this.precision=e}get typeId(){return y.Float}get ArrayType(){switch(this.precision){case kt.HALF:return Uint16Array;case kt.SINGLE:return Float32Array;case kt.DOUBLE:return Float64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}toString(){return`Float${this.precision<<5||16}`}}Pp=Symbol.toStringTag;Wr[Pp]=(s=>(s.precision=null,s[Symbol.toStringTag]="Float"))(Wr.prototype);let gl=class extends B{constructor(){super()}get typeId(){return y.Binary}toString(){return"Binary"}};Np=Symbol.toStringTag;gl[Np]=(s=>(s.ArrayType=Uint8Array,s[Symbol.toStringTag]="Binary"))(gl.prototype);let bl=class extends B{constructor(){super()}get typeId(){return y.Utf8}toString(){return"Utf8"}};zp=Symbol.toStringTag;bl[zp]=(s=>(s.ArrayType=Uint8Array,s[Symbol.toStringTag]="Utf8"))(bl.prototype);let yl=class extends B{constructor(){super()}get typeId(){return y.Bool}toString(){return"Bool"}};Hp=Symbol.toStringTag;yl[Hp]=(s=>(s.ArrayType=Uint8Array,s[Symbol.toStringTag]="Bool"))(yl.prototype);let vl=class extends B{constructor(e,t,i=128){super(),this.scale=e,this.precision=t,this.bitWidth=i}get typeId(){return y.Decimal}toString(){return`Decimal[${this.precision}e${this.scale>0?"+":""}${this.scale}]`}};Vp=Symbol.toStringTag;vl[Vp]=(s=>(s.scale=null,s.precision=null,s.ArrayType=Uint32Array,s[Symbol.toStringTag]="Decimal"))(vl.prototype);class wl extends B{constructor(e){super(),this.unit=e}get typeId(){return y.Date}toString(){return`Date${(this.unit+1)*32}<${Ki[this.unit]}>`}}Wp=Symbol.toStringTag;wl[Wp]=(s=>(s.unit=null,s.ArrayType=Int32Array,s[Symbol.toStringTag]="Date"))(wl.prototype);class Ur extends B{constructor(e,t){super(),this.unit=e,this.bitWidth=t}get typeId(){return y.Time}toString(){return`Time${this.bitWidth}<${Y[this.unit]}>`}get ArrayType(){switch(this.bitWidth){case 32:return Int32Array;case 64:return BigInt64Array}throw new Error(`Unrecognized ${this[Symbol.toStringTag]} type`)}}Up=Symbol.toStringTag;Ur[Up]=(s=>(s.unit=null,s.bitWidth=null,s[Symbol.toStringTag]="Time"))(Ur.prototype);class Cl extends B{constructor(e,t){super(),this.unit=e,this.timezone=t}get typeId(){return y.Timestamp}toString(){return`Timestamp<${Y[this.unit]}${this.timezone?`, ${this.timezone}`:""}>`}}jp=Symbol.toStringTag;Cl[jp]=(s=>(s.unit=null,s.timezone=null,s.ArrayType=Int32Array,s[Symbol.toStringTag]="Timestamp"))(Cl.prototype);class El extends B{constructor(e){super(),this.unit=e}get typeId(){return y.Interval}toString(){return`Interval<${ws[this.unit]}>`}}Gp=Symbol.toStringTag;El[Gp]=(s=>(s.unit=null,s.ArrayType=Int32Array,s[Symbol.toStringTag]="Interval"))(El.prototype);let xl=class extends B{constructor(e){super(),this.unit=e}get typeId(){return y.Duration}toString(){return`Duration<${Y[this.unit]}>`}};qp=Symbol.toStringTag;xl[qp]=(s=>(s.unit=null,s.ArrayType=BigInt64Array,s[Symbol.toStringTag]="Duration"))(xl.prototype);let kl=class extends B{constructor(e){super(),this.children=[e]}get typeId(){return y.List}toString(){return`List<${this.valueType}>`}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}};$p=Symbol.toStringTag;kl[$p]=(s=>(s.children=null,s[Symbol.toStringTag]="List"))(kl.prototype);class ht extends B{constructor(e){super(),this.children=e}get typeId(){return y.Struct}toString(){return`Struct<{${this.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}Kp=Symbol.toStringTag;ht[Kp]=(s=>(s.children=null,s[Symbol.toStringTag]="Struct"))(ht.prototype);class Sl extends B{constructor(e,t,i){super(),this.mode=e,this.children=i,this.typeIds=t=Int32Array.from(t),this.typeIdToChildIndex=t.reduce((n,r,o)=>(n[r]=o)&&n||n,Object.create(null))}get typeId(){return y.Union}toString(){return`${this[Symbol.toStringTag]}<${this.children.map(e=>`${e.type}`).join(" | ")}>`}}Yp=Symbol.toStringTag;Sl[Yp]=(s=>(s.mode=null,s.typeIds=null,s.children=null,s.typeIdToChildIndex=null,s.ArrayType=Int8Array,s[Symbol.toStringTag]="Union"))(Sl.prototype);let _l=class extends B{constructor(e){super(),this.byteWidth=e}get typeId(){return y.FixedSizeBinary}toString(){return`FixedSizeBinary[${this.byteWidth}]`}};Qp=Symbol.toStringTag;_l[Qp]=(s=>(s.byteWidth=null,s.ArrayType=Uint8Array,s[Symbol.toStringTag]="FixedSizeBinary"))(_l.prototype);let Rl=class extends B{constructor(e,t){super(),this.listSize=e,this.children=[t]}get typeId(){return y.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get ArrayType(){return this.valueType.ArrayType}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}};Jp=Symbol.toStringTag;Rl[Jp]=(s=>(s.children=null,s.listSize=null,s[Symbol.toStringTag]="FixedSizeList"))(Rl.prototype);class Tl extends B{constructor(e,t=!1){var i,n,r;if(super(),this.children=[e],this.keysSorted=t,e&&(e.name="entries",!((i=e==null?void 0:e.type)===null||i===void 0)&&i.children)){const o=(n=e==null?void 0:e.type)===null||n===void 0?void 0:n.children[0];o&&(o.name="key");const l=(r=e==null?void 0:e.type)===null||r===void 0?void 0:r.children[1];l&&(l.name="value")}}get typeId(){return y.Map}get keyType(){return this.children[0].type.children[0].type}get valueType(){return this.children[0].type.children[1].type}get childType(){return this.children[0].type}toString(){return`Map<{${this.children[0].type.children.map(e=>`${e.name}:${e.type}`).join(", ")}}>`}}Xp=Symbol.toStringTag;Tl[Xp]=(s=>(s.children=null,s.keysSorted=null,s[Symbol.toStringTag]="Map_"))(Tl.prototype);const jw=(s=>()=>++s)(-1);class Wn extends B{constructor(e,t,i,n){super(),this.indices=t,this.dictionary=e,this.isOrdered=n||!1,this.id=i==null?jw():ni(i)}get typeId(){return y.Dictionary}get children(){return this.dictionary.children}get valueType(){return this.dictionary}get ArrayType(){return this.dictionary.ArrayType}toString(){return`Dictionary<${this.indices}, ${this.dictionary}>`}}Zp=Symbol.toStringTag;Wn[Zp]=(s=>(s.id=null,s.indices=null,s.isOrdered=null,s.dictionary=null,s[Symbol.toStringTag]="Dictionary"))(Wn.prototype);function Wi(s){const e=s;switch(s.typeId){case y.Decimal:return s.bitWidth/32;case y.Timestamp:return 2;case y.Date:return 1+e.unit;case y.Interval:return 1+e.unit;case y.FixedSizeList:return e.listSize;case y.FixedSizeBinary:return e.byteWidth;default:return 1}}class te{visitMany(e,...t){return e.map((i,n)=>this.visit(i,...t.map(r=>r[n])))}visit(...e){return this.getVisitFn(e[0],!1).apply(this,e)}getVisitFn(e,t=!0){return Gw(this,e,t)}getVisitFnByTypeId(e,t=!0){return vn(this,e,t)}visitNull(e,...t){return null}visitBool(e,...t){return null}visitInt(e,...t){return null}visitFloat(e,...t){return null}visitUtf8(e,...t){return null}visitBinary(e,...t){return null}visitFixedSizeBinary(e,...t){return null}visitDate(e,...t){return null}visitTimestamp(e,...t){return null}visitTime(e,...t){return null}visitDecimal(e,...t){return null}visitList(e,...t){return null}visitStruct(e,...t){return null}visitUnion(e,...t){return null}visitDictionary(e,...t){return null}visitInterval(e,...t){return null}visitDuration(e,...t){return null}visitFixedSizeList(e,...t){return null}visitMap(e,...t){return null}}function Gw(s,e,t=!0){return typeof e=="number"?vn(s,e,t):typeof e=="string"&&e in y?vn(s,y[e],t):e&&e instanceof B?vn(s,rd(e),t):e!=null&&e.type&&e.type instanceof B?vn(s,rd(e.type),t):vn(s,y.NONE,t)}function vn(s,e,t=!0){let i=null;switch(e){case y.Null:i=s.visitNull;break;case y.Bool:i=s.visitBool;break;case y.Int:i=s.visitInt;break;case y.Int8:i=s.visitInt8||s.visitInt;break;case y.Int16:i=s.visitInt16||s.visitInt;break;case y.Int32:i=s.visitInt32||s.visitInt;break;case y.Int64:i=s.visitInt64||s.visitInt;break;case y.Uint8:i=s.visitUint8||s.visitInt;break;case y.Uint16:i=s.visitUint16||s.visitInt;break;case y.Uint32:i=s.visitUint32||s.visitInt;break;case y.Uint64:i=s.visitUint64||s.visitInt;break;case y.Float:i=s.visitFloat;break;case y.Float16:i=s.visitFloat16||s.visitFloat;break;case y.Float32:i=s.visitFloat32||s.visitFloat;break;case y.Float64:i=s.visitFloat64||s.visitFloat;break;case y.Utf8:i=s.visitUtf8;break;case y.Binary:i=s.visitBinary;break;case y.FixedSizeBinary:i=s.visitFixedSizeBinary;break;case y.Date:i=s.visitDate;break;case y.DateDay:i=s.visitDateDay||s.visitDate;break;case y.DateMillisecond:i=s.visitDateMillisecond||s.visitDate;break;case y.Timestamp:i=s.visitTimestamp;break;case y.TimestampSecond:i=s.visitTimestampSecond||s.visitTimestamp;break;case y.TimestampMillisecond:i=s.visitTimestampMillisecond||s.visitTimestamp;break;case y.TimestampMicrosecond:i=s.visitTimestampMicrosecond||s.visitTimestamp;break;case y.TimestampNanosecond:i=s.visitTimestampNanosecond||s.visitTimestamp;break;case y.Time:i=s.visitTime;break;case y.TimeSecond:i=s.visitTimeSecond||s.visitTime;break;case y.TimeMillisecond:i=s.visitTimeMillisecond||s.visitTime;break;case y.TimeMicrosecond:i=s.visitTimeMicrosecond||s.visitTime;break;case y.TimeNanosecond:i=s.visitTimeNanosecond||s.visitTime;break;case y.Decimal:i=s.visitDecimal;break;case y.List:i=s.visitList;break;case y.Struct:i=s.visitStruct;break;case y.Union:i=s.visitUnion;break;case y.DenseUnion:i=s.visitDenseUnion||s.visitUnion;break;case y.SparseUnion:i=s.visitSparseUnion||s.visitUnion;break;case y.Dictionary:i=s.visitDictionary;break;case y.Interval:i=s.visitInterval;break;case y.IntervalDayTime:i=s.visitIntervalDayTime||s.visitInterval;break;case y.IntervalYearMonth:i=s.visitIntervalYearMonth||s.visitInterval;break;case y.Duration:i=s.visitDuration;break;case y.DurationSecond:i=s.visitDurationSecond||s.visitDuration;break;case y.DurationMillisecond:i=s.visitDurationMillisecond||s.visitDuration;break;case y.DurationMicrosecond:i=s.visitDurationMicrosecond||s.visitDuration;break;case y.DurationNanosecond:i=s.visitDurationNanosecond||s.visitDuration;break;case y.FixedSizeList:i=s.visitFixedSizeList;break;case y.Map:i=s.visitMap;break}if(typeof i=="function")return i;if(!t)return()=>null;throw new Error(`Unrecognized type '${y[e]}'`)}function rd(s){switch(s.typeId){case y.Null:return y.Null;case y.Int:{const{bitWidth:e,isSigned:t}=s;switch(e){case 8:return t?y.Int8:y.Uint8;case 16:return t?y.Int16:y.Uint16;case 32:return t?y.Int32:y.Uint32;case 64:return t?y.Int64:y.Uint64}return y.Int}case y.Float:switch(s.precision){case kt.HALF:return y.Float16;case kt.SINGLE:return y.Float32;case kt.DOUBLE:return y.Float64}return y.Float;case y.Binary:return y.Binary;case y.Utf8:return y.Utf8;case y.Bool:return y.Bool;case y.Decimal:return y.Decimal;case y.Time:switch(s.unit){case Y.SECOND:return y.TimeSecond;case Y.MILLISECOND:return y.TimeMillisecond;case Y.MICROSECOND:return y.TimeMicrosecond;case Y.NANOSECOND:return y.TimeNanosecond}return y.Time;case y.Timestamp:switch(s.unit){case Y.SECOND:return y.TimestampSecond;case Y.MILLISECOND:return y.TimestampMillisecond;case Y.MICROSECOND:return y.TimestampMicrosecond;case Y.NANOSECOND:return y.TimestampNanosecond}return y.Timestamp;case y.Date:switch(s.unit){case Ki.DAY:return y.DateDay;case Ki.MILLISECOND:return y.DateMillisecond}return y.Date;case y.Interval:switch(s.unit){case ws.DAY_TIME:return y.IntervalDayTime;case ws.YEAR_MONTH:return y.IntervalYearMonth}return y.Interval;case y.Duration:switch(s.unit){case Y.SECOND:return y.DurationSecond;case Y.MILLISECOND:return y.DurationMillisecond;case Y.MICROSECOND:return y.DurationMicrosecond;case Y.NANOSECOND:return y.DurationNanosecond}return y.Duration;case y.Map:return y.Map;case y.List:return y.List;case y.Struct:return y.Struct;case y.Union:switch(s.mode){case pt.Dense:return y.DenseUnion;case pt.Sparse:return y.SparseUnion}return y.Union;case y.FixedSizeBinary:return y.FixedSizeBinary;case y.FixedSizeList:return y.FixedSizeList;case y.Dictionary:return y.Dictionary}throw new Error(`Unrecognized type '${y[s.typeId]}'`)}te.prototype.visitInt8=null;te.prototype.visitInt16=null;te.prototype.visitInt32=null;te.prototype.visitInt64=null;te.prototype.visitUint8=null;te.prototype.visitUint16=null;te.prototype.visitUint32=null;te.prototype.visitUint64=null;te.prototype.visitFloat16=null;te.prototype.visitFloat32=null;te.prototype.visitFloat64=null;te.prototype.visitDateDay=null;te.prototype.visitDateMillisecond=null;te.prototype.visitTimestampSecond=null;te.prototype.visitTimestampMillisecond=null;te.prototype.visitTimestampMicrosecond=null;te.prototype.visitTimestampNanosecond=null;te.prototype.visitTimeSecond=null;te.prototype.visitTimeMillisecond=null;te.prototype.visitTimeMicrosecond=null;te.prototype.visitTimeNanosecond=null;te.prototype.visitDenseUnion=null;te.prototype.visitSparseUnion=null;te.prototype.visitIntervalDayTime=null;te.prototype.visitIntervalYearMonth=null;te.prototype.visitDuration=null;te.prototype.visitDurationSecond=null;te.prototype.visitDurationMillisecond=null;te.prototype.visitDurationMicrosecond=null;te.prototype.visitDurationNanosecond=null;const em=new Float64Array(1),bn=new Uint32Array(em.buffer);function tm(s){const e=(s&31744)>>10,t=(s&1023)/1024,i=Math.pow(-1,(s&32768)>>15);switch(e){case 31:return i*(t?Number.NaN:1/0);case 0:return i*(t?6103515625e-14*t:0)}return i*Math.pow(2,e-15)*(1+t)}function qw(s){if(s!==s)return 32256;em[0]=s;const e=(bn[1]&2147483648)>>16&65535;let t=bn[1]&2146435072,i=0;return t>=1089470464?bn[0]>0?t=31744:(t=(t&2080374784)>>16,i=(bn[1]&1048575)>>10):t<=1056964608?(i=1048576+(bn[1]&1048575),i=1048576+(i<<(t>>20)-998)>>21,t=0):(t=t-1056964608>>10,i=(bn[1]&1048575)+512>>10),e|t|i&65535}class U extends te{}function $(s){return(e,t,i)=>{if(e.setValid(t,i!=null))return s(e,t,i)}}const $w=(s,e,t)=>{s[e]=Math.trunc(t/864e5)},Jc=(s,e,t)=>{s[e]=Math.trunc(t%4294967296),s[e+1]=Math.trunc(t/4294967296)},Kw=(s,e,t)=>{s[e]=Math.trunc(t*1e3%4294967296),s[e+1]=Math.trunc(t*1e3/4294967296)},Yw=(s,e,t)=>{s[e]=Math.trunc(t*1e6%4294967296),s[e+1]=Math.trunc(t*1e6/4294967296)},im=(s,e,t,i)=>{if(t+1<e.length){const{[t]:n,[t+1]:r}=e;s.set(i.subarray(0,r-n),n)}},Qw=({offset:s,values:e},t,i)=>{const n=s+t;i?e[n>>3]|=1<<n%8:e[n>>3]&=~(1<<n%8)},Zi=({values:s},e,t)=>{s[e]=t},Xc=({values:s},e,t)=>{s[e]=t},sm=({values:s},e,t)=>{s[e]=qw(t)},Jw=(s,e,t)=>{switch(s.type.precision){case kt.HALF:return sm(s,e,t);case kt.SINGLE:case kt.DOUBLE:return Xc(s,e,t)}},nm=({values:s},e,t)=>{$w(s,e,t.valueOf())},rm=({values:s},e,t)=>{Jc(s,e*2,t.valueOf())},Xw=({stride:s,values:e},t,i)=>{e.set(i.subarray(0,s),s*t)},Zw=({values:s,valueOffsets:e},t,i)=>im(s,e,t,i),e0=({values:s,valueOffsets:e},t,i)=>{im(s,e,t,$c(i))},t0=(s,e,t)=>{s.type.unit===Ki.DAY?nm(s,e,t):rm(s,e,t)},om=({values:s},e,t)=>Jc(s,e*2,t/1e3),lm=({values:s},e,t)=>Jc(s,e*2,t),am=({values:s},e,t)=>Kw(s,e*2,t),hm=({values:s},e,t)=>Yw(s,e*2,t),i0=(s,e,t)=>{switch(s.type.unit){case Y.SECOND:return om(s,e,t);case Y.MILLISECOND:return lm(s,e,t);case Y.MICROSECOND:return am(s,e,t);case Y.NANOSECOND:return hm(s,e,t)}},cm=({values:s},e,t)=>{s[e]=t},um=({values:s},e,t)=>{s[e]=t},dm=({values:s},e,t)=>{s[e]=t},fm=({values:s},e,t)=>{s[e]=t},s0=(s,e,t)=>{switch(s.type.unit){case Y.SECOND:return cm(s,e,t);case Y.MILLISECOND:return um(s,e,t);case Y.MICROSECOND:return dm(s,e,t);case Y.NANOSECOND:return fm(s,e,t)}},n0=({values:s,stride:e},t,i)=>{s.set(i.subarray(0,e),e*t)},r0=(s,e,t)=>{const i=s.children[0],n=s.valueOffsets,r=Xt.getVisitFn(i);if(Array.isArray(t))for(let o=-1,l=n[e],a=n[e+1];l<a;)r(i,l++,t[++o]);else for(let o=-1,l=n[e],a=n[e+1];l<a;)r(i,l++,t.get(++o))},o0=(s,e,t)=>{const i=s.children[0],{valueOffsets:n}=s,r=Xt.getVisitFn(i);let{[e]:o,[e+1]:l}=n;const a=t instanceof Map?t.entries():Object.entries(t);for(const h of a)if(r(i,o,h),++o>=l)break},l0=(s,e)=>(t,i,n,r)=>i&&t(i,s,e[r]),a0=(s,e)=>(t,i,n,r)=>i&&t(i,s,e.get(r)),h0=(s,e)=>(t,i,n,r)=>i&&t(i,s,e.get(n.name)),c0=(s,e)=>(t,i,n,r)=>i&&t(i,s,e[n.name]),u0=(s,e,t)=>{const i=s.type.children.map(r=>Xt.getVisitFn(r.type)),n=t instanceof Map?h0(e,t):t instanceof pe?a0(e,t):Array.isArray(t)?l0(e,t):c0(e,t);s.type.children.forEach((r,o)=>n(i[o],s.children[o],r,o))},d0=(s,e,t)=>{s.type.mode===pt.Dense?pm(s,e,t):mm(s,e,t)},pm=(s,e,t)=>{const i=s.type.typeIdToChildIndex[s.typeIds[e]],n=s.children[i];Xt.visit(n,s.valueOffsets[e],t)},mm=(s,e,t)=>{const i=s.type.typeIdToChildIndex[s.typeIds[e]],n=s.children[i];Xt.visit(n,e,t)},f0=(s,e,t)=>{var i;(i=s.dictionary)===null||i===void 0||i.set(s.values[e],t)},p0=(s,e,t)=>{s.type.unit===ws.DAY_TIME?gm(s,e,t):bm(s,e,t)},gm=({values:s},e,t)=>{s.set(t.subarray(0,2),2*e)},bm=({values:s},e,t)=>{s[e]=t[0]*12+t[1]%12},ym=({values:s},e,t)=>{s[e]=t},vm=({values:s},e,t)=>{s[e]=t},wm=({values:s},e,t)=>{s[e]=t},Cm=({values:s},e,t)=>{s[e]=t},m0=(s,e,t)=>{switch(s.type.unit){case Y.SECOND:return ym(s,e,t);case Y.MILLISECOND:return vm(s,e,t);case Y.MICROSECOND:return wm(s,e,t);case Y.NANOSECOND:return Cm(s,e,t)}},g0=(s,e,t)=>{const{stride:i}=s,n=s.children[0],r=Xt.getVisitFn(n);if(Array.isArray(t))for(let o=-1,l=e*i;++o<i;)r(n,l+o,t[o]);else for(let o=-1,l=e*i;++o<i;)r(n,l+o,t.get(o))};U.prototype.visitBool=$(Qw);U.prototype.visitInt=$(Zi);U.prototype.visitInt8=$(Zi);U.prototype.visitInt16=$(Zi);U.prototype.visitInt32=$(Zi);U.prototype.visitInt64=$(Zi);U.prototype.visitUint8=$(Zi);U.prototype.visitUint16=$(Zi);U.prototype.visitUint32=$(Zi);U.prototype.visitUint64=$(Zi);U.prototype.visitFloat=$(Jw);U.prototype.visitFloat16=$(sm);U.prototype.visitFloat32=$(Xc);U.prototype.visitFloat64=$(Xc);U.prototype.visitUtf8=$(e0);U.prototype.visitBinary=$(Zw);U.prototype.visitFixedSizeBinary=$(Xw);U.prototype.visitDate=$(t0);U.prototype.visitDateDay=$(nm);U.prototype.visitDateMillisecond=$(rm);U.prototype.visitTimestamp=$(i0);U.prototype.visitTimestampSecond=$(om);U.prototype.visitTimestampMillisecond=$(lm);U.prototype.visitTimestampMicrosecond=$(am);U.prototype.visitTimestampNanosecond=$(hm);U.prototype.visitTime=$(s0);U.prototype.visitTimeSecond=$(cm);U.prototype.visitTimeMillisecond=$(um);U.prototype.visitTimeMicrosecond=$(dm);U.prototype.visitTimeNanosecond=$(fm);U.prototype.visitDecimal=$(n0);U.prototype.visitList=$(r0);U.prototype.visitStruct=$(u0);U.prototype.visitUnion=$(d0);U.prototype.visitDenseUnion=$(pm);U.prototype.visitSparseUnion=$(mm);U.prototype.visitDictionary=$(f0);U.prototype.visitInterval=$(p0);U.prototype.visitIntervalDayTime=$(gm);U.prototype.visitIntervalYearMonth=$(bm);U.prototype.visitDuration=$(m0);U.prototype.visitDurationSecond=$(ym);U.prototype.visitDurationMillisecond=$(vm);U.prototype.visitDurationMicrosecond=$(wm);U.prototype.visitDurationNanosecond=$(Cm);U.prototype.visitFixedSizeList=$(g0);U.prototype.visitMap=$(o0);const Xt=new U,ei=Symbol.for("parent"),On=Symbol.for("rowIndex");class Zc{constructor(e,t){return this[ei]=e,this[On]=t,new Proxy(this,new y0)}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[On],t=this[ei],i=t.type.children,n={};for(let r=-1,o=i.length;++r<o;)n[i[r].name]=_t.visit(t.children[r],e);return n}toString(){return`{${[...this].map(([e,t])=>`${Nr(e)}: ${Nr(t)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}[Symbol.iterator](){return new b0(this[ei],this[On])}}class b0{constructor(e,t){this.childIndex=0,this.children=e.children,this.rowIndex=t,this.childFields=e.type.children,this.numChildren=this.childFields.length}[Symbol.iterator](){return this}next(){const e=this.childIndex;return e<this.numChildren?(this.childIndex=e+1,{done:!1,value:[this.childFields[e].name,_t.visit(this.children[e],this.rowIndex)]}):{done:!0,value:null}}}Object.defineProperties(Zc.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[ei]:{writable:!0,enumerable:!1,configurable:!1,value:null},[On]:{writable:!0,enumerable:!1,configurable:!1,value:-1}});class y0{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[ei].type.children.map(t=>t.name)}has(e,t){return e[ei].type.children.findIndex(i=>i.name===t)!==-1}getOwnPropertyDescriptor(e,t){if(e[ei].type.children.findIndex(i=>i.name===t)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,t){if(Reflect.has(e,t))return e[t];const i=e[ei].type.children.findIndex(n=>n.name===t);if(i!==-1){const n=_t.visit(e[ei].children[i],e[On]);return Reflect.set(e,t,n),n}}set(e,t,i){const n=e[ei].type.children.findIndex(r=>r.name===t);return n!==-1?(Xt.visit(e[ei].children[n],e[On],i),Reflect.set(e,t,i)):Reflect.has(e,t)||typeof t=="symbol"?Reflect.set(e,t,i):!1}}class z extends te{}function j(s){return(e,t)=>e.getValid(t)?s(e,t):null}const v0=(s,e)=>864e5*s[e],eu=(s,e)=>4294967296*s[e+1]+(s[e]>>>0),w0=(s,e)=>4294967296*(s[e+1]/1e3)+(s[e]>>>0)/1e3,C0=(s,e)=>4294967296*(s[e+1]/1e6)+(s[e]>>>0)/1e6,Em=s=>new Date(s),E0=(s,e)=>Em(v0(s,e)),x0=(s,e)=>Em(eu(s,e)),k0=(s,e)=>null,xm=(s,e,t)=>{if(t+1>=e.length)return null;const i=e[t],n=e[t+1];return s.subarray(i,n)},S0=({offset:s,values:e},t)=>{const i=s+t;return(e[i>>3]&1<<i%8)!==0},km=({values:s},e)=>E0(s,e),Sm=({values:s},e)=>x0(s,e*2),Ls=({stride:s,values:e},t)=>e[s*t],_0=({stride:s,values:e},t)=>tm(e[s*t]),_m=({values:s},e)=>s[e],R0=({stride:s,values:e},t)=>e.subarray(s*t,s*(t+1)),T0=({values:s,valueOffsets:e},t)=>xm(s,e,t),M0=({values:s,valueOffsets:e},t)=>{const i=xm(s,e,t);return i!==null?Ah(i):null},D0=({values:s},e)=>s[e],A0=({type:s,values:e},t)=>s.precision!==kt.HALF?e[t]:tm(e[t]),O0=(s,e)=>s.type.unit===Ki.DAY?km(s,e):Sm(s,e),Rm=({values:s},e)=>1e3*eu(s,e*2),Tm=({values:s},e)=>eu(s,e*2),Mm=({values:s},e)=>w0(s,e*2),Dm=({values:s},e)=>C0(s,e*2),L0=(s,e)=>{switch(s.type.unit){case Y.SECOND:return Rm(s,e);case Y.MILLISECOND:return Tm(s,e);case Y.MICROSECOND:return Mm(s,e);case Y.NANOSECOND:return Dm(s,e)}},Am=({values:s},e)=>s[e],Om=({values:s},e)=>s[e],Lm=({values:s},e)=>s[e],Im=({values:s},e)=>s[e],I0=(s,e)=>{switch(s.type.unit){case Y.SECOND:return Am(s,e);case Y.MILLISECOND:return Om(s,e);case Y.MICROSECOND:return Lm(s,e);case Y.NANOSECOND:return Im(s,e)}},B0=({values:s,stride:e},t)=>Qc.decimal(s.subarray(e*t,e*(t+1))),F0=(s,e)=>{const{valueOffsets:t,stride:i,children:n}=s,{[e*i]:r,[e*i+1]:o}=t,a=n[0].slice(r,o-r);return new pe([a])},P0=(s,e)=>{const{valueOffsets:t,children:i}=s,{[e]:n,[e+1]:r}=t,o=i[0];return new tu(o.slice(n,r-n))},N0=(s,e)=>new Zc(s,e),z0=(s,e)=>s.type.mode===pt.Dense?Bm(s,e):Fm(s,e),Bm=(s,e)=>{const t=s.type.typeIdToChildIndex[s.typeIds[e]],i=s.children[t];return _t.visit(i,s.valueOffsets[e])},Fm=(s,e)=>{const t=s.type.typeIdToChildIndex[s.typeIds[e]],i=s.children[t];return _t.visit(i,e)},H0=(s,e)=>{var t;return(t=s.dictionary)===null||t===void 0?void 0:t.get(s.values[e])},V0=(s,e)=>s.type.unit===ws.DAY_TIME?Pm(s,e):Nm(s,e),Pm=({values:s},e)=>s.subarray(2*e,2*(e+1)),Nm=({values:s},e)=>{const t=s[e],i=new Int32Array(2);return i[0]=Math.trunc(t/12),i[1]=Math.trunc(t%12),i},zm=({values:s},e)=>s[e],Hm=({values:s},e)=>s[e],Vm=({values:s},e)=>s[e],Wm=({values:s},e)=>s[e],W0=(s,e)=>{switch(s.type.unit){case Y.SECOND:return zm(s,e);case Y.MILLISECOND:return Hm(s,e);case Y.MICROSECOND:return Vm(s,e);case Y.NANOSECOND:return Wm(s,e)}},U0=(s,e)=>{const{stride:t,children:i}=s,r=i[0].slice(e*t,t);return new pe([r])};z.prototype.visitNull=j(k0);z.prototype.visitBool=j(S0);z.prototype.visitInt=j(D0);z.prototype.visitInt8=j(Ls);z.prototype.visitInt16=j(Ls);z.prototype.visitInt32=j(Ls);z.prototype.visitInt64=j(_m);z.prototype.visitUint8=j(Ls);z.prototype.visitUint16=j(Ls);z.prototype.visitUint32=j(Ls);z.prototype.visitUint64=j(_m);z.prototype.visitFloat=j(A0);z.prototype.visitFloat16=j(_0);z.prototype.visitFloat32=j(Ls);z.prototype.visitFloat64=j(Ls);z.prototype.visitUtf8=j(M0);z.prototype.visitBinary=j(T0);z.prototype.visitFixedSizeBinary=j(R0);z.prototype.visitDate=j(O0);z.prototype.visitDateDay=j(km);z.prototype.visitDateMillisecond=j(Sm);z.prototype.visitTimestamp=j(L0);z.prototype.visitTimestampSecond=j(Rm);z.prototype.visitTimestampMillisecond=j(Tm);z.prototype.visitTimestampMicrosecond=j(Mm);z.prototype.visitTimestampNanosecond=j(Dm);z.prototype.visitTime=j(I0);z.prototype.visitTimeSecond=j(Am);z.prototype.visitTimeMillisecond=j(Om);z.prototype.visitTimeMicrosecond=j(Lm);z.prototype.visitTimeNanosecond=j(Im);z.prototype.visitDecimal=j(B0);z.prototype.visitList=j(F0);z.prototype.visitStruct=j(N0);z.prototype.visitUnion=j(z0);z.prototype.visitDenseUnion=j(Bm);z.prototype.visitSparseUnion=j(Fm);z.prototype.visitDictionary=j(H0);z.prototype.visitInterval=j(V0);z.prototype.visitIntervalDayTime=j(Pm);z.prototype.visitIntervalYearMonth=j(Nm);z.prototype.visitDuration=j(W0);z.prototype.visitDurationSecond=j(zm);z.prototype.visitDurationMillisecond=j(Hm);z.prototype.visitDurationMicrosecond=j(Vm);z.prototype.visitDurationNanosecond=j(Wm);z.prototype.visitFixedSizeList=j(U0);z.prototype.visitMap=j(P0);const _t=new z,yi=Symbol.for("keys"),Ln=Symbol.for("vals");class tu{constructor(e){return this[yi]=new pe([e.children[0]]).memoize(),this[Ln]=e.children[1],new Proxy(this,new G0)}[Symbol.iterator](){return new j0(this[yi],this[Ln])}get size(){return this[yi].length}toArray(){return Object.values(this.toJSON())}toJSON(){const e=this[yi],t=this[Ln],i={};for(let n=-1,r=e.length;++n<r;)i[e.get(n)]=_t.visit(t,n);return i}toString(){return`{${[...this].map(([e,t])=>`${Nr(e)}: ${Nr(t)}`).join(", ")}}`}[Symbol.for("nodejs.util.inspect.custom")](){return this.toString()}}class j0{constructor(e,t){this.keys=e,this.vals=t,this.keyIndex=0,this.numKeys=e.length}[Symbol.iterator](){return this}next(){const e=this.keyIndex;return e===this.numKeys?{done:!0,value:null}:(this.keyIndex++,{done:!1,value:[this.keys.get(e),_t.visit(this.vals,e)]})}}class G0{isExtensible(){return!1}deleteProperty(){return!1}preventExtensions(){return!0}ownKeys(e){return e[yi].toArray().map(String)}has(e,t){return e[yi].includes(t)}getOwnPropertyDescriptor(e,t){if(e[yi].indexOf(t)!==-1)return{writable:!0,enumerable:!0,configurable:!0}}get(e,t){if(Reflect.has(e,t))return e[t];const i=e[yi].indexOf(t);if(i!==-1){const n=_t.visit(Reflect.get(e,Ln),i);return Reflect.set(e,t,n),n}}set(e,t,i){const n=e[yi].indexOf(t);return n!==-1?(Xt.visit(Reflect.get(e,Ln),n,i),Reflect.set(e,t,i)):Reflect.has(e,t)?Reflect.set(e,t,i):!1}}Object.defineProperties(tu.prototype,{[Symbol.toStringTag]:{enumerable:!1,configurable:!1,value:"Row"},[yi]:{writable:!0,enumerable:!1,configurable:!1,value:null},[Ln]:{writable:!0,enumerable:!1,configurable:!1,value:null}});let od;function Um(s,e,t,i){const{length:n=0}=s;let r=typeof e!="number"?0:e,o=typeof t!="number"?n:t;return r<0&&(r=(r%n+n)%n),o<0&&(o=(o%n+n)%n),o<r&&(od=r,r=o,o=od),o>n&&(o=n),i?i(s,r,o):[r,o]}const ld=s=>s!==s;function rr(s){if(typeof s!=="object"||s===null)return ld(s)?ld:t=>t===s;if(s instanceof Date){const t=s.valueOf();return i=>i instanceof Date?i.valueOf()===t:!1}return ArrayBuffer.isView(s)?t=>t?Bw(s,t):!1:s instanceof Map?$0(s):Array.isArray(s)?q0(s):s instanceof pe?K0(s):Y0(s,!0)}function q0(s){const e=[];for(let t=-1,i=s.length;++t<i;)e[t]=rr(s[t]);return Ca(e)}function $0(s){let e=-1;const t=[];for(const i of s.values())t[++e]=rr(i);return Ca(t)}function K0(s){const e=[];for(let t=-1,i=s.length;++t<i;)e[t]=rr(s.get(t));return Ca(e)}function Y0(s,e=!1){const t=Object.keys(s);if(!e&&t.length===0)return()=>!1;const i=[];for(let n=-1,r=t.length;++n<r;)i[n]=rr(s[t[n]]);return Ca(i,t)}function Ca(s,e){return t=>{if(!t||typeof t!="object")return!1;switch(t.constructor){case Array:return Q0(s,t);case Map:return ad(s,t,t.keys());case tu:case Zc:case Object:case void 0:return ad(s,t,e||Object.keys(t))}return t instanceof pe?J0(s,t):!1}}function Q0(s,e){const t=s.length;if(e.length!==t)return!1;for(let i=-1;++i<t;)if(!s[i](e[i]))return!1;return!0}function J0(s,e){const t=s.length;if(e.length!==t)return!1;for(let i=-1;++i<t;)if(!s[i](e.get(i)))return!1;return!0}function ad(s,e,t){const i=t[Symbol.iterator](),n=e instanceof Map?e.keys():Object.keys(e)[Symbol.iterator](),r=e instanceof Map?e.values():Object.values(e)[Symbol.iterator]();let o=0;const l=s.length;let a=r.next(),h=i.next(),c=n.next();for(;o<l&&!h.done&&!c.done&&!a.done&&!(h.value!==c.value||!s[o](a.value));++o,h=i.next(),c=n.next(),a=r.next());return o===l&&h.done&&c.done&&a.done?!0:(i.return&&i.return(),n.return&&n.return(),r.return&&r.return(),!1)}function jm(s,e,t,i){return(t&1<<i)!==0}function X0(s,e,t,i){return(t&1<<i)>>i}function Ml(s,e,t){const i=t.byteLength+7&-8;if(s>0||t.byteLength<i){const n=new Uint8Array(i);return n.set(s%8===0?t.subarray(s>>3):Dl(new iu(t,s,e,null,jm)).subarray(0,i)),n}return t}function Dl(s){const e=[];let t=0,i=0,n=0;for(const o of s)o&&(n|=1<<i),++i===8&&(e[t++]=n,n=i=0);(t===0||i>0)&&(e[t++]=n);const r=new Uint8Array(e.length+7&-8);return r.set(e),r}class iu{constructor(e,t,i,n,r){this.bytes=e,this.length=i,this.context=n,this.get=r,this.bit=t%8,this.byteIndex=t>>3,this.byte=e[this.byteIndex++],this.index=0}next(){return this.index<this.length?(this.bit===8&&(this.bit=0,this.byte=this.bytes[this.byteIndex++]),{value:this.get(this.context,this.index++,this.byte,this.bit++)}):{done:!0,value:null}}[Symbol.iterator](){return this}}function Ih(s,e,t){if(t-e<=0)return 0;if(t-e<8){let r=0;for(const o of new iu(s,e,t-e,s,X0))r+=o;return r}const i=t>>3<<3,n=e+(e%8===0?0:8-e%8);return Ih(s,e,n)+Ih(s,i,t)+Z0(s,n>>3,i-n>>3)}function Z0(s,e,t){let i=0,n=Math.trunc(e);const r=new DataView(s.buffer,s.byteOffset,s.byteLength),o=t===void 0?s.byteLength:n+t;for(;o-n>=4;)i+=$a(r.getUint32(n)),n+=4;for(;o-n>=2;)i+=$a(r.getUint16(n)),n+=2;for(;o-n>=1;)i+=$a(r.getUint8(n)),n+=1;return i}function $a(s){let e=Math.trunc(s);return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),(e+(e>>>4)&252645135)*16843009>>>24}const eC=-1;class Ce{get typeId(){return this.type.typeId}get ArrayType(){return this.type.ArrayType}get buffers(){return[this.valueOffsets,this.values,this.nullBitmap,this.typeIds]}get nullable(){if(this._nullCount!==0){const{type:e}=this;return B.isSparseUnion(e)?this.children.some(t=>t.nullable):B.isDenseUnion(e)?this.children.some(t=>t.nullable):this.nullBitmap&&this.nullBitmap.byteLength>0}return!0}get byteLength(){let e=0;const{valueOffsets:t,values:i,nullBitmap:n,typeIds:r}=this;return t&&(e+=t.byteLength),i&&(e+=i.byteLength),n&&(e+=n.byteLength),r&&(e+=r.byteLength),this.children.reduce((o,l)=>o+l.byteLength,e)}get nullCount(){if(B.isUnion(this.type))return this.children.reduce((i,n)=>i+n.nullCount,0);let e=this._nullCount,t;return e<=eC&&(t=this.nullBitmap)&&(this._nullCount=e=this.length-Ih(t,this.offset,this.offset+this.length)),e}constructor(e,t,i,n,r,o=[],l){this.type=e,this.children=o,this.dictionary=l,this.offset=Math.floor(Math.max(t||0,0)),this.length=Math.floor(Math.max(i||0,0)),this._nullCount=Math.floor(Math.max(n||0,-1));let a;r instanceof Ce?(this.stride=r.stride,this.values=r.values,this.typeIds=r.typeIds,this.nullBitmap=r.nullBitmap,this.valueOffsets=r.valueOffsets):(this.stride=Wi(e),r&&((a=r[0])&&(this.valueOffsets=a),(a=r[1])&&(this.values=a),(a=r[2])&&(this.nullBitmap=a),(a=r[3])&&(this.typeIds=a)))}getValid(e){const{type:t}=this;if(B.isUnion(t)){const i=t,n=this.children[i.typeIdToChildIndex[this.typeIds[e]]],r=i.mode===pt.Dense?this.valueOffsets[e]:e;return n.getValid(r)}if(this.nullable&&this.nullCount>0){const i=this.offset+e;return(this.nullBitmap[i>>3]&1<<i%8)!==0}return!0}setValid(e,t){let i;const{type:n}=this;if(B.isUnion(n)){const r=n,o=this.children[r.typeIdToChildIndex[this.typeIds[e]]],l=r.mode===pt.Dense?this.valueOffsets[e]:e;i=o.getValid(l),o.setValid(l,t)}else{let{nullBitmap:r}=this;const{offset:o,length:l}=this,a=o+e,h=1<<a%8,c=a>>3;(!r||r.byteLength<=c)&&(r=new Uint8Array((o+l+63&-64)>>3).fill(255),this.nullCount>0&&r.set(Ml(o,l,this.nullBitmap),0),Object.assign(this,{nullBitmap:r,_nullCount:-1}));const u=r[c];i=(u&h)!==0,t?r[c]=u|h:r[c]=u&~h}return i!==!!t&&(this._nullCount=this.nullCount+(t?-1:1)),t}clone(e=this.type,t=this.offset,i=this.length,n=this._nullCount,r=this,o=this.children){return new Ce(e,t,i,n,r,o,this.dictionary)}slice(e,t){const{stride:i,typeId:n,children:r}=this,o=+(this._nullCount===0)-1,l=n===16?i:1,a=this._sliceBuffers(e,t,i,n);return this.clone(this.type,this.offset+e,t,o,a,r.length===0||this.valueOffsets?r:this._sliceChildren(r,l*e,l*t))}_changeLengthAndBackfillNullBitmap(e){if(this.typeId===y.Null)return this.clone(this.type,0,e,0);const{length:t,nullCount:i}=this,n=new Uint8Array((e+63&-64)>>3).fill(255,0,t>>3);n[t>>3]=(1<<t-(t&-8))-1,i>0&&n.set(Ml(this.offset,t,this.nullBitmap),0);const r=this.buffers;return r[Vi.VALIDITY]=n,this.clone(this.type,0,e,i+(e-t),r)}_sliceBuffers(e,t,i,n){let r;const{buffers:o}=this;return(r=o[Vi.TYPE])&&(o[Vi.TYPE]=r.subarray(e,e+t)),(r=o[Vi.OFFSET])&&(o[Vi.OFFSET]=r.subarray(e,e+t+1))||(r=o[Vi.DATA])&&(o[Vi.DATA]=n===6?r:r.subarray(i*e,i*(e+t))),o}_sliceChildren(e,t,i){return e.map(n=>n.slice(t,i))}}Ce.prototype.children=Object.freeze([]);class Or extends te{visit(e){return this.getVisitFn(e.type).call(this,e)}visitNull(e){const{["type"]:t,["offset"]:i=0,["length"]:n=0}=e;return new Ce(t,i,n,n)}visitBool(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.ArrayType,e.data),{["length"]:o=r.length>>3,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,r,n])}visitInt(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.ArrayType,e.data),{["length"]:o=r.length,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,r,n])}visitFloat(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.ArrayType,e.data),{["length"]:o=r.length,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,r,n])}visitUtf8(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.data),r=ue(e.nullBitmap),o=ur(e.valueOffsets),{["length"]:l=o.length-1,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ce(t,i,l,a,[o,n,r])}visitBinary(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.data),r=ue(e.nullBitmap),o=ur(e.valueOffsets),{["length"]:l=o.length-1,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ce(t,i,l,a,[o,n,r])}visitFixedSizeBinary(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.ArrayType,e.data),{["length"]:o=r.length/Wi(t),["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,r,n])}visitDate(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.ArrayType,e.data),{["length"]:o=r.length/Wi(t),["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,r,n])}visitTimestamp(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.ArrayType,e.data),{["length"]:o=r.length/Wi(t),["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,r,n])}visitTime(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.ArrayType,e.data),{["length"]:o=r.length/Wi(t),["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,r,n])}visitDecimal(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.ArrayType,e.data),{["length"]:o=r.length/Wi(t),["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,r,n])}visitList(e){const{["type"]:t,["offset"]:i=0,["child"]:n}=e,r=ue(e.nullBitmap),o=ur(e.valueOffsets),{["length"]:l=o.length-1,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ce(t,i,l,a,[o,void 0,r],[n])}visitStruct(e){const{["type"]:t,["offset"]:i=0,["children"]:n=[]}=e,r=ue(e.nullBitmap),{length:o=n.reduce((a,{length:h})=>Math.max(a,h),0),nullCount:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,void 0,r],n)}visitUnion(e){const{["type"]:t,["offset"]:i=0,["children"]:n=[]}=e,r=ye(t.ArrayType,e.typeIds),{["length"]:o=r.length,["nullCount"]:l=-1}=e;if(B.isSparseUnion(t))return new Ce(t,i,o,l,[void 0,void 0,void 0,r],n);const a=ur(e.valueOffsets);return new Ce(t,i,o,l,[a,void 0,void 0,r],n)}visitDictionary(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.indices.ArrayType,e.data),{["dictionary"]:o=new pe([new Or().visit({type:t.dictionary})])}=e,{["length"]:l=r.length,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ce(t,i,l,a,[void 0,r,n],[],o)}visitInterval(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.ArrayType,e.data),{["length"]:o=r.length/Wi(t),["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,r,n])}visitDuration(e){const{["type"]:t,["offset"]:i=0}=e,n=ue(e.nullBitmap),r=ye(t.ArrayType,e.data),{["length"]:o=r.length,["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,r,n])}visitFixedSizeList(e){const{["type"]:t,["offset"]:i=0,["child"]:n=new Or().visit({type:t.valueType})}=e,r=ue(e.nullBitmap),{["length"]:o=n.length/Wi(t),["nullCount"]:l=e.nullBitmap?-1:0}=e;return new Ce(t,i,o,l,[void 0,void 0,r],[n])}visitMap(e){const{["type"]:t,["offset"]:i=0,["child"]:n=new Or().visit({type:t.childType})}=e,r=ue(e.nullBitmap),o=ur(e.valueOffsets),{["length"]:l=o.length-1,["nullCount"]:a=e.nullBitmap?-1:0}=e;return new Ce(t,i,l,a,[o,void 0,r],[n])}}const tC=new Or;function oe(s){return tC.visit(s)}class hd{constructor(e=0,t){this.numChunks=e,this.getChunkIterator=t,this.chunkIndex=0,this.chunkIterator=this.getChunkIterator(0)}next(){for(;this.chunkIndex<this.numChunks;){const e=this.chunkIterator.next();if(!e.done)return e;++this.chunkIndex<this.numChunks&&(this.chunkIterator=this.getChunkIterator(this.chunkIndex))}return{done:!0,value:null}}[Symbol.iterator](){return this}}function Gm(s){return s.reduce((e,t)=>e+t.nullCount,0)}function qm(s){return s.reduce((e,t,i)=>(e[i+1]=e[i]+t.length,e),new Uint32Array(s.length+1))}function $m(s,e,t,i){const n=[];for(let r=-1,o=s.length;++r<o;){const l=s[r],a=e[r],{length:h}=l;if(a>=i)break;if(t>=a+h)continue;if(a>=t&&a+h<=i){n.push(l);continue}const c=Math.max(0,t-a),u=Math.min(i-a,h);n.push(l.slice(c,u-c))}return n.length===0&&n.push(s[0].slice(0,0)),n}function su(s,e,t,i){let n=0,r=0,o=e.length-1;do{if(n>=o-1)return t<e[o]?i(s,n,t-e[n]):null;r=n+Math.trunc((o-n)*.5),t<e[r]?o=r:n=r}while(n<o)}function nu(s,e){return s.getValid(e)}function In(s){function e(t,i,n){return s(t[i],n)}return function(t){const i=this.data;return su(i,this._offsets,t,e)}}function Km(s){let e;function t(i,n,r){return s(i[n],r,e)}return function(i,n){const r=this.data;e=n;const o=su(r,this._offsets,i,t);return e=void 0,o}}function Ym(s){let e;function t(i,n,r){let o=r,l=0,a=0;for(let h=n-1,c=i.length;++h<c;){const u=i[h];if(~(l=s(u,e,o)))return a+l;o=0,a+=u.length}return-1}return function(i,n){e=i;const r=this.data,o=typeof n!="number"?t(r,0,0):su(r,this._offsets,n,t);return e=void 0,o}}class H extends te{}function iC(s,e){return e===null&&s.length>0?0:-1}function sC(s,e){const{nullBitmap:t}=s;if(!t||s.nullCount<=0)return-1;let i=0;for(const n of new iu(t,s.offset+(e||0),s.length,t,jm)){if(!n)return i;++i}return-1}function Q(s,e,t){if(e===void 0)return-1;if(e===null)switch(s.typeId){case y.Union:break;case y.Dictionary:break;default:return sC(s,t)}const i=_t.getVisitFn(s),n=rr(e);for(let r=(t||0)-1,o=s.length;++r<o;)if(n(i(s,r)))return r;return-1}function Qm(s,e,t){const i=_t.getVisitFn(s),n=rr(e);for(let r=(t||0)-1,o=s.length;++r<o;)if(n(i(s,r)))return r;return-1}H.prototype.visitNull=iC;H.prototype.visitBool=Q;H.prototype.visitInt=Q;H.prototype.visitInt8=Q;H.prototype.visitInt16=Q;H.prototype.visitInt32=Q;H.prototype.visitInt64=Q;H.prototype.visitUint8=Q;H.prototype.visitUint16=Q;H.prototype.visitUint32=Q;H.prototype.visitUint64=Q;H.prototype.visitFloat=Q;H.prototype.visitFloat16=Q;H.prototype.visitFloat32=Q;H.prototype.visitFloat64=Q;H.prototype.visitUtf8=Q;H.prototype.visitBinary=Q;H.prototype.visitFixedSizeBinary=Q;H.prototype.visitDate=Q;H.prototype.visitDateDay=Q;H.prototype.visitDateMillisecond=Q;H.prototype.visitTimestamp=Q;H.prototype.visitTimestampSecond=Q;H.prototype.visitTimestampMillisecond=Q;H.prototype.visitTimestampMicrosecond=Q;H.prototype.visitTimestampNanosecond=Q;H.prototype.visitTime=Q;H.prototype.visitTimeSecond=Q;H.prototype.visitTimeMillisecond=Q;H.prototype.visitTimeMicrosecond=Q;H.prototype.visitTimeNanosecond=Q;H.prototype.visitDecimal=Q;H.prototype.visitList=Q;H.prototype.visitStruct=Q;H.prototype.visitUnion=Q;H.prototype.visitDenseUnion=Qm;H.prototype.visitSparseUnion=Qm;H.prototype.visitDictionary=Q;H.prototype.visitInterval=Q;H.prototype.visitIntervalDayTime=Q;H.prototype.visitIntervalYearMonth=Q;H.prototype.visitDuration=Q;H.prototype.visitDurationSecond=Q;H.prototype.visitDurationMillisecond=Q;H.prototype.visitDurationMicrosecond=Q;H.prototype.visitDurationNanosecond=Q;H.prototype.visitFixedSizeList=Q;H.prototype.visitMap=Q;const Al=new H;class V extends te{}function G(s){const{type:e}=s;if(s.nullCount===0&&s.stride===1&&(e.typeId===y.Timestamp||e instanceof Es&&e.bitWidth!==64||e instanceof Ur&&e.bitWidth!==64||e instanceof Wr&&e.precision!==kt.HALF))return new hd(s.data.length,i=>{const n=s.data[i];return n.values.subarray(0,n.length)[Symbol.iterator]()});let t=0;return new hd(s.data.length,i=>{const r=s.data[i].length,o=s.slice(t,t+r);return t+=r,new nC(o)})}class nC{constructor(e){this.vector=e,this.index=0}next(){return this.index<this.vector.length?{value:this.vector.get(this.index++)}:{done:!0,value:null}}[Symbol.iterator](){return this}}V.prototype.visitNull=G;V.prototype.visitBool=G;V.prototype.visitInt=G;V.prototype.visitInt8=G;V.prototype.visitInt16=G;V.prototype.visitInt32=G;V.prototype.visitInt64=G;V.prototype.visitUint8=G;V.prototype.visitUint16=G;V.prototype.visitUint32=G;V.prototype.visitUint64=G;V.prototype.visitFloat=G;V.prototype.visitFloat16=G;V.prototype.visitFloat32=G;V.prototype.visitFloat64=G;V.prototype.visitUtf8=G;V.prototype.visitBinary=G;V.prototype.visitFixedSizeBinary=G;V.prototype.visitDate=G;V.prototype.visitDateDay=G;V.prototype.visitDateMillisecond=G;V.prototype.visitTimestamp=G;V.prototype.visitTimestampSecond=G;V.prototype.visitTimestampMillisecond=G;V.prototype.visitTimestampMicrosecond=G;V.prototype.visitTimestampNanosecond=G;V.prototype.visitTime=G;V.prototype.visitTimeSecond=G;V.prototype.visitTimeMillisecond=G;V.prototype.visitTimeMicrosecond=G;V.prototype.visitTimeNanosecond=G;V.prototype.visitDecimal=G;V.prototype.visitList=G;V.prototype.visitStruct=G;V.prototype.visitUnion=G;V.prototype.visitDenseUnion=G;V.prototype.visitSparseUnion=G;V.prototype.visitDictionary=G;V.prototype.visitInterval=G;V.prototype.visitIntervalDayTime=G;V.prototype.visitIntervalYearMonth=G;V.prototype.visitDuration=G;V.prototype.visitDurationSecond=G;V.prototype.visitDurationMillisecond=G;V.prototype.visitDurationMicrosecond=G;V.prototype.visitDurationNanosecond=G;V.prototype.visitFixedSizeList=G;V.prototype.visitMap=G;const ru=new V,rC=(s,e)=>s+e;class Is extends te{visitNull(e,t){return 0}visitInt(e,t){return e.type.bitWidth/8}visitFloat(e,t){return e.type.ArrayType.BYTES_PER_ELEMENT}visitBool(e,t){return 1/8}visitDecimal(e,t){return e.type.bitWidth/8}visitDate(e,t){return(e.type.unit+1)*4}visitTime(e,t){return e.type.bitWidth/8}visitTimestamp(e,t){return e.type.unit===Y.SECOND?4:8}visitInterval(e,t){return(e.type.unit+1)*4}visitDuration(e,t){return 8}visitStruct(e,t){return e.children.reduce((i,n)=>i+Fi.visit(n,t),0)}visitFixedSizeBinary(e,t){return e.type.byteWidth}visitMap(e,t){return 8+e.children.reduce((i,n)=>i+Fi.visit(n,t),0)}visitDictionary(e,t){var i;return e.type.indices.bitWidth/8+(((i=e.dictionary)===null||i===void 0?void 0:i.getByteLength(e.values[t]))||0)}}const oC=({valueOffsets:s},e)=>8+(s[e+1]-s[e]),lC=({valueOffsets:s},e)=>8+(s[e+1]-s[e]),aC=({valueOffsets:s,stride:e,children:t},i)=>{const n=t[0],{[i*e]:r}=s,{[i*e+1]:o}=s,l=Fi.getVisitFn(n.type),a=n.slice(r,o-r);let h=8;for(let c=-1,u=o-r;++c<u;)h+=l(a,c);return h},hC=({stride:s,children:e},t)=>{const i=e[0],n=i.slice(t*s,s),r=Fi.getVisitFn(i.type);let o=0;for(let l=-1,a=n.length;++l<a;)o+=r(n,l);return o},cC=(s,e)=>s.type.mode===pt.Dense?Jm(s,e):Xm(s,e),Jm=({type:s,children:e,typeIds:t,valueOffsets:i},n)=>{const r=s.typeIdToChildIndex[t[n]];return 8+Fi.visit(e[r],i[n])},Xm=({children:s},e)=>4+Fi.visitMany(s,s.map(()=>e)).reduce(rC,0);Is.prototype.visitUtf8=oC;Is.prototype.visitBinary=lC;Is.prototype.visitList=aC;Is.prototype.visitFixedSizeList=hC;Is.prototype.visitUnion=cC;Is.prototype.visitDenseUnion=Jm;Is.prototype.visitSparseUnion=Xm;const Fi=new Is;var Zm;const eg={},tg={};class pe{constructor(e){var t,i,n;const r=e[0]instanceof pe?e.flatMap(l=>l.data):e;if(r.length===0||r.some(l=>!(l instanceof Ce)))throw new TypeError("Vector constructor expects an Array of Data instances.");const o=(t=r[0])===null||t===void 0?void 0:t.type;switch(r.length){case 0:this._offsets=[0];break;case 1:{const{get:l,set:a,indexOf:h,byteLength:c}=eg[o.typeId],u=r[0];this.isValid=d=>nu(u,d),this.get=d=>l(u,d),this.set=(d,f)=>a(u,d,f),this.indexOf=d=>h(u,d),this.getByteLength=d=>c(u,d),this._offsets=[0,u.length];break}default:Object.setPrototypeOf(this,tg[o.typeId]),this._offsets=qm(r);break}this.data=r,this.type=o,this.stride=Wi(o),this.numChildren=(n=(i=o.children)===null||i===void 0?void 0:i.length)!==null&&n!==void 0?n:0,this.length=this._offsets.at(-1)}get byteLength(){return this.data.reduce((e,t)=>e+t.byteLength,0)}get nullCount(){return Gm(this.data)}get ArrayType(){return this.type.ArrayType}get[Symbol.toStringTag](){return`${this.VectorName}<${this.type[Symbol.toStringTag]}>`}get VectorName(){return`${y[this.type.typeId]}Vector`}isValid(e){return!1}get(e){return null}set(e,t){}indexOf(e,t){return-1}includes(e,t){return this.indexOf(e,t)>-1}getByteLength(e){return 0}[Symbol.iterator](){return ru.visit(this)}concat(...e){return new pe(this.data.concat(e.flatMap(t=>t.data).flat(Number.POSITIVE_INFINITY)))}slice(e,t){return new pe(Um(this,e,t,({data:i,_offsets:n},r,o)=>$m(i,n,r,o)))}toJSON(){return[...this]}toArray(){const{type:e,data:t,length:i,stride:n,ArrayType:r}=this;switch(e.typeId){case y.Int:case y.Float:case y.Decimal:case y.Time:case y.Timestamp:switch(t.length){case 0:return new r;case 1:return t[0].values.subarray(0,i*n);default:return t.reduce((o,{values:l,length:a})=>(o.array.set(l.subarray(0,a*n),o.offset),o.offset+=a*n,o),{array:new r(i*n),offset:0}).array}}return[...this]}toString(){return`[${[...this].join(",")}]`}getChild(e){var t;return this.getChildAt((t=this.type.children)===null||t===void 0?void 0:t.findIndex(i=>i.name===e))}getChildAt(e){return e>-1&&e<this.numChildren?new pe(this.data.map(({children:t})=>t[e])):null}get isMemoized(){return B.isDictionary(this.type)?this.data[0].dictionary.isMemoized:!1}memoize(){if(B.isDictionary(this.type)){const e=new Ol(this.data[0].dictionary),t=this.data.map(i=>{const n=i.clone();return n.dictionary=e,n});return new pe(t)}return new Ol(this)}unmemoize(){if(B.isDictionary(this.type)&&this.isMemoized){const e=this.data[0].dictionary.unmemoize(),t=this.data.map(i=>{const n=i.clone();return n.dictionary=e,n});return new pe(t)}return this}}Zm=Symbol.toStringTag;pe[Zm]=(s=>{s.type=B.prototype,s.data=[],s.length=0,s.stride=1,s.numChildren=0,s._offsets=new Uint32Array([0]),s[Symbol.isConcatSpreadable]=!0;const e=Object.keys(y).map(t=>y[t]).filter(t=>typeof t=="number"&&t!==y.NONE);for(const t of e){const i=_t.getVisitFnByTypeId(t),n=Xt.getVisitFnByTypeId(t),r=Al.getVisitFnByTypeId(t),o=Fi.getVisitFnByTypeId(t);eg[t]={get:i,set:n,indexOf:r,byteLength:o},tg[t]=Object.create(s,{isValid:{value:In(nu)},get:{value:In(_t.getVisitFnByTypeId(t))},set:{value:Km(Xt.getVisitFnByTypeId(t))},indexOf:{value:Ym(Al.getVisitFnByTypeId(t))},getByteLength:{value:In(Fi.getVisitFnByTypeId(t))}})}return"Vector"})(pe.prototype);class Ol extends pe{constructor(e){super(e.data);const t=this.get,i=this.set,n=this.slice,r=new Array(this.length);Object.defineProperty(this,"get",{value(o){const l=r[o];if(l!==void 0)return l;const a=t.call(this,o);return r[o]=a,a}}),Object.defineProperty(this,"set",{value(o,l){i.call(this,o,l),r[o]=l}}),Object.defineProperty(this,"slice",{value:(o,l)=>new Ol(n.call(this,o,l))}),Object.defineProperty(this,"isMemoized",{value:!0}),Object.defineProperty(this,"unmemoize",{value:()=>new pe(this.data)}),Object.defineProperty(this,"memoize",{value:()=>this})}}class Bh{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}offset(){return this.bb.readInt64(this.bb_pos)}metaDataLength(){return this.bb.readInt32(this.bb_pos+8)}bodyLength(){return this.bb.readInt64(this.bb_pos+16)}static sizeOf(){return 24}static createBlock(e,t,i,n){return e.prep(8,24),e.writeInt64(BigInt(n??0)),e.pad(4),e.writeInt32(i),e.writeInt64(BigInt(t??0)),e.offset()}}const Ka=2,vi=4,Gi=4,we=4,os=new Int32Array(2),cd=new Float32Array(os.buffer),ud=new Float64Array(os.buffer),_o=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Fh;(function(s){s[s.UTF8_BYTES=1]="UTF8_BYTES",s[s.UTF16_STRING=2]="UTF16_STRING"})(Fh||(Fh={}));let Un=class ig{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new ig(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return os[0]=this.readInt32(e),cd[0]}readFloat64(e){return os[_o?0:1]=this.readInt32(e),os[_o?1:0]=this.readInt32(e+4),ud[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){cd[0]=t,this.writeInt32(e,os[0])}writeFloat64(e,t){ud[0]=t,this.writeInt32(e,os[_o?0:1]),this.writeInt32(e+4,os[_o?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+vi+Gi)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Gi;t++)e+=String.fromCharCode(this.readInt8(this.position_+vi+t));return e}__offset(e,t){const i=e-this.readInt32(e);return t<this.readInt16(i)?this.readInt16(i+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const i=this.readInt32(e);e+=vi;const n=this.bytes_.subarray(e,e+i);return t===Fh.UTF8_BYTES?n:this.text_decoder_.decode(n)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+vi}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Gi)throw new Error("FlatBuffers: file identifier must be length "+Gi);for(let t=0;t<Gi;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+vi+t))return!1;return!0}createScalarList(e,t){const i=[];for(let n=0;n<t;++n){const r=e(n);r!==null&&i.push(r)}return i}createObjList(e,t){const i=[];for(let n=0;n<t;++n){const r=e(n);r!==null&&i.push(r.unpack())}return i}},sg=class ng{constructor(e){this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null,this.text_encoder=new TextEncoder;let t;e?t=e:t=1024,this.bb=Un.allocate(t),this.space=t}clear(){this.bb.clear(),this.space=this.bb.capacity(),this.minalign=1,this.vtable=null,this.vtable_in_use=0,this.isNested=!1,this.object_start=0,this.vtables=[],this.vector_num_elems=0,this.force_defaults=!1,this.string_maps=null}forceDefaults(e){this.force_defaults=e}dataBuffer(){return this.bb}asUint8Array(){return this.bb.bytes().subarray(this.bb.position(),this.bb.position()+this.offset())}prep(e,t){e>this.minalign&&(this.minalign=e);const i=~(this.bb.capacity()-this.space+t)+1&e-1;for(;this.space<i+e+t;){const n=this.bb.capacity();this.bb=ng.growByteBuffer(this.bb),this.space+=this.bb.capacity()-n}this.pad(i)}pad(e){for(let t=0;t<e;t++)this.bb.writeInt8(--this.space,0)}writeInt8(e){this.bb.writeInt8(this.space-=1,e)}writeInt16(e){this.bb.writeInt16(this.space-=2,e)}writeInt32(e){this.bb.writeInt32(this.space-=4,e)}writeInt64(e){this.bb.writeInt64(this.space-=8,e)}writeFloat32(e){this.bb.writeFloat32(this.space-=4,e)}writeFloat64(e){this.bb.writeFloat64(this.space-=8,e)}addInt8(e){this.prep(1,0),this.writeInt8(e)}addInt16(e){this.prep(2,0),this.writeInt16(e)}addInt32(e){this.prep(4,0),this.writeInt32(e)}addInt64(e){this.prep(8,0),this.writeInt64(e)}addFloat32(e){this.prep(4,0),this.writeFloat32(e)}addFloat64(e){this.prep(8,0),this.writeFloat64(e)}addFieldInt8(e,t,i){(this.force_defaults||t!=i)&&(this.addInt8(t),this.slot(e))}addFieldInt16(e,t,i){(this.force_defaults||t!=i)&&(this.addInt16(t),this.slot(e))}addFieldInt32(e,t,i){(this.force_defaults||t!=i)&&(this.addInt32(t),this.slot(e))}addFieldInt64(e,t,i){(this.force_defaults||t!==i)&&(this.addInt64(t),this.slot(e))}addFieldFloat32(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat32(t),this.slot(e))}addFieldFloat64(e,t,i){(this.force_defaults||t!=i)&&(this.addFloat64(t),this.slot(e))}addFieldOffset(e,t,i){(this.force_defaults||t!=i)&&(this.addOffset(t),this.slot(e))}addFieldStruct(e,t,i){t!=i&&(this.nested(t),this.slot(e))}nested(e){if(e!=this.offset())throw new TypeError("FlatBuffers: struct must be serialized inline.")}notNested(){if(this.isNested)throw new TypeError("FlatBuffers: object serialization must not be nested.")}slot(e){this.vtable!==null&&(this.vtable[e]=this.offset())}offset(){return this.bb.capacity()-this.space}static growByteBuffer(e){const t=e.capacity();if(t&3221225472)throw new Error("FlatBuffers: cannot grow buffer beyond 2 gigabytes.");const i=t<<1,n=Un.allocate(i);return n.setPosition(i-t),n.bytes().set(e.bytes(),i-t),n}addOffset(e){this.prep(vi,0),this.writeInt32(this.offset()-e+vi)}startObject(e){this.notNested(),this.vtable==null&&(this.vtable=[]),this.vtable_in_use=e;for(let t=0;t<e;t++)this.vtable[t]=0;this.isNested=!0,this.object_start=this.offset()}endObject(){if(this.vtable==null||!this.isNested)throw new Error("FlatBuffers: endObject called without startObject");this.addInt32(0);const e=this.offset();let t=this.vtable_in_use-1;for(;t>=0&&this.vtable[t]==0;t--);const i=t+1;for(;t>=0;t--)this.addInt16(this.vtable[t]!=0?e-this.vtable[t]:0);const n=2;this.addInt16(e-this.object_start);const r=(i+n)*Ka;this.addInt16(r);let o=0;const l=this.space;e:for(t=0;t<this.vtables.length;t++){const a=this.bb.capacity()-this.vtables[t];if(r==this.bb.readInt16(a)){for(let h=Ka;h<r;h+=Ka)if(this.bb.readInt16(l+h)!=this.bb.readInt16(a+h))continue e;o=this.vtables[t];break}}return o?(this.space=this.bb.capacity()-e,this.bb.writeInt32(this.space,o-e)):(this.vtables.push(this.offset()),this.bb.writeInt32(this.bb.capacity()-e,this.offset()-e)),this.isNested=!1,e}finish(e,t,i){const n=i?we:0;if(t){const r=t;if(this.prep(this.minalign,vi+Gi+n),r.length!=Gi)throw new TypeError("FlatBuffers: file identifier must be length "+Gi);for(let o=Gi-1;o>=0;o--)this.writeInt8(r.charCodeAt(o))}this.prep(this.minalign,vi+n),this.addOffset(e),n&&this.addInt32(this.bb.capacity()-this.space),this.bb.setPosition(this.space)}finishSizePrefixed(e,t){this.finish(e,t,!0)}requiredField(e,t){const i=this.bb.capacity()-e,n=i-this.bb.readInt32(i);if(!(t<this.bb.readInt16(n)&&this.bb.readInt16(n+t)!=0))throw new TypeError("FlatBuffers: field "+t+" must be set")}startVector(e,t,i){this.notNested(),this.vector_num_elems=t,this.prep(vi,e*t),this.prep(i,e*t)}endVector(){return this.writeInt32(this.vector_num_elems),this.offset()}createSharedString(e){if(!e)return 0;if(this.string_maps||(this.string_maps=new Map),this.string_maps.has(e))return this.string_maps.get(e);const t=this.createString(e);return this.string_maps.set(e,t),t}createString(e){if(e==null)return 0;let t;e instanceof Uint8Array?t=e:t=this.text_encoder.encode(e),this.addInt8(0),this.startVector(1,t.length,1),this.bb.setPosition(this.space-=t.length);for(let i=0,n=this.space,r=this.bb.bytes();i<t.length;i++)r[n++]=t[i];return this.endVector()}createObjectOffset(e){return e===null?0:typeof e=="string"?this.createString(e):e.pack(this)}createObjectOffsetList(e){const t=[];for(let i=0;i<e.length;++i){const n=e[i];if(n!==null)t.push(this.createObjectOffset(n));else throw new TypeError("FlatBuffers: Argument for createObjectOffsetList cannot contain null.")}return t}createStructOffsetList(e,t){return t(this,e.length),this.createObjectOffsetList(e.slice().reverse()),this.endVector()}};class je{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsKeyValue(e,t){return(t||new je).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsKeyValue(e,t){return e.setPosition(e.position()+we),(t||new je).__init(e.readInt32(e.position())+e.position(),e)}key(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}value(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startKeyValue(e){e.startObject(2)}static addKey(e,t){e.addFieldOffset(0,t,0)}static addValue(e,t){e.addFieldOffset(1,t,0)}static endKeyValue(e){return e.endObject()}static createKeyValue(e,t,i){return je.startKeyValue(e),je.addKey(e,t),je.addValue(e,i),je.endKeyValue(e)}}var jn;(function(s){s[s.V1=0]="V1",s[s.V2=1]="V2",s[s.V3=2]="V3",s[s.V4=3]="V4",s[s.V5=4]="V5"})(jn||(jn={}));var Gn;(function(s){s[s.Little=0]="Little",s[s.Big=1]="Big"})(Gn||(Gn={}));var Ll;(function(s){s[s.DenseArray=0]="DenseArray"})(Ll||(Ll={}));class Lt{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInt(e,t){return(t||new Lt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInt(e,t){return e.setPosition(e.position()+we),(t||new Lt).__init(e.readInt32(e.position())+e.position(),e)}bitWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}isSigned(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startInt(e){e.startObject(2)}static addBitWidth(e,t){e.addFieldInt32(0,t,0)}static addIsSigned(e,t){e.addFieldInt8(1,+t,0)}static endInt(e){return e.endObject()}static createInt(e,t,i){return Lt.startInt(e),Lt.addBitWidth(e,t),Lt.addIsSigned(e,i),Lt.endInt(e)}}class qi{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDictionaryEncoding(e,t){return(t||new qi).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryEncoding(e,t){return e.setPosition(e.position()+we),(t||new qi).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}indexType(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new Lt).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}isOrdered(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}dictionaryKind(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt16(this.bb_pos+e):Ll.DenseArray}static startDictionaryEncoding(e){e.startObject(4)}static addId(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addIndexType(e,t){e.addFieldOffset(1,t,0)}static addIsOrdered(e,t){e.addFieldInt8(2,+t,0)}static addDictionaryKind(e,t){e.addFieldInt16(3,t,Ll.DenseArray)}static endDictionaryEncoding(e){return e.endObject()}}class js{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBinary(e,t){return(t||new js).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBinary(e,t){return e.setPosition(e.position()+we),(t||new js).__init(e.readInt32(e.position())+e.position(),e)}static startBinary(e){e.startObject(0)}static endBinary(e){return e.endObject()}static createBinary(e){return js.startBinary(e),js.endBinary(e)}}let dd=class Er{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBool(e,t){return(t||new Er).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBool(e,t){return e.setPosition(e.position()+we),(t||new Er).__init(e.readInt32(e.position())+e.position(),e)}static startBool(e){e.startObject(0)}static endBool(e){return e.endObject()}static createBool(e){return Er.startBool(e),Er.endBool(e)}};var Il;(function(s){s[s.DAY=0]="DAY",s[s.MILLISECOND=1]="MILLISECOND"})(Il||(Il={}));let Xo=class wn{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDate(e,t){return(t||new wn).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDate(e,t){return e.setPosition(e.position()+we),(t||new wn).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Il.MILLISECOND}static startDate(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,Il.MILLISECOND)}static endDate(e){return e.endObject()}static createDate(e,t){return wn.startDate(e),wn.addUnit(e,t),wn.endDate(e)}};class vt{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDecimal(e,t){return(t||new vt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDecimal(e,t){return e.setPosition(e.position()+we),(t||new vt).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}scale(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}bitWidth(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readInt32(this.bb_pos+e):128}static startDecimal(e){e.startObject(3)}static addPrecision(e,t){e.addFieldInt32(0,t,0)}static addScale(e,t){e.addFieldInt32(1,t,0)}static addBitWidth(e,t){e.addFieldInt32(2,t,128)}static endDecimal(e){return e.endObject()}static createDecimal(e,t,i,n){return vt.startDecimal(e),vt.addPrecision(e,t),vt.addScale(e,i),vt.addBitWidth(e,n),vt.endDecimal(e)}}var xs;(function(s){s[s.SECOND=0]="SECOND",s[s.MILLISECOND=1]="MILLISECOND",s[s.MICROSECOND=2]="MICROSECOND",s[s.NANOSECOND=3]="NANOSECOND"})(xs||(xs={}));class wi{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDuration(e,t){return(t||new wi).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDuration(e,t){return e.setPosition(e.position()+we),(t||new wi).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):xs.MILLISECOND}static startDuration(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,xs.MILLISECOND)}static endDuration(e){return e.endObject()}static createDuration(e,t){return wi.startDuration(e),wi.addUnit(e,t),wi.endDuration(e)}}class Ci{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFixedSizeBinary(e,t){return(t||new Ci).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeBinary(e,t){return e.setPosition(e.position()+we),(t||new Ci).__init(e.readInt32(e.position())+e.position(),e)}byteWidth(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeBinary(e){e.startObject(1)}static addByteWidth(e,t){e.addFieldInt32(0,t,0)}static endFixedSizeBinary(e){return e.endObject()}static createFixedSizeBinary(e,t){return Ci.startFixedSizeBinary(e),Ci.addByteWidth(e,t),Ci.endFixedSizeBinary(e)}}class Ei{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFixedSizeList(e,t){return(t||new Ei).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFixedSizeList(e,t){return e.setPosition(e.position()+we),(t||new Ei).__init(e.readInt32(e.position())+e.position(),e)}listSize(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt32(this.bb_pos+e):0}static startFixedSizeList(e){e.startObject(1)}static addListSize(e,t){e.addFieldInt32(0,t,0)}static endFixedSizeList(e){return e.endObject()}static createFixedSizeList(e,t){return Ei.startFixedSizeList(e),Ei.addListSize(e,t),Ei.endFixedSizeList(e)}}var Bl;(function(s){s[s.HALF=0]="HALF",s[s.SINGLE=1]="SINGLE",s[s.DOUBLE=2]="DOUBLE"})(Bl||(Bl={}));class xi{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFloatingPoint(e,t){return(t||new xi).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFloatingPoint(e,t){return e.setPosition(e.position()+we),(t||new xi).__init(e.readInt32(e.position())+e.position(),e)}precision(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Bl.HALF}static startFloatingPoint(e){e.startObject(1)}static addPrecision(e,t){e.addFieldInt16(0,t,Bl.HALF)}static endFloatingPoint(e){return e.endObject()}static createFloatingPoint(e,t){return xi.startFloatingPoint(e),xi.addPrecision(e,t),xi.endFloatingPoint(e)}}var Fl;(function(s){s[s.YEAR_MONTH=0]="YEAR_MONTH",s[s.DAY_TIME=1]="DAY_TIME",s[s.MONTH_DAY_NANO=2]="MONTH_DAY_NANO"})(Fl||(Fl={}));class ki{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsInterval(e,t){return(t||new ki).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsInterval(e,t){return e.setPosition(e.position()+we),(t||new ki).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Fl.YEAR_MONTH}static startInterval(e){e.startObject(1)}static addUnit(e,t){e.addFieldInt16(0,t,Fl.YEAR_MONTH)}static endInterval(e){return e.endObject()}static createInterval(e,t){return ki.startInterval(e),ki.addUnit(e,t),ki.endInterval(e)}}class Gs{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsList(e,t){return(t||new Gs).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsList(e,t){return e.setPosition(e.position()+we),(t||new Gs).__init(e.readInt32(e.position())+e.position(),e)}static startList(e){e.startObject(0)}static endList(e){return e.endObject()}static createList(e){return Gs.startList(e),Gs.endList(e)}}let Zo=class Cn{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMap(e,t){return(t||new Cn).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMap(e,t){return e.setPosition(e.position()+we),(t||new Cn).__init(e.readInt32(e.position())+e.position(),e)}keysSorted(){const e=this.bb.__offset(this.bb_pos,4);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startMap(e){e.startObject(1)}static addKeysSorted(e,t){e.addFieldInt8(0,+t,0)}static endMap(e){return e.endObject()}static createMap(e,t){return Cn.startMap(e),Cn.addKeysSorted(e,t),Cn.endMap(e)}},fd=class xr{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsNull(e,t){return(t||new xr).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsNull(e,t){return e.setPosition(e.position()+we),(t||new xr).__init(e.readInt32(e.position())+e.position(),e)}static startNull(e){e.startObject(0)}static endNull(e){return e.endObject()}static createNull(e){return xr.startNull(e),xr.endNull(e)}};class qs{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsStruct_(e,t){return(t||new qs).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsStruct_(e,t){return e.setPosition(e.position()+we),(t||new qs).__init(e.readInt32(e.position())+e.position(),e)}static startStruct_(e){e.startObject(0)}static endStruct_(e){return e.endObject()}static createStruct_(e){return qs.startStruct_(e),qs.endStruct_(e)}}class jt{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTime(e,t){return(t||new jt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTime(e,t){return e.setPosition(e.position()+we),(t||new jt).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):xs.MILLISECOND}bitWidth(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):32}static startTime(e){e.startObject(2)}static addUnit(e,t){e.addFieldInt16(0,t,xs.MILLISECOND)}static addBitWidth(e,t){e.addFieldInt32(1,t,32)}static endTime(e){return e.endObject()}static createTime(e,t,i){return jt.startTime(e),jt.addUnit(e,t),jt.addBitWidth(e,i),jt.endTime(e)}}class Gt{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsTimestamp(e,t){return(t||new Gt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsTimestamp(e,t){return e.setPosition(e.position()+we),(t||new Gt).__init(e.readInt32(e.position())+e.position(),e)}unit(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):xs.SECOND}timezone(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.__string(this.bb_pos+t,e):null}static startTimestamp(e){e.startObject(2)}static addUnit(e,t){e.addFieldInt16(0,t,xs.SECOND)}static addTimezone(e,t){e.addFieldOffset(1,t,0)}static endTimestamp(e){return e.endObject()}static createTimestamp(e,t,i){return Gt.startTimestamp(e),Gt.addUnit(e,t),Gt.addTimezone(e,i),Gt.endTimestamp(e)}}var Pl;(function(s){s[s.Sparse=0]="Sparse",s[s.Dense=1]="Dense"})(Pl||(Pl={}));class wt{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsUnion(e,t){return(t||new wt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUnion(e,t){return e.setPosition(e.position()+we),(t||new wt).__init(e.readInt32(e.position())+e.position(),e)}mode(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Pl.Sparse}typeIds(e){const t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readInt32(this.bb.__vector(this.bb_pos+t)+e*4):0}typeIdsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}typeIdsArray(){const e=this.bb.__offset(this.bb_pos,6);return e?new Int32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}static startUnion(e){e.startObject(2)}static addMode(e,t){e.addFieldInt16(0,t,Pl.Sparse)}static addTypeIds(e,t){e.addFieldOffset(1,t,0)}static createTypeIdsVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addInt32(t[i]);return e.endVector()}static startTypeIdsVector(e,t){e.startVector(4,t,4)}static endUnion(e){return e.endObject()}static createUnion(e,t,i){return wt.startUnion(e),wt.addMode(e,t),wt.addTypeIds(e,i),wt.endUnion(e)}}class $s{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsUtf8(e,t){return(t||new $s).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsUtf8(e,t){return e.setPosition(e.position()+we),(t||new $s).__init(e.readInt32(e.position())+e.position(),e)}static startUtf8(e){e.startObject(0)}static endUtf8(e){return e.endObject()}static createUtf8(e){return $s.startUtf8(e),$s.endUtf8(e)}}var Me;(function(s){s[s.NONE=0]="NONE",s[s.Null=1]="Null",s[s.Int=2]="Int",s[s.FloatingPoint=3]="FloatingPoint",s[s.Binary=4]="Binary",s[s.Utf8=5]="Utf8",s[s.Bool=6]="Bool",s[s.Decimal=7]="Decimal",s[s.Date=8]="Date",s[s.Time=9]="Time",s[s.Timestamp=10]="Timestamp",s[s.Interval=11]="Interval",s[s.List=12]="List",s[s.Struct_=13]="Struct_",s[s.Union=14]="Union",s[s.FixedSizeBinary=15]="FixedSizeBinary",s[s.FixedSizeList=16]="FixedSizeList",s[s.Map=17]="Map",s[s.Duration=18]="Duration",s[s.LargeBinary=19]="LargeBinary",s[s.LargeUtf8=20]="LargeUtf8",s[s.LargeList=21]="LargeList",s[s.RunEndEncoded=22]="RunEndEncoded"})(Me||(Me={}));let zt=class el{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsField(e,t){return(t||new el).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsField(e,t){return e.setPosition(e.position()+we),(t||new el).__init(e.readInt32(e.position())+e.position(),e)}name(e){const t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}nullable(){const e=this.bb.__offset(this.bb_pos,6);return e?!!this.bb.readInt8(this.bb_pos+e):!1}typeType(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Me.NONE}type(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__union(e,this.bb_pos+t):null}dictionary(e){const t=this.bb.__offset(this.bb_pos,12);return t?(e||new qi).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}children(e,t){const i=this.bb.__offset(this.bb_pos,14);return i?(t||new el).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}childrenLength(){const e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,16);return i?(t||new je).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,16);return e?this.bb.__vector_len(this.bb_pos+e):0}static startField(e){e.startObject(7)}static addName(e,t){e.addFieldOffset(0,t,0)}static addNullable(e,t){e.addFieldInt8(1,+t,0)}static addTypeType(e,t){e.addFieldInt8(2,t,Me.NONE)}static addType(e,t){e.addFieldOffset(3,t,0)}static addDictionary(e,t){e.addFieldOffset(4,t,0)}static addChildren(e,t){e.addFieldOffset(5,t,0)}static createChildrenVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startChildrenVector(e,t){e.startVector(4,t,4)}static addCustomMetadata(e,t){e.addFieldOffset(6,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endField(e){return e.endObject()}},mi=class Hi{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsSchema(e,t){return(t||new Hi).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsSchema(e,t){return e.setPosition(e.position()+we),(t||new Hi).__init(e.readInt32(e.position())+e.position(),e)}endianness(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):Gn.Little}fields(e,t){const i=this.bb.__offset(this.bb_pos,6);return i?(t||new zt).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}fieldsLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,8);return i?(t||new je).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}features(e){const t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readInt64(this.bb.__vector(this.bb_pos+t)+e*8):BigInt(0)}featuresLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}static startSchema(e){e.startObject(4)}static addEndianness(e,t){e.addFieldInt16(0,t,Gn.Little)}static addFields(e,t){e.addFieldOffset(1,t,0)}static createFieldsVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startFieldsVector(e,t){e.startVector(4,t,4)}static addCustomMetadata(e,t){e.addFieldOffset(2,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static addFeatures(e,t){e.addFieldOffset(3,t,0)}static createFeaturesVector(e,t){e.startVector(8,t.length,8);for(let i=t.length-1;i>=0;i--)e.addInt64(t[i]);return e.endVector()}static startFeaturesVector(e,t){e.startVector(8,t,8)}static endSchema(e){return e.endObject()}static finishSchemaBuffer(e,t){e.finish(t)}static finishSizePrefixedSchemaBuffer(e,t){e.finish(t,void 0,!0)}static createSchema(e,t,i,n,r){return Hi.startSchema(e),Hi.addEndianness(e,t),Hi.addFields(e,i),Hi.addCustomMetadata(e,n),Hi.addFeatures(e,r),Hi.endSchema(e)}};class Dt{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFooter(e,t){return(t||new Dt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFooter(e,t){return e.setPosition(e.position()+we),(t||new Dt).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):jn.V1}schema(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new mi).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}dictionaries(e,t){const i=this.bb.__offset(this.bb_pos,8);return i?(t||new Bh).__init(this.bb.__vector(this.bb_pos+i)+e*24,this.bb):null}dictionariesLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}recordBatches(e,t){const i=this.bb.__offset(this.bb_pos,10);return i?(t||new Bh).__init(this.bb.__vector(this.bb_pos+i)+e*24,this.bb):null}recordBatchesLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,12);return i?(t||new je).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFooter(e){e.startObject(5)}static addVersion(e,t){e.addFieldInt16(0,t,jn.V1)}static addSchema(e,t){e.addFieldOffset(1,t,0)}static addDictionaries(e,t){e.addFieldOffset(2,t,0)}static startDictionariesVector(e,t){e.startVector(24,t,8)}static addRecordBatches(e,t){e.addFieldOffset(3,t,0)}static startRecordBatchesVector(e,t){e.startVector(24,t,8)}static addCustomMetadata(e,t){e.addFieldOffset(4,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endFooter(e){return e.endObject()}static finishFooterBuffer(e,t){e.finish(t)}static finishSizePrefixedFooterBuffer(e,t){e.finish(t,void 0,!0)}}class me{constructor(e=[],t,i,n=Ze.V5){this.fields=e||[],this.metadata=t||new Map,i||(i=Ph(e)),this.dictionaries=i,this.metadataVersion=n}get[Symbol.toStringTag](){return"Schema"}get names(){return this.fields.map(e=>e.name)}toString(){return`Schema<{ ${this.fields.map((e,t)=>`${t}: ${e}`).join(", ")} }>`}select(e){const t=new Set(e),i=this.fields.filter(n=>t.has(n.name));return new me(i,this.metadata)}selectAt(e){const t=e.map(i=>this.fields[i]).filter(Boolean);return new me(t,this.metadata)}assign(...e){const t=e[0]instanceof me?e[0]:Array.isArray(e[0])?new me(e[0]):new me(e),i=[...this.fields],n=Ro(Ro(new Map,this.metadata),t.metadata),r=t.fields.filter(l=>{const a=i.findIndex(h=>h.name===l.name);return~a?(i[a]=l.clone({metadata:Ro(Ro(new Map,i[a].metadata),l.metadata)}))&&!1:!0}),o=Ph(r,new Map);return new me([...i,...r],n,new Map([...this.dictionaries,...o]))}}me.prototype.fields=null;me.prototype.metadata=null;me.prototype.dictionaries=null;class Re{static new(...e){let[t,i,n,r]=e;return e[0]&&typeof e[0]=="object"&&({name:t}=e[0],i===void 0&&(i=e[0].type),n===void 0&&(n=e[0].nullable),r===void 0&&(r=e[0].metadata)),new Re(`${t}`,i,n,r)}constructor(e,t,i=!1,n){this.name=e,this.type=t,this.nullable=i,this.metadata=n||new Map}get typeId(){return this.type.typeId}get[Symbol.toStringTag](){return"Field"}toString(){return`${this.name}: ${this.type}`}clone(...e){let[t,i,n,r]=e;return!e[0]||typeof e[0]!="object"?[t=this.name,i=this.type,n=this.nullable,r=this.metadata]=e:{name:t=this.name,type:i=this.type,nullable:n=this.nullable,metadata:r=this.metadata}=e[0],Re.new(t,i,n,r)}}Re.prototype.type=null;Re.prototype.name=null;Re.prototype.nullable=null;Re.prototype.metadata=null;function Ro(s,e){return new Map([...s||new Map,...e||new Map])}function Ph(s,e=new Map){for(let t=-1,i=s.length;++t<i;){const r=s[t].type;if(B.isDictionary(r)){if(!e.has(r.id))e.set(r.id,r.dictionary);else if(e.get(r.id)!==r.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}r.children&&r.children.length>0&&Ph(r.children,e)}return e}var uC=sg,dC=Un;class jr{static decode(e){e=new dC(ue(e));const t=Dt.getRootAsFooter(e),i=me.decode(t.schema(),new Map,t.version());return new fC(i,t)}static encode(e){const t=new uC,i=me.encode(t,e.schema);Dt.startRecordBatchesVector(t,e.numRecordBatches);for(const o of[...e.recordBatches()].slice().reverse())ks.encode(t,o);const n=t.endVector();Dt.startDictionariesVector(t,e.numDictionaries);for(const o of[...e.dictionaryBatches()].slice().reverse())ks.encode(t,o);const r=t.endVector();return Dt.startFooter(t),Dt.addSchema(t,i),Dt.addVersion(t,Ze.V5),Dt.addRecordBatches(t,n),Dt.addDictionaries(t,r),Dt.finishFooterBuffer(t,Dt.endFooter(t)),t.asUint8Array()}get numRecordBatches(){return this._recordBatches.length}get numDictionaries(){return this._dictionaryBatches.length}constructor(e,t=Ze.V5,i,n){this.schema=e,this.version=t,i&&(this._recordBatches=i),n&&(this._dictionaryBatches=n)}*recordBatches(){for(let e,t=-1,i=this.numRecordBatches;++t<i;)(e=this.getRecordBatch(t))&&(yield e)}*dictionaryBatches(){for(let e,t=-1,i=this.numDictionaries;++t<i;)(e=this.getDictionaryBatch(t))&&(yield e)}getRecordBatch(e){return e>=0&&e<this.numRecordBatches&&this._recordBatches[e]||null}getDictionaryBatch(e){return e>=0&&e<this.numDictionaries&&this._dictionaryBatches[e]||null}}class fC extends jr{get numRecordBatches(){return this._footer.recordBatchesLength()}get numDictionaries(){return this._footer.dictionariesLength()}constructor(e,t){super(e,t.version()),this._footer=t}getRecordBatch(e){if(e>=0&&e<this.numRecordBatches){const t=this._footer.recordBatches(e);if(t)return ks.decode(t)}return null}getDictionaryBatch(e){if(e>=0&&e<this.numDictionaries){const t=this._footer.dictionaries(e);if(t)return ks.decode(t)}return null}}class ks{static decode(e){return new ks(e.metaDataLength(),e.bodyLength(),e.offset())}static encode(e,t){const{metaDataLength:i}=t,n=BigInt(t.offset),r=BigInt(t.bodyLength);return Bh.createBlock(e,n,i,r)}constructor(e,t,i){this.metaDataLength=e,this.offset=ni(i),this.bodyLength=ni(t)}}const Le=Object.freeze({done:!0,value:void 0});class pd{constructor(e){this._json=e}get schema(){return this._json.schema}get batches(){return this._json.batches||[]}get dictionaries(){return this._json.dictionaries||[]}}class ou{tee(){return this._getDOMStream().tee()}pipe(e,t){return this._getNodeStream().pipe(e,t)}pipeTo(e,t){return this._getDOMStream().pipeTo(e,t)}pipeThrough(e,t){return this._getDOMStream().pipeThrough(e,t)}_getDOMStream(){return this._DOMStream||(this._DOMStream=this.toDOMStream())}_getNodeStream(){return this._nodeStream||(this._nodeStream=this.toNodeStream())}}class pC extends ou{constructor(){super(),this._values=[],this.resolvers=[],this._closedPromise=new Promise(e=>this._closedPromiseResolve=e)}get closed(){return this._closedPromise}cancel(e){return K(this,void 0,void 0,function*(){yield this.return(e)})}write(e){this._ensureOpen()&&(this.resolvers.length<=0?this._values.push(e):this.resolvers.shift().resolve({done:!1,value:e}))}abort(e){this._closedPromiseResolve&&(this.resolvers.length<=0?this._error={error:e}:this.resolvers.shift().reject({done:!0,value:e}))}close(){if(this._closedPromiseResolve){const{resolvers:e}=this;for(;e.length>0;)e.shift().resolve(Le);this._closedPromiseResolve(),this._closedPromiseResolve=void 0}}[Symbol.asyncIterator](){return this}toDOMStream(e){return Ut.toDOMStream(this._closedPromiseResolve||this._error?this:this._values,e)}toNodeStream(e){return Ut.toNodeStream(this._closedPromiseResolve||this._error?this:this._values,e)}throw(e){return K(this,void 0,void 0,function*(){return yield this.abort(e),Le})}return(e){return K(this,void 0,void 0,function*(){return yield this.close(),Le})}read(e){return K(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return K(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(...e){return this._values.length>0?Promise.resolve({done:!1,value:this._values.shift()}):this._error?Promise.reject({done:!0,value:this._error.error}):this._closedPromiseResolve?new Promise((t,i)=>{this.resolvers.push({resolve:t,reject:i})}):Promise.resolve(Le)}_ensureOpen(){if(this._closedPromiseResolve)return!0;throw new Error("AsyncQueue is closed")}}class tl extends pC{write(e){if((e=ue(e)).byteLength>0)return super.write(e)}toString(e=!1){return e?Ah(this.toUint8Array(!0)):this.toUint8Array(!1).then(Ah)}toUint8Array(e=!1){return e?Bi(this._values)[0]:K(this,void 0,void 0,function*(){var t,i,n,r;const o=[];let l=0;try{for(var a=!0,h=en(this),c;c=yield h.next(),t=c.done,!t;a=!0){r=c.value,a=!1;const u=r;o.push(u),l+=u.byteLength}}catch(u){i={error:u}}finally{try{!a&&!t&&(n=h.return)&&(yield n.call(h))}finally{if(i)throw i.error}}return Bi(o,l)[0]})}}class Nl{constructor(e){e&&(this.source=new mC(Ut.fromIterable(e)))}[Symbol.iterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class qn{constructor(e){e instanceof qn?this.source=e.source:e instanceof tl?this.source=new Fs(Ut.fromAsyncIterable(e)):Dp(e)?this.source=new Fs(Ut.fromNodeStream(e)):Kc(e)?this.source=new Fs(Ut.fromDOMStream(e)):Mp(e)?this.source=new Fs(Ut.fromDOMStream(e.body)):oo(e)?this.source=new Fs(Ut.fromIterable(e)):nn(e)?this.source=new Fs(Ut.fromAsyncIterable(e)):nr(e)&&(this.source=new Fs(Ut.fromAsyncIterable(e)))}[Symbol.asyncIterator](){return this}next(e){return this.source.next(e)}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}get closed(){return this.source.closed}cancel(e){return this.source.cancel(e)}peek(e){return this.source.peek(e)}read(e){return this.source.read(e)}}class mC{constructor(e){this.source=e}cancel(e){this.return(e)}peek(e){return this.next(e,"peek").value}read(e){return this.next(e,"read").value}next(e,t="read"){return this.source.next({cmd:t,size:e})}throw(e){return Object.create(this.source.throw&&this.source.throw(e)||Le)}return(e){return Object.create(this.source.return&&this.source.return(e)||Le)}}class Fs{constructor(e){this.source=e,this._closedPromise=new Promise(t=>this._closedPromiseResolve=t)}cancel(e){return K(this,void 0,void 0,function*(){yield this.return(e)})}get closed(){return this._closedPromise}read(e){return K(this,void 0,void 0,function*(){return(yield this.next(e,"read")).value})}peek(e){return K(this,void 0,void 0,function*(){return(yield this.next(e,"peek")).value})}next(e,t="read"){return K(this,void 0,void 0,function*(){return yield this.source.next({cmd:t,size:e})})}throw(e){return K(this,void 0,void 0,function*(){const t=this.source.throw&&(yield this.source.throw(e))||Le;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(t)})}return(e){return K(this,void 0,void 0,function*(){const t=this.source.return&&(yield this.source.return(e))||Le;return this._closedPromiseResolve&&this._closedPromiseResolve(),this._closedPromiseResolve=void 0,Object.create(t)})}}class md extends Nl{constructor(e,t){super(),this.position=0,this.buffer=ue(e),this.size=t===void 0?this.buffer.byteLength:t}readInt32(e){const{buffer:t,byteOffset:i}=this.readAt(e,4);return new DataView(t,i).getInt32(0,!0)}seek(e){return this.position=Math.min(e,this.size),e<this.size}read(e){const{buffer:t,size:i,position:n}=this;return t&&n<i?(typeof e!="number"&&(e=Number.POSITIVE_INFINITY),this.position=Math.min(i,n+Math.min(i-n,e)),t.subarray(n,this.position)):null}readAt(e,t){const i=this.buffer,n=Math.min(this.size,e+t);return i?i.subarray(e,n):new Uint8Array(t)}close(){this.buffer&&(this.buffer=null)}throw(e){return this.close(),{done:!0,value:e}}return(e){return this.close(),{done:!0,value:e}}}class zl extends qn{constructor(e,t){super(),this.position=0,this._handle=e,typeof t=="number"?this.size=t:this._pending=K(this,void 0,void 0,function*(){this.size=(yield e.stat()).size,delete this._pending})}readInt32(e){return K(this,void 0,void 0,function*(){const{buffer:t,byteOffset:i}=yield this.readAt(e,4);return new DataView(t,i).getInt32(0,!0)})}seek(e){return K(this,void 0,void 0,function*(){return this._pending&&(yield this._pending),this.position=Math.min(e,this.size),e<this.size})}read(e){return K(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:t,size:i,position:n}=this;if(t&&n<i){typeof e!="number"&&(e=Number.POSITIVE_INFINITY);let r=n,o=0,l=0;const a=Math.min(i,r+Math.min(i-r,e)),h=new Uint8Array(Math.max(0,(this.position=a)-r));for(;(r+=l)<a&&(o+=l)<h.byteLength;)({bytesRead:l}=yield t.read(h,o,h.byteLength-o,r));return h}return null})}readAt(e,t){return K(this,void 0,void 0,function*(){this._pending&&(yield this._pending);const{_handle:i,size:n}=this;if(i&&e+t<n){const r=Math.min(n,e+t),o=new Uint8Array(r-e);return(yield i.read(o,0,t,e)).buffer}return new Uint8Array(t)})}close(){return K(this,void 0,void 0,function*(){const e=this._handle;this._handle=null,e&&(yield e.close())})}throw(e){return K(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}return(e){return K(this,void 0,void 0,function*(){return yield this.close(),{done:!0,value:e}})}}const gC=65536;function Sn(s){return s<0&&(s=4294967295+s+1),`0x${s.toString(16)}`}const $n=8,lu=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8];class rg{constructor(e){this.buffer=e}high(){return this.buffer[1]}low(){return this.buffer[0]}_times(e){const t=new Uint32Array([this.buffer[1]>>>16,this.buffer[1]&65535,this.buffer[0]>>>16,this.buffer[0]&65535]),i=new Uint32Array([e.buffer[1]>>>16,e.buffer[1]&65535,e.buffer[0]>>>16,e.buffer[0]&65535]);let n=t[3]*i[3];this.buffer[0]=n&65535;let r=n>>>16;return n=t[2]*i[3],r+=n,n=t[3]*i[2]>>>0,r+=n,this.buffer[0]+=r<<16,this.buffer[1]=r>>>0<n?gC:0,this.buffer[1]+=r>>>16,this.buffer[1]+=t[1]*i[3]+t[2]*i[2]+t[3]*i[1],this.buffer[1]+=t[0]*i[3]+t[1]*i[2]+t[2]*i[1]+t[3]*i[0]<<16,this}_plus(e){const t=this.buffer[0]+e.buffer[0]>>>0;this.buffer[1]+=e.buffer[1],t<this.buffer[0]>>>0&&++this.buffer[1],this.buffer[0]=t}lessThan(e){return this.buffer[1]<e.buffer[1]||this.buffer[1]===e.buffer[1]&&this.buffer[0]<e.buffer[0]}equals(e){return this.buffer[1]===e.buffer[1]&&this.buffer[0]==e.buffer[0]}greaterThan(e){return e.lessThan(this)}hex(){return`${Sn(this.buffer[1])} ${Sn(this.buffer[0])}`}}class ge extends rg{times(e){return this._times(e),this}plus(e){return this._plus(e),this}static from(e,t=new Uint32Array(2)){return ge.fromString(typeof e=="string"?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(2)){return ge.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(2)){const i=e.length,n=new ge(t);for(let r=0;r<i;){const o=$n<i-r?$n:i-r,l=new ge(new Uint32Array([Number.parseInt(e.slice(r,r+o),10),0])),a=new ge(new Uint32Array([lu[o],0]));n.times(a),n.plus(l),r+=o}return n}static convertArray(e){const t=new Uint32Array(e.length*2);for(let i=-1,n=e.length;++i<n;)ge.from(e[i],new Uint32Array(t.buffer,t.byteOffset+2*i*4,2));return t}static multiply(e,t){return new ge(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new ge(new Uint32Array(e.buffer)).plus(t)}}class bt extends rg{negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[0]==0&&++this.buffer[1],this}times(e){return this._times(e),this}plus(e){return this._plus(e),this}lessThan(e){const t=this.buffer[1]<<0,i=e.buffer[1]<<0;return t<i||t===i&&this.buffer[0]<e.buffer[0]}static from(e,t=new Uint32Array(2)){return bt.fromString(typeof e=="string"?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(2)){return bt.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(2)){const i=e.startsWith("-"),n=e.length,r=new bt(t);for(let o=i?1:0;o<n;){const l=$n<n-o?$n:n-o,a=new bt(new Uint32Array([Number.parseInt(e.slice(o,o+l),10),0])),h=new bt(new Uint32Array([lu[l],0]));r.times(h),r.plus(a),o+=l}return i?r.negate():r}static convertArray(e){const t=new Uint32Array(e.length*2);for(let i=-1,n=e.length;++i<n;)bt.from(e[i],new Uint32Array(t.buffer,t.byteOffset+2*i*4,2));return t}static multiply(e,t){return new bt(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new bt(new Uint32Array(e.buffer)).plus(t)}}class gi{constructor(e){this.buffer=e}high(){return new bt(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2))}low(){return new bt(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset,2))}negate(){return this.buffer[0]=~this.buffer[0]+1,this.buffer[1]=~this.buffer[1],this.buffer[2]=~this.buffer[2],this.buffer[3]=~this.buffer[3],this.buffer[0]==0&&++this.buffer[1],this.buffer[1]==0&&++this.buffer[2],this.buffer[2]==0&&++this.buffer[3],this}times(e){const t=new ge(new Uint32Array([this.buffer[3],0])),i=new ge(new Uint32Array([this.buffer[2],0])),n=new ge(new Uint32Array([this.buffer[1],0])),r=new ge(new Uint32Array([this.buffer[0],0])),o=new ge(new Uint32Array([e.buffer[3],0])),l=new ge(new Uint32Array([e.buffer[2],0])),a=new ge(new Uint32Array([e.buffer[1],0])),h=new ge(new Uint32Array([e.buffer[0],0]));let c=ge.multiply(r,h);this.buffer[0]=c.low();const u=new ge(new Uint32Array([c.high(),0]));return c=ge.multiply(n,h),u.plus(c),c=ge.multiply(r,a),u.plus(c),this.buffer[1]=u.low(),this.buffer[3]=u.lessThan(c)?1:0,this.buffer[2]=u.high(),new ge(new Uint32Array(this.buffer.buffer,this.buffer.byteOffset+8,2)).plus(ge.multiply(i,h)).plus(ge.multiply(n,a)).plus(ge.multiply(r,l)),this.buffer[3]+=ge.multiply(t,h).plus(ge.multiply(i,a)).plus(ge.multiply(n,l)).plus(ge.multiply(r,o)).low(),this}plus(e){const t=new Uint32Array(4);return t[3]=this.buffer[3]+e.buffer[3]>>>0,t[2]=this.buffer[2]+e.buffer[2]>>>0,t[1]=this.buffer[1]+e.buffer[1]>>>0,t[0]=this.buffer[0]+e.buffer[0]>>>0,t[0]<this.buffer[0]>>>0&&++t[1],t[1]<this.buffer[1]>>>0&&++t[2],t[2]<this.buffer[2]>>>0&&++t[3],this.buffer[3]=t[3],this.buffer[2]=t[2],this.buffer[1]=t[1],this.buffer[0]=t[0],this}hex(){return`${Sn(this.buffer[3])} ${Sn(this.buffer[2])} ${Sn(this.buffer[1])} ${Sn(this.buffer[0])}`}static multiply(e,t){return new gi(new Uint32Array(e.buffer)).times(t)}static add(e,t){return new gi(new Uint32Array(e.buffer)).plus(t)}static from(e,t=new Uint32Array(4)){return gi.fromString(typeof e=="string"?e:e.toString(),t)}static fromNumber(e,t=new Uint32Array(4)){return gi.fromString(e.toString(),t)}static fromString(e,t=new Uint32Array(4)){const i=e.startsWith("-"),n=e.length,r=new gi(t);for(let o=i?1:0;o<n;){const l=$n<n-o?$n:n-o,a=new gi(new Uint32Array([Number.parseInt(e.slice(o,o+l),10),0,0,0])),h=new gi(new Uint32Array([lu[l],0,0,0]));r.times(h),r.plus(a),o+=l}return i?r.negate():r}static convertArray(e){const t=new Uint32Array(e.length*4);for(let i=-1,n=e.length;++i<n;)gi.from(e[i],new Uint32Array(t.buffer,t.byteOffset+4*4*i,4));return t}}class og extends te{constructor(e,t,i,n,r=Ze.V5){super(),this.nodesIndex=-1,this.buffersIndex=-1,this.bytes=e,this.nodes=t,this.buffers=i,this.dictionaries=n,this.metadataVersion=r}visit(e){return super.visit(e instanceof Re?e.type:e)}visitNull(e,{length:t}=this.nextFieldNode()){return oe({type:e,length:t})}visitBool(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitInt(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitFloat(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitUtf8(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitBinary(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),data:this.readData(e)})}visitFixedSizeBinary(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDate(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitTimestamp(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitTime(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDecimal(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitList(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}visitStruct(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),children:this.visitMany(e.children)})}visitUnion(e,{length:t,nullCount:i}=this.nextFieldNode()){return this.metadataVersion<Ze.V5&&this.readNullBitmap(e,i),e.mode===pt.Sparse?this.visitSparseUnion(e,{length:t,nullCount:i}):this.visitDenseUnion(e,{length:t,nullCount:i})}visitDenseUnion(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,typeIds:this.readTypeIds(e),valueOffsets:this.readOffsets(e),children:this.visitMany(e.children)})}visitSparseUnion(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,typeIds:this.readTypeIds(e),children:this.visitMany(e.children)})}visitDictionary(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e.indices),dictionary:this.readDictionary(e)})}visitInterval(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitDuration(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),data:this.readData(e)})}visitFixedSizeList(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),child:this.visit(e.children[0])})}visitMap(e,{length:t,nullCount:i}=this.nextFieldNode()){return oe({type:e,length:t,nullCount:i,nullBitmap:this.readNullBitmap(e,i),valueOffsets:this.readOffsets(e),child:this.visit(e.children[0])})}nextFieldNode(){return this.nodes[++this.nodesIndex]}nextBufferRange(){return this.buffers[++this.buffersIndex]}readNullBitmap(e,t,i=this.nextBufferRange()){return t>0&&this.readData(e,i)||new Uint8Array(0)}readOffsets(e,t){return this.readData(e,t)}readTypeIds(e,t){return this.readData(e,t)}readData(e,{length:t,offset:i}=this.nextBufferRange()){return this.bytes.subarray(i,i+t)}readDictionary(e){return this.dictionaries.get(e.id)}}class bC extends og{constructor(e,t,i,n,r){super(new Uint8Array(0),t,i,n,r),this.sources=e}readNullBitmap(e,t,{offset:i}=this.nextBufferRange()){return t<=0?new Uint8Array(0):Dl(this.sources[i])}readOffsets(e,{offset:t}=this.nextBufferRange()){return ye(Uint8Array,ye(Int32Array,this.sources[t]))}readTypeIds(e,{offset:t}=this.nextBufferRange()){return ye(Uint8Array,ye(e.ArrayType,this.sources[t]))}readData(e,{offset:t}=this.nextBufferRange()){const{sources:i}=this;return B.isTimestamp(e)||(B.isInt(e)||B.isTime(e))&&e.bitWidth===64||B.isDuration(e)||B.isDate(e)&&e.unit===Ki.MILLISECOND?ye(Uint8Array,bt.convertArray(i[t])):B.isDecimal(e)?ye(Uint8Array,gi.convertArray(i[t])):B.isBinary(e)||B.isFixedSizeBinary(e)?yC(i[t]):B.isBool(e)?Dl(i[t]):B.isUtf8(e)?$c(i[t].join("")):ye(Uint8Array,ye(e.ArrayType,i[t].map(n=>+n)))}}function yC(s){const e=s.join(""),t=new Uint8Array(e.length/2);for(let i=0;i<e.length;i+=2)t[i>>1]=Number.parseInt(e.slice(i,i+2),16);return t}class W extends te{compareSchemas(e,t){return e===t||t instanceof e.constructor&&this.compareManyFields(e.fields,t.fields)}compareManyFields(e,t){return e===t||Array.isArray(e)&&Array.isArray(t)&&e.length===t.length&&e.every((i,n)=>this.compareFields(i,t[n]))}compareFields(e,t){return e===t||t instanceof e.constructor&&e.name===t.name&&e.nullable===t.nullable&&this.visit(e.type,t.type)}}function mt(s,e){return e instanceof s.constructor}function lo(s,e){return s===e||mt(s,e)}function es(s,e){return s===e||mt(s,e)&&s.bitWidth===e.bitWidth&&s.isSigned===e.isSigned}function Ea(s,e){return s===e||mt(s,e)&&s.precision===e.precision}function vC(s,e){return s===e||mt(s,e)&&s.byteWidth===e.byteWidth}function au(s,e){return s===e||mt(s,e)&&s.unit===e.unit}function ao(s,e){return s===e||mt(s,e)&&s.unit===e.unit&&s.timezone===e.timezone}function ho(s,e){return s===e||mt(s,e)&&s.unit===e.unit&&s.bitWidth===e.bitWidth}function wC(s,e){return s===e||mt(s,e)&&s.children.length===e.children.length&&Ss.compareManyFields(s.children,e.children)}function CC(s,e){return s===e||mt(s,e)&&s.children.length===e.children.length&&Ss.compareManyFields(s.children,e.children)}function hu(s,e){return s===e||mt(s,e)&&s.mode===e.mode&&s.typeIds.every((t,i)=>t===e.typeIds[i])&&Ss.compareManyFields(s.children,e.children)}function EC(s,e){return s===e||mt(s,e)&&s.id===e.id&&s.isOrdered===e.isOrdered&&Ss.visit(s.indices,e.indices)&&Ss.visit(s.dictionary,e.dictionary)}function cu(s,e){return s===e||mt(s,e)&&s.unit===e.unit}function co(s,e){return s===e||mt(s,e)&&s.unit===e.unit}function xC(s,e){return s===e||mt(s,e)&&s.listSize===e.listSize&&s.children.length===e.children.length&&Ss.compareManyFields(s.children,e.children)}function kC(s,e){return s===e||mt(s,e)&&s.keysSorted===e.keysSorted&&s.children.length===e.children.length&&Ss.compareManyFields(s.children,e.children)}W.prototype.visitNull=lo;W.prototype.visitBool=lo;W.prototype.visitInt=es;W.prototype.visitInt8=es;W.prototype.visitInt16=es;W.prototype.visitInt32=es;W.prototype.visitInt64=es;W.prototype.visitUint8=es;W.prototype.visitUint16=es;W.prototype.visitUint32=es;W.prototype.visitUint64=es;W.prototype.visitFloat=Ea;W.prototype.visitFloat16=Ea;W.prototype.visitFloat32=Ea;W.prototype.visitFloat64=Ea;W.prototype.visitUtf8=lo;W.prototype.visitBinary=lo;W.prototype.visitFixedSizeBinary=vC;W.prototype.visitDate=au;W.prototype.visitDateDay=au;W.prototype.visitDateMillisecond=au;W.prototype.visitTimestamp=ao;W.prototype.visitTimestampSecond=ao;W.prototype.visitTimestampMillisecond=ao;W.prototype.visitTimestampMicrosecond=ao;W.prototype.visitTimestampNanosecond=ao;W.prototype.visitTime=ho;W.prototype.visitTimeSecond=ho;W.prototype.visitTimeMillisecond=ho;W.prototype.visitTimeMicrosecond=ho;W.prototype.visitTimeNanosecond=ho;W.prototype.visitDecimal=lo;W.prototype.visitList=wC;W.prototype.visitStruct=CC;W.prototype.visitUnion=hu;W.prototype.visitDenseUnion=hu;W.prototype.visitSparseUnion=hu;W.prototype.visitDictionary=EC;W.prototype.visitInterval=cu;W.prototype.visitIntervalDayTime=cu;W.prototype.visitIntervalYearMonth=cu;W.prototype.visitDuration=co;W.prototype.visitDurationSecond=co;W.prototype.visitDurationMillisecond=co;W.prototype.visitDurationMicrosecond=co;W.prototype.visitDurationNanosecond=co;W.prototype.visitFixedSizeList=xC;W.prototype.visitMap=kC;const Ss=new W;function Nh(s,e){return Ss.compareSchemas(s,e)}function Ya(s,e){return SC(s,e.map(t=>t.data.concat()))}function SC(s,e){const t=[...s.fields],i=[],n={numBatches:e.reduce((u,d)=>Math.max(u,d.length),0)};let r=0,o=0,l=-1;const a=e.length;let h,c=[];for(;n.numBatches-- >0;){for(o=Number.POSITIVE_INFINITY,l=-1;++l<a;)c[l]=h=e[l].shift(),o=Math.min(o,h?h.length:o);Number.isFinite(o)&&(c=_C(t,o,c,e,n),o>0&&(i[r++]=oe({type:new ht(t),length:o,nullCount:0,children:c.slice()})))}return[s=s.assign(t),i.map(u=>new Ct(s,u))]}function _C(s,e,t,i,n){var r;const o=(e+63&-64)>>3;for(let l=-1,a=i.length;++l<a;){const h=t[l],c=h==null?void 0:h.length;if(c>=e)c===e?t[l]=h:(t[l]=h.slice(0,e),n.numBatches=Math.max(n.numBatches,i[l].unshift(h.slice(e,c-e))));else{const u=s[l];s[l]=u.clone({nullable:!0}),t[l]=(r=h==null?void 0:h._changeLengthAndBackfillNullBitmap(e))!==null&&r!==void 0?r:oe({type:u.type,length:e,nullCount:e,nullBitmap:new Uint8Array(o)})}}return t}var lg;class ot{constructor(...e){var t,i;if(e.length===0)return this.batches=[],this.schema=new me([]),this._offsets=[0],this;let n,r;e[0]instanceof me&&(n=e.shift()),e.at(-1)instanceof Uint32Array&&(r=e.pop());const o=a=>{if(a){if(a instanceof Ct)return[a];if(a instanceof ot)return a.batches;if(a instanceof Ce){if(a.type instanceof ht)return[new Ct(new me(a.type.children),a)]}else{if(Array.isArray(a))return a.flatMap(h=>o(h));if(typeof a[Symbol.iterator]=="function")return[...a].flatMap(h=>o(h));if(typeof a=="object"){const h=Object.keys(a),c=h.map(f=>new pe([a[f]])),u=new me(h.map((f,p)=>new Re(String(f),c[p].type))),[,d]=Ya(u,c);return d.length===0?[new Ct(a)]:d}}}return[]},l=e.flatMap(a=>o(a));if(n=(i=n??((t=l[0])===null||t===void 0?void 0:t.schema))!==null&&i!==void 0?i:new me([]),!(n instanceof me))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");for(const a of l){if(!(a instanceof Ct))throw new TypeError("Table constructor expects a [Schema, RecordBatch[]] pair.");if(!Nh(n,a.schema))throw new TypeError("Table and inner RecordBatch schemas must be equivalent.")}this.schema=n,this.batches=l,this._offsets=r??qm(this.data)}get data(){return this.batches.map(({data:e})=>e)}get numCols(){return this.schema.fields.length}get numRows(){return this.data.reduce((e,t)=>e+t.length,0)}get nullCount(){return this._nullCount===-1&&(this._nullCount=Gm(this.data)),this._nullCount}isValid(e){return!1}get(e){return null}set(e,t){}indexOf(e,t){return-1}getByteLength(e){return 0}[Symbol.iterator](){return this.batches.length>0?ru.visit(new pe(this.data)):new Array(0)[Symbol.iterator]()}toArray(){return[...this]}toString(){return`[
  ${this.toArray().join(`,
  `)}
]`}concat(...e){const t=this.schema,i=this.data.concat(e.flatMap(({data:n})=>n));return new ot(t,i.map(n=>new Ct(t,n)))}slice(e,t){const i=this.schema;[e,t]=Um({length:this.numRows},e,t);const n=$m(this.data,this._offsets,e,t);return new ot(i,n.map(r=>new Ct(i,r)))}getChild(e){return this.getChildAt(this.schema.fields.findIndex(t=>t.name===e))}getChildAt(e){if(e>-1&&e<this.schema.fields.length){const t=this.data.map(i=>i.children[e]);if(t.length===0){const{type:i}=this.schema.fields[e],n=oe({type:i,length:0,nullCount:0});t.push(n._changeLengthAndBackfillNullBitmap(this.numRows))}return new pe(t)}return null}setChild(e,t){var i;return this.setChildAt((i=this.schema.fields)===null||i===void 0?void 0:i.findIndex(n=>n.name===e),t)}setChildAt(e,t){let i=this.schema,n=[...this.batches];if(e>-1&&e<this.numCols){t||(t=new pe([oe({type:new Cs,length:this.numRows})]));const r=i.fields.slice(),o=r[e].clone({type:t.type}),l=this.schema.fields.map((a,h)=>this.getChildAt(h));[r[e],l[e]]=[o,t],[i,n]=Ya(i,l)}return new ot(i,n)}select(e){const t=this.schema.fields.reduce((i,n,r)=>i.set(n.name,r),new Map);return this.selectAt(e.map(i=>t.get(i)).filter(i=>i>-1))}selectAt(e){const t=this.schema.selectAt(e),i=this.batches.map(n=>n.selectAt(e));return new ot(t,i)}assign(e){const t=this.schema.fields,[i,n]=e.schema.fields.reduce((l,a,h)=>{const[c,u]=l,d=t.findIndex(f=>f.name===a.name);return~d?u[d]=h:c.push(h),l},[[],[]]),r=this.schema.assign(e.schema),o=[...t.map((l,a)=>[a,n[a]]).map(([l,a])=>a===void 0?this.getChildAt(l):e.getChildAt(a)),...i.map(l=>e.getChildAt(l))].filter(Boolean);return new ot(...Ya(r,o))}}lg=Symbol.toStringTag;ot[lg]=(s=>(s.schema=null,s.batches=[],s._offsets=new Uint32Array([0]),s._nullCount=-1,s[Symbol.isConcatSpreadable]=!0,s.isValid=In(nu),s.get=In(_t.getVisitFn(y.Struct)),s.set=Km(Xt.getVisitFn(y.Struct)),s.indexOf=Ym(Al.getVisitFn(y.Struct)),s.getByteLength=In(Fi.getVisitFn(y.Struct)),"Table"))(ot.prototype);var ag;let Ct=class kr{constructor(...e){switch(e.length){case 2:{if([this.schema]=e,!(this.schema instanceof me))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");if([,this.data=oe({nullCount:0,type:new ht(this.schema.fields),children:this.schema.fields.map(t=>oe({type:t.type,nullCount:0}))})]=e,!(this.data instanceof Ce))throw new TypeError("RecordBatch constructor expects a [Schema, Data] pair.");[this.schema,this.data]=gd(this.schema,this.data.children);break}case 1:{const[t]=e,{fields:i,children:n,length:r}=Object.keys(t).reduce((a,h,c)=>(a.children[c]=t[h],a.length=Math.max(a.length,t[h].length),a.fields[c]=Re.new({name:h,type:t[h].type,nullable:!0}),a),{length:0,fields:new Array,children:new Array}),o=new me(i),l=oe({type:new ht(i),length:r,children:n,nullCount:0});[this.schema,this.data]=gd(o,l.children,r);break}default:throw new TypeError("RecordBatch constructor expects an Object mapping names to child Data, or a [Schema, Data] pair.")}}get dictionaries(){return this._dictionaries||(this._dictionaries=hg(this.schema.fields,this.data.children))}get numCols(){return this.schema.fields.length}get numRows(){return this.data.length}get nullCount(){return this.data.nullCount}isValid(e){return this.data.getValid(e)}get(e){return _t.visit(this.data,e)}set(e,t){return Xt.visit(this.data,e,t)}indexOf(e,t){return Al.visit(this.data,e,t)}getByteLength(e){return Fi.visit(this.data,e)}[Symbol.iterator](){return ru.visit(new pe([this.data]))}toArray(){return[...this]}concat(...e){return new ot(this.schema,[this,...e])}slice(e,t){const[i]=new pe([this.data]).slice(e,t).data;return new kr(this.schema,i)}getChild(e){var t;return this.getChildAt((t=this.schema.fields)===null||t===void 0?void 0:t.findIndex(i=>i.name===e))}getChildAt(e){return e>-1&&e<this.schema.fields.length?new pe([this.data.children[e]]):null}setChild(e,t){var i;return this.setChildAt((i=this.schema.fields)===null||i===void 0?void 0:i.findIndex(n=>n.name===e),t)}setChildAt(e,t){let i=this.schema,n=this.data;if(e>-1&&e<this.numCols){t||(t=new pe([oe({type:new Cs,length:this.numRows})]));const r=i.fields.slice(),o=n.children.slice(),l=r[e].clone({type:t.type});[r[e],o[e]]=[l,t.data[0]],i=new me(r,new Map(this.schema.metadata)),n=oe({type:new ht(r),children:o})}return new kr(i,n)}select(e){const t=this.schema.select(e),i=new ht(t.fields),n=[];for(const r of e){const o=this.schema.fields.findIndex(l=>l.name===r);~o&&(n[o]=this.data.children[o])}return new kr(t,oe({type:i,length:this.numRows,children:n}))}selectAt(e){const t=this.schema.selectAt(e),i=e.map(r=>this.data.children[r]).filter(Boolean),n=oe({type:new ht(t.fields),length:this.numRows,children:i});return new kr(t,n)}};ag=Symbol.toStringTag;Ct[ag]=(s=>(s._nullCount=-1,s[Symbol.isConcatSpreadable]=!0,"RecordBatch"))(Ct.prototype);function gd(s,e,t=e.reduce((i,n)=>Math.max(i,n.length),0)){var i;const n=[...s.fields],r=[...e],o=(t+63&-64)>>3;for(const[l,a]of s.fields.entries()){const h=e[l];(!h||h.length!==t)&&(n[l]=a.clone({nullable:!0}),r[l]=(i=h==null?void 0:h._changeLengthAndBackfillNullBitmap(t))!==null&&i!==void 0?i:oe({type:a.type,length:t,nullCount:t,nullBitmap:new Uint8Array(o)}))}return[s.assign(n),oe({type:new ht(n),length:t,children:r})]}function hg(s,e,t=new Map){var i,n;if(((i=s==null?void 0:s.length)!==null&&i!==void 0?i:0)>0&&(s==null?void 0:s.length)===(e==null?void 0:e.length))for(let r=-1,o=s.length;++r<o;){const{type:l}=s[r],a=e[r];for(const h of[a,...((n=a==null?void 0:a.dictionary)===null||n===void 0?void 0:n.data)||[]])hg(l.children,h==null?void 0:h.children,t);if(B.isDictionary(l)){const{id:h}=l;if(!t.has(h))a!=null&&a.dictionary&&t.set(h,a.dictionary);else if(t.get(h)!==a.dictionary)throw new Error("Cannot create Schema containing two different dictionaries with the same Id")}}return t}class uu extends Ct{constructor(e){const t=e.fields.map(n=>oe({type:n.type})),i=oe({type:new ht(e.fields),nullCount:0,children:t});super(e,i)}}var Hl;(function(s){s[s.BUFFER=0]="BUFFER"})(Hl||(Hl={}));var Vl;(function(s){s[s.LZ4_FRAME=0]="LZ4_FRAME",s[s.ZSTD=1]="ZSTD"})(Vl||(Vl={}));class ls{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsBodyCompression(e,t){return(t||new ls).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsBodyCompression(e,t){return e.setPosition(e.position()+we),(t||new ls).__init(e.readInt32(e.position())+e.position(),e)}codec(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt8(this.bb_pos+e):Vl.LZ4_FRAME}method(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt8(this.bb_pos+e):Hl.BUFFER}static startBodyCompression(e){e.startObject(2)}static addCodec(e,t){e.addFieldInt8(0,t,Vl.LZ4_FRAME)}static addMethod(e,t){e.addFieldInt8(1,t,Hl.BUFFER)}static endBodyCompression(e){return e.endObject()}static createBodyCompression(e,t,i){return ls.startBodyCompression(e),ls.addCodec(e,t),ls.addMethod(e,i),ls.endBodyCompression(e)}}class cg{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}offset(){return this.bb.readInt64(this.bb_pos)}length(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createBuffer(e,t,i){return e.prep(8,16),e.writeInt64(BigInt(i??0)),e.writeInt64(BigInt(t??0)),e.offset()}}let ug=class{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}length(){return this.bb.readInt64(this.bb_pos)}nullCount(){return this.bb.readInt64(this.bb_pos+8)}static sizeOf(){return 16}static createFieldNode(e,t,i){return e.prep(8,16),e.writeInt64(BigInt(i??0)),e.writeInt64(BigInt(t??0)),e.offset()}},Ui=class zh{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsRecordBatch(e,t){return(t||new zh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsRecordBatch(e,t){return e.setPosition(e.position()+we),(t||new zh).__init(e.readInt32(e.position())+e.position(),e)}length(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}nodes(e,t){const i=this.bb.__offset(this.bb_pos,6);return i?(t||new ug).__init(this.bb.__vector(this.bb_pos+i)+e*16,this.bb):null}nodesLength(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}buffers(e,t){const i=this.bb.__offset(this.bb_pos,8);return i?(t||new cg).__init(this.bb.__vector(this.bb_pos+i)+e*16,this.bb):null}buffersLength(){const e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}compression(e){const t=this.bb.__offset(this.bb_pos,10);return t?(e||new ls).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}static startRecordBatch(e){e.startObject(4)}static addLength(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addNodes(e,t){e.addFieldOffset(1,t,0)}static startNodesVector(e,t){e.startVector(16,t,8)}static addBuffers(e,t){e.addFieldOffset(2,t,0)}static startBuffersVector(e,t){e.startVector(16,t,8)}static addCompression(e,t){e.addFieldOffset(3,t,0)}static endRecordBatch(e){return e.endObject()}},En=class Hh{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsDictionaryBatch(e,t){return(t||new Hh).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsDictionaryBatch(e,t){return e.setPosition(e.position()+we),(t||new Hh).__init(e.readInt32(e.position())+e.position(),e)}id(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}data(e){const t=this.bb.__offset(this.bb_pos,6);return t?(e||new Ui).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}isDelta(){const e=this.bb.__offset(this.bb_pos,8);return e?!!this.bb.readInt8(this.bb_pos+e):!1}static startDictionaryBatch(e){e.startObject(3)}static addId(e,t){e.addFieldInt64(0,t,BigInt("0"))}static addData(e,t){e.addFieldOffset(1,t,0)}static addIsDelta(e,t){e.addFieldInt8(2,+t,0)}static endDictionaryBatch(e){return e.endObject()}};var Wl;(function(s){s[s.NONE=0]="NONE",s[s.Schema=1]="Schema",s[s.DictionaryBatch=2]="DictionaryBatch",s[s.RecordBatch=3]="RecordBatch",s[s.Tensor=4]="Tensor",s[s.SparseTensor=5]="SparseTensor"})(Wl||(Wl={}));let rs=class fi{constructor(){this.bb=null,this.bb_pos=0}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsMessage(e,t){return(t||new fi).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsMessage(e,t){return e.setPosition(e.position()+we),(t||new fi).__init(e.readInt32(e.position())+e.position(),e)}version(){const e=this.bb.__offset(this.bb_pos,4);return e?this.bb.readInt16(this.bb_pos+e):jn.V1}headerType(){const e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Wl.NONE}header(e){const t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__union(e,this.bb_pos+t):null}bodyLength(){const e=this.bb.__offset(this.bb_pos,10);return e?this.bb.readInt64(this.bb_pos+e):BigInt("0")}customMetadata(e,t){const i=this.bb.__offset(this.bb_pos,12);return i?(t||new je).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+i)+e*4),this.bb):null}customMetadataLength(){const e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}static startMessage(e){e.startObject(5)}static addVersion(e,t){e.addFieldInt16(0,t,jn.V1)}static addHeaderType(e,t){e.addFieldInt8(1,t,Wl.NONE)}static addHeader(e,t){e.addFieldOffset(2,t,0)}static addBodyLength(e,t){e.addFieldInt64(3,t,BigInt("0"))}static addCustomMetadata(e,t){e.addFieldOffset(4,t,0)}static createCustomMetadataVector(e,t){e.startVector(4,t.length,4);for(let i=t.length-1;i>=0;i--)e.addOffset(t[i]);return e.endVector()}static startCustomMetadataVector(e,t){e.startVector(4,t,4)}static endMessage(e){return e.endObject()}static finishMessageBuffer(e,t){e.finish(t)}static finishSizePrefixedMessageBuffer(e,t){e.finish(t,void 0,!0)}static createMessage(e,t,i,n,r,o){return fi.startMessage(e),fi.addVersion(e,t),fi.addHeaderType(e,i),fi.addHeader(e,n),fi.addBodyLength(e,r),fi.addCustomMetadata(e,o),fi.endMessage(e)}};class RC extends te{visit(e,t){return e==null||t==null?void 0:super.visit(e,t)}visitNull(e,t){return fd.startNull(t),fd.endNull(t)}visitInt(e,t){return Lt.startInt(t),Lt.addBitWidth(t,e.bitWidth),Lt.addIsSigned(t,e.isSigned),Lt.endInt(t)}visitFloat(e,t){return xi.startFloatingPoint(t),xi.addPrecision(t,e.precision),xi.endFloatingPoint(t)}visitBinary(e,t){return js.startBinary(t),js.endBinary(t)}visitBool(e,t){return dd.startBool(t),dd.endBool(t)}visitUtf8(e,t){return $s.startUtf8(t),$s.endUtf8(t)}visitDecimal(e,t){return vt.startDecimal(t),vt.addScale(t,e.scale),vt.addPrecision(t,e.precision),vt.addBitWidth(t,e.bitWidth),vt.endDecimal(t)}visitDate(e,t){return Xo.startDate(t),Xo.addUnit(t,e.unit),Xo.endDate(t)}visitTime(e,t){return jt.startTime(t),jt.addUnit(t,e.unit),jt.addBitWidth(t,e.bitWidth),jt.endTime(t)}visitTimestamp(e,t){const i=e.timezone&&t.createString(e.timezone)||void 0;return Gt.startTimestamp(t),Gt.addUnit(t,e.unit),i!==void 0&&Gt.addTimezone(t,i),Gt.endTimestamp(t)}visitInterval(e,t){return ki.startInterval(t),ki.addUnit(t,e.unit),ki.endInterval(t)}visitDuration(e,t){return wi.startDuration(t),wi.addUnit(t,e.unit),wi.endDuration(t)}visitList(e,t){return Gs.startList(t),Gs.endList(t)}visitStruct(e,t){return qs.startStruct_(t),qs.endStruct_(t)}visitUnion(e,t){wt.startTypeIdsVector(t,e.typeIds.length);const i=wt.createTypeIdsVector(t,e.typeIds);return wt.startUnion(t),wt.addMode(t,e.mode),wt.addTypeIds(t,i),wt.endUnion(t)}visitDictionary(e,t){const i=this.visit(e.indices,t);return qi.startDictionaryEncoding(t),qi.addId(t,BigInt(e.id)),qi.addIsOrdered(t,e.isOrdered),i!==void 0&&qi.addIndexType(t,i),qi.endDictionaryEncoding(t)}visitFixedSizeBinary(e,t){return Ci.startFixedSizeBinary(t),Ci.addByteWidth(t,e.byteWidth),Ci.endFixedSizeBinary(t)}visitFixedSizeList(e,t){return Ei.startFixedSizeList(t),Ei.addListSize(t,e.listSize),Ei.endFixedSizeList(t)}visitMap(e,t){return Zo.startMap(t),Zo.addKeysSorted(t,e.keysSorted),Zo.endMap(t)}}const Qa=new RC;function TC(s,e=new Map){return new me(DC(s,e),il(s.metadata),e)}function dg(s){return new Pt(s.count,fg(s.columns),pg(s.columns))}function MC(s){return new Pi(dg(s.data),s.id,s.isDelta)}function DC(s,e){return(s.fields||[]).filter(Boolean).map(t=>Re.fromJSON(t,e))}function bd(s,e){return(s.children||[]).filter(Boolean).map(t=>Re.fromJSON(t,e))}function fg(s){return(s||[]).reduce((e,t)=>[...e,new _s(t.count,AC(t.VALIDITY)),...fg(t.children)],[])}function pg(s,e=[]){for(let t=-1,i=(s||[]).length;++t<i;){const n=s[t];n.VALIDITY&&e.push(new Ti(e.length,n.VALIDITY.length)),n.TYPE_ID&&e.push(new Ti(e.length,n.TYPE_ID.length)),n.OFFSET&&e.push(new Ti(e.length,n.OFFSET.length)),n.DATA&&e.push(new Ti(e.length,n.DATA.length)),e=pg(n.children,e)}return e}function AC(s){return(s||[]).reduce((e,t)=>e+ +(t===0),0)}function OC(s,e){let t,i,n,r,o,l;return!e||!(r=s.dictionary)?(o=vd(s,bd(s,e)),n=new Re(s.name,o,s.nullable,il(s.metadata))):e.has(t=r.id)?(i=(i=r.indexType)?yd(i):new Vr,l=new Wn(e.get(t),i,t,r.isOrdered),n=new Re(s.name,l,s.nullable,il(s.metadata))):(i=(i=r.indexType)?yd(i):new Vr,e.set(t,o=vd(s,bd(s,e))),l=new Wn(o,i,t,r.isOrdered),n=new Re(s.name,l,s.nullable,il(s.metadata))),n||null}function il(s=[]){return new Map(s.map(({key:e,value:t})=>[e,t]))}function yd(s){return new Es(s.isSigned,s.bitWidth)}function vd(s,e){const t=s.type.name;switch(t){case"NONE":return new Cs;case"null":return new Cs;case"binary":return new gl;case"utf8":return new bl;case"bool":return new yl;case"list":return new kl((e||[])[0]);case"struct":return new ht(e||[]);case"struct_":return new ht(e||[])}switch(t){case"int":{const i=s.type;return new Es(i.isSigned,i.bitWidth)}case"floatingpoint":{const i=s.type;return new Wr(kt[i.precision])}case"decimal":{const i=s.type;return new vl(i.scale,i.precision,i.bitWidth)}case"date":{const i=s.type;return new wl(Ki[i.unit])}case"time":{const i=s.type;return new Ur(Y[i.unit],i.bitWidth)}case"timestamp":{const i=s.type;return new Cl(Y[i.unit],i.timezone)}case"interval":{const i=s.type;return new El(ws[i.unit])}case"duration":{const i=s.type;return new xl(Y[i.unit])}case"union":{const i=s.type,[n,...r]=(i.mode+"").toLowerCase(),o=n.toUpperCase()+r.join("");return new Sl(pt[o],i.typeIds||[],e||[])}case"fixedsizebinary":{const i=s.type;return new _l(i.byteWidth)}case"fixedsizelist":{const i=s.type;return new Rl(i.listSize,(e||[])[0])}case"map":{const i=s.type;return new Tl((e||[])[0],i.keysSorted)}}throw new Error(`Unrecognized type: "${t}"`)}var LC=sg,IC=Un;class ct{static fromJSON(e,t){const i=new ct(0,Ze.V5,t);return i._createHeader=BC(e,t),i}static decode(e){e=new IC(ue(e));const t=rs.getRootAsMessage(e),i=t.bodyLength(),n=t.version(),r=t.headerType(),o=new ct(i,n,r);return o._createHeader=FC(t,r),o}static encode(e){const t=new LC;let i=-1;return e.isSchema()?i=me.encode(t,e.header()):e.isRecordBatch()?i=Pt.encode(t,e.header()):e.isDictionaryBatch()&&(i=Pi.encode(t,e.header())),rs.startMessage(t),rs.addVersion(t,Ze.V5),rs.addHeader(t,i),rs.addHeaderType(t,e.headerType),rs.addBodyLength(t,BigInt(e.bodyLength)),rs.finishMessageBuffer(t,rs.endMessage(t)),t.asUint8Array()}static from(e,t=0){if(e instanceof me)return new ct(0,Ze.V5,fe.Schema,e);if(e instanceof Pt)return new ct(t,Ze.V5,fe.RecordBatch,e);if(e instanceof Pi)return new ct(t,Ze.V5,fe.DictionaryBatch,e);throw new Error(`Unrecognized Message header: ${e}`)}get type(){return this.headerType}get version(){return this._version}get headerType(){return this._headerType}get bodyLength(){return this._bodyLength}header(){return this._createHeader()}isSchema(){return this.headerType===fe.Schema}isRecordBatch(){return this.headerType===fe.RecordBatch}isDictionaryBatch(){return this.headerType===fe.DictionaryBatch}constructor(e,t,i,n){this._version=t,this._headerType=i,this.body=new Uint8Array(0),n&&(this._createHeader=()=>n),this._bodyLength=ni(e)}}class Pt{get nodes(){return this._nodes}get length(){return this._length}get buffers(){return this._buffers}constructor(e,t,i){this._nodes=t,this._buffers=i,this._length=ni(e)}}class Pi{get id(){return this._id}get data(){return this._data}get isDelta(){return this._isDelta}get length(){return this.data.length}get nodes(){return this.data.nodes}get buffers(){return this.data.buffers}constructor(e,t,i=!1){this._data=e,this._isDelta=i,this._id=ni(t)}}class Ti{constructor(e,t){this.offset=ni(e),this.length=ni(t)}}class _s{constructor(e,t){this.length=ni(e),this.nullCount=ni(t)}}function BC(s,e){return()=>{switch(e){case fe.Schema:return me.fromJSON(s);case fe.RecordBatch:return Pt.fromJSON(s);case fe.DictionaryBatch:return Pi.fromJSON(s)}throw new Error(`Unrecognized Message type: { name: ${fe[e]}, type: ${e} }`)}}function FC(s,e){return()=>{switch(e){case fe.Schema:return me.decode(s.header(new mi),new Map,s.version());case fe.RecordBatch:return Pt.decode(s.header(new Ui),s.version());case fe.DictionaryBatch:return Pi.decode(s.header(new En),s.version())}throw new Error(`Unrecognized Message type: { name: ${fe[e]}, type: ${e} }`)}}Re.encode=$C;Re.decode=GC;Re.fromJSON=OC;me.encode=qC;me.decode=PC;me.fromJSON=TC;Pt.encode=KC;Pt.decode=NC;Pt.fromJSON=dg;Pi.encode=YC;Pi.decode=zC;Pi.fromJSON=MC;_s.encode=QC;_s.decode=VC;Ti.encode=JC;Ti.decode=HC;function PC(s,e=new Map,t=Ze.V5){const i=jC(s,e);return new me(i,sl(s),e,t)}function NC(s,e=Ze.V5){if(s.compression()!==null)throw new Error("Record batch compression not implemented");return new Pt(s.length(),WC(s),UC(s,e))}function zC(s,e=Ze.V5){return new Pi(Pt.decode(s.data(),e),s.id(),s.isDelta())}function HC(s){return new Ti(s.offset(),s.length())}function VC(s){return new _s(s.length(),s.nullCount())}function WC(s){const e=[];for(let t,i=-1,n=-1,r=s.nodesLength();++i<r;)(t=s.nodes(i))&&(e[++n]=_s.decode(t));return e}function UC(s,e){const t=[];for(let i,n=-1,r=-1,o=s.buffersLength();++n<o;)(i=s.buffers(n))&&(e<Ze.V4&&(i.bb_pos+=8*(n+1)),t[++r]=Ti.decode(i));return t}function jC(s,e){const t=[];for(let i,n=-1,r=-1,o=s.fieldsLength();++n<o;)(i=s.fields(n))&&(t[++r]=Re.decode(i,e));return t}function wd(s,e){const t=[];for(let i,n=-1,r=-1,o=s.childrenLength();++n<o;)(i=s.children(n))&&(t[++r]=Re.decode(i,e));return t}function GC(s,e){let t,i,n,r,o,l;return!e||!(l=s.dictionary())?(n=Ed(s,wd(s,e)),i=new Re(s.name(),n,s.nullable(),sl(s))):e.has(t=ni(l.id()))?(r=(r=l.indexType())?Cd(r):new Vr,o=new Wn(e.get(t),r,t,l.isOrdered()),i=new Re(s.name(),o,s.nullable(),sl(s))):(r=(r=l.indexType())?Cd(r):new Vr,e.set(t,n=Ed(s,wd(s,e))),o=new Wn(n,r,t,l.isOrdered()),i=new Re(s.name(),o,s.nullable(),sl(s))),i||null}function sl(s){const e=new Map;if(s)for(let t,i,n=-1,r=Math.trunc(s.customMetadataLength());++n<r;)(t=s.customMetadata(n))&&(i=t.key())!=null&&e.set(i,t.value());return e}function Cd(s){return new Es(s.isSigned(),s.bitWidth())}function Ed(s,e){const t=s.typeType();switch(t){case Me.NONE:return new Cs;case Me.Null:return new Cs;case Me.Binary:return new gl;case Me.Utf8:return new bl;case Me.Bool:return new yl;case Me.List:return new kl((e||[])[0]);case Me.Struct_:return new ht(e||[])}switch(t){case Me.Int:{const i=s.type(new Lt);return new Es(i.isSigned(),i.bitWidth())}case Me.FloatingPoint:{const i=s.type(new xi);return new Wr(i.precision())}case Me.Decimal:{const i=s.type(new vt);return new vl(i.scale(),i.precision(),i.bitWidth())}case Me.Date:{const i=s.type(new Xo);return new wl(i.unit())}case Me.Time:{const i=s.type(new jt);return new Ur(i.unit(),i.bitWidth())}case Me.Timestamp:{const i=s.type(new Gt);return new Cl(i.unit(),i.timezone())}case Me.Interval:{const i=s.type(new ki);return new El(i.unit())}case Me.Duration:{const i=s.type(new wi);return new xl(i.unit())}case Me.Union:{const i=s.type(new wt);return new Sl(i.mode(),i.typeIdsArray()||[],e||[])}case Me.FixedSizeBinary:{const i=s.type(new Ci);return new _l(i.byteWidth())}case Me.FixedSizeList:{const i=s.type(new Ei);return new Rl(i.listSize(),(e||[])[0])}case Me.Map:{const i=s.type(new Zo);return new Tl((e||[])[0],i.keysSorted())}}throw new Error(`Unrecognized type: "${Me[t]}" (${t})`)}function qC(s,e){const t=e.fields.map(r=>Re.encode(s,r));mi.startFieldsVector(s,t.length);const i=mi.createFieldsVector(s,t),n=e.metadata&&e.metadata.size>0?mi.createCustomMetadataVector(s,[...e.metadata].map(([r,o])=>{const l=s.createString(`${r}`),a=s.createString(`${o}`);return je.startKeyValue(s),je.addKey(s,l),je.addValue(s,a),je.endKeyValue(s)})):-1;return mi.startSchema(s),mi.addFields(s,i),mi.addEndianness(s,XC?Gn.Little:Gn.Big),n!==-1&&mi.addCustomMetadata(s,n),mi.endSchema(s)}function $C(s,e){let t=-1,i=-1,n=-1;const r=e.type;let o=e.typeId;B.isDictionary(r)?(o=r.dictionary.typeId,n=Qa.visit(r,s),i=Qa.visit(r.dictionary,s)):i=Qa.visit(r,s);const l=(r.children||[]).map(c=>Re.encode(s,c)),a=zt.createChildrenVector(s,l),h=e.metadata&&e.metadata.size>0?zt.createCustomMetadataVector(s,[...e.metadata].map(([c,u])=>{const d=s.createString(`${c}`),f=s.createString(`${u}`);return je.startKeyValue(s),je.addKey(s,d),je.addValue(s,f),je.endKeyValue(s)})):-1;return e.name&&(t=s.createString(e.name)),zt.startField(s),zt.addType(s,i),zt.addTypeType(s,o),zt.addChildren(s,a),zt.addNullable(s,!!e.nullable),t!==-1&&zt.addName(s,t),n!==-1&&zt.addDictionary(s,n),h!==-1&&zt.addCustomMetadata(s,h),zt.endField(s)}function KC(s,e){const t=e.nodes||[],i=e.buffers||[];Ui.startNodesVector(s,t.length);for(const o of t.slice().reverse())_s.encode(s,o);const n=s.endVector();Ui.startBuffersVector(s,i.length);for(const o of i.slice().reverse())Ti.encode(s,o);const r=s.endVector();return Ui.startRecordBatch(s),Ui.addLength(s,BigInt(e.length)),Ui.addNodes(s,n),Ui.addBuffers(s,r),Ui.endRecordBatch(s)}function YC(s,e){const t=Pt.encode(s,e.data);return En.startDictionaryBatch(s),En.addId(s,BigInt(e.id)),En.addIsDelta(s,e.isDelta),En.addData(s,t),En.endDictionaryBatch(s)}function QC(s,e){return ug.createFieldNode(s,BigInt(e.length),BigInt(e.nullCount))}function JC(s,e){return cg.createBuffer(s,BigInt(e.offset),BigInt(e.length))}const XC=(()=>{const s=new ArrayBuffer(2);return new DataView(s).setInt16(0,256,!0),new Int16Array(s)[0]===256})(),du=s=>`Expected ${fe[s]} Message in stream, but was null or length 0.`,fu=s=>`Header pointer of flatbuffer-encoded ${fe[s]} Message is null or length 0.`,mg=(s,e)=>`Expected to read ${s} metadata bytes, but only read ${e}.`,gg=(s,e)=>`Expected to read ${s} bytes for message body, but only read ${e}.`;class bg{constructor(e){this.source=e instanceof Nl?e:new Nl(e)}[Symbol.iterator](){return this}next(){let e;return(e=this.readMetadataLength()).done||e.value===-1&&(e=this.readMetadataLength()).done||(e=this.readMetadata(e.value)).done?Le:e}throw(e){return this.source.throw(e)}return(e){return this.source.return(e)}readMessage(e){let t;if((t=this.next()).done)return null;if(e!=null&&t.value.headerType!==e)throw new Error(du(e));return t.value}readMessageBody(e){if(e<=0)return new Uint8Array(0);const t=ue(this.source.read(e));if(t.byteLength<e)throw new Error(gg(e,t.byteLength));return t.byteOffset%8===0&&t.byteOffset+t.byteLength<=t.buffer.byteLength?t:t.slice()}readSchema(e=!1){const t=fe.Schema,i=this.readMessage(t),n=i==null?void 0:i.header();if(e&&!n)throw new Error(fu(t));return n}readMetadataLength(){const e=this.source.read(xa),t=e&&new Un(e),i=(t==null?void 0:t.readInt32(0))||0;return{done:i===0,value:i}}readMetadata(e){const t=this.source.read(e);if(!t)return Le;if(t.byteLength<e)throw new Error(mg(e,t.byteLength));return{done:!1,value:ct.decode(t)}}}class ZC{constructor(e,t){this.source=e instanceof qn?e:Tp(e)?new zl(e,t):new qn(e)}[Symbol.asyncIterator](){return this}next(){return K(this,void 0,void 0,function*(){let e;return(e=yield this.readMetadataLength()).done||e.value===-1&&(e=yield this.readMetadataLength()).done||(e=yield this.readMetadata(e.value)).done?Le:e})}throw(e){return K(this,void 0,void 0,function*(){return yield this.source.throw(e)})}return(e){return K(this,void 0,void 0,function*(){return yield this.source.return(e)})}readMessage(e){return K(this,void 0,void 0,function*(){let t;if((t=yield this.next()).done)return null;if(e!=null&&t.value.headerType!==e)throw new Error(du(e));return t.value})}readMessageBody(e){return K(this,void 0,void 0,function*(){if(e<=0)return new Uint8Array(0);const t=ue(yield this.source.read(e));if(t.byteLength<e)throw new Error(gg(e,t.byteLength));return t.byteOffset%8===0&&t.byteOffset+t.byteLength<=t.buffer.byteLength?t:t.slice()})}readSchema(e=!1){return K(this,void 0,void 0,function*(){const t=fe.Schema,i=yield this.readMessage(t),n=i==null?void 0:i.header();if(e&&!n)throw new Error(fu(t));return n})}readMetadataLength(){return K(this,void 0,void 0,function*(){const e=yield this.source.read(xa),t=e&&new Un(e),i=(t==null?void 0:t.readInt32(0))||0;return{done:i===0,value:i}})}readMetadata(e){return K(this,void 0,void 0,function*(){const t=yield this.source.read(e);if(!t)return Le;if(t.byteLength<e)throw new Error(mg(e,t.byteLength));return{done:!1,value:ct.decode(t)}})}}class e1 extends bg{constructor(e){super(new Uint8Array(0)),this._schema=!1,this._body=[],this._batchIndex=0,this._dictionaryIndex=0,this._json=e instanceof pd?e:new pd(e)}next(){const{_json:e}=this;if(!this._schema)return this._schema=!0,{done:!1,value:ct.fromJSON(e.schema,fe.Schema)};if(this._dictionaryIndex<e.dictionaries.length){const t=e.dictionaries[this._dictionaryIndex++];return this._body=t.data.columns,{done:!1,value:ct.fromJSON(t,fe.DictionaryBatch)}}if(this._batchIndex<e.batches.length){const t=e.batches[this._batchIndex++];return this._body=t.columns,{done:!1,value:ct.fromJSON(t,fe.RecordBatch)}}return this._body=[],Le}readMessageBody(e){return t(this._body);function t(i){return(i||[]).reduce((n,r)=>[...n,...r.VALIDITY&&[r.VALIDITY]||[],...r.TYPE_ID&&[r.TYPE_ID]||[],...r.OFFSET&&[r.OFFSET]||[],...r.DATA&&[r.DATA]||[],...t(r.children)],[])}}readMessage(e){let t;if((t=this.next()).done)return null;if(e!=null&&t.value.headerType!==e)throw new Error(du(e));return t.value}readSchema(){const e=fe.Schema,t=this.readMessage(e),i=t==null?void 0:t.header();if(!t||!i)throw new Error(fu(e));return i}}const xa=4,Vh="ARROW1",Gr=new Uint8Array(Vh.length);for(let s=0;s<Vh.length;s+=1)Gr[s]=Vh.codePointAt(s);function pu(s,e=0){for(let t=-1,i=Gr.length;++t<i;)if(Gr[t]!==s[e+t])return!1;return!0}const uo=Gr.length,yg=uo+xa,t1=uo*2+xa;class Kt extends ou{constructor(e){super(),this._impl=e}get closed(){return this._impl.closed}get schema(){return this._impl.schema}get autoDestroy(){return this._impl.autoDestroy}get dictionaries(){return this._impl.dictionaries}get numDictionaries(){return this._impl.numDictionaries}get numRecordBatches(){return this._impl.numRecordBatches}get footer(){return this._impl.isFile()?this._impl.footer:null}isSync(){return this._impl.isSync()}isAsync(){return this._impl.isAsync()}isFile(){return this._impl.isFile()}isStream(){return this._impl.isStream()}next(){return this._impl.next()}throw(e){return this._impl.throw(e)}return(e){return this._impl.return(e)}cancel(){return this._impl.cancel()}reset(e){return this._impl.reset(e),this._DOMStream=void 0,this._nodeStream=void 0,this}open(e){const t=this._impl.open(e);return nn(t)?t.then(()=>this):this}readRecordBatch(e){return this._impl.isFile()?this._impl.readRecordBatch(e):null}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}toDOMStream(){return Ut.toDOMStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this})}toNodeStream(){return Ut.toNodeStream(this.isSync()?{[Symbol.iterator]:()=>this}:{[Symbol.asyncIterator]:()=>this},{objectMode:!0})}static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,t){throw new Error('"throughDOM" not available in this environment')}static from(e){return e instanceof Kt?e:Oh(e)?r1(e):Tp(e)?a1(e):nn(e)?K(this,void 0,void 0,function*(){return yield Kt.from(yield e)}):Mp(e)||Kc(e)||Dp(e)||nr(e)?l1(new qn(e)):o1(new Nl(e))}static readAll(e){return e instanceof Kt?e.isSync()?xd(e):kd(e):Oh(e)||ArrayBuffer.isView(e)||oo(e)||Rp(e)?xd(e):kd(e)}}class Ul extends Kt{constructor(e){super(e),this._impl=e}readAll(){return[...this]}[Symbol.iterator](){return this._impl[Symbol.iterator]()}[Symbol.asyncIterator](){return Ri(this,arguments,function*(){yield Z(yield*Jo(en(this[Symbol.iterator]())))})}}class jl extends Kt{constructor(e){super(e),this._impl=e}readAll(){var e,t,i,n;return K(this,void 0,void 0,function*(){const r=new Array;try{for(var o=!0,l=en(this),a;a=yield l.next(),e=a.done,!e;o=!0){n=a.value,o=!1;const h=n;r.push(h)}}catch(h){t={error:h}}finally{try{!o&&!e&&(i=l.return)&&(yield i.call(l))}finally{if(t)throw t.error}}return r})}[Symbol.iterator](){throw new Error("AsyncRecordBatchStreamReader is not Iterable")}[Symbol.asyncIterator](){return this._impl[Symbol.asyncIterator]()}}class vg extends Ul{constructor(e){super(e),this._impl=e}}class i1 extends jl{constructor(e){super(e),this._impl=e}}class wg{get numDictionaries(){return this._dictionaryIndex}get numRecordBatches(){return this._recordBatchIndex}constructor(e=new Map){this.closed=!1,this.autoDestroy=!0,this._dictionaryIndex=0,this._recordBatchIndex=0,this.dictionaries=e}isSync(){return!1}isAsync(){return!1}isFile(){return!1}isStream(){return!1}reset(e){return this._dictionaryIndex=0,this._recordBatchIndex=0,this.schema=e,this.dictionaries=new Map,this}_loadRecordBatch(e,t){const i=this._loadVectors(e,t,this.schema.fields),n=oe({type:new ht(this.schema.fields),length:e.length,children:i});return new Ct(this.schema,n)}_loadDictionaryBatch(e,t){const{id:i,isDelta:n}=e,{dictionaries:r,schema:o}=this,l=r.get(i);if(n||!l){const a=o.dictionaries.get(i),h=this._loadVectors(e.data,t,[a]);return(l&&n?l.concat(new pe(h)):new pe(h)).memoize()}return l.memoize()}_loadVectors(e,t,i){return new og(t,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(i)}}class Gl extends wg{constructor(e,t){super(t),this._reader=Oh(e)?new e1(this._handle=e):new bg(this._handle=e)}isSync(){return!0}isStream(){return!0}[Symbol.iterator](){return this}cancel(){!this.closed&&(this.closed=!0)&&(this.reset()._reader.return(),this._reader=null,this.dictionaries=null)}open(e){return this.closed||(this.autoDestroy=Eg(this,e),this.schema||(this.schema=this._reader.readSchema())||this.cancel()),this}throw(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.throw(e):Le}return(e){return!this.closed&&this.autoDestroy&&(this.closed=!0)?this.reset()._reader.return(e):Le}next(){if(this.closed)return Le;let e;const{_reader:t}=this;for(;e=this._readNextMessageAndValidate();)if(e.isSchema())this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const i=e.header(),n=t.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(i,n)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const i=e.header(),n=t.readMessageBody(e.bodyLength),r=this._loadDictionaryBatch(i,n);this.dictionaries.set(i.id,r)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new uu(this.schema)}):this.return()}_readNextMessageAndValidate(e){return this._reader.readMessage(e)}}class ql extends wg{constructor(e,t){super(t),this._reader=new ZC(this._handle=e)}isAsync(){return!0}isStream(){return!0}[Symbol.asyncIterator](){return this}cancel(){return K(this,void 0,void 0,function*(){!this.closed&&(this.closed=!0)&&(yield this.reset()._reader.return(),this._reader=null,this.dictionaries=null)})}open(e){return K(this,void 0,void 0,function*(){return this.closed||(this.autoDestroy=Eg(this,e),this.schema||(this.schema=yield this._reader.readSchema())||(yield this.cancel())),this})}throw(e){return K(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.throw(e):Le})}return(e){return K(this,void 0,void 0,function*(){return!this.closed&&this.autoDestroy&&(this.closed=!0)?yield this.reset()._reader.return(e):Le})}next(){return K(this,void 0,void 0,function*(){if(this.closed)return Le;let e;const{_reader:t}=this;for(;e=yield this._readNextMessageAndValidate();)if(e.isSchema())yield this.reset(e.header());else if(e.isRecordBatch()){this._recordBatchIndex++;const i=e.header(),n=yield t.readMessageBody(e.bodyLength);return{done:!1,value:this._loadRecordBatch(i,n)}}else if(e.isDictionaryBatch()){this._dictionaryIndex++;const i=e.header(),n=yield t.readMessageBody(e.bodyLength),r=this._loadDictionaryBatch(i,n);this.dictionaries.set(i.id,r)}return this.schema&&this._recordBatchIndex===0?(this._recordBatchIndex++,{done:!1,value:new uu(this.schema)}):yield this.return()})}_readNextMessageAndValidate(e){return K(this,void 0,void 0,function*(){return yield this._reader.readMessage(e)})}}class Cg extends Gl{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,t){super(e instanceof md?e:new md(e),t)}isSync(){return!0}isFile(){return!0}open(e){if(!this.closed&&!this._footer){this.schema=(this._footer=this._readFooter()).schema;for(const t of this._footer.dictionaryBatches())t&&this._readDictionaryBatch(this._dictionaryIndex++)}return super.open(e)}readRecordBatch(e){var t;if(this.closed)return null;this._footer||this.open();const i=(t=this._footer)===null||t===void 0?void 0:t.getRecordBatch(e);if(i&&this._handle.seek(i.offset)){const n=this._reader.readMessage(fe.RecordBatch);if(n!=null&&n.isRecordBatch()){const r=n.header(),o=this._reader.readMessageBody(n.bodyLength);return this._loadRecordBatch(r,o)}}return null}_readDictionaryBatch(e){var t;const i=(t=this._footer)===null||t===void 0?void 0:t.getDictionaryBatch(e);if(i&&this._handle.seek(i.offset)){const n=this._reader.readMessage(fe.DictionaryBatch);if(n!=null&&n.isDictionaryBatch()){const r=n.header(),o=this._reader.readMessageBody(n.bodyLength),l=this._loadDictionaryBatch(r,o);this.dictionaries.set(r.id,l)}}}_readFooter(){const{_handle:e}=this,t=e.size-yg,i=e.readInt32(t),n=e.readAt(t-i,i);return jr.decode(n)}_readNextMessageAndValidate(e){var t;if(this._footer||this.open(),this._footer&&this._recordBatchIndex<this.numRecordBatches){const i=(t=this._footer)===null||t===void 0?void 0:t.getRecordBatch(this._recordBatchIndex);if(i&&this._handle.seek(i.offset))return this._reader.readMessage(e)}return null}}class s1 extends ql{get footer(){return this._footer}get numDictionaries(){return this._footer?this._footer.numDictionaries:0}get numRecordBatches(){return this._footer?this._footer.numRecordBatches:0}constructor(e,...t){const i=typeof t[0]!="number"?t.shift():void 0,n=t[0]instanceof Map?t.shift():void 0;super(e instanceof zl?e:new zl(e,i),n)}isFile(){return!0}isAsync(){return!0}open(e){const t=Object.create(null,{open:{get:()=>super.open}});return K(this,void 0,void 0,function*(){if(!this.closed&&!this._footer){this.schema=(this._footer=yield this._readFooter()).schema;for(const i of this._footer.dictionaryBatches())i&&(yield this._readDictionaryBatch(this._dictionaryIndex++))}return yield t.open.call(this,e)})}readRecordBatch(e){var t;return K(this,void 0,void 0,function*(){if(this.closed)return null;this._footer||(yield this.open());const i=(t=this._footer)===null||t===void 0?void 0:t.getRecordBatch(e);if(i&&(yield this._handle.seek(i.offset))){const n=yield this._reader.readMessage(fe.RecordBatch);if(n!=null&&n.isRecordBatch()){const r=n.header(),o=yield this._reader.readMessageBody(n.bodyLength);return this._loadRecordBatch(r,o)}}return null})}_readDictionaryBatch(e){var t;return K(this,void 0,void 0,function*(){const i=(t=this._footer)===null||t===void 0?void 0:t.getDictionaryBatch(e);if(i&&(yield this._handle.seek(i.offset))){const n=yield this._reader.readMessage(fe.DictionaryBatch);if(n!=null&&n.isDictionaryBatch()){const r=n.header(),o=yield this._reader.readMessageBody(n.bodyLength),l=this._loadDictionaryBatch(r,o);this.dictionaries.set(r.id,l)}}})}_readFooter(){return K(this,void 0,void 0,function*(){const{_handle:e}=this;e._pending&&(yield e._pending);const t=e.size-yg,i=yield e.readInt32(t),n=yield e.readAt(t-i,i);return jr.decode(n)})}_readNextMessageAndValidate(e){return K(this,void 0,void 0,function*(){if(this._footer||(yield this.open()),this._footer&&this._recordBatchIndex<this.numRecordBatches){const t=this._footer.getRecordBatch(this._recordBatchIndex);if(t&&(yield this._handle.seek(t.offset)))return yield this._reader.readMessage(e)}return null})}}class n1 extends Gl{constructor(e,t){super(e,t)}_loadVectors(e,t,i){return new bC(t,e.nodes,e.buffers,this.dictionaries,this.schema.metadataVersion).visitMany(i)}}function Eg(s,e){return e&&typeof e.autoDestroy=="boolean"?e.autoDestroy:s.autoDestroy}function*xd(s){const e=Kt.from(s);try{if(!e.open({autoDestroy:!1}).closed)do yield e;while(!e.reset().open().closed)}finally{e.cancel()}}function kd(s){return Ri(this,arguments,function*(){const t=yield Z(Kt.from(s));try{if(!(yield Z(t.open({autoDestroy:!1}))).closed)do yield yield Z(t);while(!(yield Z(t.reset().open())).closed)}finally{yield Z(t.cancel())}})}function r1(s){return new Ul(new n1(s))}function o1(s){const e=s.peek(uo+7&-8);return e&&e.byteLength>=4?pu(e)?new vg(new Cg(s.read())):new Ul(new Gl(s)):new Ul(new Gl(function*(){}()))}function l1(s){return K(this,void 0,void 0,function*(){const e=yield s.peek(uo+7&-8);return e&&e.byteLength>=4?pu(e)?new vg(new Cg(yield s.read())):new jl(new ql(s)):new jl(new ql(function(){return Ri(this,arguments,function*(){})}()))})}function a1(s){return K(this,void 0,void 0,function*(){const{size:e}=yield s.stat(),t=new zl(s,e);return e>=t1&&pu(yield t.readAt(0,uo+7&-8))?new i1(new s1(t)):new jl(new ql(t))})}class Fe extends te{static assemble(...e){const t=n=>n.flatMap(r=>Array.isArray(r)?t(r):r instanceof Ct?r.data.children:r.data),i=new Fe;return i.visitMany(t(e)),i}constructor(){super(),this._byteLength=0,this._nodes=[],this._buffers=[],this._bufferRegions=[]}visit(e){if(e instanceof pe)return this.visitMany(e.data),this;const{type:t}=e;if(!B.isDictionary(t)){const{length:i}=e;if(i>2147483647)throw new RangeError("Cannot write arrays larger than 2^31 - 1 in length");if(B.isUnion(t))this.nodes.push(new _s(i,0));else{const{nullCount:n}=e;B.isNull(t)||si.call(this,n<=0?new Uint8Array(0):Ml(e.offset,i,e.nullBitmap)),this.nodes.push(new _s(i,n))}}return super.visit(e)}visitNull(e){return this}visitDictionary(e){return this.visit(e.clone(e.type.indices))}get nodes(){return this._nodes}get buffers(){return this._buffers}get byteLength(){return this._byteLength}get bufferRegions(){return this._bufferRegions}}function si(s){const e=s.byteLength+7&-8;return this.buffers.push(s),this.bufferRegions.push(new Ti(this._byteLength,e)),this._byteLength+=e,this}function h1(s){var e;const{type:t,length:i,typeIds:n,valueOffsets:r}=s;if(si.call(this,n),t.mode===pt.Sparse)return Wh.call(this,s);if(t.mode===pt.Dense){if(s.offset<=0)return si.call(this,r),Wh.call(this,s);{const o=new Int32Array(i),l=Object.create(null),a=Object.create(null);for(let h,c,u=-1;++u<i;)(h=n[u])!==void 0&&((c=l[h])===void 0&&(c=l[h]=r[u]),o[u]=r[u]-c,a[h]=((e=a[h])!==null&&e!==void 0?e:0)+1);si.call(this,o),this.visitMany(s.children.map((h,c)=>{const u=t.typeIds[c],d=l[u],f=a[u];return h.slice(d,Math.min(i,f))}))}}return this}function c1(s){let e;return s.nullCount>=s.length?si.call(this,new Uint8Array(0)):(e=s.values)instanceof Uint8Array?si.call(this,Ml(s.offset,s.length,e)):si.call(this,Dl(s.values))}function ts(s){return si.call(this,s.values.subarray(0,s.length*s.stride))}function xg(s){const{length:e,values:t,valueOffsets:i}=s,{[0]:n,[e]:r}=i,o=Math.min(r-n,t.byteLength-n);return si.call(this,Op(-n,e+1,i)),si.call(this,t.subarray(n,n+o)),this}function mu(s){const{length:e,valueOffsets:t}=s;if(t){const{[0]:i,[e]:n}=t;return si.call(this,Op(-i,e+1,t)),this.visit(s.children[0].slice(i,n-i))}return this.visit(s.children[0])}function Wh(s){return this.visitMany(s.type.children.map((e,t)=>s.children[t]).filter(Boolean))[0]}Fe.prototype.visitBool=c1;Fe.prototype.visitInt=ts;Fe.prototype.visitFloat=ts;Fe.prototype.visitUtf8=xg;Fe.prototype.visitBinary=xg;Fe.prototype.visitFixedSizeBinary=ts;Fe.prototype.visitDate=ts;Fe.prototype.visitTimestamp=ts;Fe.prototype.visitTime=ts;Fe.prototype.visitDecimal=ts;Fe.prototype.visitList=mu;Fe.prototype.visitStruct=Wh;Fe.prototype.visitUnion=h1;Fe.prototype.visitInterval=ts;Fe.prototype.visitDuration=ts;Fe.prototype.visitFixedSizeList=mu;Fe.prototype.visitMap=mu;class kg extends ou{static throughNode(e){throw new Error('"throughNode" not available in this environment')}static throughDOM(e,t){throw new Error('"throughDOM" not available in this environment')}constructor(e){super(),this._position=0,this._started=!1,this._sink=new tl,this._schema=null,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._dictionaryDeltaOffsets=new Map,St(e)||(e={autoDestroy:!0,writeLegacyIpcFormat:!1}),this._autoDestroy=typeof e.autoDestroy=="boolean"?e.autoDestroy:!0,this._writeLegacyIpcFormat=typeof e.writeLegacyIpcFormat=="boolean"?e.writeLegacyIpcFormat:!1}toString(e=!1){return this._sink.toString(e)}toUint8Array(e=!1){return this._sink.toUint8Array(e)}writeAll(e){return nn(e)?e.then(t=>this.writeAll(t)):nr(e)?vu(this,e):yu(this,e)}get closed(){return this._sink.closed}[Symbol.asyncIterator](){return this._sink[Symbol.asyncIterator]()}toDOMStream(e){return this._sink.toDOMStream(e)}toNodeStream(e){return this._sink.toNodeStream(e)}close(){return this.reset()._sink.close()}abort(e){return this.reset()._sink.abort(e)}finish(){return this._autoDestroy?this.close():this.reset(this._sink,this._schema),this}reset(e=this._sink,t=null){return e===this._sink||e instanceof tl?this._sink=e:(this._sink=new tl,e&&Tw(e)?this.toDOMStream({type:"bytes"}).pipeTo(e):e&&Mw(e)&&this.toNodeStream({objectMode:!1}).pipe(e)),this._started&&this._schema&&this._writeFooter(this._schema),this._started=!1,this._dictionaryBlocks=[],this._recordBatchBlocks=[],this._dictionaryDeltaOffsets=new Map,(!t||!Nh(t,this._schema))&&(t==null?(this._position=0,this._schema=null):(this._started=!0,this._schema=t,this._writeSchema(t))),this}write(e){let t=null;if(this._sink){if(e==null)return this.finish()&&void 0;if(e instanceof ot&&!(t=e.schema))return this.finish()&&void 0;if(e instanceof Ct&&!(t=e.schema))return this.finish()&&void 0}else throw new Error("RecordBatchWriter is closed");if(t&&!Nh(t,this._schema)){if(this._started&&this._autoDestroy)return this.close();this.reset(this._sink,t)}e instanceof Ct?e instanceof uu||this._writeRecordBatch(e):e instanceof ot?this.writeAll(e.batches):oo(e)&&this.writeAll(e)}_writeMessage(e,t=8){const i=t-1,n=ct.encode(e),r=n.byteLength,o=this._writeLegacyIpcFormat?4:8,l=r+o+i&~i,a=l-r-o;return e.headerType===fe.RecordBatch?this._recordBatchBlocks.push(new ks(l,e.bodyLength,this._position)):e.headerType===fe.DictionaryBatch&&this._dictionaryBlocks.push(new ks(l,e.bodyLength,this._position)),this._writeLegacyIpcFormat||this._write(Int32Array.of(-1)),this._write(Int32Array.of(l-o)),r>0&&this._write(n),this._writePadding(a)}_write(e){if(this._started){const t=ue(e);t&&t.byteLength>0&&(this._sink.write(t),this._position+=t.byteLength)}return this}_writeSchema(e){return this._writeMessage(ct.from(e))}_writeFooter(e){return this._writeLegacyIpcFormat?this._write(Int32Array.of(0)):this._write(Int32Array.of(-1,0))}_writeMagic(){return this._write(Gr)}_writePadding(e){return e>0?this._write(new Uint8Array(e)):this}_writeRecordBatch(e){const{byteLength:t,nodes:i,bufferRegions:n,buffers:r}=Fe.assemble(e),o=new Pt(e.numRows,i,n),l=ct.from(o,t);return this._writeDictionaries(e)._writeMessage(l)._writeBodyBuffers(r)}_writeDictionaryBatch(e,t,i=!1){this._dictionaryDeltaOffsets.set(t,e.length+(this._dictionaryDeltaOffsets.get(t)||0));const{byteLength:n,nodes:r,bufferRegions:o,buffers:l}=Fe.assemble(new pe([e])),a=new Pt(e.length,r,o),h=new Pi(a,t,i),c=ct.from(h,n);return this._writeMessage(c)._writeBodyBuffers(l)}_writeBodyBuffers(e){let t,i,n;for(let r=-1,o=e.length;++r<o;)(t=e[r])&&(i=t.byteLength)>0&&(this._write(t),(n=(i+7&-8)-i)>0&&this._writePadding(n));return this}_writeDictionaries(e){for(let[t,i]of e.dictionaries){let n=this._dictionaryDeltaOffsets.get(t)||0;if(n===0||(i=i==null?void 0:i.slice(n)).length>0)for(const r of i.data)this._writeDictionaryBatch(r,t,n>0),n+=r.length}return this}}class gu extends kg{static writeAll(e,t){const i=new gu(t);return nn(e)?e.then(n=>i.writeAll(n)):nr(e)?vu(i,e):yu(i,e)}}class bu extends kg{static writeAll(e){const t=new bu;return nn(e)?e.then(i=>t.writeAll(i)):nr(e)?vu(t,e):yu(t,e)}constructor(){super(),this._autoDestroy=!0}_writeSchema(e){return this._writeMagic()._writePadding(2)}_writeFooter(e){const t=jr.encode(new jr(e,Ze.V5,this._recordBatchBlocks,this._dictionaryBlocks));return super._writeFooter(e)._write(t)._write(Int32Array.of(t.byteLength))._writeMagic()}}function yu(s,e){let t=e;e instanceof ot&&(t=e.batches,s.reset(void 0,e.schema));for(const i of t)s.write(i);return s.finish()}function vu(s,e){var t,i,n,r,o,l,a;return K(this,void 0,void 0,function*(){try{for(t=!0,i=en(e);n=yield i.next(),r=n.done,!r;t=!0){a=n.value,t=!1;const h=a;s.write(h)}}catch(h){o={error:h}}finally{try{!t&&!r&&(l=i.return)&&(yield l.call(i))}finally{if(o)throw o.error}}return s.finish()})}function u1(s,e="stream"){return(e==="stream"?gu:bu).writeAll(s).toUint8Array(!0)}var d1=Object.create,Sg=Object.defineProperty,f1=Object.getOwnPropertyDescriptor,p1=Object.getOwnPropertyNames,m1=Object.getPrototypeOf,g1=Object.prototype.hasOwnProperty,b1=(s,e)=>()=>(e||s((e={exports:{}}).exports,e),e.exports),y1=(s,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of p1(e))!g1.call(s,n)&&n!==t&&Sg(s,n,{get:()=>e[n],enumerable:!(i=f1(e,n))||i.enumerable});return s},v1=(s,e,t)=>(t=s!=null?d1(m1(s)):{},y1(e||!s||!s.__esModule?Sg(t,"default",{value:s,enumerable:!0}):t,s)),w1=b1((s,e)=>{e.exports=Worker}),C1=(s=>(s[s.UNDEFINED=0]="UNDEFINED",s[s.AUTOMATIC=1]="AUTOMATIC",s[s.READ_ONLY=2]="READ_ONLY",s[s.READ_WRITE=3]="READ_WRITE",s))(C1||{}),E1=(s=>(s[s.IDENTIFIER=0]="IDENTIFIER",s[s.NUMERIC_CONSTANT=1]="NUMERIC_CONSTANT",s[s.STRING_CONSTANT=2]="STRING_CONSTANT",s[s.OPERATOR=3]="OPERATOR",s[s.KEYWORD=4]="KEYWORD",s[s.COMMENT=5]="COMMENT",s))(E1||{}),x1=(s=>(s[s.NONE=0]="NONE",s[s.DEBUG=1]="DEBUG",s[s.INFO=2]="INFO",s[s.WARNING=3]="WARNING",s[s.ERROR=4]="ERROR",s))(x1||{}),k1=(s=>(s[s.NONE=0]="NONE",s[s.CONNECT=1]="CONNECT",s[s.DISCONNECT=2]="DISCONNECT",s[s.OPEN=3]="OPEN",s[s.QUERY=4]="QUERY",s[s.INSTANTIATE=5]="INSTANTIATE",s))(k1||{}),S1=(s=>(s[s.NONE=0]="NONE",s[s.OK=1]="OK",s[s.ERROR=2]="ERROR",s[s.START=3]="START",s[s.RUN=4]="RUN",s[s.CAPTURE=5]="CAPTURE",s))(S1||{}),_1=(s=>(s[s.NONE=0]="NONE",s[s.WEB_WORKER=1]="WEB_WORKER",s[s.NODE_WORKER=2]="NODE_WORKER",s[s.BINDINGS=3]="BINDINGS",s[s.ASYNC_DUCKDB=4]="ASYNC_DUCKDB",s))(_1||{}),R1=class{constructor(s=2){this.level=s}log(s){s.level>=this.level&&console.log(s)}},T1=(s=>(s[s.SUCCESS=0]="SUCCESS",s))(T1||{}),M1=class{constructor(s,e){this._bindings=s,this._conn=e}get bindings(){return this._bindings}async close(){return this._bindings.disconnect(this._conn)}useUnsafe(s){return s(this._bindings,this._conn)}async query(s){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:s});let e=await this._bindings.runQuery(this._conn,s),t=Kt.from(e);return console.assert(t.isSync(),"Reader is not sync"),console.assert(t.isFile(),"Reader is not file"),new ot(t)}async send(s){this._bindings.logger.log({timestamp:new Date,level:2,origin:4,topic:4,event:4,value:s});let e=await this._bindings.startPendingQuery(this._conn,s);for(;e==null;)e=await this._bindings.pollPendingQuery(this._conn);let t=new _g(this._bindings,this._conn,e),i=await Kt.from(t);return console.assert(i.isAsync()),console.assert(i.isStream()),i}async cancelSent(){return await this._bindings.cancelPendingQuery(this._conn)}async getTableNames(s){return await this._bindings.getTableNames(this._conn,s)}async prepare(s){let e=await this._bindings.createPrepared(this._conn,s);return new D1(this._bindings,this._conn,e)}async insertArrowTable(s,e){let t=u1(s,"stream");await this.insertArrowFromIPCStream(t,e)}async insertArrowFromIPCStream(s,e){await this._bindings.insertArrowFromIPCStream(this._conn,s,e)}async insertCSVFromPath(s,e){await this._bindings.insertCSVFromPath(this._conn,s,e)}async insertJSONFromPath(s,e){await this._bindings.insertJSONFromPath(this._conn,s,e)}},_g=class{constructor(s,e,t){this.db=s,this.conn=e,this.header=t,this._first=!0,this._depleted=!1,this._inFlight=null}async next(){if(this._first)return this._first=!1,{done:!1,value:this.header};if(this._depleted)return{done:!0,value:null};let s;return this._inFlight!=null?(s=await this._inFlight,this._inFlight=null):s=await this.db.fetchQueryResults(this.conn),this._depleted=s.length==0,this._depleted||(this._inFlight=this.db.fetchQueryResults(this.conn)),{done:this._depleted,value:s}}[Symbol.asyncIterator](){return this}},D1=class{constructor(s,e,t){this.bindings=s,this.connectionId=e,this.statementId=t}async close(){await this.bindings.closePrepared(this.connectionId,this.statementId)}async query(...s){let e=await this.bindings.runPrepared(this.connectionId,this.statementId,s),t=Kt.from(e);return console.assert(t.isSync()),console.assert(t.isFile()),new ot(t)}async send(...s){let e=await this.bindings.sendPrepared(this.connectionId,this.statementId,s),t=new _g(this.bindings,this.connectionId,e),i=await Kt.from(t);return console.assert(i.isAsync()),console.assert(i.isStream()),i}},A1=(s=>(s.CANCEL_PENDING_QUERY="CANCEL_PENDING_QUERY",s.CLOSE_PREPARED="CLOSE_PREPARED",s.COLLECT_FILE_STATISTICS="COLLECT_FILE_STATISTICS",s.CONNECT="CONNECT",s.COPY_FILE_TO_BUFFER="COPY_FILE_TO_BUFFER",s.COPY_FILE_TO_PATH="COPY_FILE_TO_PATH",s.CREATE_PREPARED="CREATE_PREPARED",s.DISCONNECT="DISCONNECT",s.DROP_FILE="DROP_FILE",s.DROP_FILES="DROP_FILES",s.EXPORT_FILE_STATISTICS="EXPORT_FILE_STATISTICS",s.FETCH_QUERY_RESULTS="FETCH_QUERY_RESULTS",s.FLUSH_FILES="FLUSH_FILES",s.GET_FEATURE_FLAGS="GET_FEATURE_FLAGS",s.GET_TABLE_NAMES="GET_TABLE_NAMES",s.GET_VERSION="GET_VERSION",s.GLOB_FILE_INFOS="GLOB_FILE_INFOS",s.INSERT_ARROW_FROM_IPC_STREAM="INSERT_ARROW_FROM_IPC_STREAM",s.INSERT_CSV_FROM_PATH="IMPORT_CSV_FROM_PATH",s.INSERT_JSON_FROM_PATH="IMPORT_JSON_FROM_PATH",s.INSTANTIATE="INSTANTIATE",s.OPEN="OPEN",s.PING="PING",s.POLL_PENDING_QUERY="POLL_PENDING_QUERY",s.REGISTER_FILE_BUFFER="REGISTER_FILE_BUFFER",s.REGISTER_FILE_HANDLE="REGISTER_FILE_HANDLE",s.REGISTER_FILE_URL="REGISTER_FILE_URL",s.RESET="RESET",s.RUN_PREPARED="RUN_PREPARED",s.RUN_QUERY="RUN_QUERY",s.SEND_PREPARED="SEND_PREPARED",s.START_PENDING_QUERY="START_PENDING_QUERY",s.TOKENIZE="TOKENIZE",s))(A1||{}),O1=(s=>(s.CONNECTION_INFO="CONNECTION_INFO",s.ERROR="ERROR",s.FEATURE_FLAGS="FEATURE_FLAGS",s.FILE_BUFFER="FILE_BUFFER",s.FILE_INFOS="FILE_INFOS",s.FILE_SIZE="FILE_SIZE",s.FILE_STATISTICS="FILE_STATISTICS",s.INSTANTIATE_PROGRESS="INSTANTIATE_PROGRESS",s.LOG="LOG",s.OK="OK",s.PREPARED_STATEMENT_ID="PREPARED_STATEMENT_ID",s.QUERY_PLAN="QUERY_PLAN",s.QUERY_RESULT="QUERY_RESULT",s.QUERY_RESULT_CHUNK="QUERY_RESULT_CHUNK",s.QUERY_RESULT_HEADER="QUERY_RESULT_HEADER",s.QUERY_RESULT_HEADER_OR_NULL="QUERY_RESULT_HEADER_OR_NULL",s.REGISTERED_FILE="REGISTERED_FILE",s.SCRIPT_TOKENS="SCRIPT_TOKENS",s.SUCCESS="SUCCESS",s.TABLE_NAMES="TABLE_NAMES",s.VERSION_STRING="VERSION_STRING",s))(O1||{}),le=class{constructor(s,e){this.promiseResolver=()=>{},this.promiseRejecter=()=>{},this.type=s,this.data=e,this.promise=new Promise((t,i)=>{this.promiseResolver=t,this.promiseRejecter=i})}};function nl(s){switch(s.typeId){case y.Binary:return{sqlType:"binary"};case y.Bool:return{sqlType:"bool"};case y.Date:return{sqlType:"date"};case y.DateDay:return{sqlType:"date32[d]"};case y.DateMillisecond:return{sqlType:"date64[ms]"};case y.Decimal:{let e=s;return{sqlType:"decimal",precision:e.precision,scale:e.scale}}case y.Float:return{sqlType:"float"};case y.Float16:return{sqlType:"float16"};case y.Float32:return{sqlType:"float32"};case y.Float64:return{sqlType:"float64"};case y.Int:return{sqlType:"int32"};case y.Int16:return{sqlType:"int16"};case y.Int32:return{sqlType:"int32"};case y.Int64:return{sqlType:"int64"};case y.Uint16:return{sqlType:"uint16"};case y.Uint32:return{sqlType:"uint32"};case y.Uint64:return{sqlType:"uint64"};case y.Uint8:return{sqlType:"uint8"};case y.IntervalDayTime:return{sqlType:"interval[dt]"};case y.IntervalYearMonth:return{sqlType:"interval[m]"};case y.List:return{sqlType:"list",valueType:nl(s.valueType)};case y.FixedSizeBinary:return{sqlType:"fixedsizebinary",byteWidth:s.byteWidth};case y.Null:return{sqlType:"null"};case y.Utf8:return{sqlType:"utf8"};case y.Struct:return{sqlType:"struct",fields:s.children.map(e=>Uh(e.name,e.type))};case y.Map:{let e=s;return{sqlType:"map",keyType:nl(e.keyType),valueType:nl(e.valueType)}}case y.Time:return{sqlType:"time[s]"};case y.TimeMicrosecond:return{sqlType:"time[us]"};case y.TimeMillisecond:return{sqlType:"time[ms]"};case y.TimeNanosecond:return{sqlType:"time[ns]"};case y.TimeSecond:return{sqlType:"time[s]"};case y.Timestamp:return{sqlType:"timestamp",timezone:s.timezone||void 0};case y.TimestampSecond:return{sqlType:"timestamp[s]",timezone:s.timezone||void 0};case y.TimestampMicrosecond:return{sqlType:"timestamp[us]",timezone:s.timezone||void 0};case y.TimestampNanosecond:return{sqlType:"timestamp[ns]",timezone:s.timezone||void 0};case y.TimestampMillisecond:return{sqlType:"timestamp[ms]",timezone:s.timezone||void 0}}throw new Error("unsupported arrow type: ".concat(s.toString()))}function Uh(s,e){let t=nl(e);return t.name=s,t}var L1=new TextEncoder,I1=class{constructor(s,e=null){this._onInstantiationProgress=[],this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{},this._nextMessageId=0,this._pendingRequests=new Map,this._logger=s,this._onMessageHandler=this.onMessage.bind(this),this._onErrorHandler=this.onError.bind(this),this._onCloseHandler=this.onClose.bind(this),e!=null&&this.attach(e)}get logger(){return this._logger}attach(s){this._worker=s,this._worker.addEventListener("message",this._onMessageHandler),this._worker.addEventListener("error",this._onErrorHandler),this._worker.addEventListener("close",this._onCloseHandler),this._workerShutdownPromise=new Promise((e,t)=>{this._workerShutdownResolver=e})}detach(){this._worker&&(this._worker.removeEventListener("message",this._onMessageHandler),this._worker.removeEventListener("error",this._onErrorHandler),this._worker.removeEventListener("close",this._onCloseHandler),this._worker=null,this._workerShutdownResolver(null),this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async terminate(){this._worker&&(this._worker.terminate(),this._worker=null,this._workerShutdownPromise=null,this._workerShutdownResolver=()=>{})}async postTask(s,e=[]){if(!this._worker){console.error("cannot send a message since the worker is not set!");return}let t=this._nextMessageId++;return this._pendingRequests.set(t,s),this._worker.postMessage({messageId:t,type:s.type,data:s.data},e),await s.promise}onMessage(s){var e;let t=s.data;switch(t.type){case"LOG":{this._logger.log(t.data);return}case"INSTANTIATE_PROGRESS":{for(let n of this._onInstantiationProgress)n(t.data);return}}let i=this._pendingRequests.get(t.requestId);if(!i){console.warn("unassociated response: [".concat(t.requestId,", ").concat(t.type.toString(),"]"));return}if(this._pendingRequests.delete(t.requestId),t.type=="ERROR"){let n=new Error(t.data.message);n.name=t.data.name,(e=Object.getOwnPropertyDescriptor(n,"stack"))!=null&&e.writable&&(n.stack=t.data.stack),i.promiseRejecter(n);return}switch(i.type){case"CLOSE_PREPARED":case"COLLECT_FILE_STATISTICS":case"COPY_FILE_TO_PATH":case"DISCONNECT":case"DROP_FILE":case"DROP_FILES":case"FLUSH_FILES":case"INSERT_ARROW_FROM_IPC_STREAM":case"IMPORT_CSV_FROM_PATH":case"IMPORT_JSON_FROM_PATH":case"OPEN":case"PING":case"REGISTER_FILE_BUFFER":case"REGISTER_FILE_HANDLE":case"REGISTER_FILE_URL":case"RESET":if(t.type=="OK"){i.promiseResolver(t.data);return}break;case"INSTANTIATE":if(this._onInstantiationProgress=[],t.type=="OK"){i.promiseResolver(t.data);return}break;case"GLOB_FILE_INFOS":if(t.type=="FILE_INFOS"){i.promiseResolver(t.data);return}break;case"GET_VERSION":if(t.type=="VERSION_STRING"){i.promiseResolver(t.data);return}break;case"GET_FEATURE_FLAGS":if(t.type=="FEATURE_FLAGS"){i.promiseResolver(t.data);return}break;case"GET_TABLE_NAMES":if(t.type=="TABLE_NAMES"){i.promiseResolver(t.data);return}break;case"TOKENIZE":if(t.type=="SCRIPT_TOKENS"){i.promiseResolver(t.data);return}break;case"COPY_FILE_TO_BUFFER":if(t.type=="FILE_BUFFER"){i.promiseResolver(t.data);return}break;case"EXPORT_FILE_STATISTICS":if(t.type=="FILE_STATISTICS"){i.promiseResolver(t.data);return}break;case"CONNECT":if(t.type=="CONNECTION_INFO"){i.promiseResolver(t.data);return}break;case"RUN_PREPARED":case"RUN_QUERY":if(t.type=="QUERY_RESULT"){i.promiseResolver(t.data);return}break;case"SEND_PREPARED":if(t.type=="QUERY_RESULT_HEADER"){i.promiseResolver(t.data);return}break;case"START_PENDING_QUERY":if(t.type=="QUERY_RESULT_HEADER_OR_NULL"){i.promiseResolver(t.data);return}break;case"POLL_PENDING_QUERY":if(t.type=="QUERY_RESULT_HEADER_OR_NULL"){i.promiseResolver(t.data);return}break;case"CANCEL_PENDING_QUERY":if(this._onInstantiationProgress=[],t.type=="SUCCESS"){i.promiseResolver(t.data);return}break;case"FETCH_QUERY_RESULTS":if(t.type=="QUERY_RESULT_CHUNK"){i.promiseResolver(t.data);return}break;case"CREATE_PREPARED":if(t.type=="PREPARED_STATEMENT_ID"){i.promiseResolver(t.data);return}break}i.promiseRejecter(new Error("unexpected response type: ".concat(t.type.toString())))}onError(s){console.error(s),console.error("error in duckdb worker: ".concat(s.message)),this._pendingRequests.clear()}onClose(){if(this._workerShutdownResolver(null),this._pendingRequests.size!=0){console.warn("worker terminated with ".concat(this._pendingRequests.size," pending requests"));return}this._pendingRequests.clear()}async reset(){let s=new le("RESET",null);return await this.postTask(s)}async ping(){let s=new le("PING",null);await this.postTask(s)}async dropFile(s){let e=new le("DROP_FILE",s);return await this.postTask(e)}async dropFiles(){let s=new le("DROP_FILES",null);return await this.postTask(s)}async flushFiles(){let s=new le("FLUSH_FILES",null);return await this.postTask(s)}async instantiate(s,e=null,t=i=>{}){this._onInstantiationProgress.push(t);let i=new le("INSTANTIATE",[s,e]);return await this.postTask(i)}async getVersion(){let s=new le("GET_VERSION",null);return await this.postTask(s)}async getFeatureFlags(){let s=new le("GET_FEATURE_FLAGS",null);return await this.postTask(s)}async open(s){let e=new le("OPEN",s);await this.postTask(e)}async tokenize(s){let e=new le("TOKENIZE",s);return await this.postTask(e)}async connectInternal(){let s=new le("CONNECT",null);return await this.postTask(s)}async connect(){let s=await this.connectInternal();return new M1(this,s)}async disconnect(s){let e=new le("DISCONNECT",s);await this.postTask(e)}async runQuery(s,e){let t=new le("RUN_QUERY",[s,e]);return await this.postTask(t)}async startPendingQuery(s,e){let t=new le("START_PENDING_QUERY",[s,e]);return await this.postTask(t)}async pollPendingQuery(s){let e=new le("POLL_PENDING_QUERY",s);return await this.postTask(e)}async cancelPendingQuery(s){let e=new le("CANCEL_PENDING_QUERY",s);return await this.postTask(e)}async fetchQueryResults(s){let e=new le("FETCH_QUERY_RESULTS",s);return await this.postTask(e)}async getTableNames(s,e){let t=new le("GET_TABLE_NAMES",[s,e]);return await this.postTask(t)}async createPrepared(s,e){let t=new le("CREATE_PREPARED",[s,e]);return await this.postTask(t)}async closePrepared(s,e){let t=new le("CLOSE_PREPARED",[s,e]);await this.postTask(t)}async runPrepared(s,e,t){let i=new le("RUN_PREPARED",[s,e,t]);return await this.postTask(i)}async sendPrepared(s,e,t){let i=new le("SEND_PREPARED",[s,e,t]);return await this.postTask(i)}async globFiles(s){let e=new le("GLOB_FILE_INFOS",s);return await this.postTask(e)}async registerFileText(s,e){let t=L1.encode(e);await this.registerFileBuffer(s,t)}async registerFileURL(s,e,t,i){e===void 0&&(e=s);let n=new le("REGISTER_FILE_URL",[s,e,t,i]);await this.postTask(n)}async registerEmptyFileBuffer(s){let e=new le("REGISTER_FILE_BUFFER",[s,new Uint8Array]);await this.postTask(e)}async registerFileBuffer(s,e){let t=new le("REGISTER_FILE_BUFFER",[s,e]);await this.postTask(t,[e.buffer])}async registerFileHandle(s,e,t,i){let n=new le("REGISTER_FILE_HANDLE",[s,e,t,i]);await this.postTask(n,[])}async collectFileStatistics(s,e){let t=new le("COLLECT_FILE_STATISTICS",[s,e]);await this.postTask(t,[])}async exportFileStatistics(s){let e=new le("EXPORT_FILE_STATISTICS",s);return await this.postTask(e,[])}async copyFileToBuffer(s){let e=new le("COPY_FILE_TO_BUFFER",s);return await this.postTask(e)}async copyFileToPath(s,e){let t=new le("COPY_FILE_TO_PATH",[s,e]);await this.postTask(t)}async insertArrowFromIPCStream(s,e,t){if(e.length==0)return;let i=new le("INSERT_ARROW_FROM_IPC_STREAM",[s,e,t]);await this.postTask(i,[e.buffer])}async insertCSVFromPath(s,e,t){if(t.columns!==void 0){let n=[];for(let r in t.columns){let o=t.columns[r];n.push(Uh(r,o))}t.columnsFlat=n,delete t.columns}let i=new le("IMPORT_CSV_FROM_PATH",[s,e,t]);await this.postTask(i)}async insertJSONFromPath(s,e,t){if(t.columns!==void 0){let n=[];for(let r in t.columns){let o=t.columns[r];n.push(Uh(r,o))}t.columnsFlat=n,delete t.columns}let i=new le("IMPORT_JSON_FROM_PATH",[s,e,t]);await this.postTask(i)}},B1=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,3,1,0,1,10,14,1,12,0,65,0,65,0,65,0,252,10,0,0,11])),F1=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,8,1,6,0,6,64,25,11,11])),P1=async()=>WebAssembly.validate(new Uint8Array([0,97,115,109,1,0,0,0,1,5,1,96,0,1,123,3,2,1,0,10,10,1,8,0,65,0,253,15,253,98,11])),N1=()=>(async s=>{try{return typeof MessageChannel<"u"&&new MessageChannel().port1.postMessage(new SharedArrayBuffer(1)),WebAssembly.validate(s)}catch{return!1}})(new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,5,4,1,3,1,1,10,11,1,9,0,65,0,254,16,2,0,26,11])),wu={name:"@duckdb/duckdb-wasm",version:"1.28.1-dev91.0",description:"DuckDB powered by WebAssembly",license:"MIT",repository:{type:"git",url:"https://github.com/duckdb/duckdb-wasm.git"},keywords:["sql","duckdb","relational","database","data","query","wasm","analytics","olap","arrow","parquet","json","csv"],dependencies:{"apache-arrow":"^14.0.1"},devDependencies:{"@types/emscripten":"^1.39.10","@types/jasmine":"^5.1.4","@typescript-eslint/eslint-plugin":"^6.18.0","@typescript-eslint/parser":"^6.18.0",esbuild:"^0.19.10",eslint:"^8.56.0","eslint-plugin-jasmine":"^4.1.3","eslint-plugin-react":"^7.33.2","fast-glob":"^3.3.2",jasmine:"^5.1.0","jasmine-core":"^5.1.1","jasmine-spec-reporter":"^7.0.0","js-sha256":"^0.10.1",karma:"^6.4.2","karma-chrome-launcher":"^3.2.0","karma-coverage":"^2.2.1","karma-firefox-launcher":"^2.1.2","karma-jasmine":"^5.1.0","karma-jasmine-html-reporter":"^2.1.0","karma-sourcemap-loader":"^0.4.0","karma-spec-reporter":"^0.0.36","make-dir":"^4.0.0",nyc:"^15.1.0",prettier:"^3.2.2",puppeteer:"^21.6.1",rimraf:"^5.0.5",s3rver:"^3.7.1",typedoc:"^0.25.4",typescript:"^5.3.3","wasm-feature-detect":"^1.6.1","web-worker":"^1.2.0"},scripts:{"build:debug":"node bundle.mjs debug && tsc --emitDeclarationOnly","build:release":"node bundle.mjs release && tsc --emitDeclarationOnly",docs:"typedoc",report:"node ./coverage.mjs","test:node":"node --enable-source-maps ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:node:debug":"node --inspect-brk --enable-source-maps ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:node:coverage":"nyc -r json --report-dir ./coverage/node node ../../node_modules/jasmine/bin/jasmine ./dist/tests-node.cjs","test:firefox":"karma start ./karma/tests-firefox.cjs","test:chrome":"karma start ./karma/tests-chrome.cjs","test:chrome:eh":"karma start ./karma/tests-chrome-eh.cjs","test:chrome:coverage":"karma start ./karma/tests-chrome-coverage.cjs","test:browser":"karma start ./karma/tests-all.cjs","test:browser:debug":"karma start ./karma/tests-debug.cjs",test:"npm run test:chrome && npm run test:node","test:coverage":"npm run test:chrome:coverage && npm run test:node:coverage && npm run report",lint:"eslint src test"},files:["dist","!dist/types/test"],main:"dist/duckdb-browser.cjs",module:"dist/duckdb-browser.mjs",types:"dist/duckdb-browser.d.ts",jsdelivr:"dist/duckdb-browser.cjs",unpkg:"dist/duckdb-browser.mjs",sideEffects:!1,browser:{fs:!1,path:!1,perf_hooks:!1,os:!1,worker_threads:!1},exports:{"./dist/duckdb-mvp.wasm":"./dist/duckdb-mvp.wasm","./dist/duckdb-eh.wasm":"./dist/duckdb-eh.wasm","./dist/duckdb-coi.wasm":"./dist/duckdb-coi.wasm","./dist/duckdb-browser":"./dist/duckdb-browser.mjs","./dist/duckdb-browser.cjs":"./dist/duckdb-browser.cjs","./dist/duckdb-browser.mjs":"./dist/duckdb-browser.mjs","./dist/duckdb-browser-blocking":"./dist/duckdb-browser-blocking.mjs","./dist/duckdb-browser-blocking.mjs":"./dist/duckdb-browser-blocking.mjs","./dist/duckdb-browser-blocking.cjs":"./dist/duckdb-browser-blocking.cjs","./dist/duckdb-browser-coi.pthread.worker.js":"./dist/duckdb-browser-coi.pthread.worker.js","./dist/duckdb-browser-coi.worker.js":"./dist/duckdb-browser-coi.worker.js","./dist/duckdb-browser-eh.worker.js":"./dist/duckdb-browser-eh.worker.js","./dist/duckdb-browser-mvp.worker.js":"./dist/duckdb-browser-mvp.worker.js","./dist/duckdb-node":"./dist/duckdb-node.cjs","./dist/duckdb-node.cjs":"./dist/duckdb-node.cjs","./dist/duckdb-node-blocking":"./dist/duckdb-node-blocking.cjs","./dist/duckdb-node-blocking.cjs":"./dist/duckdb-node-blocking.cjs","./dist/duckdb-node-eh.worker.cjs":"./dist/duckdb-node-eh.worker.cjs","./dist/duckdb-node-mvp.worker.cjs":"./dist/duckdb-node-mvp.worker.cjs","./blocking":{browser:{types:"./dist/duckdb-browser-blocking.d.ts",import:"./dist/duckdb-browser-blocking.mjs",require:"./dist/duckdb-browser-blocking.cjs"},node:{types:"./dist/duckdb-node-blocking.d.ts",require:"./dist/duckdb-node-blocking.cjs",import:"./dist/duckdb-node-blocking.cjs"},types:"./dist/duckdb-browser-blocking.d.ts",import:"./dist/duckdb-browser-blocking.mjs",require:"./dist/duckdb-browser-blocking.cjs"},".":{browser:{types:"./dist/duckdb-browser.d.ts",import:"./dist/duckdb-browser.mjs",require:"./dist/duckdb-browser.cjs"},node:{types:"./dist/duckdb-node.d.ts",import:"./dist/duckdb-node.cjs",require:"./dist/duckdb-node.cjs"},types:"./dist/duckdb-browser.d.ts",import:"./dist/duckdb-browser.mjs",require:"./dist/duckdb-browser.cjs"}}},z1=wu.name,H1=wu.version,Cu=wu.version.split(".");Cu[0];Cu[1];Cu[2];var V1=()=>typeof navigator>"u";function W1(){let s="https://cdn.jsdelivr.net/npm/".concat(z1,"@").concat(H1,"/dist/");return{mvp:{mainModule:"".concat(s,"duckdb-mvp.wasm"),mainWorker:"".concat(s,"duckdb-browser-mvp.worker.js")},eh:{mainModule:"".concat(s,"duckdb-eh.wasm"),mainWorker:"".concat(s,"duckdb-browser-eh.worker.js")}}}var Ja=null,Xa=null,Za=null,eh=null,th=null;async function U1(){return Ja==null&&(Ja=typeof BigInt64Array<"u"),Xa==null&&(Xa=await F1()),Za==null&&(Za=await N1()),eh==null&&(eh=await P1()),th==null&&(th=await B1()),{bigInt64Array:Ja,crossOriginIsolated:V1()||globalThis.crossOriginIsolated||!1,wasmExceptions:Xa,wasmSIMD:eh,wasmThreads:Za,wasmBulkMemory:th}}async function j1(s){let e=await U1();if(e.wasmExceptions){if(e.wasmSIMD&&e.wasmThreads&&e.crossOriginIsolated&&s.coi)return{mainModule:s.coi.mainModule,mainWorker:s.coi.mainWorker,pthreadWorker:s.coi.pthreadWorker};if(s.eh)return{mainModule:s.eh.mainModule,mainWorker:s.eh.mainWorker,pthreadWorker:null}}return{mainModule:s.mvp.mainModule,mainWorker:s.mvp.mainWorker,pthreadWorker:null}}v1(w1());function G1(){let s=new TextDecoder;return e=>(typeof SharedArrayBuffer<"u"&&e.buffer instanceof SharedArrayBuffer&&(e=new Uint8Array(e)),s.decode(e))}G1();var q1=(s=>(s[s.BUFFER=0]="BUFFER",s[s.NODE_FS=1]="NODE_FS",s[s.BROWSER_FILEREADER=2]="BROWSER_FILEREADER",s[s.BROWSER_FSACCESS=3]="BROWSER_FSACCESS",s[s.HTTP=4]="HTTP",s[s.S3=5]="S3",s))(q1||{});const $1=async()=>{const s=W1(),e=await j1(s),t=URL.createObjectURL(new Blob([`importScripts("${e.mainWorker}");`],{type:"text/javascript"})),i=new Worker(t),n=new R1,r=new I1(n,i);return await r.instantiate(e.mainModule,e.pthreadWorker),URL.revokeObjectURL(t),r};function K1(s,e,t){let{connProm:i}=e,{dbInit:n}=e;xp(async()=>t(0,{connProm:i,dbInit:n}=r(),i,t(1,n)));async function r(){try{return console.log("Instantiating DuckDB..."),t(1,n=await $1()),t(0,i=await n.connect(":memory:")),i&&console.log("DuckDB Instantiated!"),{connProm:i,dbInit:n}}catch(o){results=new Promise((l,a)=>a(o))}}return s.$$set=o=>{"connProm"in o&&t(0,i=o.connProm),"dbInit"in o&&t(1,n=o.dbInit)},[i,n]}class Y1 extends fn{constructor(e){super(),pn(this,e,K1,null,dn,{connProm:0,dbInit:1})}}class de{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,i){[e,t]=Kn(this,e,t);let n=[];return this.decompose(0,e,n,2),i.length&&i.decompose(0,i.length,n,3),this.decompose(t,this.length,n,1),Si.from(n,this.length-(t-e)+i.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){[e,t]=Kn(this,e,t);let i=[];return this.decompose(e,t,i,0),Si.from(i,t-e)}eq(e){if(e==this)return!0;if(e.length!=this.length||e.lines!=this.lines)return!1;let t=this.scanIdentical(e,1),i=this.length-this.scanIdentical(e,-1),n=new Lr(this),r=new Lr(e);for(let o=t,l=t;;){if(n.next(o),r.next(o),o=0,n.lineBreak!=r.lineBreak||n.done!=r.done||n.value!=r.value)return!1;if(l+=n.value.length,n.done||l>=i)return!0}}iter(e=1){return new Lr(this,e)}iterRange(e,t=this.length){return new Rg(this,e,t)}iterLines(e,t){let i;if(e==null)i=this.iter();else{t==null&&(t=this.lines+1);let n=this.line(e).from;i=this.iterRange(n,Math.max(n,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to))}return new Tg(i)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?de.empty:e.length<=32?new Be(e):Si.from(Be.split(e,[]))}}class Be extends de{constructor(e,t=Q1(e)){super(),this.text=e,this.length=t}get lines(){return this.text.length}get children(){return null}lineInner(e,t,i,n){for(let r=0;;r++){let o=this.text[r],l=n+o.length;if((t?i:l)>=e)return new J1(n,l,i,o);n=l+1,i++}}decompose(e,t,i,n){let r=e<=0&&t>=this.length?this:new Be(Sd(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(n&1){let o=i.pop(),l=rl(r.text,o.text.slice(),0,r.length);if(l.length<=32)i.push(new Be(l,o.length+r.length));else{let a=l.length>>1;i.push(new Be(l.slice(0,a)),new Be(l.slice(a)))}}else i.push(r)}replace(e,t,i){if(!(i instanceof Be))return super.replace(e,t,i);[e,t]=Kn(this,e,t);let n=rl(this.text,rl(i.text,Sd(this.text,0,e)),t),r=this.length+i.length-(t-e);return n.length<=32?new Be(n,r):Si.from(Be.split(n,[]),r)}sliceString(e,t=this.length,i=`
`){[e,t]=Kn(this,e,t);let n="";for(let r=0,o=0;r<=t&&o<this.text.length;o++){let l=this.text[o],a=r+l.length;r>e&&o&&(n+=i),e<a&&t>r&&(n+=l.slice(Math.max(0,e-r),t-r)),r=a+1}return n}flatten(e){for(let t of this.text)e.push(t)}scanIdentical(){return 0}static split(e,t){let i=[],n=-1;for(let r of e)i.push(r),n+=r.length+1,i.length==32&&(t.push(new Be(i,n)),i=[],n=-1);return n>-1&&t.push(new Be(i,n)),t}}class Si extends de{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let i of e)this.lines+=i.lines}lineInner(e,t,i,n){for(let r=0;;r++){let o=this.children[r],l=n+o.length,a=i+o.lines-1;if((t?a:l)>=e)return o.lineInner(e,t,i,n);n=l+1,i=a+1}}decompose(e,t,i,n){for(let r=0,o=0;o<=t&&r<this.children.length;r++){let l=this.children[r],a=o+l.length;if(e<=a&&t>=o){let h=n&((o<=e?1:0)|(a>=t?2:0));o>=e&&a<=t&&!h?i.push(l):l.decompose(e-o,t-o,i,h)}o=a+1}}replace(e,t,i){if([e,t]=Kn(this,e,t),i.lines<this.lines)for(let n=0,r=0;n<this.children.length;n++){let o=this.children[n],l=r+o.length;if(e>=r&&t<=l){let a=o.replace(e-r,t-r,i),h=this.lines-o.lines+a.lines;if(a.lines<h>>4&&a.lines>h>>6){let c=this.children.slice();return c[n]=a,new Si(c,this.length-(t-e)+i.length)}return super.replace(r,l,a)}r=l+1}return super.replace(e,t,i)}sliceString(e,t=this.length,i=`
`){[e,t]=Kn(this,e,t);let n="";for(let r=0,o=0;r<this.children.length&&o<=t;r++){let l=this.children[r],a=o+l.length;o>e&&r&&(n+=i),e<a&&t>o&&(n+=l.sliceString(e-o,t-o,i)),o=a+1}return n}flatten(e){for(let t of this.children)t.flatten(e)}scanIdentical(e,t){if(!(e instanceof Si))return 0;let i=0,[n,r,o,l]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;n+=t,r+=t){if(n==o||r==l)return i;let a=this.children[n],h=e.children[r];if(a!=h)return i+a.scanIdentical(h,t);i+=a.length+1}}static from(e,t=e.reduce((i,n)=>i+n.length+1,-1)){let i=0;for(let f of e)i+=f.lines;if(i<32){let f=[];for(let p of e)p.flatten(f);return new Be(f,t)}let n=Math.max(32,i>>5),r=n<<1,o=n>>1,l=[],a=0,h=-1,c=[];function u(f){let p;if(f.lines>r&&f instanceof Si)for(let m of f.children)u(m);else f.lines>o&&(a>o||!a)?(d(),l.push(f)):f instanceof Be&&a&&(p=c[c.length-1])instanceof Be&&f.lines+p.lines<=32?(a+=f.lines,h+=f.length+1,c[c.length-1]=new Be(p.text.concat(f.text),p.length+1+f.length)):(a+f.lines>n&&d(),a+=f.lines,h+=f.length+1,c.push(f))}function d(){a!=0&&(l.push(c.length==1?c[0]:Si.from(c,h)),h=-1,a=c.length=0)}for(let f of e)u(f);return d(),l.length==1?l[0]:new Si(l,t)}}de.empty=new Be([""],0);function Q1(s){let e=-1;for(let t of s)e+=t.length+1;return e}function rl(s,e,t=0,i=1e9){for(let n=0,r=0,o=!0;r<s.length&&n<=i;r++){let l=s[r],a=n+l.length;a>=t&&(a>i&&(l=l.slice(0,i-n)),n<t&&(l=l.slice(t-n)),o?(e[e.length-1]+=l,o=!1):e.push(l)),n=a+1}return e}function Sd(s,e,t){return rl(s,[""],e,t)}class Lr{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof Be?e.text.length:e.children.length)<<1]}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let i=this.nodes.length-1,n=this.nodes[i],r=this.offsets[i],o=r>>1,l=n instanceof Be?n.text.length:n.children.length;if(o==(t>0?l:0)){if(i==0)return this.done=!0,this.value="",this;t>0&&this.offsets[i-1]++,this.nodes.pop(),this.offsets.pop()}else if((r&1)==(t>0?0:1)){if(this.offsets[i]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--}else if(n instanceof Be){let a=n.text[o+(t<0?-1:0)];if(this.offsets[i]+=t,a.length>Math.max(0,e))return this.value=e==0?a:t>0?a.slice(e):a.slice(0,a.length-e),this;e-=a.length}else{let a=n.children[o+(t<0?-1:0)];e>a.length?(e-=a.length,this.offsets[i]+=t):(t<0&&this.offsets[i]--,this.nodes.push(a),this.offsets.push(t>0?1:(a instanceof Be?a.text.length:a.children.length)<<1))}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}}class Rg{constructor(e,t,i){this.value="",this.done=!1,this.cursor=new Lr(e,t>i?-1:1),this.pos=t>i?e.length:0,this.from=Math.min(t,i),this.to=Math.max(t,i)}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let i=t<0?this.pos-this.from:this.to-this.pos;e>i&&(e=i),i-=e;let{value:n}=this.cursor.next(e);return this.pos+=(n.length+e)*t,this.value=n.length<=i?n:t<0?n.slice(n.length-i):n.slice(0,i),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}}class Tg{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1}next(e=0){let{done:t,lineBreak:i,value:n}=this.inner.next(e);return t&&this.afterBreak?(this.value="",this.afterBreak=!1):t?(this.done=!0,this.value=""):i?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=n,this.afterBreak=!1),this}get lineBreak(){return!1}}typeof Symbol<"u"&&(de.prototype[Symbol.iterator]=function(){return this.iter()},Lr.prototype[Symbol.iterator]=Rg.prototype[Symbol.iterator]=Tg.prototype[Symbol.iterator]=function(){return this});class J1{constructor(e,t,i,n){this.from=e,this.to=t,this.number=i,this.text=n}get length(){return this.to-this.from}}function Kn(s,e,t){return e=Math.max(0,Math.min(s.length,e)),[e,Math.max(e,Math.min(s.length,t))]}let Bn="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(s=>s?parseInt(s,36):1);for(let s=1;s<Bn.length;s++)Bn[s]+=Bn[s-1];function X1(s){for(let e=1;e<Bn.length;e+=2)if(Bn[e]>s)return Bn[e-1]<=s;return!1}function _d(s){return s>=127462&&s<=127487}const Rd=8205;function tt(s,e,t=!0,i=!0){return(t?Mg:Z1)(s,e,i)}function Mg(s,e,t){if(e==s.length)return e;e&&Dg(s.charCodeAt(e))&&Ag(s.charCodeAt(e-1))&&e--;let i=Qe(s,e);for(e+=qt(i);e<s.length;){let n=Qe(s,e);if(i==Rd||n==Rd||t&&X1(n))e+=qt(n),i=n;else if(_d(n)){let r=0,o=e-2;for(;o>=0&&_d(Qe(s,o));)r++,o-=2;if(r%2==0)break;e+=2}else break}return e}function Z1(s,e,t){for(;e>0;){let i=Mg(s,e-2,t);if(i<e)return i;e--}return 0}function Dg(s){return s>=56320&&s<57344}function Ag(s){return s>=55296&&s<56320}function Qe(s,e){let t=s.charCodeAt(e);if(!Ag(t)||e+1==s.length)return t;let i=s.charCodeAt(e+1);return Dg(i)?(t-55296<<10)+(i-56320)+65536:t}function Eu(s){return s<=65535?String.fromCharCode(s):(s-=65536,String.fromCharCode((s>>10)+55296,(s&1023)+56320))}function qt(s){return s<65536?1:2}const jh=/\r\n?|\n/;var ut=function(s){return s[s.Simple=0]="Simple",s[s.TrackDel=1]="TrackDel",s[s.TrackBefore=2]="TrackBefore",s[s.TrackAfter=3]="TrackAfter",s}(ut||(ut={}));class Li{constructor(e){this.sections=e}get length(){let e=0;for(let t=0;t<this.sections.length;t+=2)e+=this.sections[t];return e}get newLength(){let e=0;for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t+1];e+=i<0?this.sections[t]:i}return e}get empty(){return this.sections.length==0||this.sections.length==2&&this.sections[1]<0}iterGaps(e){for(let t=0,i=0,n=0;t<this.sections.length;){let r=this.sections[t++],o=this.sections[t++];o<0?(e(i,n,r),n+=r):n+=o,i+=r}}iterChangedRanges(e,t=!1){Gh(this,e,t)}get invertedDesc(){let e=[];for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];n<0?e.push(i,n):e.push(n,i)}return new Li(e)}composeDesc(e){return this.empty?e:e.empty?this:Og(this,e)}mapDesc(e,t=!1){return e.empty?this:qh(this,e,t)}mapPos(e,t=-1,i=ut.Simple){let n=0,r=0;for(let o=0;o<this.sections.length;){let l=this.sections[o++],a=this.sections[o++],h=n+l;if(a<0){if(h>e)return r+(e-n);r+=l}else{if(i!=ut.Simple&&h>=e&&(i==ut.TrackDel&&n<e&&h>e||i==ut.TrackBefore&&n<e||i==ut.TrackAfter&&h>e))return null;if(h>e||h==e&&t<0&&!l)return e==n||t<0?r:r+a;r+=a}n=h}if(e>n)throw new RangeError(`Position ${e} is out of range for changeset of length ${n}`);return r}touchesRange(e,t=e){for(let i=0,n=0;i<this.sections.length&&n<=t;){let r=this.sections[i++],o=this.sections[i++],l=n+r;if(o>=0&&n<=t&&l>=e)return n<e&&l>t?"cover":!0;n=l}return!1}toString(){let e="";for(let t=0;t<this.sections.length;){let i=this.sections[t++],n=this.sections[t++];e+=(e?" ":"")+i+(n>=0?":"+n:"")}return e}toJSON(){return this.sections}static fromJSON(e){if(!Array.isArray(e)||e.length%2||e.some(t=>typeof t!="number"))throw new RangeError("Invalid JSON representation of ChangeDesc");return new Li(e)}static create(e){return new Li(e)}}class Ue extends Li{constructor(e,t){super(e),this.inserted=t}apply(e){if(this.length!=e.length)throw new RangeError("Applying change set to a document with the wrong length");return Gh(this,(t,i,n,r,o)=>e=e.replace(n,n+(i-t),o),!1),e}mapDesc(e,t=!1){return qh(this,e,t,!0)}invert(e){let t=this.sections.slice(),i=[];for(let n=0,r=0;n<t.length;n+=2){let o=t[n],l=t[n+1];if(l>=0){t[n]=l,t[n+1]=o;let a=n>>1;for(;i.length<a;)i.push(de.empty);i.push(o?e.slice(r,r+o):de.empty)}r+=o}return new Ue(t,i)}compose(e){return this.empty?e:e.empty?this:Og(this,e,!0)}map(e,t=!1){return e.empty?this:qh(this,e,t,!0)}iterChanges(e,t=!1){Gh(this,e,t)}get desc(){return Li.create(this.sections)}filter(e){let t=[],i=[],n=[],r=new qr(this);e:for(let o=0,l=0;;){let a=o==e.length?1e9:e[o++];for(;l<a||l==a&&r.len==0;){if(r.done)break e;let c=Math.min(r.len,a-l);st(n,c,-1);let u=r.ins==-1?-1:r.off==0?r.ins:0;st(t,c,u),u>0&&us(i,t,r.text),r.forward(c),l+=c}let h=e[o++];for(;l<h;){if(r.done)break e;let c=Math.min(r.len,h-l);st(t,c,-1),st(n,c,r.ins==-1?-1:r.off==0?r.ins:0),r.forward(c),l+=c}}return{changes:new Ue(t,i),filtered:Li.create(n)}}toJSON(){let e=[];for(let t=0;t<this.sections.length;t+=2){let i=this.sections[t],n=this.sections[t+1];n<0?e.push(i):n==0?e.push([i]):e.push([i].concat(this.inserted[t>>1].toJSON()))}return e}static of(e,t,i){let n=[],r=[],o=0,l=null;function a(c=!1){if(!c&&!n.length)return;o<t&&st(n,t-o,-1);let u=new Ue(n,r);l=l?l.compose(u.map(l)):u,n=[],r=[],o=0}function h(c){if(Array.isArray(c))for(let u of c)h(u);else if(c instanceof Ue){if(c.length!=t)throw new RangeError(`Mismatched change set length (got ${c.length}, expected ${t})`);a(),l=l?l.compose(c.map(l)):c}else{let{from:u,to:d=u,insert:f}=c;if(u>d||u<0||d>t)throw new RangeError(`Invalid change range ${u} to ${d} (in doc of length ${t})`);let p=f?typeof f=="string"?de.of(f.split(i||jh)):f:de.empty,m=p.length;if(u==d&&m==0)return;u<o&&a(),u>o&&st(n,u-o,-1),st(n,d-u,m),us(r,n,p),o=d}}return h(e),a(!l),l}static empty(e){return new Ue(e?[e,-1]:[],[])}static fromJSON(e){if(!Array.isArray(e))throw new RangeError("Invalid JSON representation of ChangeSet");let t=[],i=[];for(let n=0;n<e.length;n++){let r=e[n];if(typeof r=="number")t.push(r,-1);else{if(!Array.isArray(r)||typeof r[0]!="number"||r.some((o,l)=>l&&typeof o!="string"))throw new RangeError("Invalid JSON representation of ChangeSet");if(r.length==1)t.push(r[0],0);else{for(;i.length<n;)i.push(de.empty);i[n]=de.of(r.slice(1)),t.push(r[0],i[n].length)}}}return new Ue(t,i)}static createSet(e,t){return new Ue(e,t)}}function st(s,e,t,i=!1){if(e==0&&t<=0)return;let n=s.length-2;n>=0&&t<=0&&t==s[n+1]?s[n]+=e:e==0&&s[n]==0?s[n+1]+=t:i?(s[n]+=e,s[n+1]+=t):s.push(e,t)}function us(s,e,t){if(t.length==0)return;let i=e.length-2>>1;if(i<s.length)s[s.length-1]=s[s.length-1].append(t);else{for(;s.length<i;)s.push(de.empty);s.push(t)}}function Gh(s,e,t){let i=s.inserted;for(let n=0,r=0,o=0;o<s.sections.length;){let l=s.sections[o++],a=s.sections[o++];if(a<0)n+=l,r+=l;else{let h=n,c=r,u=de.empty;for(;h+=l,c+=a,a&&i&&(u=u.append(i[o-2>>1])),!(t||o==s.sections.length||s.sections[o+1]<0);)l=s.sections[o++],a=s.sections[o++];e(n,h,r,c,u),n=h,r=c}}}function qh(s,e,t,i=!1){let n=[],r=i?[]:null,o=new qr(s),l=new qr(e);for(let a=-1;;)if(o.ins==-1&&l.ins==-1){let h=Math.min(o.len,l.len);st(n,h,-1),o.forward(h),l.forward(h)}else if(l.ins>=0&&(o.ins<0||a==o.i||o.off==0&&(l.len<o.len||l.len==o.len&&!t))){let h=l.len;for(st(n,l.ins,-1);h;){let c=Math.min(o.len,h);o.ins>=0&&a<o.i&&o.len<=c&&(st(n,0,o.ins),r&&us(r,n,o.text),a=o.i),o.forward(c),h-=c}l.next()}else if(o.ins>=0){let h=0,c=o.len;for(;c;)if(l.ins==-1){let u=Math.min(c,l.len);h+=u,c-=u,l.forward(u)}else if(l.ins==0&&l.len<c)c-=l.len,l.next();else break;st(n,h,a<o.i?o.ins:0),r&&a<o.i&&us(r,n,o.text),a=o.i,o.forward(o.len-c)}else{if(o.done&&l.done)return r?Ue.createSet(n,r):Li.create(n);throw new Error("Mismatched change set lengths")}}function Og(s,e,t=!1){let i=[],n=t?[]:null,r=new qr(s),o=new qr(e);for(let l=!1;;){if(r.done&&o.done)return n?Ue.createSet(i,n):Li.create(i);if(r.ins==0)st(i,r.len,0,l),r.next();else if(o.len==0&&!o.done)st(i,0,o.ins,l),n&&us(n,i,o.text),o.next();else{if(r.done||o.done)throw new Error("Mismatched change set lengths");{let a=Math.min(r.len2,o.len),h=i.length;if(r.ins==-1){let c=o.ins==-1?-1:o.off?0:o.ins;st(i,a,c,l),n&&c&&us(n,i,o.text)}else o.ins==-1?(st(i,r.off?0:r.len,a,l),n&&us(n,i,r.textBit(a))):(st(i,r.off?0:r.len,o.off?0:o.ins,l),n&&!o.off&&us(n,i,o.text));l=(r.ins>a||o.ins>=0&&o.len>a)&&(l||i.length>h),r.forward2(a),o.forward(a)}}}}class qr{constructor(e){this.set=e,this.i=0,this.next()}next(){let{sections:e}=this.set;this.i<e.length?(this.len=e[this.i++],this.ins=e[this.i++]):(this.len=0,this.ins=-2),this.off=0}get done(){return this.ins==-2}get len2(){return this.ins<0?this.len:this.ins}get text(){let{inserted:e}=this.set,t=this.i-2>>1;return t>=e.length?de.empty:e[t]}textBit(e){let{inserted:t}=this.set,i=this.i-2>>1;return i>=t.length&&!e?de.empty:t[i].slice(this.off,e==null?void 0:this.off+e)}forward(e){e==this.len?this.next():(this.len-=e,this.off+=e)}forward2(e){this.ins==-1?this.forward(e):e==this.ins?this.next():(this.ins-=e,this.off+=e)}}class Ks{constructor(e,t,i){this.from=e,this.to=t,this.flags=i}get anchor(){return this.flags&32?this.to:this.from}get head(){return this.flags&32?this.from:this.to}get empty(){return this.from==this.to}get assoc(){return this.flags&8?-1:this.flags&16?1:0}get bidiLevel(){let e=this.flags&7;return e==7?null:e}get goalColumn(){let e=this.flags>>6;return e==16777215?void 0:e}map(e,t=-1){let i,n;return this.empty?i=n=e.mapPos(this.from,t):(i=e.mapPos(this.from,1),n=e.mapPos(this.to,-1)),i==this.from&&n==this.to?this:new Ks(i,n,this.flags)}extend(e,t=e){if(e<=this.anchor&&t>=this.anchor)return S.range(e,t);let i=Math.abs(e-this.anchor)>Math.abs(t-this.anchor)?e:t;return S.range(this.anchor,i)}eq(e,t=!1){return this.anchor==e.anchor&&this.head==e.head&&(!t||!this.empty||this.assoc==e.assoc)}toJSON(){return{anchor:this.anchor,head:this.head}}static fromJSON(e){if(!e||typeof e.anchor!="number"||typeof e.head!="number")throw new RangeError("Invalid JSON representation for SelectionRange");return S.range(e.anchor,e.head)}static create(e,t,i){return new Ks(e,t,i)}}class S{constructor(e,t){this.ranges=e,this.mainIndex=t}map(e,t=-1){return e.empty?this:S.create(this.ranges.map(i=>i.map(e,t)),this.mainIndex)}eq(e,t=!1){if(this.ranges.length!=e.ranges.length||this.mainIndex!=e.mainIndex)return!1;for(let i=0;i<this.ranges.length;i++)if(!this.ranges[i].eq(e.ranges[i],t))return!1;return!0}get main(){return this.ranges[this.mainIndex]}asSingle(){return this.ranges.length==1?this:new S([this.main],0)}addRange(e,t=!0){return S.create([e].concat(this.ranges),t?0:this.mainIndex+1)}replaceRange(e,t=this.mainIndex){let i=this.ranges.slice();return i[t]=e,S.create(i,this.mainIndex)}toJSON(){return{ranges:this.ranges.map(e=>e.toJSON()),main:this.mainIndex}}static fromJSON(e){if(!e||!Array.isArray(e.ranges)||typeof e.main!="number"||e.main>=e.ranges.length)throw new RangeError("Invalid JSON representation for EditorSelection");return new S(e.ranges.map(t=>Ks.fromJSON(t)),e.main)}static single(e,t=e){return new S([S.range(e,t)],0)}static create(e,t=0){if(e.length==0)throw new RangeError("A selection needs at least one range");for(let i=0,n=0;n<e.length;n++){let r=e[n];if(r.empty?r.from<=i:r.from<i)return S.normalized(e.slice(),t);i=r.to}return new S(e,t)}static cursor(e,t=0,i,n){return Ks.create(e,e,(t==0?0:t<0?8:16)|(i==null?7:Math.min(6,i))|(n??16777215)<<6)}static range(e,t,i,n){let r=(i??16777215)<<6|(n==null?7:Math.min(6,n));return t<e?Ks.create(t,e,48|r):Ks.create(e,t,(t>e?8:0)|r)}static normalized(e,t=0){let i=e[t];e.sort((n,r)=>n.from-r.from),t=e.indexOf(i);for(let n=1;n<e.length;n++){let r=e[n],o=e[n-1];if(r.empty?r.from<=o.to:r.from<o.to){let l=o.from,a=Math.max(r.to,o.to);n<=t&&t--,e.splice(--n,2,r.anchor>r.head?S.range(a,l):S.range(l,a))}}return new S(e,t)}}function Lg(s,e){for(let t of s.ranges)if(t.to>e)throw new RangeError("Selection points outside of document")}let xu=0;class O{constructor(e,t,i,n,r){this.combine=e,this.compareInput=t,this.compare=i,this.isStatic=n,this.id=xu++,this.default=e([]),this.extensions=typeof r=="function"?r(this):r}get reader(){return this}static define(e={}){return new O(e.combine||(t=>t),e.compareInput||((t,i)=>t===i),e.compare||(e.combine?(t,i)=>t===i:ku),!!e.static,e.enables)}of(e){return new ol([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new ol(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new ol(e,this,2,t)}from(e,t){return t||(t=i=>i),this.compute([e],i=>t(i.field(e)))}}function ku(s,e){return s==e||s.length==e.length&&s.every((t,i)=>t===e[i])}class ol{constructor(e,t,i,n){this.dependencies=e,this.facet=t,this.type=i,this.value=n,this.id=xu++}dynamicSlot(e){var t;let i=this.value,n=this.facet.compareInput,r=this.id,o=e[r]>>1,l=this.type==2,a=!1,h=!1,c=[];for(let u of this.dependencies)u=="doc"?a=!0:u=="selection"?h=!0:((t=e[u.id])!==null&&t!==void 0?t:1)&1||c.push(e[u.id]);return{create(u){return u.values[o]=i(u),1},update(u,d){if(a&&d.docChanged||h&&(d.docChanged||d.selection)||$h(u,c)){let f=i(u);if(l?!Td(f,u.values[o],n):!n(f,u.values[o]))return u.values[o]=f,1}return 0},reconfigure:(u,d)=>{let f,p=d.config.address[r];if(p!=null){let m=Kl(d,p);if(this.dependencies.every(g=>g instanceof O?d.facet(g)===u.facet(g):g instanceof it?d.field(g,!1)==u.field(g,!1):!0)||(l?Td(f=i(u),m,n):n(f=i(u),m)))return u.values[o]=m,0}else f=i(u);return u.values[o]=f,1}}}}function Td(s,e,t){if(s.length!=e.length)return!1;for(let i=0;i<s.length;i++)if(!t(s[i],e[i]))return!1;return!0}function $h(s,e){let t=!1;for(let i of e)Ir(s,i)&1&&(t=!0);return t}function eE(s,e,t){let i=t.map(a=>s[a.id]),n=t.map(a=>a.type),r=i.filter(a=>!(a&1)),o=s[e.id]>>1;function l(a){let h=[];for(let c=0;c<i.length;c++){let u=Kl(a,i[c]);if(n[c]==2)for(let d of u)h.push(d);else h.push(u)}return e.combine(h)}return{create(a){for(let h of i)Ir(a,h);return a.values[o]=l(a),1},update(a,h){if(!$h(a,r))return 0;let c=l(a);return e.compare(c,a.values[o])?0:(a.values[o]=c,1)},reconfigure(a,h){let c=$h(a,i),u=h.config.facets[e.id],d=h.facet(e);if(u&&!c&&ku(t,u))return a.values[o]=d,0;let f=l(a);return e.compare(f,d)?(a.values[o]=d,0):(a.values[o]=f,1)}}}const Md=O.define({static:!0});class it{constructor(e,t,i,n,r){this.id=e,this.createF=t,this.updateF=i,this.compareF=n,this.spec=r,this.provides=void 0}static define(e){let t=new it(xu++,e.create,e.update,e.compare||((i,n)=>i===n),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Md).find(i=>i.field==this);return((t==null?void 0:t.create)||this.createF)(e)}slot(e){let t=e[this.id]>>1;return{create:i=>(i.values[t]=this.create(i),1),update:(i,n)=>{let r=i.values[t],o=this.updateF(r,n);return this.compareF(r,o)?0:(i.values[t]=o,1)},reconfigure:(i,n)=>n.config.address[this.id]!=null?(i.values[t]=n.field(this),0):(i.values[t]=this.create(i),1)}}init(e){return[this,Md.of({field:this,create:e})]}get extension(){return this}}const Vs={lowest:4,low:3,default:2,high:1,highest:0};function dr(s){return e=>new Ig(e,s)}const or={highest:dr(Vs.highest),high:dr(Vs.high),default:dr(Vs.default),low:dr(Vs.low),lowest:dr(Vs.lowest)};class Ig{constructor(e,t){this.inner=e,this.prec=t}}class ka{of(e){return new Kh(this,e)}reconfigure(e){return ka.reconfigure.of({compartment:this,extension:e})}get(e){return e.config.compartments.get(this)}}class Kh{constructor(e,t){this.compartment=e,this.inner=t}}class $l{constructor(e,t,i,n,r,o){for(this.base=e,this.compartments=t,this.dynamicSlots=i,this.address=n,this.staticValues=r,this.facets=o,this.statusTemplate=[];this.statusTemplate.length<i.length;)this.statusTemplate.push(0)}staticFacet(e){let t=this.address[e.id];return t==null?e.default:this.staticValues[t>>1]}static resolve(e,t,i){let n=[],r=Object.create(null),o=new Map;for(let d of tE(e,t,o))d instanceof it?n.push(d):(r[d.facet.id]||(r[d.facet.id]=[])).push(d);let l=Object.create(null),a=[],h=[];for(let d of n)l[d.id]=h.length<<1,h.push(f=>d.slot(f));let c=i==null?void 0:i.config.facets;for(let d in r){let f=r[d],p=f[0].facet,m=c&&c[d]||[];if(f.every(g=>g.type==0))if(l[p.id]=a.length<<1|1,ku(m,f))a.push(i.facet(p));else{let g=p.combine(f.map(b=>b.value));a.push(i&&p.compare(g,i.facet(p))?i.facet(p):g)}else{for(let g of f)g.type==0?(l[g.id]=a.length<<1|1,a.push(g.value)):(l[g.id]=h.length<<1,h.push(b=>g.dynamicSlot(b)));l[p.id]=h.length<<1,h.push(g=>eE(g,p,f))}}let u=h.map(d=>d(l));return new $l(e,o,u,l,a,r)}}function tE(s,e,t){let i=[[],[],[],[],[]],n=new Map;function r(o,l){let a=n.get(o);if(a!=null){if(a<=l)return;let h=i[a].indexOf(o);h>-1&&i[a].splice(h,1),o instanceof Kh&&t.delete(o.compartment)}if(n.set(o,l),Array.isArray(o))for(let h of o)r(h,l);else if(o instanceof Kh){if(t.has(o.compartment))throw new RangeError("Duplicate use of compartment in extensions");let h=e.get(o.compartment)||o.inner;t.set(o.compartment,h),r(h,l)}else if(o instanceof Ig)r(o.inner,o.prec);else if(o instanceof it)i[l].push(o),o.provides&&r(o.provides,l);else if(o instanceof ol)i[l].push(o),o.facet.extensions&&r(o.facet.extensions,Vs.default);else{let h=o.extension;if(!h)throw new Error(`Unrecognized extension value in extension set (${o}). This sometimes happens because multiple instances of @codemirror/state are loaded, breaking instanceof checks.`);r(h,l)}}return r(s,Vs.default),i.reduce((o,l)=>o.concat(l))}function Ir(s,e){if(e&1)return 2;let t=e>>1,i=s.status[t];if(i==4)throw new Error("Cyclic dependency between fields and/or facets");if(i&2)return i;s.status[t]=4;let n=s.computeSlot(s,s.config.dynamicSlots[t]);return s.status[t]=2|n}function Kl(s,e){return e&1?s.config.staticValues[e>>1]:s.values[e>>1]}const Bg=O.define(),Yh=O.define({combine:s=>s.some(e=>e),static:!0}),Fg=O.define({combine:s=>s.length?s[0]:void 0,static:!0}),Pg=O.define(),Ng=O.define(),zg=O.define(),Hg=O.define({combine:s=>s.length?s[0]:!1});class is{constructor(e,t){this.type=e,this.value=t}static define(){return new iE}}class iE{of(e){return new is(this,e)}}class sE{constructor(e){this.map=e}of(e){return new ee(this,e)}}class ee{constructor(e,t){this.type=e,this.value=t}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new ee(this.type,t)}is(e){return this.type==e}static define(e={}){return new sE(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let i=[];for(let n of e){let r=n.map(t);r&&i.push(r)}return i}}ee.reconfigure=ee.define();ee.appendConfig=ee.define();class Ge{constructor(e,t,i,n,r,o){this.startState=e,this.changes=t,this.selection=i,this.effects=n,this.annotations=r,this.scrollIntoView=o,this._doc=null,this._state=null,i&&Lg(i,t.newLength),r.some(l=>l.type==Ge.time)||(this.annotations=r.concat(Ge.time.of(Date.now())))}static create(e,t,i,n,r,o){return new Ge(e,t,i,n,r,o)}get newDoc(){return this._doc||(this._doc=this.changes.apply(this.startState.doc))}get newSelection(){return this.selection||this.startState.selection.map(this.changes)}get state(){return this._state||this.startState.applyTransaction(this),this._state}annotation(e){for(let t of this.annotations)if(t.type==e)return t.value}get docChanged(){return!this.changes.empty}get reconfigured(){return this.startState.config!=this.state.config}isUserEvent(e){let t=this.annotation(Ge.userEvent);return!!(t&&(t==e||t.length>e.length&&t.slice(0,e.length)==e&&t[e.length]=="."))}}Ge.time=is.define();Ge.userEvent=is.define();Ge.addToHistory=is.define();Ge.remote=is.define();function nE(s,e){let t=[];for(let i=0,n=0;;){let r,o;if(i<s.length&&(n==e.length||e[n]>=s[i]))r=s[i++],o=s[i++];else if(n<e.length)r=e[n++],o=e[n++];else return t;!t.length||t[t.length-1]<r?t.push(r,o):t[t.length-1]<o&&(t[t.length-1]=o)}}function Vg(s,e,t){var i;let n,r,o;return t?(n=e.changes,r=Ue.empty(e.changes.length),o=s.changes.compose(e.changes)):(n=e.changes.map(s.changes),r=s.changes.mapDesc(e.changes,!0),o=s.changes.compose(n)),{changes:o,selection:e.selection?e.selection.map(r):(i=s.selection)===null||i===void 0?void 0:i.map(n),effects:ee.mapEffects(s.effects,n).concat(ee.mapEffects(e.effects,r)),annotations:s.annotations.length?s.annotations.concat(e.annotations):e.annotations,scrollIntoView:s.scrollIntoView||e.scrollIntoView}}function Qh(s,e,t){let i=e.selection,n=Fn(e.annotations);return e.userEvent&&(n=n.concat(Ge.userEvent.of(e.userEvent))),{changes:e.changes instanceof Ue?e.changes:Ue.of(e.changes||[],t,s.facet(Fg)),selection:i&&(i instanceof S?i:S.single(i.anchor,i.head)),effects:Fn(e.effects),annotations:n,scrollIntoView:!!e.scrollIntoView}}function Wg(s,e,t){let i=Qh(s,e.length?e[0]:{},s.doc.length);e.length&&e[0].filter===!1&&(t=!1);for(let r=1;r<e.length;r++){e[r].filter===!1&&(t=!1);let o=!!e[r].sequential;i=Vg(i,Qh(s,e[r],o?i.changes.newLength:s.doc.length),o)}let n=Ge.create(s,i.changes,i.selection,i.effects,i.annotations,i.scrollIntoView);return oE(t?rE(n):n)}function rE(s){let e=s.startState,t=!0;for(let n of e.facet(Pg)){let r=n(s);if(r===!1){t=!1;break}Array.isArray(r)&&(t=t===!0?r:nE(t,r))}if(t!==!0){let n,r;if(t===!1)r=s.changes.invertedDesc,n=Ue.empty(e.doc.length);else{let o=s.changes.filter(t);n=o.changes,r=o.filtered.mapDesc(o.changes).invertedDesc}s=Ge.create(e,n,s.selection&&s.selection.map(r),ee.mapEffects(s.effects,r),s.annotations,s.scrollIntoView)}let i=e.facet(Ng);for(let n=i.length-1;n>=0;n--){let r=i[n](s);r instanceof Ge?s=r:Array.isArray(r)&&r.length==1&&r[0]instanceof Ge?s=r[0]:s=Wg(e,Fn(r),!1)}return s}function oE(s){let e=s.startState,t=e.facet(zg),i=s;for(let n=t.length-1;n>=0;n--){let r=t[n](s);r&&Object.keys(r).length&&(i=Vg(i,Qh(e,r,s.changes.newLength),!0))}return i==s?s:Ge.create(e,s.changes,s.selection,i.effects,i.annotations,i.scrollIntoView)}const lE=[];function Fn(s){return s==null?lE:Array.isArray(s)?s:[s]}var De=function(s){return s[s.Word=0]="Word",s[s.Space=1]="Space",s[s.Other=2]="Other",s}(De||(De={}));const aE=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/;let Jh;try{Jh=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u")}catch{}function hE(s){if(Jh)return Jh.test(s);for(let e=0;e<s.length;e++){let t=s[e];if(/\w/.test(t)||t>""&&(t.toUpperCase()!=t.toLowerCase()||aE.test(t)))return!0}return!1}function cE(s){return e=>{if(!/\S/.test(e))return De.Space;if(hE(e))return De.Word;for(let t=0;t<s.length;t++)if(e.indexOf(s[t])>-1)return De.Word;return De.Other}}class ae{constructor(e,t,i,n,r,o){this.config=e,this.doc=t,this.selection=i,this.values=n,this.status=e.statusTemplate.slice(),this.computeSlot=r,o&&(o._state=this);for(let l=0;l<this.config.dynamicSlots.length;l++)Ir(this,l<<1);this.computeSlot=null}field(e,t=!0){let i=this.config.address[e.id];if(i==null){if(t)throw new RangeError("Field is not present in this state");return}return Ir(this,i),Kl(this,i)}update(...e){return Wg(this,e,!0)}applyTransaction(e){let t=this.config,{base:i,compartments:n}=t;for(let l of e.effects)l.is(ka.reconfigure)?(t&&(n=new Map,t.compartments.forEach((a,h)=>n.set(h,a)),t=null),n.set(l.value.compartment,l.value.extension)):l.is(ee.reconfigure)?(t=null,i=l.value):l.is(ee.appendConfig)&&(t=null,i=Fn(i).concat(l.value));let r;t?r=e.startState.values.slice():(t=$l.resolve(i,n,this),r=new ae(t,this.doc,this.selection,t.dynamicSlots.map(()=>null),(a,h)=>h.reconfigure(a,this),null).values);let o=e.startState.facet(Yh)?e.newSelection:e.newSelection.asSingle();new ae(t,e.newDoc,o,r,(l,a)=>a.update(l,e),e)}replaceSelection(e){return typeof e=="string"&&(e=this.toText(e)),this.changeByRange(t=>({changes:{from:t.from,to:t.to,insert:e},range:S.cursor(t.from+e.length)}))}changeByRange(e){let t=this.selection,i=e(t.ranges[0]),n=this.changes(i.changes),r=[i.range],o=Fn(i.effects);for(let l=1;l<t.ranges.length;l++){let a=e(t.ranges[l]),h=this.changes(a.changes),c=h.map(n);for(let d=0;d<l;d++)r[d]=r[d].map(c);let u=n.mapDesc(h,!0);r.push(a.range.map(u)),n=n.compose(c),o=ee.mapEffects(o,c).concat(ee.mapEffects(Fn(a.effects),u))}return{changes:n,selection:S.create(r,t.mainIndex),effects:o}}changes(e=[]){return e instanceof Ue?e:Ue.of(e,this.doc.length,this.facet(ae.lineSeparator))}toText(e){return de.of(e.split(this.facet(ae.lineSeparator)||jh))}sliceDoc(e=0,t=this.doc.length){return this.doc.sliceString(e,t,this.lineBreak)}facet(e){let t=this.config.address[e.id];return t==null?e.default:(Ir(this,t),Kl(this,t))}toJSON(e){let t={doc:this.sliceDoc(),selection:this.selection.toJSON()};if(e)for(let i in e){let n=e[i];n instanceof it&&this.config.address[n.id]!=null&&(t[i]=n.spec.toJSON(this.field(e[i]),this))}return t}static fromJSON(e,t={},i){if(!e||typeof e.doc!="string")throw new RangeError("Invalid JSON representation for EditorState");let n=[];if(i){for(let r in i)if(Object.prototype.hasOwnProperty.call(e,r)){let o=i[r],l=e[r];n.push(o.init(a=>o.spec.fromJSON(l,a)))}}return ae.create({doc:e.doc,selection:S.fromJSON(e.selection),extensions:t.extensions?n.concat([t.extensions]):n})}static create(e={}){let t=$l.resolve(e.extensions||[],new Map),i=e.doc instanceof de?e.doc:de.of((e.doc||"").split(t.staticFacet(ae.lineSeparator)||jh)),n=e.selection?e.selection instanceof S?e.selection:S.single(e.selection.anchor,e.selection.head):S.single(0);return Lg(n,i.length),t.staticFacet(Yh)||(n=n.asSingle()),new ae(t,i,n,t.dynamicSlots.map(()=>null),(r,o)=>o.create(r),null)}get tabSize(){return this.facet(ae.tabSize)}get lineBreak(){return this.facet(ae.lineSeparator)||`
`}get readOnly(){return this.facet(Hg)}phrase(e,...t){for(let i of this.facet(ae.phrases))if(Object.prototype.hasOwnProperty.call(i,e)){e=i[e];break}return t.length&&(e=e.replace(/\$(\$|\d*)/g,(i,n)=>{if(n=="$")return"$";let r=+(n||1);return!r||r>t.length?i:t[r-1]})),e}languageDataAt(e,t,i=-1){let n=[];for(let r of this.facet(Bg))for(let o of r(this,t,i))Object.prototype.hasOwnProperty.call(o,e)&&n.push(o[e]);return n}charCategorizer(e){return cE(this.languageDataAt("wordChars",e).join(""))}wordAt(e){let{text:t,from:i,length:n}=this.doc.lineAt(e),r=this.charCategorizer(e),o=e-i,l=e-i;for(;o>0;){let a=tt(t,o,!1);if(r(t.slice(a,o))!=De.Word)break;o=a}for(;l<n;){let a=tt(t,l);if(r(t.slice(l,a))!=De.Word)break;l=a}return o==l?null:S.range(o+i,l+i)}}ae.allowMultipleSelections=Yh;ae.tabSize=O.define({combine:s=>s.length?s[0]:4});ae.lineSeparator=Fg;ae.readOnly=Hg;ae.phrases=O.define({compare(s,e){let t=Object.keys(s),i=Object.keys(e);return t.length==i.length&&t.every(n=>s[n]==e[n])}});ae.languageData=Bg;ae.changeFilter=Pg;ae.transactionFilter=Ng;ae.transactionExtender=zg;ka.reconfigure=ee.define();function Ni(s,e,t={}){let i={};for(let n of s)for(let r of Object.keys(n)){let o=n[r],l=i[r];if(l===void 0)i[r]=o;else if(!(l===o||o===void 0))if(Object.hasOwnProperty.call(t,r))i[r]=t[r](l,o);else throw new Error("Config merge conflict for field "+r)}for(let n in e)i[n]===void 0&&(i[n]=e[n]);return i}class rn{eq(e){return this==e}range(e,t=e){return Xh.create(e,t,this)}}rn.prototype.startSide=rn.prototype.endSide=0;rn.prototype.point=!1;rn.prototype.mapMode=ut.TrackDel;let Xh=class Ug{constructor(e,t,i){this.from=e,this.to=t,this.value=i}static create(e,t,i){return new Ug(e,t,i)}};function Zh(s,e){return s.from-e.from||s.value.startSide-e.value.startSide}class Su{constructor(e,t,i,n){this.from=e,this.to=t,this.value=i,this.maxPoint=n}get length(){return this.to[this.to.length-1]}findIndex(e,t,i,n=0){let r=i?this.to:this.from;for(let o=n,l=r.length;;){if(o==l)return o;let a=o+l>>1,h=r[a]-e||(i?this.value[a].endSide:this.value[a].startSide)-t;if(a==o)return h>=0?o:l;h>=0?l=a:o=a+1}}between(e,t,i,n){for(let r=this.findIndex(t,-1e9,!0),o=this.findIndex(i,1e9,!1,r);r<o;r++)if(n(this.from[r]+e,this.to[r]+e,this.value[r])===!1)return!1}map(e,t){let i=[],n=[],r=[],o=-1,l=-1;for(let a=0;a<this.value.length;a++){let h=this.value[a],c=this.from[a]+e,u=this.to[a]+e,d,f;if(c==u){let p=t.mapPos(c,h.startSide,h.mapMode);if(p==null||(d=f=p,h.startSide!=h.endSide&&(f=t.mapPos(c,h.endSide),f<d)))continue}else if(d=t.mapPos(c,h.startSide),f=t.mapPos(u,h.endSide),d>f||d==f&&h.startSide>0&&h.endSide<=0)continue;(f-d||h.endSide-h.startSide)<0||(o<0&&(o=d),h.point&&(l=Math.max(l,f-d)),i.push(h),n.push(d-o),r.push(f-o))}return{mapped:i.length?new Su(n,r,i,l):null,pos:o}}}class he{constructor(e,t,i,n){this.chunkPos=e,this.chunk=t,this.nextLayer=i,this.maxPoint=n}static create(e,t,i,n){return new he(e,t,i,n)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:i=!1,filterFrom:n=0,filterTo:r=this.length}=e,o=e.filter;if(t.length==0&&!o)return this;if(i&&(t=t.slice().sort(Zh)),this.isEmpty)return t.length?he.of(t):this;let l=new jg(this,null,-1).goto(0),a=0,h=[],c=new Rs;for(;l.value||a<t.length;)if(a<t.length&&(l.from-t[a].from||l.startSide-t[a].value.startSide)>=0){let u=t[a++];c.addInner(u.from,u.to,u.value)||h.push(u)}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(a==t.length||this.chunkEnd(l.chunkIndex)<t[a].from)&&(!o||n>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&c.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||n>l.to||r<l.from||o(l.from,l.to,l.value))&&(c.addInner(l.from,l.to,l.value)||h.push(Xh.create(l.from,l.to,l.value))),l.next());return c.finishInner(this.nextLayer.isEmpty&&!h.length?he.empty:this.nextLayer.update({add:h,filter:o,filterFrom:n,filterTo:r}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],i=[],n=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],a=this.chunk[o],h=e.touchesRange(l,l+a.length);if(h===!1)n=Math.max(n,a.maxPoint),t.push(a),i.push(e.mapPos(l));else if(h===!0){let{mapped:c,pos:u}=a.map(l,e);c&&(n=Math.max(n,c.maxPoint),t.push(c),i.push(u))}}let r=this.nextLayer.map(e);return t.length==0?r:new he(i,t,r||he.empty,n)}between(e,t,i){if(!this.isEmpty){for(let n=0;n<this.chunk.length;n++){let r=this.chunkPos[n],o=this.chunk[n];if(t>=r&&e<=r+o.length&&o.between(r,e-r,t-r,i)===!1)return}this.nextLayer.between(e,t,i)}}iter(e=0){return $r.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return $r.from(e).goto(t)}static compare(e,t,i,n,r=-1){let o=e.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=r),l=t.filter(u=>u.maxPoint>0||!u.isEmpty&&u.maxPoint>=r),a=Dd(o,l,i),h=new fr(o,a,r),c=new fr(l,a,r);i.iterGaps((u,d,f)=>Ad(h,u,c,d,f,n)),i.empty&&i.length==0&&Ad(h,0,c,0,0,n)}static eq(e,t,i=0,n){n==null&&(n=999999999);let r=e.filter(c=>!c.isEmpty&&t.indexOf(c)<0),o=t.filter(c=>!c.isEmpty&&e.indexOf(c)<0);if(r.length!=o.length)return!1;if(!r.length)return!0;let l=Dd(r,o),a=new fr(r,l,0).goto(i),h=new fr(o,l,0).goto(i);for(;;){if(a.to!=h.to||!ec(a.active,h.active)||a.point&&(!h.point||!a.point.eq(h.point)))return!1;if(a.to>n)return!0;a.next(),h.next()}}static spans(e,t,i,n,r=-1){let o=new fr(e,null,r).goto(t),l=t,a=o.openStart;for(;;){let h=Math.min(o.to,i);if(o.point){let c=o.activeForPoint(o.to),u=o.pointFrom<t?c.length+1:Math.min(c.length,a);n.point(l,h,o.point,c,u,o.pointRank),a=Math.min(o.openEnd(h),c.length)}else h>l&&(n.span(l,h,o.active,a),a=o.openEnd(h));if(o.to>i)return a+(o.point&&o.to>i?1:0);l=o.to,o.next()}}static of(e,t=!1){let i=new Rs;for(let n of e instanceof Xh?[e]:t?uE(e):e)i.add(n.from,n.to,n.value);return i.finish()}static join(e){if(!e.length)return he.empty;let t=e[e.length-1];for(let i=e.length-2;i>=0;i--)for(let n=e[i];n!=he.empty;n=n.nextLayer)t=new he(n.chunkPos,n.chunk,t,Math.max(n.maxPoint,t.maxPoint));return t}}he.empty=new he([],[],null,-1);function uE(s){if(s.length>1)for(let e=s[0],t=1;t<s.length;t++){let i=s[t];if(Zh(e,i)>0)return s.slice().sort(Zh);e=i}return s}he.empty.nextLayer=he.empty;class Rs{finishChunk(e){this.chunks.push(new Su(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[])}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null}add(e,t,i){this.addInner(e,t,i)||(this.nextLayer||(this.nextLayer=new Rs)).add(e,t,i)}addInner(e,t,i){let n=e-this.lastTo||i.startSide-this.last.endSide;if(n<=0&&(e-this.lastFrom||i.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return n<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=i,this.lastFrom=e,this.lastTo=t,this.value.push(i),i.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return!1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let i=t.value.length-1;return this.last=t.value[i],this.lastFrom=t.from[i]+e,this.lastTo=t.to[i]+e,!0}finish(){return this.finishInner(he.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=he.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}}function Dd(s,e,t){let i=new Map;for(let r of s)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&i.set(r.chunk[o],r.chunkPos[o]);let n=new Set;for(let r of e)for(let o=0;o<r.chunk.length;o++){let l=i.get(r.chunk[o]);l!=null&&(t?t.mapPos(l):l)==r.chunkPos[o]&&!(t!=null&&t.touchesRange(l,l+r.chunk[o].length))&&n.add(r.chunk[o])}return n}class jg{constructor(e,t,i,n=0){this.layer=e,this.skip=t,this.minPoint=i,this.rank=n}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,i){for(;this.chunkIndex<this.layer.chunk.length;){let n=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(n)||this.layer.chunkEnd(this.chunkIndex)<e||n.maxPoint<this.minPoint))break;this.chunkIndex++,i=!1}if(this.chunkIndex<this.layer.chunk.length){let n=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!i||this.rangeIndex<n)&&this.setRangeIndex(n)}this.next()}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0)}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else{let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],i=e+t.from[this.rangeIndex];if(this.from=i,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0}else this.rangeIndex=e}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next()}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}}class $r{constructor(e){this.heap=e}static from(e,t=null,i=-1){let n=[];for(let r=0;r<e.length;r++)for(let o=e[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=i&&n.push(new jg(o,t,i,r));return n.length==1?n[0]:new $r(n)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let i of this.heap)i.goto(e,t);for(let i=this.heap.length>>1;i>=0;i--)ih(this.heap,i);return this.next(),this}forward(e,t){for(let i of this.heap)i.forward(e,t);for(let i=this.heap.length>>1;i>=0;i--)ih(this.heap,i);(this.to-e||this.value.endSide-t)<0&&this.next()}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else{let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),ih(this.heap,0)}}}function ih(s,e){for(let t=s[e];;){let i=(e<<1)+1;if(i>=s.length)break;let n=s[i];if(i+1<s.length&&n.compare(s[i+1])>=0&&(n=s[i+1],i++),t.compare(n)<0)break;s[i]=t,s[e]=n,e=i}}class fr{constructor(e,t,i){this.minPoint=i,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=$r.from(e,t,i)}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t)}removeActive(e){To(this.active,e),To(this.activeTo,e),To(this.activeRank,e),this.minActive=Od(this.active,this.activeTo)}addActive(e){let t=0,{value:i,to:n,rank:r}=this.cursor;for(;t<this.activeRank.length&&(r-this.activeRank[t]||n-this.activeTo[t])>0;)t++;Mo(this.active,t,i),Mo(this.activeTo,t,n),Mo(this.activeRank,t,r),e&&Mo(e,t,this.cursor.from),this.minActive=Od(this.active,this.activeTo)}next(){let e=this.to,t=this.point;this.point=null;let i=this.openStart<0?[]:null;for(;;){let n=this.minActive;if(n>-1&&(this.activeTo[n]-this.cursor.from||this.active[n].endSide-this.cursor.startSide)<0){if(this.activeTo[n]>e){this.to=this.activeTo[n],this.endSide=this.active[n].endSide;break}this.removeActive(n),i&&To(i,n)}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else{let r=this.cursor.value;if(!r.point)this.addActive(i),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else{this.point=r,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=r.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else{this.to=this.endSide=1e9;break}}if(i){this.openStart=0;for(let n=i.length-1;n>=0&&i[n]<e;n--)this.openStart++}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let i=this.active.length-1;i>=0&&!(this.activeRank[i]<this.pointRank);i--)(this.activeTo[i]>e||this.activeTo[i]==e&&this.active[i].endSide>=this.point.endSide)&&t.push(this.active[i]);return t.reverse()}openEnd(e){let t=0;for(let i=this.activeTo.length-1;i>=0&&this.activeTo[i]>e;i--)t++;return t}}function Ad(s,e,t,i,n,r){s.goto(e),t.goto(i);let o=i+n,l=i,a=i-e;for(;;){let h=s.to+a-t.to||s.endSide-t.endSide,c=h<0?s.to+a:t.to,u=Math.min(c,o);if(s.point||t.point?s.point&&t.point&&(s.point==t.point||s.point.eq(t.point))&&ec(s.activeForPoint(s.to),t.activeForPoint(t.to))||r.comparePoint(l,u,s.point,t.point):u>l&&!ec(s.active,t.active)&&r.compareRange(l,u,s.active,t.active),c>o)break;l=c,h<=0&&s.next(),h>=0&&t.next()}}function ec(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(s[t]!=e[t]&&!s[t].eq(e[t]))return!1;return!0}function To(s,e){for(let t=e,i=s.length-1;t<i;t++)s[t]=s[t+1];s.pop()}function Mo(s,e,t){for(let i=s.length-1;i>=e;i--)s[i+1]=s[i];s[e]=t}function Od(s,e){let t=-1,i=1e9;for(let n=0;n<e.length;n++)(e[n]-i||s[n].endSide-s[t].endSide)<0&&(t=n,i=e[n]);return t}function lr(s,e,t=s.length){let i=0;for(let n=0;n<t;)s.charCodeAt(n)==9?(i+=e-i%e,n++):(i++,n=tt(s,n));return i}function tc(s,e,t,i){for(let n=0,r=0;;){if(r>=e)return n;if(n==s.length)break;r+=s.charCodeAt(n)==9?t-r%t:1,n=tt(s,n)}return i===!0?-1:s.length}const ic="",Ld=typeof Symbol>"u"?"__"+ic:Symbol.for(ic),sc=typeof Symbol>"u"?"__styleSet"+Math.floor(Math.random()*1e8):Symbol("styleSet"),Id=typeof globalThis<"u"?globalThis:typeof window<"u"?window:{};class Ts{constructor(e,t){this.rules=[];let{finish:i}=t||{};function n(o){return/^@/.test(o)?[o]:o.split(/,\s*/)}function r(o,l,a,h){let c=[],u=/^@(\w+)\b/.exec(o[0]),d=u&&u[1]=="keyframes";if(u&&l==null)return a.push(o[0]+";");for(let f in l){let p=l[f];if(/&/.test(f))r(f.split(/,\s*/).map(m=>o.map(g=>m.replace(/&/,g))).reduce((m,g)=>m.concat(g)),p,a);else if(p&&typeof p=="object"){if(!u)throw new RangeError("The value of a property ("+f+") should be a primitive value.");r(n(f),p,c,d)}else p!=null&&c.push(f.replace(/_.*/,"").replace(/[A-Z]/g,m=>"-"+m.toLowerCase())+": "+p+";")}(c.length||d)&&a.push((i&&!u&&!h?o.map(i):o).join(", ")+" {"+c.join(" ")+"}")}for(let o in e)r(n(o),e[o],this.rules)}getRules(){return this.rules.join(`
`)}static newName(){let e=Id[Ld]||1;return Id[Ld]=e+1,ic+e.toString(36)}static mount(e,t,i){let n=e[sc],r=i&&i.nonce;n?r&&n.setNonce(r):n=new dE(e,r),n.mount(Array.isArray(t)?t:[t])}}let Bd=new Map;class dE{constructor(e,t){let i=e.ownerDocument||e,n=i.defaultView;if(!e.head&&e.adoptedStyleSheets&&n.CSSStyleSheet){let r=Bd.get(i);if(r)return e.adoptedStyleSheets=[r.sheet,...e.adoptedStyleSheets],e[sc]=r;this.sheet=new n.CSSStyleSheet,e.adoptedStyleSheets=[this.sheet,...e.adoptedStyleSheets],Bd.set(i,this)}else{this.styleTag=i.createElement("style"),t&&this.styleTag.setAttribute("nonce",t);let r=e.head||e;r.insertBefore(this.styleTag,r.firstChild)}this.modules=[],e[sc]=this}mount(e){let t=this.sheet,i=0,n=0;for(let r=0;r<e.length;r++){let o=e[r],l=this.modules.indexOf(o);if(l<n&&l>-1&&(this.modules.splice(l,1),n--,l=-1),l==-1){if(this.modules.splice(n++,0,o),t)for(let a=0;a<o.rules.length;a++)t.insertRule(o.rules[a],i++)}else{for(;n<l;)i+=this.modules[n++].rules.length;i+=o.rules.length,n++}}if(!t){let r="";for(let o=0;o<this.modules.length;o++)r+=this.modules[o].getRules()+`
`;this.styleTag.textContent=r}}setNonce(e){this.styleTag&&this.styleTag.getAttribute("nonce")!=e&&this.styleTag.setAttribute("nonce",e)}}var Ms={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},Kr={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},fE=typeof navigator<"u"&&/Mac/.test(navigator.platform),pE=typeof navigator<"u"&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent);for(var Je=0;Je<10;Je++)Ms[48+Je]=Ms[96+Je]=String(Je);for(var Je=1;Je<=24;Je++)Ms[Je+111]="F"+Je;for(var Je=65;Je<=90;Je++)Ms[Je]=String.fromCharCode(Je+32),Kr[Je]=String.fromCharCode(Je);for(var sh in Ms)Kr.hasOwnProperty(sh)||(Kr[sh]=Ms[sh]);function mE(s){var e=fE&&s.metaKey&&s.shiftKey&&!s.ctrlKey&&!s.altKey||pE&&s.shiftKey&&s.key&&s.key.length==1||s.key=="Unidentified",t=!e&&s.key||(s.shiftKey?Kr:Ms)[s.keyCode]||s.key||"Unidentified";return t=="Esc"&&(t="Escape"),t=="Del"&&(t="Delete"),t=="Left"&&(t="ArrowLeft"),t=="Up"&&(t="ArrowUp"),t=="Right"&&(t="ArrowRight"),t=="Down"&&(t="ArrowDown"),t}function Yl(s){let e;return s.nodeType==11?e=s.getSelection?s:s.ownerDocument:e=s,e.getSelection()}function nc(s,e){return e?s==e||s.contains(e.nodeType!=1?e.parentNode:e):!1}function gE(s){let e=s.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}function ll(s,e){if(!e.anchorNode)return!1;try{return nc(s,e.anchorNode)}catch{return!1}}function Yn(s){return s.nodeType==3?on(s,0,s.nodeValue.length).getClientRects():s.nodeType==1?s.getClientRects():[]}function Br(s,e,t,i){return t?Fd(s,e,t,i,-1)||Fd(s,e,t,i,1):!1}function Yr(s){for(var e=0;;e++)if(s=s.previousSibling,!s)return e}function Fd(s,e,t,i,n){for(;;){if(s==t&&e==i)return!0;if(e==(n<0?0:Yi(s))){if(s.nodeName=="DIV")return!1;let r=s.parentNode;if(!r||r.nodeType!=1)return!1;e=Yr(s)+(n<0?0:1),s=r}else if(s.nodeType==1){if(s=s.childNodes[e+(n<0?-1:0)],s.nodeType==1&&s.contentEditable=="false")return!1;e=n<0?Yi(s):0}else return!1}}function Yi(s){return s.nodeType==3?s.nodeValue.length:s.childNodes.length}function Sa(s,e){let t=e?s.left:s.right;return{left:t,right:t,top:s.top,bottom:s.bottom}}function bE(s){return{left:0,right:s.innerWidth,top:0,bottom:s.innerHeight}}function Gg(s,e){let t=e.width/s.offsetWidth,i=e.height/s.offsetHeight;return(t>.995&&t<1.005||!isFinite(t)||Math.abs(e.width-s.offsetWidth)<1)&&(t=1),(i>.995&&i<1.005||!isFinite(i)||Math.abs(e.height-s.offsetHeight)<1)&&(i=1),{scaleX:t,scaleY:i}}function yE(s,e,t,i,n,r,o,l){let a=s.ownerDocument,h=a.defaultView||window;for(let c=s,u=!1;c&&!u;)if(c.nodeType==1){let d,f=c==a.body,p=1,m=1;if(f)d=bE(h);else{if(/^(fixed|sticky)$/.test(getComputedStyle(c).position)&&(u=!0),c.scrollHeight<=c.clientHeight&&c.scrollWidth<=c.clientWidth){c=c.assignedSlot||c.parentNode;continue}let v=c.getBoundingClientRect();({scaleX:p,scaleY:m}=Gg(c,v)),d={left:v.left,right:v.left+c.clientWidth*p,top:v.top,bottom:v.top+c.clientHeight*m}}let g=0,b=0;if(n=="nearest")e.top<d.top?(b=-(d.top-e.top+o),t>0&&e.bottom>d.bottom+b&&(b=e.bottom-d.bottom+b+o)):e.bottom>d.bottom&&(b=e.bottom-d.bottom+o,t<0&&e.top-b<d.top&&(b=-(d.top+b-e.top+o)));else{let v=e.bottom-e.top,C=d.bottom-d.top;b=(n=="center"&&v<=C?e.top+v/2-C/2:n=="start"||n=="center"&&t<0?e.top-o:e.bottom-C+o)-d.top}if(i=="nearest"?e.left<d.left?(g=-(d.left-e.left+r),t>0&&e.right>d.right+g&&(g=e.right-d.right+g+r)):e.right>d.right&&(g=e.right-d.right+r,t<0&&e.left<d.left+g&&(g=-(d.left+g-e.left+r))):g=(i=="center"?e.left+(e.right-e.left)/2-(d.right-d.left)/2:i=="start"==l?e.left-r:e.right-(d.right-d.left)+r)-d.left,g||b)if(f)h.scrollBy(g,b);else{let v=0,C=0;if(b){let x=c.scrollTop;c.scrollTop+=b/m,C=(c.scrollTop-x)*m}if(g){let x=c.scrollLeft;c.scrollLeft+=g/p,v=(c.scrollLeft-x)*p}e={left:e.left-v,top:e.top-C,right:e.right-v,bottom:e.bottom-C},v&&Math.abs(v-g)<1&&(i="nearest"),C&&Math.abs(C-b)<1&&(n="nearest")}if(f)break;c=c.assignedSlot||c.parentNode}else if(c.nodeType==11)c=c.host;else break}function vE(s){let e=s.ownerDocument;for(let t=s.parentNode;t&&t!=e.body;)if(t.nodeType==1){if(t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth)return t;t=t.assignedSlot||t.parentNode}else if(t.nodeType==11)t=t.host;else break;return null}class wE{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}eq(e){return this.anchorNode==e.anchorNode&&this.anchorOffset==e.anchorOffset&&this.focusNode==e.focusNode&&this.focusOffset==e.focusOffset}setRange(e){let{anchorNode:t,focusNode:i}=e;this.set(t,Math.min(e.anchorOffset,t?Yi(t):0),i,Math.min(e.focusOffset,i?Yi(i):0))}set(e,t,i,n){this.anchorNode=e,this.anchorOffset=t,this.focusNode=i,this.focusOffset=n}}let yn=null;function qg(s){if(s.setActive)return s.setActive();if(yn)return s.focus(yn);let e=[];for(let t=s;t&&(e.push(t,t.scrollTop,t.scrollLeft),t!=t.ownerDocument);t=t.parentNode);if(s.focus(yn==null?{get preventScroll(){return yn={preventScroll:!0},!0}}:void 0),!yn){yn=!1;for(let t=0;t<e.length;){let i=e[t++],n=e[t++],r=e[t++];i.scrollTop!=n&&(i.scrollTop=n),i.scrollLeft!=r&&(i.scrollLeft=r)}}}let Pd;function on(s,e,t=e){let i=Pd||(Pd=document.createRange());return i.setEnd(s,t),i.setStart(s,e),i}function Pn(s,e,t){let i={key:e,code:e,keyCode:t,which:t,cancelable:!0},n=new KeyboardEvent("keydown",i);n.synthetic=!0,s.dispatchEvent(n);let r=new KeyboardEvent("keyup",i);return r.synthetic=!0,s.dispatchEvent(r),n.defaultPrevented||r.defaultPrevented}function CE(s){for(;s;){if(s&&(s.nodeType==9||s.nodeType==11&&s.host))return s;s=s.assignedSlot||s.parentNode}return null}function $g(s){for(;s.attributes.length;)s.removeAttributeNode(s.attributes[0])}function EE(s,e){let t=e.focusNode,i=e.focusOffset;if(!t||e.anchorNode!=t||e.anchorOffset!=i)return!1;for(i=Math.min(i,Yi(t));;)if(i){if(t.nodeType!=1)return!1;let n=t.childNodes[i-1];n.contentEditable=="false"?i--:(t=n,i=Yi(t))}else{if(t==s)return!0;i=Yr(t),t=t.parentNode}}function Kg(s){return s.scrollTop>Math.max(1,s.scrollHeight-s.clientHeight-4)}class nt{constructor(e,t,i=!0){this.node=e,this.offset=t,this.precise=i}static before(e,t){return new nt(e.parentNode,Yr(e),t)}static after(e,t){return new nt(e.parentNode,Yr(e)+1,t)}}const _u=[];class Se{constructor(){this.parent=null,this.dom=null,this.flags=2}get overrideDOMText(){return null}get posAtStart(){return this.parent?this.parent.posBefore(this):0}get posAtEnd(){return this.posAtStart+this.length}posBefore(e){let t=this.posAtStart;for(let i of this.children){if(i==e)return t;t+=i.length+i.breakAfter}throw new RangeError("Invalid child in posBefore")}posAfter(e){return this.posBefore(e)+e.length}sync(e,t){if(this.flags&2){let i=this.dom,n=null,r;for(let o of this.children){if(o.flags&7){if(!o.dom&&(r=n?n.nextSibling:i.firstChild)){let l=Se.get(r);(!l||!l.parent&&l.canReuseDOM(o))&&o.reuseDOM(r)}o.sync(e,t),o.flags&=-8}if(r=n?n.nextSibling:i.firstChild,t&&!t.written&&t.node==i&&r!=o.dom&&(t.written=!0),o.dom.parentNode==i)for(;r&&r!=o.dom;)r=Nd(r);else i.insertBefore(o.dom,r);n=o.dom}for(r=n?n.nextSibling:i.firstChild,r&&t&&t.node==i&&(t.written=!0);r;)r=Nd(r)}else if(this.flags&1)for(let i of this.children)i.flags&7&&(i.sync(e,t),i.flags&=-8)}reuseDOM(e){}localPosFromDOM(e,t){let i;if(e==this.dom)i=this.dom.childNodes[t];else{let n=Yi(e)==0?0:t==0?-1:1;for(;;){let r=e.parentNode;if(r==this.dom)break;n==0&&r.firstChild!=r.lastChild&&(e==r.firstChild?n=-1:n=1),e=r}n<0?i=e:i=e.nextSibling}if(i==this.dom.firstChild)return 0;for(;i&&!Se.get(i);)i=i.nextSibling;if(!i)return this.length;for(let n=0,r=0;;n++){let o=this.children[n];if(o.dom==i)return r;r+=o.length+o.breakAfter}}domBoundsAround(e,t,i=0){let n=-1,r=-1,o=-1,l=-1;for(let a=0,h=i,c=i;a<this.children.length;a++){let u=this.children[a],d=h+u.length;if(h<e&&d>t)return u.domBoundsAround(e,t,h);if(d>=e&&n==-1&&(n=a,r=h),h>t&&u.dom.parentNode==this.dom){o=a,l=c;break}c=d,h=d+u.breakAfter}return{from:r,to:l<0?i+this.length:l,startDOM:(n?this.children[n-1].dom.nextSibling:null)||this.dom.firstChild,endDOM:o<this.children.length&&o>=0?this.children[o].dom:null}}markDirty(e=!1){this.flags|=2,this.markParentsDirty(e)}markParentsDirty(e){for(let t=this.parent;t;t=t.parent){if(e&&(t.flags|=2),t.flags&1)return;t.flags|=1,e=!1}}setParent(e){this.parent!=e&&(this.parent=e,this.flags&7&&this.markParentsDirty(!0))}setDOM(e){this.dom!=e&&(this.dom&&(this.dom.cmView=null),this.dom=e,e.cmView=this)}get rootView(){for(let e=this;;){let t=e.parent;if(!t)return e;e=t}}replaceChildren(e,t,i=_u){this.markDirty();for(let n=e;n<t;n++){let r=this.children[n];r.parent==this&&i.indexOf(r)<0&&r.destroy()}this.children.splice(e,t-e,...i);for(let n=0;n<i.length;n++)i[n].setParent(this)}ignoreMutation(e){return!1}ignoreEvent(e){return!1}childCursor(e=this.length){return new Yg(this.children,e,this.children.length)}childPos(e,t=1){return this.childCursor().findPos(e,t)}toString(){let e=this.constructor.name.replace("View","");return e+(this.children.length?"("+this.children.join()+")":this.length?"["+(e=="Text"?this.text:this.length)+"]":"")+(this.breakAfter?"#":"")}static get(e){return e.cmView}get isEditable(){return!0}get isWidget(){return!1}get isHidden(){return!1}merge(e,t,i,n,r,o){return!1}become(e){return!1}canReuseDOM(e){return e.constructor==this.constructor&&!((this.flags|e.flags)&8)}getSide(){return 0}destroy(){for(let e of this.children)e.parent==this&&e.destroy();this.parent=null}}Se.prototype.breakAfter=0;function Nd(s){let e=s.nextSibling;return s.parentNode.removeChild(s),e}class Yg{constructor(e,t,i){this.children=e,this.pos=t,this.i=i,this.off=0}findPos(e,t=1){for(;;){if(e>this.pos||e==this.pos&&(t>0||this.i==0||this.children[this.i-1].breakAfter))return this.off=e-this.pos,this;let i=this.children[--this.i];this.pos-=i.length+i.breakAfter}}}function Qg(s,e,t,i,n,r,o,l,a){let{children:h}=s,c=h.length?h[e]:null,u=r.length?r[r.length-1]:null,d=u?u.breakAfter:o;if(!(e==i&&c&&!o&&!d&&r.length<2&&c.merge(t,n,r.length?u:null,t==0,l,a))){if(i<h.length){let f=h[i];f&&(n<f.length||f.breakAfter&&(u!=null&&u.breakAfter))?(e==i&&(f=f.split(n),n=0),!d&&u&&f.merge(0,n,u,!0,0,a)?r[r.length-1]=f:((n||f.children.length&&!f.children[0].length)&&f.merge(0,n,null,!1,0,a),r.push(f))):f!=null&&f.breakAfter&&(u?u.breakAfter=1:o=1),i++}for(c&&(c.breakAfter=o,t>0&&(!o&&r.length&&c.merge(t,c.length,r[0],!1,l,0)?c.breakAfter=r.shift().breakAfter:(t<c.length||c.children.length&&c.children[c.children.length-1].length==0)&&c.merge(t,c.length,null,!1,l,0),e++));e<i&&r.length;)if(h[i-1].become(r[r.length-1]))i--,r.pop(),a=r.length?0:l;else if(h[e].become(r[0]))e++,r.shift(),l=r.length?0:a;else break;!r.length&&e&&i<h.length&&!h[e-1].breakAfter&&h[i].merge(0,0,h[e-1],!1,l,a)&&e--,(e<i||r.length)&&s.replaceChildren(e,i,r)}}function Jg(s,e,t,i,n,r){let o=s.childCursor(),{i:l,off:a}=o.findPos(t,1),{i:h,off:c}=o.findPos(e,-1),u=e-t;for(let d of i)u+=d.length;s.length+=u,Qg(s,h,c,l,a,i,0,n,r)}let Bt=typeof navigator<"u"?navigator:{userAgent:"",vendor:"",platform:""},rc=typeof document<"u"?document:{documentElement:{style:{}}};const oc=/Edge\/(\d+)/.exec(Bt.userAgent),Xg=/MSIE \d/.test(Bt.userAgent),lc=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(Bt.userAgent),_a=!!(Xg||lc||oc),zd=!_a&&/gecko\/(\d+)/i.test(Bt.userAgent),nh=!_a&&/Chrome\/(\d+)/.exec(Bt.userAgent),Hd="webkitFontSmoothing"in rc.documentElement.style,Zg=!_a&&/Apple Computer/.test(Bt.vendor),Vd=Zg&&(/Mobile\/\w+/.test(Bt.userAgent)||Bt.maxTouchPoints>2);var L={mac:Vd||/Mac/.test(Bt.platform),windows:/Win/.test(Bt.platform),linux:/Linux|X11/.test(Bt.platform),ie:_a,ie_version:Xg?rc.documentMode||6:lc?+lc[1]:oc?+oc[1]:0,gecko:zd,gecko_version:zd?+(/Firefox\/(\d+)/.exec(Bt.userAgent)||[0,0])[1]:0,chrome:!!nh,chrome_version:nh?+nh[1]:0,ios:Vd,android:/Android\b/.test(Bt.userAgent),webkit:Hd,safari:Zg,webkit_version:Hd?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0,tabSize:rc.documentElement.style.tabSize!=null?"tab-size":"-moz-tab-size"};const xE=256;class Qi extends Se{constructor(e){super(),this.text=e}get length(){return this.text.length}createDOM(e){this.setDOM(e||document.createTextNode(this.text))}sync(e,t){this.dom||this.createDOM(),this.dom.nodeValue!=this.text&&(t&&t.node==this.dom&&(t.written=!0),this.dom.nodeValue=this.text)}reuseDOM(e){e.nodeType==3&&this.createDOM(e)}merge(e,t,i){return this.flags&8||i&&(!(i instanceof Qi)||this.length-(t-e)+i.length>xE||i.flags&8)?!1:(this.text=this.text.slice(0,e)+(i?i.text:"")+this.text.slice(t),this.markDirty(),!0)}split(e){let t=new Qi(this.text.slice(e));return this.text=this.text.slice(0,e),this.markDirty(),t.flags|=this.flags&8,t}localPosFromDOM(e,t){return e==this.dom?t:t?this.text.length:0}domAtPos(e){return new nt(this.dom,e)}domBoundsAround(e,t,i){return{from:i,to:i+this.length,startDOM:this.dom,endDOM:this.dom.nextSibling}}coordsAt(e,t){return kE(this.dom,e,t)}}class Ji extends Se{constructor(e,t=[],i=0){super(),this.mark=e,this.children=t,this.length=i;for(let n of t)n.setParent(this)}setAttrs(e){if($g(e),this.mark.class&&(e.className=this.mark.class),this.mark.attrs)for(let t in this.mark.attrs)e.setAttribute(t,this.mark.attrs[t]);return e}canReuseDOM(e){return super.canReuseDOM(e)&&!((this.flags|e.flags)&8)}reuseDOM(e){e.nodeName==this.mark.tagName.toUpperCase()&&(this.setDOM(e),this.flags|=6)}sync(e,t){this.dom?this.flags&4&&this.setAttrs(this.dom):this.setDOM(this.setAttrs(document.createElement(this.mark.tagName))),super.sync(e,t)}merge(e,t,i,n,r,o){return i&&(!(i instanceof Ji&&i.mark.eq(this.mark))||e&&r<=0||t<this.length&&o<=0)?!1:(Jg(this,e,t,i?i.children.slice():[],r-1,o-1),this.markDirty(),!0)}split(e){let t=[],i=0,n=-1,r=0;for(let l of this.children){let a=i+l.length;a>e&&t.push(i<e?l.split(e-i):l),n<0&&i>=e&&(n=r),i=a,r++}let o=this.length-e;return this.length=e,n>-1&&(this.children.length=n,this.markDirty()),new Ji(this.mark,t,o)}domAtPos(e){return eb(this,e)}coordsAt(e,t){return ib(this,e,t)}}function kE(s,e,t){let i=s.nodeValue.length;e>i&&(e=i);let n=e,r=e,o=0;e==0&&t<0||e==i&&t>=0?L.chrome||L.gecko||(e?(n--,o=1):r<i&&(r++,o=-1)):t<0?n--:r<i&&r++;let l=on(s,n,r).getClientRects();if(!l.length)return null;let a=l[(o?o<0:t>=0)?0:l.length-1];return L.safari&&!o&&a.width==0&&(a=Array.prototype.find.call(l,h=>h.width)||a),o?Sa(a,o<0):a||null}class ds extends Se{static create(e,t,i){return new ds(e,t,i)}constructor(e,t,i){super(),this.widget=e,this.length=t,this.side=i,this.prevWidget=null}split(e){let t=ds.create(this.widget,this.length-e,this.side);return this.length-=e,t}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}getSide(){return this.side}merge(e,t,i,n,r,o){return i&&(!(i instanceof ds)||!this.widget.compare(i.widget)||e>0&&r<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}become(e){return e instanceof ds&&e.side==this.side&&this.widget.constructor==e.widget.constructor?(this.widget.compare(e.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get overrideDOMText(){if(this.length==0)return de.empty;let e=this;for(;e.parent;)e=e.parent;let{view:t}=e,i=t&&t.state.doc,n=this.posAtStart;return i?i.slice(n,n+this.length):de.empty}domAtPos(e){return(this.length?e==0:this.side>0)?nt.before(this.dom):nt.after(this.dom,e==this.length)}domBoundsAround(){return null}coordsAt(e,t){let i=this.widget.coordsAt(this.dom,e,t);if(i)return i;let n=this.dom.getClientRects(),r=null;if(!n.length)return null;let o=this.side?this.side<0:e>0;for(let l=o?n.length-1:0;r=n[l],!(e>0?l==0:l==n.length-1||r.top<r.bottom);l+=o?-1:1);return Sa(r,!o)}get isEditable(){return!1}get isWidget(){return!0}get isHidden(){return this.widget.isHidden}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}}class Qn extends Se{constructor(e){super(),this.side=e}get length(){return 0}merge(){return!1}become(e){return e instanceof Qn&&e.side==this.side}split(){return new Qn(this.side)}sync(){if(!this.dom){let e=document.createElement("img");e.className="cm-widgetBuffer",e.setAttribute("aria-hidden","true"),this.setDOM(e)}}getSide(){return this.side}domAtPos(e){return this.side>0?nt.before(this.dom):nt.after(this.dom)}localPosFromDOM(){return 0}domBoundsAround(){return null}coordsAt(e){return this.dom.getBoundingClientRect()}get overrideDOMText(){return de.empty}get isHidden(){return!0}}Qi.prototype.children=ds.prototype.children=Qn.prototype.children=_u;function eb(s,e){let t=s.dom,{children:i}=s,n=0;for(let r=0;n<i.length;n++){let o=i[n],l=r+o.length;if(!(l==r&&o.getSide()<=0)){if(e>r&&e<l&&o.dom.parentNode==t)return o.domAtPos(e-r);if(e<=r)break;r=l}}for(let r=n;r>0;r--){let o=i[r-1];if(o.dom.parentNode==t)return o.domAtPos(o.length)}for(let r=n;r<i.length;r++){let o=i[r];if(o.dom.parentNode==t)return o.domAtPos(0)}return new nt(t,0)}function tb(s,e,t){let i,{children:n}=s;t>0&&e instanceof Ji&&n.length&&(i=n[n.length-1])instanceof Ji&&i.mark.eq(e.mark)?tb(i,e.children[0],t-1):(n.push(e),e.setParent(s)),s.length+=e.length}function ib(s,e,t){let i=null,n=-1,r=null,o=-1;function l(h,c){for(let u=0,d=0;u<h.children.length&&d<=c;u++){let f=h.children[u],p=d+f.length;p>=c&&(f.children.length?l(f,c-d):(!r||r.isHidden&&t>0)&&(p>c||d==p&&f.getSide()>0)?(r=f,o=c-d):(d<c||d==p&&f.getSide()<0&&!f.isHidden)&&(i=f,n=c-d)),d=p}}l(s,e);let a=(t<0?i:r)||i||r;return a?a.coordsAt(Math.max(0,a==i?n:o),t):SE(s)}function SE(s){let e=s.dom.lastChild;if(!e)return s.dom.getBoundingClientRect();let t=Yn(e);return t[t.length-1]||null}function ac(s,e){for(let t in s)t=="class"&&e.class?e.class+=" "+s.class:t=="style"&&e.style?e.style+=";"+s.style:e[t]=s[t];return e}const Wd=Object.create(null);function Ru(s,e,t){if(s==e)return!0;s||(s=Wd),e||(e=Wd);let i=Object.keys(s),n=Object.keys(e);if(i.length-(t&&i.indexOf(t)>-1?1:0)!=n.length-(t&&n.indexOf(t)>-1?1:0))return!1;for(let r of i)if(r!=t&&(n.indexOf(r)==-1||s[r]!==e[r]))return!1;return!0}function hc(s,e,t){let i=!1;if(e)for(let n in e)t&&n in t||(i=!0,n=="style"?s.style.cssText="":s.removeAttribute(n));if(t)for(let n in t)e&&e[n]==t[n]||(i=!0,n=="style"?s.style.cssText=t[n]:s.setAttribute(n,t[n]));return i}function _E(s){let e=Object.create(null);for(let t=0;t<s.attributes.length;t++){let i=s.attributes[t];e[i.name]=i.value}return e}class Ve extends Se{constructor(){super(...arguments),this.children=[],this.length=0,this.prevAttrs=void 0,this.attrs=null,this.breakAfter=0}merge(e,t,i,n,r,o){if(i){if(!(i instanceof Ve))return!1;this.dom||i.transferDOM(this)}return n&&this.setDeco(i?i.attrs:null),Jg(this,e,t,i?i.children.slice():[],r,o),!0}split(e){let t=new Ve;if(t.breakAfter=this.breakAfter,this.length==0)return t;let{i,off:n}=this.childPos(e);n&&(t.append(this.children[i].split(n),0),this.children[i].merge(n,this.children[i].length,null,!1,0,0),i++);for(let r=i;r<this.children.length;r++)t.append(this.children[r],0);for(;i>0&&this.children[i-1].length==0;)this.children[--i].destroy();return this.children.length=i,this.markDirty(),this.length=e,t}transferDOM(e){this.dom&&(this.markDirty(),e.setDOM(this.dom),e.prevAttrs=this.prevAttrs===void 0?this.attrs:this.prevAttrs,this.prevAttrs=void 0,this.dom=null)}setDeco(e){Ru(this.attrs,e)||(this.dom&&(this.prevAttrs=this.attrs,this.markDirty()),this.attrs=e)}append(e,t){tb(this,e,t)}addLineDeco(e){let t=e.spec.attributes,i=e.spec.class;t&&(this.attrs=ac(t,this.attrs||{})),i&&(this.attrs=ac({class:i},this.attrs||{}))}domAtPos(e){return eb(this,e)}reuseDOM(e){e.nodeName=="DIV"&&(this.setDOM(e),this.flags|=6)}sync(e,t){var i;this.dom?this.flags&4&&($g(this.dom),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0):(this.setDOM(document.createElement("div")),this.dom.className="cm-line",this.prevAttrs=this.attrs?null:void 0),this.prevAttrs!==void 0&&(hc(this.dom,this.prevAttrs,this.attrs),this.dom.classList.add("cm-line"),this.prevAttrs=void 0),super.sync(e,t);let n=this.dom.lastChild;for(;n&&Se.get(n)instanceof Ji;)n=n.lastChild;if(!n||!this.length||n.nodeName!="BR"&&((i=Se.get(n))===null||i===void 0?void 0:i.isEditable)==!1&&(!L.ios||!this.children.some(r=>r instanceof Qi))){let r=document.createElement("BR");r.cmIgnore=!0,this.dom.appendChild(r)}}measureTextSize(){if(this.children.length==0||this.length>20)return null;let e=0,t;for(let i of this.children){if(!(i instanceof Qi)||/[^ -~]/.test(i.text))return null;let n=Yn(i.dom);if(n.length!=1)return null;e+=n[0].width,t=n[0].height}return e?{lineHeight:this.dom.getBoundingClientRect().height,charWidth:e/this.length,textHeight:t}:null}coordsAt(e,t){let i=ib(this,e,t);if(!this.children.length&&i&&this.parent){let{heightOracle:n}=this.parent.view.viewState,r=i.bottom-i.top;if(Math.abs(r-n.lineHeight)<2&&n.textHeight<r){let o=(r-n.textHeight)/2;return{top:i.top+o,bottom:i.bottom-o,left:i.left,right:i.left}}}return i}become(e){return!1}covers(){return!0}static find(e,t){for(let i=0,n=0;i<e.children.length;i++){let r=e.children[i],o=n+r.length;if(o>=t){if(r instanceof Ve)return r;if(o>t)break}n=o+r.breakAfter}return null}}class gs extends Se{constructor(e,t,i){super(),this.widget=e,this.length=t,this.deco=i,this.breakAfter=0,this.prevWidget=null}merge(e,t,i,n,r,o){return i&&(!(i instanceof gs)||!this.widget.compare(i.widget)||e>0&&r<=0||t<this.length&&o<=0)?!1:(this.length=e+(i?i.length:0)+(this.length-t),!0)}domAtPos(e){return e==0?nt.before(this.dom):nt.after(this.dom,e==this.length)}split(e){let t=this.length-e;this.length=e;let i=new gs(this.widget,t,this.deco);return i.breakAfter=this.breakAfter,i}get children(){return _u}sync(e){(!this.dom||!this.widget.updateDOM(this.dom,e))&&(this.dom&&this.prevWidget&&this.prevWidget.destroy(this.dom),this.prevWidget=null,this.setDOM(this.widget.toDOM(e)),this.widget.editable||(this.dom.contentEditable="false"))}get overrideDOMText(){return this.parent?this.parent.view.state.doc.slice(this.posAtStart,this.posAtEnd):de.empty}domBoundsAround(){return null}become(e){return e instanceof gs&&e.widget.constructor==this.widget.constructor?(e.widget.compare(this.widget)||this.markDirty(!0),this.dom&&!this.prevWidget&&(this.prevWidget=this.widget),this.widget=e.widget,this.length=e.length,this.deco=e.deco,this.breakAfter=e.breakAfter,!0):!1}ignoreMutation(){return!0}ignoreEvent(e){return this.widget.ignoreEvent(e)}get isEditable(){return!1}get isWidget(){return!0}coordsAt(e,t){return this.widget.coordsAt(this.dom,e,t)}destroy(){super.destroy(),this.dom&&this.widget.destroy(this.dom)}covers(e){let{startSide:t,endSide:i}=this.deco;return t==i?!1:e<0?t<0:i>0}}class ss{eq(e){return!1}updateDOM(e,t){return!1}compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}get estimatedHeight(){return-1}get lineBreaks(){return 0}ignoreEvent(e){return!0}coordsAt(e,t,i){return null}get isHidden(){return!1}get editable(){return!1}destroy(e){}}var dt=function(s){return s[s.Text=0]="Text",s[s.WidgetBefore=1]="WidgetBefore",s[s.WidgetAfter=2]="WidgetAfter",s[s.WidgetRange=3]="WidgetRange",s}(dt||(dt={}));class F extends rn{constructor(e,t,i,n){super(),this.startSide=e,this.endSide=t,this.widget=i,this.spec=n}get heightRelevant(){return!1}static mark(e){return new fo(e)}static widget(e){let t=Math.max(-1e4,Math.min(1e4,e.side||0)),i=!!e.block;return t+=i&&!e.inlineOrder?t>0?3e8:-4e8:t>0?1e8:-1e8,new Ds(e,t,t,i,e.widget||null,!1)}static replace(e){let t=!!e.block,i,n;if(e.isBlockGap)i=-5e8,n=4e8;else{let{start:r,end:o}=sb(e,t);i=(r?t?-3e8:-1:5e8)-1,n=(o?t?2e8:1:-6e8)+1}return new Ds(e,i,n,t,e.widget||null,!0)}static line(e){return new po(e)}static set(e,t=!1){return he.of(e,t)}hasHeight(){return this.widget?this.widget.estimatedHeight>-1:!1}}F.none=he.empty;class fo extends F{constructor(e){let{start:t,end:i}=sb(e);super(t?-1:5e8,i?1:-6e8,null,e),this.tagName=e.tagName||"span",this.class=e.class||"",this.attrs=e.attributes||null}eq(e){var t,i;return this==e||e instanceof fo&&this.tagName==e.tagName&&(this.class||((t=this.attrs)===null||t===void 0?void 0:t.class))==(e.class||((i=e.attrs)===null||i===void 0?void 0:i.class))&&Ru(this.attrs,e.attrs,"class")}range(e,t=e){if(e>=t)throw new RangeError("Mark decorations may not be empty");return super.range(e,t)}}fo.prototype.point=!1;class po extends F{constructor(e){super(-2e8,-2e8,null,e)}eq(e){return e instanceof po&&this.spec.class==e.spec.class&&Ru(this.spec.attributes,e.spec.attributes)}range(e,t=e){if(t!=e)throw new RangeError("Line decoration ranges must be zero-length");return super.range(e,t)}}po.prototype.mapMode=ut.TrackBefore;po.prototype.point=!0;class Ds extends F{constructor(e,t,i,n,r,o){super(t,i,r,e),this.block=n,this.isReplace=o,this.mapMode=n?t<=0?ut.TrackBefore:ut.TrackAfter:ut.TrackDel}get type(){return this.startSide!=this.endSide?dt.WidgetRange:this.startSide<=0?dt.WidgetBefore:dt.WidgetAfter}get heightRelevant(){return this.block||!!this.widget&&(this.widget.estimatedHeight>=5||this.widget.lineBreaks>0)}eq(e){return e instanceof Ds&&RE(this.widget,e.widget)&&this.block==e.block&&this.startSide==e.startSide&&this.endSide==e.endSide}range(e,t=e){if(this.isReplace&&(e>t||e==t&&this.startSide>0&&this.endSide<=0))throw new RangeError("Invalid range for replacement decoration");if(!this.isReplace&&t!=e)throw new RangeError("Widget decorations can only have zero-length ranges");return super.range(e,t)}}Ds.prototype.point=!0;function sb(s,e=!1){let{inclusiveStart:t,inclusiveEnd:i}=s;return t==null&&(t=s.inclusive),i==null&&(i=s.inclusive),{start:t??e,end:i??e}}function RE(s,e){return s==e||!!(s&&e&&s.compare(e))}function cc(s,e,t,i=0){let n=t.length-1;n>=0&&t[n]+i>=s?t[n]=Math.max(t[n],e):t.push(s,e)}class Fr{constructor(e,t,i,n){this.doc=e,this.pos=t,this.end=i,this.disallowBlockEffectsFor=n,this.content=[],this.curLine=null,this.breakAtStart=0,this.pendingBuffer=0,this.bufferMarks=[],this.atCursorPos=!0,this.openStart=-1,this.openEnd=-1,this.text="",this.textOff=0,this.cursor=e.iter(),this.skip=t}posCovered(){if(this.content.length==0)return!this.breakAtStart&&this.doc.lineAt(this.pos).from!=this.pos;let e=this.content[this.content.length-1];return!(e.breakAfter||e instanceof gs&&e.deco.endSide<0)}getLine(){return this.curLine||(this.content.push(this.curLine=new Ve),this.atCursorPos=!0),this.curLine}flushBuffer(e=this.bufferMarks){this.pendingBuffer&&(this.curLine.append(Do(new Qn(-1),e),e.length),this.pendingBuffer=0)}addBlockWidget(e){this.flushBuffer(),this.curLine=null,this.content.push(e)}finish(e){this.pendingBuffer&&e<=this.bufferMarks.length?this.flushBuffer():this.pendingBuffer=0,!this.posCovered()&&!(e&&this.content.length&&this.content[this.content.length-1]instanceof gs)&&this.getLine()}buildText(e,t,i){for(;e>0;){if(this.textOff==this.text.length){let{value:r,lineBreak:o,done:l}=this.cursor.next(this.skip);if(this.skip=0,l)throw new Error("Ran out of text content when drawing inline views");if(o){this.posCovered()||this.getLine(),this.content.length?this.content[this.content.length-1].breakAfter=1:this.breakAtStart=1,this.flushBuffer(),this.curLine=null,this.atCursorPos=!0,e--;continue}else this.text=r,this.textOff=0}let n=Math.min(this.text.length-this.textOff,e,512);this.flushBuffer(t.slice(t.length-i)),this.getLine().append(Do(new Qi(this.text.slice(this.textOff,this.textOff+n)),t),i),this.atCursorPos=!0,this.textOff+=n,e-=n,i=0}}span(e,t,i,n){this.buildText(t-e,i,n),this.pos=t,this.openStart<0&&(this.openStart=n)}point(e,t,i,n,r,o){if(this.disallowBlockEffectsFor[o]&&i instanceof Ds){if(i.block)throw new RangeError("Block decorations may not be specified via plugins");if(t>this.doc.lineAt(this.pos).to)throw new RangeError("Decorations that replace line breaks may not be specified via plugins")}let l=t-e;if(i instanceof Ds)if(i.block)i.startSide>0&&!this.posCovered()&&this.getLine(),this.addBlockWidget(new gs(i.widget||new Ud("div"),l,i));else{let a=ds.create(i.widget||new Ud("span"),l,l?0:i.startSide),h=this.atCursorPos&&!a.isEditable&&r<=n.length&&(e<t||i.startSide>0),c=!a.isEditable&&(e<t||r>n.length||i.startSide<=0),u=this.getLine();this.pendingBuffer==2&&!h&&!a.isEditable&&(this.pendingBuffer=0),this.flushBuffer(n),h&&(u.append(Do(new Qn(1),n),r),r=n.length+Math.max(0,r-n.length)),u.append(Do(a,n),r),this.atCursorPos=c,this.pendingBuffer=c?e<t||r>n.length?1:2:0,this.pendingBuffer&&(this.bufferMarks=n.slice())}else this.doc.lineAt(this.pos).from==this.pos&&this.getLine().addLineDeco(i);l&&(this.textOff+l<=this.text.length?this.textOff+=l:(this.skip+=l-(this.text.length-this.textOff),this.text="",this.textOff=0),this.pos=t),this.openStart<0&&(this.openStart=r)}static build(e,t,i,n,r){let o=new Fr(e,t,i,r);return o.openEnd=he.spans(n,t,i,o),o.openStart<0&&(o.openStart=o.openEnd),o.finish(o.openEnd),o}}function Do(s,e){for(let t of e)s=new Ji(t,[s],s.length);return s}class Ud extends ss{constructor(e){super(),this.tag=e}eq(e){return e.tag==this.tag}toDOM(){return document.createElement(this.tag)}updateDOM(e){return e.nodeName.toLowerCase()==this.tag}get isHidden(){return!0}}var _e=function(s){return s[s.LTR=0]="LTR",s[s.RTL=1]="RTL",s}(_e||(_e={}));const ln=_e.LTR,Tu=_e.RTL;function nb(s){let e=[];for(let t=0;t<s.length;t++)e.push(1<<+s[t]);return e}const TE=nb("88888888888888888888888888888888888666888888787833333333337888888000000000000000000000000008888880000000000000000000000000088888888888888888888888888888888888887866668888088888663380888308888800000000000000000000000800000000000000000000000000000008"),ME=nb("4444448826627288999999999992222222222222222222222222222222222222222222222229999999999999999999994444444444644222822222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222999999949999999229989999223333333333"),uc=Object.create(null),ci=[];for(let s of["()","[]","{}"]){let e=s.charCodeAt(0),t=s.charCodeAt(1);uc[e]=t,uc[t]=-e}function rb(s){return s<=247?TE[s]:1424<=s&&s<=1524?2:1536<=s&&s<=1785?ME[s-1536]:1774<=s&&s<=2220?4:8192<=s&&s<=8204?256:64336<=s&&s<=65023?4:1}const DE=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac\ufb50-\ufdff]/;class fs{get dir(){return this.level%2?Tu:ln}constructor(e,t,i){this.from=e,this.to=t,this.level=i}side(e,t){return this.dir==t==e?this.to:this.from}forward(e,t){return e==(this.dir==t)}static find(e,t,i,n){let r=-1;for(let o=0;o<e.length;o++){let l=e[o];if(l.from<=t&&l.to>=t){if(l.level==i)return o;(r<0||(n!=0?n<0?l.from<t:l.to>t:e[r].level>l.level))&&(r=o)}}if(r<0)throw new RangeError("Index out of range");return r}}function ob(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++){let i=s[t],n=e[t];if(i.from!=n.from||i.to!=n.to||i.direction!=n.direction||!ob(i.inner,n.inner))return!1}return!0}const Ee=[];function AE(s,e,t,i,n){for(let r=0;r<=i.length;r++){let o=r?i[r-1].to:e,l=r<i.length?i[r].from:t,a=r?256:n;for(let h=o,c=a,u=a;h<l;h++){let d=rb(s.charCodeAt(h));d==512?d=c:d==8&&u==4&&(d=16),Ee[h]=d==4?2:d,d&7&&(u=d),c=d}for(let h=o,c=a,u=a;h<l;h++){let d=Ee[h];if(d==128)h<l-1&&c==Ee[h+1]&&c&24?d=Ee[h]=c:Ee[h]=256;else if(d==64){let f=h+1;for(;f<l&&Ee[f]==64;)f++;let p=h&&c==8||f<t&&Ee[f]==8?u==1?1:8:256;for(let m=h;m<f;m++)Ee[m]=p;h=f-1}else d==8&&u==1&&(Ee[h]=1);c=d,d&7&&(u=d)}}}function OE(s,e,t,i,n){let r=n==1?2:1;for(let o=0,l=0,a=0;o<=i.length;o++){let h=o?i[o-1].to:e,c=o<i.length?i[o].from:t;for(let u=h,d,f,p;u<c;u++)if(f=uc[d=s.charCodeAt(u)])if(f<0){for(let m=l-3;m>=0;m-=3)if(ci[m+1]==-f){let g=ci[m+2],b=g&2?n:g&4?g&1?r:n:0;b&&(Ee[u]=Ee[ci[m]]=b),l=m;break}}else{if(ci.length==189)break;ci[l++]=u,ci[l++]=d,ci[l++]=a}else if((p=Ee[u])==2||p==1){let m=p==n;a=m?0:1;for(let g=l-3;g>=0;g-=3){let b=ci[g+2];if(b&2)break;if(m)ci[g+2]|=2;else{if(b&4)break;ci[g+2]|=4}}}}}function LE(s,e,t,i){for(let n=0,r=i;n<=t.length;n++){let o=n?t[n-1].to:s,l=n<t.length?t[n].from:e;for(let a=o;a<l;){let h=Ee[a];if(h==256){let c=a+1;for(;;)if(c==l){if(n==t.length)break;c=t[n++].to,l=n<t.length?t[n].from:e}else if(Ee[c]==256)c++;else break;let u=r==1,d=(c<e?Ee[c]:i)==1,f=u==d?u?1:2:i;for(let p=c,m=n,g=m?t[m-1].to:s;p>a;)p==g&&(p=t[--m].from,g=m?t[m-1].to:s),Ee[--p]=f;a=c}else r=h,a++}}}function dc(s,e,t,i,n,r,o){let l=i%2?2:1;if(i%2==n%2)for(let a=e,h=0;a<t;){let c=!0,u=!1;if(h==r.length||a<r[h].from){let m=Ee[a];m!=l&&(c=!1,u=m==16)}let d=!c&&l==1?[]:null,f=c?i:i+1,p=a;e:for(;;)if(h<r.length&&p==r[h].from){if(u)break e;let m=r[h];if(!c)for(let g=m.to,b=h+1;;){if(g==t)break e;if(b<r.length&&r[b].from==g)g=r[b++].to;else{if(Ee[g]==l)break e;break}}if(h++,d)d.push(m);else{m.from>a&&o.push(new fs(a,m.from,f));let g=m.direction==ln!=!(f%2);fc(s,g?i+1:i,n,m.inner,m.from,m.to,o),a=m.to}p=m.to}else{if(p==t||(c?Ee[p]!=l:Ee[p]==l))break;p++}d?dc(s,a,p,i+1,n,d,o):a<p&&o.push(new fs(a,p,f)),a=p}else for(let a=t,h=r.length;a>e;){let c=!0,u=!1;if(!h||a>r[h-1].to){let m=Ee[a-1];m!=l&&(c=!1,u=m==16)}let d=!c&&l==1?[]:null,f=c?i:i+1,p=a;e:for(;;)if(h&&p==r[h-1].to){if(u)break e;let m=r[--h];if(!c)for(let g=m.from,b=h;;){if(g==e)break e;if(b&&r[b-1].to==g)g=r[--b].from;else{if(Ee[g-1]==l)break e;break}}if(d)d.push(m);else{m.to<a&&o.push(new fs(m.to,a,f));let g=m.direction==ln!=!(f%2);fc(s,g?i+1:i,n,m.inner,m.from,m.to,o),a=m.from}p=m.from}else{if(p==e||(c?Ee[p-1]!=l:Ee[p-1]==l))break;p--}d?dc(s,p,a,i+1,n,d,o):p<a&&o.push(new fs(p,a,f)),a=p}}function fc(s,e,t,i,n,r,o){let l=e%2?2:1;AE(s,n,r,i,l),OE(s,n,r,i,l),LE(n,r,i,l),dc(s,n,r,e,t,i,o)}function IE(s,e,t){if(!s)return[new fs(0,0,e==Tu?1:0)];if(e==ln&&!t.length&&!DE.test(s))return lb(s.length);if(t.length)for(;s.length>Ee.length;)Ee[Ee.length]=256;let i=[],n=e==ln?0:1;return fc(s,n,n,t,0,s.length,i),i}function lb(s){return[new fs(0,s,0)]}let ab="";function BE(s,e,t,i,n){var r;let o=i.head-s.from,l=fs.find(e,o,(r=i.bidiLevel)!==null&&r!==void 0?r:-1,i.assoc),a=e[l],h=a.side(n,t);if(o==h){let d=l+=n?1:-1;if(d<0||d>=e.length)return null;a=e[l=d],o=a.side(!n,t),h=a.side(n,t)}let c=tt(s.text,o,a.forward(n,t));(c<a.from||c>a.to)&&(c=h),ab=s.text.slice(Math.min(o,c),Math.max(o,c));let u=l==(n?e.length-1:0)?null:e[l+(n?1:-1)];return u&&c==h&&u.level+(n?0:1)<a.level?S.cursor(u.side(!n,t)+s.from,u.forward(n,t)?1:-1,u.level):S.cursor(c+s.from,a.forward(n,t)?-1:1,a.level)}function FE(s,e,t){for(let i=e;i<t;i++){let n=rb(s.charCodeAt(i));if(n==1)return ln;if(n==2||n==4)return Tu}return ln}const hb=O.define(),cb=O.define(),ub=O.define(),db=O.define(),pc=O.define(),fb=O.define(),pb=O.define(),mb=O.define({combine:s=>s.some(e=>e)}),gb=O.define({combine:s=>s.some(e=>e)});class Nn{constructor(e,t="nearest",i="nearest",n=5,r=5,o=!1){this.range=e,this.y=t,this.x=i,this.yMargin=n,this.xMargin=r,this.isSnapshot=o}map(e){return e.empty?this:new Nn(this.range.map(e),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}clip(e){return this.range.to<=e.doc.length?this:new Nn(S.cursor(e.doc.length),this.y,this.x,this.yMargin,this.xMargin,this.isSnapshot)}}const Ao=ee.define({map:(s,e)=>s.map(e)});function Yt(s,e,t){let i=s.facet(db);i.length?i[0](e):window.onerror?window.onerror(String(e),t,void 0,void 0,e):t?console.error(t+":",e):console.error(e)}const Ra=O.define({combine:s=>s.length?s[0]:!0});let PE=0;const Sr=O.define();class Pe{constructor(e,t,i,n,r){this.id=e,this.create=t,this.domEventHandlers=i,this.domEventObservers=n,this.extension=r(this)}static define(e,t){const{eventHandlers:i,eventObservers:n,provide:r,decorations:o}=t||{};return new Pe(PE++,e,i,n,l=>{let a=[Sr.of(l)];return o&&a.push(Qr.of(h=>{let c=h.plugin(l);return c?o(c):F.none})),r&&a.push(r(l)),a})}static fromClass(e,t){return Pe.define(i=>new e(i),t)}}class rh{constructor(e){this.spec=e,this.mustUpdate=null,this.value=null}update(e){if(this.value){if(this.mustUpdate){let t=this.mustUpdate;if(this.mustUpdate=null,this.value.update)try{this.value.update(t)}catch(i){if(Yt(t.state,i,"CodeMirror plugin crashed"),this.value.destroy)try{this.value.destroy()}catch{}this.deactivate()}}}else if(this.spec)try{this.value=this.spec.create(e)}catch(t){Yt(e.state,t,"CodeMirror plugin crashed"),this.deactivate()}return this}destroy(e){var t;if(!((t=this.value)===null||t===void 0)&&t.destroy)try{this.value.destroy()}catch(i){Yt(e.state,i,"CodeMirror plugin crashed")}}deactivate(){this.spec=this.value=null}}const bb=O.define(),Mu=O.define(),Qr=O.define(),yb=O.define(),Du=O.define(),vb=O.define();function jd(s,e){let t=s.state.facet(vb);if(!t.length)return t;let i=t.map(r=>r instanceof Function?r(s):r),n=[];return he.spans(i,e.from,e.to,{point(){},span(r,o,l,a){let h=r-e.from,c=o-e.from,u=n;for(let d=l.length-1;d>=0;d--,a--){let f=l[d].spec.bidiIsolate,p;if(f==null&&(f=FE(e.text,h,c)),a>0&&u.length&&(p=u[u.length-1]).to==h&&p.direction==f)p.to=c,u=p.inner;else{let m={from:h,to:c,direction:f,inner:[]};u.push(m),u=m.inner}}}}),n}const wb=O.define();function Cb(s){let e=0,t=0,i=0,n=0;for(let r of s.state.facet(wb)){let o=r(s);o&&(o.left!=null&&(e=Math.max(e,o.left)),o.right!=null&&(t=Math.max(t,o.right)),o.top!=null&&(i=Math.max(i,o.top)),o.bottom!=null&&(n=Math.max(n,o.bottom)))}return{left:e,right:t,top:i,bottom:n}}const _r=O.define();class Qt{constructor(e,t,i,n){this.fromA=e,this.toA=t,this.fromB=i,this.toB=n}join(e){return new Qt(Math.min(this.fromA,e.fromA),Math.max(this.toA,e.toA),Math.min(this.fromB,e.fromB),Math.max(this.toB,e.toB))}addToSet(e){let t=e.length,i=this;for(;t>0;t--){let n=e[t-1];if(!(n.fromA>i.toA)){if(n.toA<i.fromA)break;i=i.join(n),e.splice(t-1,1)}}return e.splice(t,0,i),e}static extendWithRanges(e,t){if(t.length==0)return e;let i=[];for(let n=0,r=0,o=0,l=0;;n++){let a=n==e.length?null:e[n],h=o-l,c=a?a.fromB:1e9;for(;r<t.length&&t[r]<c;){let u=t[r],d=t[r+1],f=Math.max(l,u),p=Math.min(c,d);if(f<=p&&new Qt(f+h,p+h,f,p).addToSet(i),d>c)break;r+=2}if(!a)return i;new Qt(a.fromA,a.toA,a.fromB,a.toB).addToSet(i),o=a.toA,l=a.toB}}}class Ql{constructor(e,t,i){this.view=e,this.state=t,this.transactions=i,this.flags=0,this.startState=e.state,this.changes=Ue.empty(this.startState.doc.length);for(let r of i)this.changes=this.changes.compose(r.changes);let n=[];this.changes.iterChangedRanges((r,o,l,a)=>n.push(new Qt(r,o,l,a))),this.changedRanges=n}static create(e,t,i){return new Ql(e,t,i)}get viewportChanged(){return(this.flags&4)>0}get heightChanged(){return(this.flags&2)>0}get geometryChanged(){return this.docChanged||(this.flags&10)>0}get focusChanged(){return(this.flags&1)>0}get docChanged(){return!this.changes.empty}get selectionSet(){return this.transactions.some(e=>e.selection)}get empty(){return this.flags==0&&this.transactions.length==0}}class Gd extends Se{get length(){return this.view.state.doc.length}constructor(e){super(),this.view=e,this.decorations=[],this.dynamicDecorationMap=[],this.domChanged=null,this.hasComposition=null,this.markedForComposition=new Set,this.minWidth=0,this.minWidthFrom=0,this.minWidthTo=0,this.impreciseAnchor=null,this.impreciseHead=null,this.forceSelection=!1,this.lastUpdate=Date.now(),this.setDOM(e.contentDOM),this.children=[new Ve],this.children[0].setParent(this),this.updateDeco(),this.updateInner([new Qt(0,0,0,e.state.doc.length)],0,null)}update(e){var t;let i=e.changedRanges;this.minWidth>0&&i.length&&(i.every(({fromA:h,toA:c})=>c<this.minWidthFrom||h>this.minWidthTo)?(this.minWidthFrom=e.changes.mapPos(this.minWidthFrom,1),this.minWidthTo=e.changes.mapPos(this.minWidthTo,1)):this.minWidth=this.minWidthFrom=this.minWidthTo=0);let n=-1;this.view.inputState.composing>=0&&(!((t=this.domChanged)===null||t===void 0)&&t.newSel?n=this.domChanged.newSel.head:!jE(e.changes,this.hasComposition)&&!e.selectionSet&&(n=e.state.selection.main.head));let r=n>-1?zE(this.view,e.changes,n):null;if(this.domChanged=null,this.hasComposition){this.markedForComposition.clear();let{from:h,to:c}=this.hasComposition;i=new Qt(h,c,e.changes.mapPos(h,-1),e.changes.mapPos(c,1)).addToSet(i.slice())}this.hasComposition=r?{from:r.range.fromB,to:r.range.toB}:null,(L.ie||L.chrome)&&!r&&e&&e.state.doc.lines!=e.startState.doc.lines&&(this.forceSelection=!0);let o=this.decorations,l=this.updateDeco(),a=WE(o,l,e.changes);return i=Qt.extendWithRanges(i,a),!(this.flags&7)&&i.length==0?!1:(this.updateInner(i,e.startState.doc.length,r),e.transactions.length&&(this.lastUpdate=Date.now()),!0)}updateInner(e,t,i){this.view.viewState.mustMeasureContent=!0,this.updateChildren(e,t,i);let{observer:n}=this.view;n.ignore(()=>{this.dom.style.height=this.view.viewState.contentHeight/this.view.scaleY+"px",this.dom.style.flexBasis=this.minWidth?this.minWidth+"px":"";let o=L.chrome||L.ios?{node:n.selectionRange.focusNode,written:!1}:void 0;this.sync(this.view,o),this.flags&=-8,o&&(o.written||n.selectionRange.focusNode!=o.node)&&(this.forceSelection=!0),this.dom.style.height=""}),this.markedForComposition.forEach(o=>o.flags&=-9);let r=[];if(this.view.viewport.from||this.view.viewport.to<this.view.state.doc.length)for(let o of this.children)o instanceof gs&&o.widget instanceof qd&&r.push(o.dom);n.updateGaps(r)}updateChildren(e,t,i){let n=i?i.range.addToSet(e.slice()):e,r=this.childCursor(t);for(let o=n.length-1;;o--){let l=o>=0?n[o]:null;if(!l)break;let{fromA:a,toA:h,fromB:c,toB:u}=l,d,f,p,m;if(i&&i.range.fromB<u&&i.range.toB>c){let x=Fr.build(this.view.state.doc,c,i.range.fromB,this.decorations,this.dynamicDecorationMap),w=Fr.build(this.view.state.doc,i.range.toB,u,this.decorations,this.dynamicDecorationMap);f=x.breakAtStart,p=x.openStart,m=w.openEnd;let E=this.compositionView(i);w.breakAtStart?E.breakAfter=1:w.content.length&&E.merge(E.length,E.length,w.content[0],!1,w.openStart,0)&&(E.breakAfter=w.content[0].breakAfter,w.content.shift()),x.content.length&&E.merge(0,0,x.content[x.content.length-1],!0,0,x.openEnd)&&x.content.pop(),d=x.content.concat(E).concat(w.content)}else({content:d,breakAtStart:f,openStart:p,openEnd:m}=Fr.build(this.view.state.doc,c,u,this.decorations,this.dynamicDecorationMap));let{i:g,off:b}=r.findPos(h,1),{i:v,off:C}=r.findPos(a,-1);Qg(this,v,C,g,b,d,f,p,m)}i&&this.fixCompositionDOM(i)}compositionView(e){let t=new Qi(e.text.nodeValue);t.flags|=8;for(let{deco:n}of e.marks)t=new Ji(n,[t],t.length);let i=new Ve;return i.append(t,0),i}fixCompositionDOM(e){let t=(r,o)=>{o.flags|=8|(o.children.some(a=>a.flags&7)?1:0),this.markedForComposition.add(o);let l=Se.get(r);l&&l!=o&&(l.dom=null),o.setDOM(r)},i=this.childPos(e.range.fromB,1),n=this.children[i.i];t(e.line,n);for(let r=e.marks.length-1;r>=-1;r--)i=n.childPos(i.off,1),n=n.children[i.i],t(r>=0?e.marks[r].node:e.text,n)}updateSelection(e=!1,t=!1){(e||!this.view.observer.selectionRange.focusNode)&&this.view.observer.readSelectionRange();let i=this.view.root.activeElement,n=i==this.dom,r=!n&&ll(this.dom,this.view.observer.selectionRange)&&!(i&&this.dom.contains(i));if(!(n||t||r))return;let o=this.forceSelection;this.forceSelection=!1;let l=this.view.state.selection.main,a=this.moveToLine(this.domAtPos(l.anchor)),h=l.empty?a:this.moveToLine(this.domAtPos(l.head));if(L.gecko&&l.empty&&!this.hasComposition&&NE(a)){let u=document.createTextNode("");this.view.observer.ignore(()=>a.node.insertBefore(u,a.node.childNodes[a.offset]||null)),a=h=new nt(u,0),o=!0}let c=this.view.observer.selectionRange;(o||!c.focusNode||(!Br(a.node,a.offset,c.anchorNode,c.anchorOffset)||!Br(h.node,h.offset,c.focusNode,c.focusOffset))&&!this.suppressWidgetCursorChange(c,l))&&(this.view.observer.ignore(()=>{L.android&&L.chrome&&this.dom.contains(c.focusNode)&&UE(c.focusNode,this.dom)&&(this.dom.blur(),this.dom.focus({preventScroll:!0}));let u=Yl(this.view.root);if(u)if(l.empty){if(L.gecko){let d=HE(a.node,a.offset);if(d&&d!=3){let f=xb(a.node,a.offset,d==1?1:-1);f&&(a=new nt(f.node,f.offset))}}u.collapse(a.node,a.offset),l.bidiLevel!=null&&u.caretBidiLevel!==void 0&&(u.caretBidiLevel=l.bidiLevel)}else if(u.extend){u.collapse(a.node,a.offset);try{u.extend(h.node,h.offset)}catch{}}else{let d=document.createRange();l.anchor>l.head&&([a,h]=[h,a]),d.setEnd(h.node,h.offset),d.setStart(a.node,a.offset),u.removeAllRanges(),u.addRange(d)}r&&this.view.root.activeElement==this.dom&&(this.dom.blur(),i&&i.focus())}),this.view.observer.setSelectionRange(a,h)),this.impreciseAnchor=a.precise?null:new nt(c.anchorNode,c.anchorOffset),this.impreciseHead=h.precise?null:new nt(c.focusNode,c.focusOffset)}suppressWidgetCursorChange(e,t){return this.hasComposition&&t.empty&&Br(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)&&this.posFromDOM(e.focusNode,e.focusOffset)==t.head}enforceCursorAssoc(){if(this.hasComposition)return;let{view:e}=this,t=e.state.selection.main,i=Yl(e.root),{anchorNode:n,anchorOffset:r}=e.observer.selectionRange;if(!i||!t.empty||!t.assoc||!i.modify)return;let o=Ve.find(this,t.head);if(!o)return;let l=o.posAtStart;if(t.head==l||t.head==l+o.length)return;let a=this.coordsAt(t.head,-1),h=this.coordsAt(t.head,1);if(!a||!h||a.bottom>h.top)return;let c=this.domAtPos(t.head+t.assoc);i.collapse(c.node,c.offset),i.modify("move",t.assoc<0?"forward":"backward","lineboundary"),e.observer.readSelectionRange();let u=e.observer.selectionRange;e.docView.posFromDOM(u.anchorNode,u.anchorOffset)!=t.from&&i.collapse(n,r)}moveToLine(e){let t=this.dom,i;if(e.node!=t)return e;for(let n=e.offset;!i&&n<t.childNodes.length;n++){let r=Se.get(t.childNodes[n]);r instanceof Ve&&(i=r.domAtPos(0))}for(let n=e.offset-1;!i&&n>=0;n--){let r=Se.get(t.childNodes[n]);r instanceof Ve&&(i=r.domAtPos(r.length))}return i?new nt(i.node,i.offset,!0):e}nearest(e){for(let t=e;t;){let i=Se.get(t);if(i&&i.rootView==this)return i;t=t.parentNode}return null}posFromDOM(e,t){let i=this.nearest(e);if(!i)throw new RangeError("Trying to find position for a DOM position outside of the document");return i.localPosFromDOM(e,t)+i.posAtStart}domAtPos(e){let{i:t,off:i}=this.childCursor().findPos(e,-1);for(;t<this.children.length-1;){let n=this.children[t];if(i<n.length||n instanceof Ve)break;t++,i=0}return this.children[t].domAtPos(i)}coordsAt(e,t){let i=null,n=0;for(let r=this.length,o=this.children.length-1;o>=0;o--){let l=this.children[o],a=r-l.breakAfter,h=a-l.length;if(a<e)break;h<=e&&(h<e||l.covers(-1))&&(a>e||l.covers(1))&&(!i||l instanceof Ve&&!(i instanceof Ve&&t>=0))&&(i=l,n=h),r=h}return i?i.coordsAt(e-n,t):null}coordsForChar(e){let{i:t,off:i}=this.childPos(e,1),n=this.children[t];if(!(n instanceof Ve))return null;for(;n.children.length;){let{i:l,off:a}=n.childPos(i,1);for(;;l++){if(l==n.children.length)return null;if((n=n.children[l]).length)break}i=a}if(!(n instanceof Qi))return null;let r=tt(n.text,i);if(r==i)return null;let o=on(n.dom,i,r).getClientRects();for(let l=0;l<o.length;l++){let a=o[l];if(l==o.length-1||a.top<a.bottom&&a.left<a.right)return a}return null}measureVisibleLineHeights(e){let t=[],{from:i,to:n}=e,r=this.view.contentDOM.clientWidth,o=r>Math.max(this.view.scrollDOM.clientWidth,this.minWidth)+1,l=-1,a=this.view.textDirection==_e.LTR;for(let h=0,c=0;c<this.children.length;c++){let u=this.children[c],d=h+u.length;if(d>n)break;if(h>=i){let f=u.dom.getBoundingClientRect();if(t.push(f.height),o){let p=u.dom.lastChild,m=p?Yn(p):[];if(m.length){let g=m[m.length-1],b=a?g.right-f.left:f.right-g.left;b>l&&(l=b,this.minWidth=r,this.minWidthFrom=h,this.minWidthTo=d)}}}h=d+u.breakAfter}return t}textDirectionAt(e){let{i:t}=this.childPos(e,1);return getComputedStyle(this.children[t].dom).direction=="rtl"?_e.RTL:_e.LTR}measureTextSize(){for(let r of this.children)if(r instanceof Ve){let o=r.measureTextSize();if(o)return o}let e=document.createElement("div"),t,i,n;return e.className="cm-line",e.style.width="99999px",e.style.position="absolute",e.textContent="abc def ghi jkl mno pqr stu",this.view.observer.ignore(()=>{this.dom.appendChild(e);let r=Yn(e.firstChild)[0];t=e.getBoundingClientRect().height,i=r?r.width/27:7,n=r?r.height:t,e.remove()}),{lineHeight:t,charWidth:i,textHeight:n}}childCursor(e=this.length){let t=this.children.length;return t&&(e-=this.children[--t].length),new Yg(this.children,e,t)}computeBlockGapDeco(){let e=[],t=this.view.viewState;for(let i=0,n=0;;n++){let r=n==t.viewports.length?null:t.viewports[n],o=r?r.from-1:this.length;if(o>i){let l=(t.lineBlockAt(o).bottom-t.lineBlockAt(i).top)/this.view.scaleY;e.push(F.replace({widget:new qd(l),block:!0,inclusive:!0,isBlockGap:!0}).range(i,o))}if(!r)break;i=r.to+1}return F.set(e)}updateDeco(){let e=this.view.state.facet(Qr).map((n,r)=>(this.dynamicDecorationMap[r]=typeof n=="function")?n(this.view):n),t=!1,i=this.view.state.facet(yb).map((n,r)=>{let o=typeof n=="function";return o&&(t=!0),o?n(this.view):n});i.length&&(this.dynamicDecorationMap[e.length]=t,e.push(he.join(i)));for(let n=e.length;n<e.length+3;n++)this.dynamicDecorationMap[n]=!1;return this.decorations=[...e,this.computeBlockGapDeco(),this.view.viewState.lineGapDeco]}scrollIntoView(e){if(e.isSnapshot){let h=this.view.viewState.lineBlockAt(e.range.head);this.view.scrollDOM.scrollTop=h.top-e.yMargin,this.view.scrollDOM.scrollLeft=e.xMargin;return}let{range:t}=e,i=this.coordsAt(t.head,t.empty?t.assoc:t.head>t.anchor?-1:1),n;if(!i)return;!t.empty&&(n=this.coordsAt(t.anchor,t.anchor>t.head?-1:1))&&(i={left:Math.min(i.left,n.left),top:Math.min(i.top,n.top),right:Math.max(i.right,n.right),bottom:Math.max(i.bottom,n.bottom)});let r=Cb(this.view),o={left:i.left-r.left,top:i.top-r.top,right:i.right+r.right,bottom:i.bottom+r.bottom},{offsetWidth:l,offsetHeight:a}=this.view.scrollDOM;yE(this.view.scrollDOM,o,t.head<t.anchor?-1:1,e.x,e.y,Math.max(Math.min(e.xMargin,l),-l),Math.max(Math.min(e.yMargin,a),-a),this.view.textDirection==_e.LTR)}}function NE(s){return s.node.nodeType==1&&s.node.firstChild&&(s.offset==0||s.node.childNodes[s.offset-1].contentEditable=="false")&&(s.offset==s.node.childNodes.length||s.node.childNodes[s.offset].contentEditable=="false")}class qd extends ss{constructor(e){super(),this.height=e}toDOM(){let e=document.createElement("div");return e.className="cm-gap",this.updateDOM(e),e}eq(e){return e.height==this.height}updateDOM(e){return e.style.height=this.height+"px",!0}get editable(){return!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}}function Eb(s,e){let t=s.observer.selectionRange,i=t.focusNode&&xb(t.focusNode,t.focusOffset,0);if(!i)return null;let n=e-i.offset;return{from:n,to:n+i.node.nodeValue.length,node:i.node}}function zE(s,e,t){let i=Eb(s,t);if(!i)return null;let{node:n,from:r,to:o}=i,l=n.nodeValue;if(/[\n\r]/.test(l)||s.state.doc.sliceString(i.from,i.to)!=l)return null;let a=e.invertedDesc,h=new Qt(a.mapPos(r),a.mapPos(o),r,o),c=[];for(let u=n.parentNode;;u=u.parentNode){let d=Se.get(u);if(d instanceof Ji)c.push({node:u,deco:d.mark});else{if(d instanceof Ve||u.nodeName=="DIV"&&u.parentNode==s.contentDOM)return{range:h,text:n,marks:c,line:u};if(u!=s.contentDOM)c.push({node:u,deco:new fo({inclusive:!0,attributes:_E(u),tagName:u.tagName.toLowerCase()})});else return null}}}function xb(s,e,t){if(t<=0)for(let i=s,n=e;;){if(i.nodeType==3)return{node:i,offset:n};if(i.nodeType==1&&n>0)i=i.childNodes[n-1],n=Yi(i);else break}if(t>=0)for(let i=s,n=e;;){if(i.nodeType==3)return{node:i,offset:n};if(i.nodeType==1&&n<i.childNodes.length&&t>=0)i=i.childNodes[n],n=0;else break}return null}function HE(s,e){return s.nodeType!=1?0:(e&&s.childNodes[e-1].contentEditable=="false"?1:0)|(e<s.childNodes.length&&s.childNodes[e].contentEditable=="false"?2:0)}let VE=class{constructor(){this.changes=[]}compareRange(e,t){cc(e,t,this.changes)}comparePoint(e,t){cc(e,t,this.changes)}};function WE(s,e,t){let i=new VE;return he.compare(s,e,t,i),i.changes}function UE(s,e){for(let t=s;t&&t!=e;t=t.assignedSlot||t.parentNode)if(t.nodeType==1&&t.contentEditable=="false")return!0;return!1}function jE(s,e){let t=!1;return e&&s.iterChangedRanges((i,n)=>{i<e.to&&n>e.from&&(t=!0)}),t}function GE(s,e,t=1){let i=s.charCategorizer(e),n=s.doc.lineAt(e),r=e-n.from;if(n.length==0)return S.cursor(e);r==0?t=1:r==n.length&&(t=-1);let o=r,l=r;t<0?o=tt(n.text,r,!1):l=tt(n.text,r);let a=i(n.text.slice(o,l));for(;o>0;){let h=tt(n.text,o,!1);if(i(n.text.slice(h,o))!=a)break;o=h}for(;l<n.length;){let h=tt(n.text,l);if(i(n.text.slice(l,h))!=a)break;l=h}return S.range(o+n.from,l+n.from)}function qE(s,e){return e.left>s?e.left-s:Math.max(0,s-e.right)}function $E(s,e){return e.top>s?e.top-s:Math.max(0,s-e.bottom)}function oh(s,e){return s.top<e.bottom-1&&s.bottom>e.top+1}function $d(s,e){return e<s.top?{top:e,left:s.left,right:s.right,bottom:s.bottom}:s}function Kd(s,e){return e>s.bottom?{top:s.top,left:s.left,right:s.right,bottom:e}:s}function mc(s,e,t){let i,n,r,o,l=!1,a,h,c,u;for(let p=s.firstChild;p;p=p.nextSibling){let m=Yn(p);for(let g=0;g<m.length;g++){let b=m[g];n&&oh(n,b)&&(b=$d(Kd(b,n.bottom),n.top));let v=qE(e,b),C=$E(t,b);if(v==0&&C==0)return p.nodeType==3?Yd(p,e,t):mc(p,e,t);if(!i||o>C||o==C&&r>v){i=p,n=b,r=v,o=C;let x=C?t<b.top?-1:1:v?e<b.left?-1:1:0;l=!x||(x>0?g<m.length-1:g>0)}v==0?t>b.bottom&&(!c||c.bottom<b.bottom)?(a=p,c=b):t<b.top&&(!u||u.top>b.top)&&(h=p,u=b):c&&oh(c,b)?c=Kd(c,b.bottom):u&&oh(u,b)&&(u=$d(u,b.top))}}if(c&&c.bottom>=t?(i=a,n=c):u&&u.top<=t&&(i=h,n=u),!i)return{node:s,offset:0};let d=Math.max(n.left,Math.min(n.right,e));if(i.nodeType==3)return Yd(i,d,t);if(l&&i.contentEditable!="false")return mc(i,d,t);let f=Array.prototype.indexOf.call(s.childNodes,i)+(e>=(n.left+n.right)/2?1:0);return{node:s,offset:f}}function Yd(s,e,t){let i=s.nodeValue.length,n=-1,r=1e9,o=0;for(let l=0;l<i;l++){let a=on(s,l,l+1).getClientRects();for(let h=0;h<a.length;h++){let c=a[h];if(c.top==c.bottom)continue;o||(o=e-c.left);let u=(c.top>t?c.top-t:t-c.bottom)-1;if(c.left-1<=e&&c.right+1>=e&&u<r){let d=e>=(c.left+c.right)/2,f=d;if((L.chrome||L.gecko)&&on(s,l).getBoundingClientRect().left==c.right&&(f=!d),u<=0)return{node:s,offset:l+(f?1:0)};n=l+(f?1:0),r=u}}}return{node:s,offset:n>-1?n:o>0?s.nodeValue.length:0}}function kb(s,e,t,i=-1){var n,r;let o=s.contentDOM.getBoundingClientRect(),l=o.top+s.viewState.paddingTop,a,{docHeight:h}=s.viewState,{x:c,y:u}=e,d=u-l;if(d<0)return 0;if(d>h)return s.state.doc.length;for(let x=s.viewState.heightOracle.textHeight/2,w=!1;a=s.elementAtHeight(d),a.type!=dt.Text;)for(;d=i>0?a.bottom+x:a.top-x,!(d>=0&&d<=h);){if(w)return t?null:0;w=!0,i=-i}u=l+d;let f=a.from;if(f<s.viewport.from)return s.viewport.from==0?0:t?null:Qd(s,o,a,c,u);if(f>s.viewport.to)return s.viewport.to==s.state.doc.length?s.state.doc.length:t?null:Qd(s,o,a,c,u);let p=s.dom.ownerDocument,m=s.root.elementFromPoint?s.root:p,g=m.elementFromPoint(c,u);g&&!s.contentDOM.contains(g)&&(g=null),g||(c=Math.max(o.left+1,Math.min(o.right-1,c)),g=m.elementFromPoint(c,u),g&&!s.contentDOM.contains(g)&&(g=null));let b,v=-1;if(g&&((n=s.docView.nearest(g))===null||n===void 0?void 0:n.isEditable)!=!1){if(p.caretPositionFromPoint){let x=p.caretPositionFromPoint(c,u);x&&({offsetNode:b,offset:v}=x)}else if(p.caretRangeFromPoint){let x=p.caretRangeFromPoint(c,u);x&&({startContainer:b,startOffset:v}=x,(!s.contentDOM.contains(b)||L.safari&&KE(b,v,c)||L.chrome&&YE(b,v,c))&&(b=void 0))}}if(!b||!s.docView.dom.contains(b)){let x=Ve.find(s.docView,f);if(!x)return d>a.top+a.height/2?a.to:a.from;({node:b,offset:v}=mc(x.dom,c,u))}let C=s.docView.nearest(b);if(!C)return null;if(C.isWidget&&((r=C.dom)===null||r===void 0?void 0:r.nodeType)==1){let x=C.dom.getBoundingClientRect();return e.y<x.top||e.y<=x.bottom&&e.x<=(x.left+x.right)/2?C.posAtStart:C.posAtEnd}else return C.localPosFromDOM(b,v)+C.posAtStart}function Qd(s,e,t,i,n){let r=Math.round((i-e.left)*s.defaultCharacterWidth);if(s.lineWrapping&&t.height>s.defaultLineHeight*1.5){let l=s.viewState.heightOracle.textHeight,a=Math.floor((n-t.top-(s.defaultLineHeight-l)*.5)/l);r+=a*s.viewState.heightOracle.lineLength}let o=s.state.sliceDoc(t.from,t.to);return t.from+tc(o,r,s.state.tabSize)}function KE(s,e,t){let i;if(s.nodeType!=3||e!=(i=s.nodeValue.length))return!1;for(let n=s.nextSibling;n;n=n.nextSibling)if(n.nodeType!=1||n.nodeName!="BR")return!1;return on(s,i-1,i).getBoundingClientRect().left>t}function YE(s,e,t){if(e!=0)return!1;for(let n=s;;){let r=n.parentNode;if(!r||r.nodeType!=1||r.firstChild!=n)return!1;if(r.classList.contains("cm-line"))break;n=r}let i=s.nodeType==1?s.getBoundingClientRect():on(s,0,Math.max(s.nodeValue.length,1)).getBoundingClientRect();return t-i.left>5}function gc(s,e){let t=s.lineBlockAt(e);if(Array.isArray(t.type)){for(let i of t.type)if(i.to>e||i.to==e&&(i.to==t.to||i.type==dt.Text))return i}return t}function QE(s,e,t,i){let n=gc(s,e.head),r=!i||n.type!=dt.Text||!(s.lineWrapping||n.widgetLineBreaks)?null:s.coordsAtPos(e.assoc<0&&e.head>n.from?e.head-1:e.head);if(r){let o=s.dom.getBoundingClientRect(),l=s.textDirectionAt(n.from),a=s.posAtCoords({x:t==(l==_e.LTR)?o.right-1:o.left+1,y:(r.top+r.bottom)/2});if(a!=null)return S.cursor(a,t?-1:1)}return S.cursor(t?n.to:n.from,t?-1:1)}function Jd(s,e,t,i){let n=s.state.doc.lineAt(e.head),r=s.bidiSpans(n),o=s.textDirectionAt(n.from);for(let l=e,a=null;;){let h=BE(n,r,o,l,t),c=ab;if(!h){if(n.number==(t?s.state.doc.lines:1))return l;c=`
`,n=s.state.doc.line(n.number+(t?1:-1)),r=s.bidiSpans(n),h=s.visualLineSide(n,!t)}if(a){if(!a(c))return l}else{if(!i)return h;a=i(c)}l=h}}function JE(s,e,t){let i=s.state.charCategorizer(e),n=i(t);return r=>{let o=i(r);return n==De.Space&&(n=o),n==o}}function XE(s,e,t,i){let n=e.head,r=t?1:-1;if(n==(t?s.state.doc.length:0))return S.cursor(n,e.assoc);let o=e.goalColumn,l,a=s.contentDOM.getBoundingClientRect(),h=s.coordsAtPos(n,e.assoc||-1),c=s.documentTop;if(h)o==null&&(o=h.left-a.left),l=r<0?h.top:h.bottom;else{let f=s.viewState.lineBlockAt(n);o==null&&(o=Math.min(a.right-a.left,s.defaultCharacterWidth*(n-f.from))),l=(r<0?f.top:f.bottom)+c}let u=a.left+o,d=i??s.viewState.heightOracle.textHeight>>1;for(let f=0;;f+=10){let p=l+(d+f)*r,m=kb(s,{x:u,y:p},!1,r);if(p<a.top||p>a.bottom||(r<0?m<n:m>n)){let g=s.docView.coordsForChar(m),b=!g||p<g.top?-1:1;return S.cursor(m,b,void 0,o)}}}function al(s,e,t){for(;;){let i=0;for(let n of s)n.between(e-1,e+1,(r,o,l)=>{if(e>r&&e<o){let a=i||t||(e-r<o-e?-1:1);e=a<0?r:o,i=a}});if(!i)return e}}function lh(s,e,t){let i=al(s.state.facet(Du).map(n=>n(s)),t.from,e.head>t.from?-1:1);return i==t.from?t:S.cursor(i,i<t.from?1:-1)}class ZE{setSelectionOrigin(e){this.lastSelectionOrigin=e,this.lastSelectionTime=Date.now()}constructor(e){this.view=e,this.lastKeyCode=0,this.lastKeyTime=0,this.lastTouchTime=0,this.lastFocusTime=0,this.lastScrollTop=0,this.lastScrollLeft=0,this.pendingIOSKey=void 0,this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastEscPress=0,this.lastContextMenu=0,this.scrollHandlers=[],this.handlers=Object.create(null),this.composing=-1,this.compositionFirstChange=null,this.compositionEndedAt=0,this.compositionPendingKey=!1,this.compositionPendingChange=!1,this.mouseSelection=null,this.draggedContent=null,this.handleEvent=this.handleEvent.bind(this),this.notifiedFocused=e.hasFocus,L.safari&&e.contentDOM.addEventListener("input",()=>null),L.gecko&&mx(e.contentDOM.ownerDocument)}handleEvent(e){!lx(this.view,e)||this.ignoreDuringComposition(e)||e.type=="keydown"&&this.keydown(e)||this.runHandlers(e.type,e)}runHandlers(e,t){let i=this.handlers[e];if(i){for(let n of i.observers)n(this.view,t);for(let n of i.handlers){if(t.defaultPrevented)break;if(n(this.view,t)){t.preventDefault();break}}}}ensureHandlers(e){let t=ex(e),i=this.handlers,n=this.view.contentDOM;for(let r in t)if(r!="scroll"){let o=!t[r].handlers.length,l=i[r];l&&o!=!l.handlers.length&&(n.removeEventListener(r,this.handleEvent),l=null),l||n.addEventListener(r,this.handleEvent,{passive:o})}for(let r in i)r!="scroll"&&!t[r]&&n.removeEventListener(r,this.handleEvent);this.handlers=t}keydown(e){if(this.lastKeyCode=e.keyCode,this.lastKeyTime=Date.now(),e.keyCode==9&&Date.now()<this.lastEscPress+2e3)return!0;if(e.keyCode!=27&&_b.indexOf(e.keyCode)<0&&(this.view.inputState.lastEscPress=0),L.android&&L.chrome&&!e.synthetic&&(e.keyCode==13||e.keyCode==8))return this.view.observer.delayAndroidKey(e.key,e.keyCode),!0;let t;return L.ios&&!e.synthetic&&!e.altKey&&!e.metaKey&&((t=Sb.find(i=>i.keyCode==e.keyCode))&&!e.ctrlKey||tx.indexOf(e.key)>-1&&e.ctrlKey&&!e.shiftKey)?(this.pendingIOSKey=t||e,setTimeout(()=>this.flushIOSKey(),250),!0):(e.keyCode!=229&&this.view.observer.forceFlush(),!1)}flushIOSKey(){let e=this.pendingIOSKey;return e?(this.pendingIOSKey=void 0,Pn(this.view.contentDOM,e.key,e.keyCode)):!1}ignoreDuringComposition(e){return/^key/.test(e.type)?this.composing>0?!0:L.safari&&!L.ios&&this.compositionPendingKey&&Date.now()-this.compositionEndedAt<100?(this.compositionPendingKey=!1,!0):!1:!1}startMouseSelection(e){this.mouseSelection&&this.mouseSelection.destroy(),this.mouseSelection=e}update(e){this.mouseSelection&&this.mouseSelection.update(e),this.draggedContent&&e.docChanged&&(this.draggedContent=this.draggedContent.map(e.changes)),e.transactions.length&&(this.lastKeyCode=this.lastSelectionTime=0)}destroy(){this.mouseSelection&&this.mouseSelection.destroy()}}function Xd(s,e){return(t,i)=>{try{return e.call(s,i,t)}catch(n){Yt(t.state,n)}}}function ex(s){let e=Object.create(null);function t(i){return e[i]||(e[i]={observers:[],handlers:[]})}for(let i of s){let n=i.spec;if(n&&n.domEventHandlers)for(let r in n.domEventHandlers){let o=n.domEventHandlers[r];o&&t(r).handlers.push(Xd(i.value,o))}if(n&&n.domEventObservers)for(let r in n.domEventObservers){let o=n.domEventObservers[r];o&&t(r).observers.push(Xd(i.value,o))}}for(let i in ri)t(i).handlers.push(ri[i]);for(let i in oi)t(i).observers.push(oi[i]);return e}const Sb=[{key:"Backspace",keyCode:8,inputType:"deleteContentBackward"},{key:"Enter",keyCode:13,inputType:"insertParagraph"},{key:"Enter",keyCode:13,inputType:"insertLineBreak"},{key:"Delete",keyCode:46,inputType:"deleteContentForward"}],tx="dthko",_b=[16,17,18,20,91,92,224,225],Oo=6;function Lo(s){return Math.max(0,s)*.7+8}function ix(s,e){return Math.max(Math.abs(s.clientX-e.clientX),Math.abs(s.clientY-e.clientY))}class sx{constructor(e,t,i,n){this.view=e,this.startEvent=t,this.style=i,this.mustSelect=n,this.scrollSpeed={x:0,y:0},this.scrolling=-1,this.lastEvent=t,this.scrollParent=vE(e.contentDOM),this.atoms=e.state.facet(Du).map(o=>o(e));let r=e.contentDOM.ownerDocument;r.addEventListener("mousemove",this.move=this.move.bind(this)),r.addEventListener("mouseup",this.up=this.up.bind(this)),this.extend=t.shiftKey,this.multiple=e.state.facet(ae.allowMultipleSelections)&&nx(e,t),this.dragging=ox(e,t)&&Db(t)==1?null:!1}start(e){this.dragging===!1&&this.select(e)}move(e){var t;if(e.buttons==0)return this.destroy();if(this.dragging||this.dragging==null&&ix(this.startEvent,e)<10)return;this.select(this.lastEvent=e);let i=0,n=0,r=((t=this.scrollParent)===null||t===void 0?void 0:t.getBoundingClientRect())||{left:0,top:0,right:this.view.win.innerWidth,bottom:this.view.win.innerHeight},o=Cb(this.view);e.clientX-o.left<=r.left+Oo?i=-Lo(r.left-e.clientX):e.clientX+o.right>=r.right-Oo&&(i=Lo(e.clientX-r.right)),e.clientY-o.top<=r.top+Oo?n=-Lo(r.top-e.clientY):e.clientY+o.bottom>=r.bottom-Oo&&(n=Lo(e.clientY-r.bottom)),this.setScrollSpeed(i,n)}up(e){this.dragging==null&&this.select(this.lastEvent),this.dragging||e.preventDefault(),this.destroy()}destroy(){this.setScrollSpeed(0,0);let e=this.view.contentDOM.ownerDocument;e.removeEventListener("mousemove",this.move),e.removeEventListener("mouseup",this.up),this.view.inputState.mouseSelection=this.view.inputState.draggedContent=null}setScrollSpeed(e,t){this.scrollSpeed={x:e,y:t},e||t?this.scrolling<0&&(this.scrolling=setInterval(()=>this.scroll(),50)):this.scrolling>-1&&(clearInterval(this.scrolling),this.scrolling=-1)}scroll(){this.scrollParent?(this.scrollParent.scrollLeft+=this.scrollSpeed.x,this.scrollParent.scrollTop+=this.scrollSpeed.y):this.view.win.scrollBy(this.scrollSpeed.x,this.scrollSpeed.y),this.dragging===!1&&this.select(this.lastEvent)}skipAtoms(e){let t=null;for(let i=0;i<e.ranges.length;i++){let n=e.ranges[i],r=null;if(n.empty){let o=al(this.atoms,n.from,0);o!=n.from&&(r=S.cursor(o,-1))}else{let o=al(this.atoms,n.from,-1),l=al(this.atoms,n.to,1);(o!=n.from||l!=n.to)&&(r=S.range(n.from==n.anchor?o:l,n.from==n.head?o:l))}r&&(t||(t=e.ranges.slice()),t[i]=r)}return t?S.create(t,e.mainIndex):e}select(e){let{view:t}=this,i=this.skipAtoms(this.style.get(e,this.extend,this.multiple));(this.mustSelect||!i.eq(t.state.selection,this.dragging===!1))&&this.view.dispatch({selection:i,userEvent:"select.pointer"}),this.mustSelect=!1}update(e){this.style.update(e)&&setTimeout(()=>this.select(this.lastEvent),20)}}function nx(s,e){let t=s.state.facet(hb);return t.length?t[0](e):L.mac?e.metaKey:e.ctrlKey}function rx(s,e){let t=s.state.facet(cb);return t.length?t[0](e):L.mac?!e.altKey:!e.ctrlKey}function ox(s,e){let{main:t}=s.state.selection;if(t.empty)return!1;let i=Yl(s.root);if(!i||i.rangeCount==0)return!0;let n=i.getRangeAt(0).getClientRects();for(let r=0;r<n.length;r++){let o=n[r];if(o.left<=e.clientX&&o.right>=e.clientX&&o.top<=e.clientY&&o.bottom>=e.clientY)return!0}return!1}function lx(s,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let t=e.target,i;t!=s.contentDOM;t=t.parentNode)if(!t||t.nodeType==11||(i=Se.get(t))&&i.ignoreEvent(e))return!1;return!0}const ri=Object.create(null),oi=Object.create(null),Rb=L.ie&&L.ie_version<15||L.ios&&L.webkit_version<604;function ax(s){let e=s.dom.parentNode;if(!e)return;let t=e.appendChild(document.createElement("textarea"));t.style.cssText="position: fixed; left: -10000px; top: 10px",t.focus(),setTimeout(()=>{s.focus(),t.remove(),Tb(s,t.value)},50)}function Tb(s,e){let{state:t}=s,i,n=1,r=t.toText(e),o=r.lines==t.selection.ranges.length;if(bc!=null&&t.selection.ranges.every(a=>a.empty)&&bc==r.toString()){let a=-1;i=t.changeByRange(h=>{let c=t.doc.lineAt(h.from);if(c.from==a)return{range:h};a=c.from;let u=t.toText((o?r.line(n++).text:e)+t.lineBreak);return{changes:{from:c.from,insert:u},range:S.cursor(h.from+u.length)}})}else o?i=t.changeByRange(a=>{let h=r.line(n++);return{changes:{from:a.from,to:a.to,insert:h.text},range:S.cursor(a.from+h.length)}}):i=t.replaceSelection(r);s.dispatch(i,{userEvent:"input.paste",scrollIntoView:!0})}oi.scroll=s=>{s.inputState.lastScrollTop=s.scrollDOM.scrollTop,s.inputState.lastScrollLeft=s.scrollDOM.scrollLeft};ri.keydown=(s,e)=>(s.inputState.setSelectionOrigin("select"),e.keyCode==27&&(s.inputState.lastEscPress=Date.now()),!1);oi.touchstart=(s,e)=>{s.inputState.lastTouchTime=Date.now(),s.inputState.setSelectionOrigin("select.pointer")};oi.touchmove=s=>{s.inputState.setSelectionOrigin("select.pointer")};ri.mousedown=(s,e)=>{if(s.observer.flush(),s.inputState.lastTouchTime>Date.now()-2e3)return!1;let t=null;for(let i of s.state.facet(ub))if(t=i(s,e),t)break;if(!t&&e.button==0&&(t=ux(s,e)),t){let i=!s.hasFocus;s.inputState.startMouseSelection(new sx(s,e,t,i)),i&&s.observer.ignore(()=>qg(s.contentDOM));let n=s.inputState.mouseSelection;if(n)return n.start(e),n.dragging===!1}return!1};function Zd(s,e,t,i){if(i==1)return S.cursor(e,t);if(i==2)return GE(s.state,e,t);{let n=Ve.find(s.docView,e),r=s.state.doc.lineAt(n?n.posAtEnd:e),o=n?n.posAtStart:r.from,l=n?n.posAtEnd:r.to;return l<s.state.doc.length&&l==r.to&&l++,S.range(o,l)}}let Mb=(s,e)=>s>=e.top&&s<=e.bottom,ef=(s,e,t)=>Mb(e,t)&&s>=t.left&&s<=t.right;function hx(s,e,t,i){let n=Ve.find(s.docView,e);if(!n)return 1;let r=e-n.posAtStart;if(r==0)return 1;if(r==n.length)return-1;let o=n.coordsAt(r,-1);if(o&&ef(t,i,o))return-1;let l=n.coordsAt(r,1);return l&&ef(t,i,l)?1:o&&Mb(i,o)?-1:1}function tf(s,e){let t=s.posAtCoords({x:e.clientX,y:e.clientY},!1);return{pos:t,bias:hx(s,t,e.clientX,e.clientY)}}const cx=L.ie&&L.ie_version<=11;let sf=null,nf=0,rf=0;function Db(s){if(!cx)return s.detail;let e=sf,t=rf;return sf=s,rf=Date.now(),nf=!e||t>Date.now()-400&&Math.abs(e.clientX-s.clientX)<2&&Math.abs(e.clientY-s.clientY)<2?(nf+1)%3:1}function ux(s,e){let t=tf(s,e),i=Db(e),n=s.state.selection;return{update(r){r.docChanged&&(t.pos=r.changes.mapPos(t.pos),n=n.map(r.changes))},get(r,o,l){let a=tf(s,r),h,c=Zd(s,a.pos,a.bias,i);if(t.pos!=a.pos&&!o){let u=Zd(s,t.pos,t.bias,i),d=Math.min(u.from,c.from),f=Math.max(u.to,c.to);c=d<c.from?S.range(d,f):S.range(f,d)}return o?n.replaceRange(n.main.extend(c.from,c.to)):l&&i==1&&n.ranges.length>1&&(h=dx(n,a.pos))?h:l?n.addRange(c):S.create([c])}}}function dx(s,e){for(let t=0;t<s.ranges.length;t++){let{from:i,to:n}=s.ranges[t];if(i<=e&&n>=e)return S.create(s.ranges.slice(0,t).concat(s.ranges.slice(t+1)),s.mainIndex==t?0:s.mainIndex-(s.mainIndex>t?1:0))}return null}ri.dragstart=(s,e)=>{let{selection:{main:t}}=s.state;if(e.target.draggable){let n=s.docView.nearest(e.target);if(n&&n.isWidget){let r=n.posAtStart,o=r+n.length;(r>=t.to||o<=t.from)&&(t=S.range(r,o))}}let{inputState:i}=s;return i.mouseSelection&&(i.mouseSelection.dragging=!0),i.draggedContent=t,e.dataTransfer&&(e.dataTransfer.setData("Text",s.state.sliceDoc(t.from,t.to)),e.dataTransfer.effectAllowed="copyMove"),!1};ri.dragend=s=>(s.inputState.draggedContent=null,!1);function of(s,e,t,i){if(!t)return;let n=s.posAtCoords({x:e.clientX,y:e.clientY},!1),{draggedContent:r}=s.inputState,o=i&&r&&rx(s,e)?{from:r.from,to:r.to}:null,l={from:n,insert:t},a=s.state.changes(o?[o,l]:l);s.focus(),s.dispatch({changes:a,selection:{anchor:a.mapPos(n,-1),head:a.mapPos(n,1)},userEvent:o?"move.drop":"input.drop"}),s.inputState.draggedContent=null}ri.drop=(s,e)=>{if(!e.dataTransfer)return!1;if(s.state.readOnly)return!0;let t=e.dataTransfer.files;if(t&&t.length){let i=Array(t.length),n=0,r=()=>{++n==t.length&&of(s,e,i.filter(o=>o!=null).join(s.state.lineBreak),!1)};for(let o=0;o<t.length;o++){let l=new FileReader;l.onerror=r,l.onload=()=>{/[\x00-\x08\x0e-\x1f]{2}/.test(l.result)||(i[o]=l.result),r()},l.readAsText(t[o])}return!0}else{let i=e.dataTransfer.getData("Text");if(i)return of(s,e,i,!0),!0}return!1};ri.paste=(s,e)=>{if(s.state.readOnly)return!0;s.observer.flush();let t=Rb?null:e.clipboardData;return t?(Tb(s,t.getData("text/plain")||t.getData("text/uri-text")),!0):(ax(s),!1)};function fx(s,e){let t=s.dom.parentNode;if(!t)return;let i=t.appendChild(document.createElement("textarea"));i.style.cssText="position: fixed; left: -10000px; top: 10px",i.value=e,i.focus(),i.selectionEnd=e.length,i.selectionStart=0,setTimeout(()=>{i.remove(),s.focus()},50)}function px(s){let e=[],t=[],i=!1;for(let n of s.selection.ranges)n.empty||(e.push(s.sliceDoc(n.from,n.to)),t.push(n));if(!e.length){let n=-1;for(let{from:r}of s.selection.ranges){let o=s.doc.lineAt(r);o.number>n&&(e.push(o.text),t.push({from:o.from,to:Math.min(s.doc.length,o.to+1)})),n=o.number}i=!0}return{text:e.join(s.lineBreak),ranges:t,linewise:i}}let bc=null;ri.copy=ri.cut=(s,e)=>{let{text:t,ranges:i,linewise:n}=px(s.state);if(!t&&!n)return!1;bc=n?t:null,e.type=="cut"&&!s.state.readOnly&&s.dispatch({changes:i,scrollIntoView:!0,userEvent:"delete.cut"});let r=Rb?null:e.clipboardData;return r?(r.clearData(),r.setData("text/plain",t),!0):(fx(s,t),!1)};const Ab=is.define();function Ob(s,e){let t=[];for(let i of s.facet(pb)){let n=i(s,e);n&&t.push(n)}return t?s.update({effects:t,annotations:Ab.of(!0)}):null}function Lb(s){setTimeout(()=>{let e=s.hasFocus;if(e!=s.inputState.notifiedFocused){let t=Ob(s.state,e);t?s.dispatch(t):s.update([])}},10)}oi.focus=s=>{s.inputState.lastFocusTime=Date.now(),!s.scrollDOM.scrollTop&&(s.inputState.lastScrollTop||s.inputState.lastScrollLeft)&&(s.scrollDOM.scrollTop=s.inputState.lastScrollTop,s.scrollDOM.scrollLeft=s.inputState.lastScrollLeft),Lb(s)};oi.blur=s=>{s.observer.clearSelectionRange(),Lb(s)};oi.compositionstart=oi.compositionupdate=s=>{s.inputState.compositionFirstChange==null&&(s.inputState.compositionFirstChange=!0),s.inputState.composing<0&&(s.inputState.composing=0)};oi.compositionend=s=>{s.inputState.composing=-1,s.inputState.compositionEndedAt=Date.now(),s.inputState.compositionPendingKey=!0,s.inputState.compositionPendingChange=s.observer.pendingRecords().length>0,s.inputState.compositionFirstChange=null,L.chrome&&L.android?s.observer.flushSoon():s.inputState.compositionPendingChange?Promise.resolve().then(()=>s.observer.flush()):setTimeout(()=>{s.inputState.composing<0&&s.docView.hasComposition&&s.update([])},50)};oi.contextmenu=s=>{s.inputState.lastContextMenu=Date.now()};ri.beforeinput=(s,e)=>{var t;let i;if(L.chrome&&L.android&&(i=Sb.find(n=>n.inputType==e.inputType))&&(s.observer.delayAndroidKey(i.key,i.keyCode),i.key=="Backspace"||i.key=="Delete")){let n=((t=window.visualViewport)===null||t===void 0?void 0:t.height)||0;setTimeout(()=>{var r;(((r=window.visualViewport)===null||r===void 0?void 0:r.height)||0)>n+10&&s.hasFocus&&(s.contentDOM.blur(),s.focus())},100)}return!1};const lf=new Set;function mx(s){lf.has(s)||(lf.add(s),s.addEventListener("copy",()=>{}),s.addEventListener("cut",()=>{}))}const af=["pre-wrap","normal","pre-line","break-spaces"];class gx{constructor(e){this.lineWrapping=e,this.doc=de.empty,this.heightSamples={},this.lineHeight=14,this.charWidth=7,this.textHeight=14,this.lineLength=30,this.heightChanged=!1}heightForGap(e,t){let i=this.doc.lineAt(t).number-this.doc.lineAt(e).number+1;return this.lineWrapping&&(i+=Math.max(0,Math.ceil((t-e-i*this.lineLength*.5)/this.lineLength))),this.lineHeight*i}heightForLine(e){return this.lineWrapping?(1+Math.max(0,Math.ceil((e-this.lineLength)/(this.lineLength-5))))*this.lineHeight:this.lineHeight}setDoc(e){return this.doc=e,this}mustRefreshForWrapping(e){return af.indexOf(e)>-1!=this.lineWrapping}mustRefreshForHeights(e){let t=!1;for(let i=0;i<e.length;i++){let n=e[i];n<0?i++:this.heightSamples[Math.floor(n*10)]||(t=!0,this.heightSamples[Math.floor(n*10)]=!0)}return t}refresh(e,t,i,n,r,o){let l=af.indexOf(e)>-1,a=Math.round(t)!=Math.round(this.lineHeight)||this.lineWrapping!=l;if(this.lineWrapping=l,this.lineHeight=t,this.charWidth=i,this.textHeight=n,this.lineLength=r,a){this.heightSamples={};for(let h=0;h<o.length;h++){let c=o[h];c<0?h++:this.heightSamples[Math.floor(c*10)]=!0}}return a}}class bx{constructor(e,t){this.from=e,this.heights=t,this.index=0}get more(){return this.index<this.heights.length}}class _i{constructor(e,t,i,n,r){this.from=e,this.length=t,this.top=i,this.height=n,this._content=r}get type(){return typeof this._content=="number"?dt.Text:Array.isArray(this._content)?this._content:this._content.type}get to(){return this.from+this.length}get bottom(){return this.top+this.height}get widget(){return this._content instanceof Ds?this._content.widget:null}get widgetLineBreaks(){return typeof this._content=="number"?this._content:0}join(e){let t=(Array.isArray(this._content)?this._content:[this]).concat(Array.isArray(e._content)?e._content:[e]);return new _i(this.from,this.length+e.length,this.top,this.height+e.height,t)}}var ke=function(s){return s[s.ByPos=0]="ByPos",s[s.ByHeight=1]="ByHeight",s[s.ByPosNoHeight=2]="ByPosNoHeight",s}(ke||(ke={}));const hl=.001;class ft{constructor(e,t,i=2){this.length=e,this.height=t,this.flags=i}get outdated(){return(this.flags&2)>0}set outdated(e){this.flags=(e?2:0)|this.flags&-3}setHeight(e,t){this.height!=t&&(Math.abs(this.height-t)>hl&&(e.heightChanged=!0),this.height=t)}replace(e,t,i){return ft.of(i)}decomposeLeft(e,t){t.push(this)}decomposeRight(e,t){t.push(this)}applyChanges(e,t,i,n){let r=this,o=i.doc;for(let l=n.length-1;l>=0;l--){let{fromA:a,toA:h,fromB:c,toB:u}=n[l],d=r.lineAt(a,ke.ByPosNoHeight,i.setDoc(t),0,0),f=d.to>=h?d:r.lineAt(h,ke.ByPosNoHeight,i,0,0);for(u+=f.to-h,h=f.to;l>0&&d.from<=n[l-1].toA;)a=n[l-1].fromA,c=n[l-1].fromB,l--,a<d.from&&(d=r.lineAt(a,ke.ByPosNoHeight,i,0,0));c+=d.from-a,a=d.from;let p=Au.build(i.setDoc(o),e,c,u);r=r.replace(a,h,p)}return r.updateHeight(i,0)}static empty(){return new At(0,0)}static of(e){if(e.length==1)return e[0];let t=0,i=e.length,n=0,r=0;for(;;)if(t==i)if(n>r*2){let l=e[t-1];l.break?e.splice(--t,1,l.left,null,l.right):e.splice(--t,1,l.left,l.right),i+=1+l.break,n-=l.size}else if(r>n*2){let l=e[i];l.break?e.splice(i,1,l.left,null,l.right):e.splice(i,1,l.left,l.right),i+=2+l.break,r-=l.size}else break;else if(n<r){let l=e[t++];l&&(n+=l.size)}else{let l=e[--i];l&&(r+=l.size)}let o=0;return e[t-1]==null?(o=1,t--):e[t]==null&&(o=1,i++),new yx(ft.of(e.slice(0,t)),o,ft.of(e.slice(i)))}}ft.prototype.size=1;class Ib extends ft{constructor(e,t,i){super(e,t),this.deco=i}blockAt(e,t,i,n){return new _i(n,this.length,i,this.height,this.deco||0)}lineAt(e,t,i,n,r){return this.blockAt(0,i,n,r)}forEachLine(e,t,i,n,r,o){e<=r+this.length&&t>=r&&o(this.blockAt(0,i,n,r))}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more&&this.setHeight(e,n.heights[n.index++]),this.outdated=!1,this}toString(){return`block(${this.length})`}}class At extends Ib{constructor(e,t){super(e,t,null),this.collapsed=0,this.widgetHeight=0,this.breaks=0}blockAt(e,t,i,n){return new _i(n,this.length,i,this.height,this.breaks)}replace(e,t,i){let n=i[0];return i.length==1&&(n instanceof At||n instanceof Ye&&n.flags&4)&&Math.abs(this.length-n.length)<10?(n instanceof Ye?n=new At(n.length,this.height):n.height=this.height,this.outdated||(n.outdated=!1),n):ft.of(i)}updateHeight(e,t=0,i=!1,n){return n&&n.from<=t&&n.more?this.setHeight(e,n.heights[n.index++]):(i||this.outdated)&&this.setHeight(e,Math.max(this.widgetHeight,e.heightForLine(this.length-this.collapsed))+this.breaks*e.lineHeight),this.outdated=!1,this}toString(){return`line(${this.length}${this.collapsed?-this.collapsed:""}${this.widgetHeight?":"+this.widgetHeight:""})`}}class Ye extends ft{constructor(e){super(e,0)}heightMetrics(e,t){let i=e.doc.lineAt(t).number,n=e.doc.lineAt(t+this.length).number,r=n-i+1,o,l=0;if(e.lineWrapping){let a=Math.min(this.height,e.lineHeight*r);o=a/r,this.length>r+1&&(l=(this.height-a)/(this.length-r-1))}else o=this.height/r;return{firstLine:i,lastLine:n,perLine:o,perChar:l}}blockAt(e,t,i,n){let{firstLine:r,lastLine:o,perLine:l,perChar:a}=this.heightMetrics(t,n);if(t.lineWrapping){let h=n+Math.round(Math.max(0,Math.min(1,(e-i)/this.height))*this.length),c=t.doc.lineAt(h),u=l+c.length*a,d=Math.max(i,e-u/2);return new _i(c.from,c.length,d,u,0)}else{let h=Math.max(0,Math.min(o-r,Math.floor((e-i)/l))),{from:c,length:u}=t.doc.line(r+h);return new _i(c,u,i+l*h,l,0)}}lineAt(e,t,i,n,r){if(t==ke.ByHeight)return this.blockAt(e,i,n,r);if(t==ke.ByPosNoHeight){let{from:f,to:p}=i.doc.lineAt(e);return new _i(f,p-f,0,0,0)}let{firstLine:o,perLine:l,perChar:a}=this.heightMetrics(i,r),h=i.doc.lineAt(e),c=l+h.length*a,u=h.number-o,d=n+l*u+a*(h.from-r-u);return new _i(h.from,h.length,Math.max(n,Math.min(d,n+this.height-c)),c,0)}forEachLine(e,t,i,n,r,o){e=Math.max(e,r),t=Math.min(t,r+this.length);let{firstLine:l,perLine:a,perChar:h}=this.heightMetrics(i,r);for(let c=e,u=n;c<=t;){let d=i.doc.lineAt(c);if(c==e){let p=d.number-l;u+=a*p+h*(e-r-p)}let f=a+h*d.length;o(new _i(d.from,d.length,u,f,0)),u+=f,c=d.to+1}}replace(e,t,i){let n=this.length-t;if(n>0){let r=i[i.length-1];r instanceof Ye?i[i.length-1]=new Ye(r.length+n):i.push(null,new Ye(n-1))}if(e>0){let r=i[0];r instanceof Ye?i[0]=new Ye(e+r.length):i.unshift(new Ye(e-1),null)}return ft.of(i)}decomposeLeft(e,t){t.push(new Ye(e-1),null)}decomposeRight(e,t){t.push(null,new Ye(this.length-e-1))}updateHeight(e,t=0,i=!1,n){let r=t+this.length;if(n&&n.from<=t+this.length&&n.more){let o=[],l=Math.max(t,n.from),a=-1;for(n.from>t&&o.push(new Ye(n.from-t-1).updateHeight(e,t));l<=r&&n.more;){let c=e.doc.lineAt(l).length;o.length&&o.push(null);let u=n.heights[n.index++];a==-1?a=u:Math.abs(u-a)>=hl&&(a=-2);let d=new At(c,u);d.outdated=!1,o.push(d),l+=c+1}l<=r&&o.push(null,new Ye(r-l).updateHeight(e,l));let h=ft.of(o);return(a<0||Math.abs(h.height-this.height)>=hl||Math.abs(a-this.heightMetrics(e,t).perLine)>=hl)&&(e.heightChanged=!0),h}else(i||this.outdated)&&(this.setHeight(e,e.heightForGap(t,t+this.length)),this.outdated=!1);return this}toString(){return`gap(${this.length})`}}class yx extends ft{constructor(e,t,i){super(e.length+t+i.length,e.height+i.height,t|(e.outdated||i.outdated?2:0)),this.left=e,this.right=i,this.size=e.size+i.size}get break(){return this.flags&1}blockAt(e,t,i,n){let r=i+this.left.height;return e<r?this.left.blockAt(e,t,i,n):this.right.blockAt(e,t,r,n+this.left.length+this.break)}lineAt(e,t,i,n,r){let o=n+this.left.height,l=r+this.left.length+this.break,a=t==ke.ByHeight?e<o:e<l,h=a?this.left.lineAt(e,t,i,n,r):this.right.lineAt(e,t,i,o,l);if(this.break||(a?h.to<l:h.from>l))return h;let c=t==ke.ByPosNoHeight?ke.ByPosNoHeight:ke.ByPos;return a?h.join(this.right.lineAt(l,c,i,o,l)):this.left.lineAt(l,c,i,n,r).join(h)}forEachLine(e,t,i,n,r,o){let l=n+this.left.height,a=r+this.left.length+this.break;if(this.break)e<a&&this.left.forEachLine(e,t,i,n,r,o),t>=a&&this.right.forEachLine(e,t,i,l,a,o);else{let h=this.lineAt(a,ke.ByPos,i,n,r);e<h.from&&this.left.forEachLine(e,h.from-1,i,n,r,o),h.to>=e&&h.from<=t&&o(h),t>h.to&&this.right.forEachLine(h.to+1,t,i,l,a,o)}}replace(e,t,i){let n=this.left.length+this.break;if(t<n)return this.balanced(this.left.replace(e,t,i),this.right);if(e>this.left.length)return this.balanced(this.left,this.right.replace(e-n,t-n,i));let r=[];e>0&&this.decomposeLeft(e,r);let o=r.length;for(let l of i)r.push(l);if(e>0&&hf(r,o-1),t<this.length){let l=r.length;this.decomposeRight(t,r),hf(r,l)}return ft.of(r)}decomposeLeft(e,t){let i=this.left.length;if(e<=i)return this.left.decomposeLeft(e,t);t.push(this.left),this.break&&(i++,e>=i&&t.push(null)),e>i&&this.right.decomposeLeft(e-i,t)}decomposeRight(e,t){let i=this.left.length,n=i+this.break;if(e>=n)return this.right.decomposeRight(e-n,t);e<i&&this.left.decomposeRight(e,t),this.break&&e<n&&t.push(null),t.push(this.right)}balanced(e,t){return e.size>2*t.size||t.size>2*e.size?ft.of(this.break?[e,null,t]:[e,t]):(this.left=e,this.right=t,this.height=e.height+t.height,this.outdated=e.outdated||t.outdated,this.size=e.size+t.size,this.length=e.length+this.break+t.length,this)}updateHeight(e,t=0,i=!1,n){let{left:r,right:o}=this,l=t+r.length+this.break,a=null;return n&&n.from<=t+r.length&&n.more?a=r=r.updateHeight(e,t,i,n):r.updateHeight(e,t,i),n&&n.from<=l+o.length&&n.more?a=o=o.updateHeight(e,l,i,n):o.updateHeight(e,l,i),a?this.balanced(r,o):(this.height=this.left.height+this.right.height,this.outdated=!1,this)}toString(){return this.left+(this.break?" ":"-")+this.right}}function hf(s,e){let t,i;s[e]==null&&(t=s[e-1])instanceof Ye&&(i=s[e+1])instanceof Ye&&s.splice(e-1,3,new Ye(t.length+1+i.length))}const vx=5;class Au{constructor(e,t){this.pos=e,this.oracle=t,this.nodes=[],this.lineStart=-1,this.lineEnd=-1,this.covering=null,this.writtenTo=e}get isCovered(){return this.covering&&this.nodes[this.nodes.length-1]==this.covering}span(e,t){if(this.lineStart>-1){let i=Math.min(t,this.lineEnd),n=this.nodes[this.nodes.length-1];n instanceof At?n.length+=i-this.pos:(i>this.pos||!this.isCovered)&&this.nodes.push(new At(i-this.pos,-1)),this.writtenTo=i,t>i&&(this.nodes.push(null),this.writtenTo++,this.lineStart=-1)}this.pos=t}point(e,t,i){if(e<t||i.heightRelevant){let n=i.widget?i.widget.estimatedHeight:0,r=i.widget?i.widget.lineBreaks:0;n<0&&(n=this.oracle.lineHeight);let o=t-e;i.block?this.addBlock(new Ib(o,n,i)):(o||r||n>=vx)&&this.addLineDeco(n,r,o)}else t>e&&this.span(e,t);this.lineEnd>-1&&this.lineEnd<this.pos&&(this.lineEnd=this.oracle.doc.lineAt(this.pos).to)}enterLine(){if(this.lineStart>-1)return;let{from:e,to:t}=this.oracle.doc.lineAt(this.pos);this.lineStart=e,this.lineEnd=t,this.writtenTo<e&&((this.writtenTo<e-1||this.nodes[this.nodes.length-1]==null)&&this.nodes.push(this.blankContent(this.writtenTo,e-1)),this.nodes.push(null)),this.pos>e&&this.nodes.push(new At(this.pos-e,-1)),this.writtenTo=this.pos}blankContent(e,t){let i=new Ye(t-e);return this.oracle.doc.lineAt(e).to==t&&(i.flags|=4),i}ensureLine(){this.enterLine();let e=this.nodes.length?this.nodes[this.nodes.length-1]:null;if(e instanceof At)return e;let t=new At(0,-1);return this.nodes.push(t),t}addBlock(e){this.enterLine();let t=e.deco;t&&t.startSide>0&&!this.isCovered&&this.ensureLine(),this.nodes.push(e),this.writtenTo=this.pos=this.pos+e.length,t&&t.endSide>0&&(this.covering=e)}addLineDeco(e,t,i){let n=this.ensureLine();n.length+=i,n.collapsed+=i,n.widgetHeight=Math.max(n.widgetHeight,e),n.breaks+=t,this.writtenTo=this.pos=this.pos+i}finish(e){let t=this.nodes.length==0?null:this.nodes[this.nodes.length-1];this.lineStart>-1&&!(t instanceof At)&&!this.isCovered?this.nodes.push(new At(0,-1)):(this.writtenTo<this.pos||t==null)&&this.nodes.push(this.blankContent(this.writtenTo,this.pos));let i=e;for(let n of this.nodes)n instanceof At&&n.updateHeight(this.oracle,i),i+=n?n.length:1;return this.nodes}static build(e,t,i,n){let r=new Au(i,e);return he.spans(t,i,n,r,0),r.finish(i)}}function wx(s,e,t){let i=new Cx;return he.compare(s,e,t,i,0),i.changes}class Cx{constructor(){this.changes=[]}compareRange(){}comparePoint(e,t,i,n){(e<t||i&&i.heightRelevant||n&&n.heightRelevant)&&cc(e,t,this.changes,5)}}function Ex(s,e){let t=s.getBoundingClientRect(),i=s.ownerDocument,n=i.defaultView||window,r=Math.max(0,t.left),o=Math.min(n.innerWidth,t.right),l=Math.max(0,t.top),a=Math.min(n.innerHeight,t.bottom);for(let h=s.parentNode;h&&h!=i.body;)if(h.nodeType==1){let c=h,u=window.getComputedStyle(c);if((c.scrollHeight>c.clientHeight||c.scrollWidth>c.clientWidth)&&u.overflow!="visible"){let d=c.getBoundingClientRect();r=Math.max(r,d.left),o=Math.min(o,d.right),l=Math.max(l,d.top),a=h==s.parentNode?d.bottom:Math.min(a,d.bottom)}h=u.position=="absolute"||u.position=="fixed"?c.offsetParent:c.parentNode}else if(h.nodeType==11)h=h.host;else break;return{left:r-t.left,right:Math.max(r,o)-t.left,top:l-(t.top+e),bottom:Math.max(l,a)-(t.top+e)}}function xx(s,e){let t=s.getBoundingClientRect();return{left:0,right:t.right-t.left,top:e,bottom:t.bottom-(t.top+e)}}class ah{constructor(e,t,i){this.from=e,this.to=t,this.size=i}static same(e,t){if(e.length!=t.length)return!1;for(let i=0;i<e.length;i++){let n=e[i],r=t[i];if(n.from!=r.from||n.to!=r.to||n.size!=r.size)return!1}return!0}draw(e,t){return F.replace({widget:new kx(this.size*(t?e.scaleY:e.scaleX),t)}).range(this.from,this.to)}}class kx extends ss{constructor(e,t){super(),this.size=e,this.vertical=t}eq(e){return e.size==this.size&&e.vertical==this.vertical}toDOM(){let e=document.createElement("div");return this.vertical?e.style.height=this.size+"px":(e.style.width=this.size+"px",e.style.height="2px",e.style.display="inline-block"),e}get estimatedHeight(){return this.vertical?this.size:-1}}class cf{constructor(e){this.state=e,this.pixelViewport={left:0,right:window.innerWidth,top:0,bottom:0},this.inView=!0,this.paddingTop=0,this.paddingBottom=0,this.contentDOMWidth=0,this.contentDOMHeight=0,this.editorHeight=0,this.editorWidth=0,this.scrollTop=0,this.scrolledToBottom=!0,this.scaleX=1,this.scaleY=1,this.scrollAnchorPos=0,this.scrollAnchorHeight=-1,this.scaler=uf,this.scrollTarget=null,this.printing=!1,this.mustMeasureContent=!0,this.defaultTextDirection=_e.LTR,this.visibleRanges=[],this.mustEnforceCursorAssoc=!1;let t=e.facet(Mu).some(i=>typeof i!="function"&&i.class=="cm-lineWrapping");this.heightOracle=new gx(t),this.stateDeco=e.facet(Qr).filter(i=>typeof i!="function"),this.heightMap=ft.empty().applyChanges(this.stateDeco,de.empty,this.heightOracle.setDoc(e.doc),[new Qt(0,0,0,e.doc.length)]),this.viewport=this.getViewport(0,null),this.updateViewportLines(),this.updateForViewport(),this.lineGaps=this.ensureLineGaps([]),this.lineGapDeco=F.set(this.lineGaps.map(i=>i.draw(this,!1))),this.computeVisibleRanges()}updateForViewport(){let e=[this.viewport],{main:t}=this.state.selection;for(let i=0;i<=1;i++){let n=i?t.head:t.anchor;if(!e.some(({from:r,to:o})=>n>=r&&n<=o)){let{from:r,to:o}=this.lineBlockAt(n);e.push(new Io(r,o))}}this.viewports=e.sort((i,n)=>i.from-n.from),this.scaler=this.heightMap.height<=7e6?uf:new Rx(this.heightOracle,this.heightMap,this.viewports)}updateViewportLines(){this.viewportLines=[],this.heightMap.forEachLine(this.viewport.from,this.viewport.to,this.heightOracle.setDoc(this.state.doc),0,0,e=>{this.viewportLines.push(this.scaler.scale==1?e:Rr(e,this.scaler))})}update(e,t=null){this.state=e.state;let i=this.stateDeco;this.stateDeco=this.state.facet(Qr).filter(c=>typeof c!="function");let n=e.changedRanges,r=Qt.extendWithRanges(n,wx(i,this.stateDeco,e?e.changes:Ue.empty(this.state.doc.length))),o=this.heightMap.height,l=this.scrolledToBottom?null:this.scrollAnchorAt(this.scrollTop);this.heightMap=this.heightMap.applyChanges(this.stateDeco,e.startState.doc,this.heightOracle.setDoc(this.state.doc),r),this.heightMap.height!=o&&(e.flags|=2),l?(this.scrollAnchorPos=e.changes.mapPos(l.from,-1),this.scrollAnchorHeight=l.top):(this.scrollAnchorPos=-1,this.scrollAnchorHeight=this.heightMap.height);let a=r.length?this.mapViewport(this.viewport,e.changes):this.viewport;(t&&(t.range.head<a.from||t.range.head>a.to)||!this.viewportIsAppropriate(a))&&(a=this.getViewport(0,t));let h=!e.changes.empty||e.flags&2||a.from!=this.viewport.from||a.to!=this.viewport.to;this.viewport=a,this.updateForViewport(),h&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(this.mapLineGaps(this.lineGaps,e.changes))),e.flags|=this.computeVisibleRanges(),t&&(this.scrollTarget=t),!this.mustEnforceCursorAssoc&&e.selectionSet&&e.view.lineWrapping&&e.state.selection.main.empty&&e.state.selection.main.assoc&&!e.state.facet(gb)&&(this.mustEnforceCursorAssoc=!0)}measure(e){let t=e.contentDOM,i=window.getComputedStyle(t),n=this.heightOracle,r=i.whiteSpace;this.defaultTextDirection=i.direction=="rtl"?_e.RTL:_e.LTR;let o=this.heightOracle.mustRefreshForWrapping(r),l=t.getBoundingClientRect(),a=o||this.mustMeasureContent||this.contentDOMHeight!=l.height;this.contentDOMHeight=l.height,this.mustMeasureContent=!1;let h=0,c=0;if(l.width&&l.height){let{scaleX:x,scaleY:w}=Gg(t,l);(this.scaleX!=x||this.scaleY!=w)&&(this.scaleX=x,this.scaleY=w,h|=8,o=a=!0)}let u=(parseInt(i.paddingTop)||0)*this.scaleY,d=(parseInt(i.paddingBottom)||0)*this.scaleY;(this.paddingTop!=u||this.paddingBottom!=d)&&(this.paddingTop=u,this.paddingBottom=d,h|=10),this.editorWidth!=e.scrollDOM.clientWidth&&(n.lineWrapping&&(a=!0),this.editorWidth=e.scrollDOM.clientWidth,h|=8);let f=e.scrollDOM.scrollTop*this.scaleY;this.scrollTop!=f&&(this.scrollAnchorHeight=-1,this.scrollTop=f),this.scrolledToBottom=Kg(e.scrollDOM);let p=(this.printing?xx:Ex)(t,this.paddingTop),m=p.top-this.pixelViewport.top,g=p.bottom-this.pixelViewport.bottom;this.pixelViewport=p;let b=this.pixelViewport.bottom>this.pixelViewport.top&&this.pixelViewport.right>this.pixelViewport.left;if(b!=this.inView&&(this.inView=b,b&&(a=!0)),!this.inView&&!this.scrollTarget)return 0;let v=l.width;if((this.contentDOMWidth!=v||this.editorHeight!=e.scrollDOM.clientHeight)&&(this.contentDOMWidth=l.width,this.editorHeight=e.scrollDOM.clientHeight,h|=8),a){let x=e.docView.measureVisibleLineHeights(this.viewport);if(n.mustRefreshForHeights(x)&&(o=!0),o||n.lineWrapping&&Math.abs(v-this.contentDOMWidth)>n.charWidth){let{lineHeight:w,charWidth:E,textHeight:k}=e.docView.measureTextSize();o=w>0&&n.refresh(r,w,E,k,v/E,x),o&&(e.docView.minWidth=0,h|=8)}m>0&&g>0?c=Math.max(m,g):m<0&&g<0&&(c=Math.min(m,g)),n.heightChanged=!1;for(let w of this.viewports){let E=w.from==this.viewport.from?x:e.docView.measureVisibleLineHeights(w);this.heightMap=(o?ft.empty().applyChanges(this.stateDeco,de.empty,this.heightOracle,[new Qt(0,0,0,e.state.doc.length)]):this.heightMap).updateHeight(n,0,o,new bx(w.from,E))}n.heightChanged&&(h|=2)}let C=!this.viewportIsAppropriate(this.viewport,c)||this.scrollTarget&&(this.scrollTarget.range.head<this.viewport.from||this.scrollTarget.range.head>this.viewport.to);return C&&(this.viewport=this.getViewport(c,this.scrollTarget)),this.updateForViewport(),(h&2||C)&&this.updateViewportLines(),(this.lineGaps.length||this.viewport.to-this.viewport.from>4e3)&&this.updateLineGaps(this.ensureLineGaps(o?[]:this.lineGaps,e)),h|=this.computeVisibleRanges(),this.mustEnforceCursorAssoc&&(this.mustEnforceCursorAssoc=!1,e.docView.enforceCursorAssoc()),h}get visibleTop(){return this.scaler.fromDOM(this.pixelViewport.top)}get visibleBottom(){return this.scaler.fromDOM(this.pixelViewport.bottom)}getViewport(e,t){let i=.5-Math.max(-.5,Math.min(.5,e/1e3/2)),n=this.heightMap,r=this.heightOracle,{visibleTop:o,visibleBottom:l}=this,a=new Io(n.lineAt(o-i*1e3,ke.ByHeight,r,0,0).from,n.lineAt(l+(1-i)*1e3,ke.ByHeight,r,0,0).to);if(t){let{head:h}=t.range;if(h<a.from||h>a.to){let c=Math.min(this.editorHeight,this.pixelViewport.bottom-this.pixelViewport.top),u=n.lineAt(h,ke.ByPos,r,0,0),d;t.y=="center"?d=(u.top+u.bottom)/2-c/2:t.y=="start"||t.y=="nearest"&&h<a.from?d=u.top:d=u.bottom-c,a=new Io(n.lineAt(d-1e3/2,ke.ByHeight,r,0,0).from,n.lineAt(d+c+1e3/2,ke.ByHeight,r,0,0).to)}}return a}mapViewport(e,t){let i=t.mapPos(e.from,-1),n=t.mapPos(e.to,1);return new Io(this.heightMap.lineAt(i,ke.ByPos,this.heightOracle,0,0).from,this.heightMap.lineAt(n,ke.ByPos,this.heightOracle,0,0).to)}viewportIsAppropriate({from:e,to:t},i=0){if(!this.inView)return!0;let{top:n}=this.heightMap.lineAt(e,ke.ByPos,this.heightOracle,0,0),{bottom:r}=this.heightMap.lineAt(t,ke.ByPos,this.heightOracle,0,0),{visibleTop:o,visibleBottom:l}=this;return(e==0||n<=o-Math.max(10,Math.min(-i,250)))&&(t==this.state.doc.length||r>=l+Math.max(10,Math.min(i,250)))&&n>o-2*1e3&&r<l+2*1e3}mapLineGaps(e,t){if(!e.length||t.empty)return e;let i=[];for(let n of e)t.touchesRange(n.from,n.to)||i.push(new ah(t.mapPos(n.from),t.mapPos(n.to),n.size));return i}ensureLineGaps(e,t){let i=this.heightOracle.lineWrapping,n=i?1e4:2e3,r=n>>1,o=n<<1;if(this.defaultTextDirection!=_e.LTR&&!i)return[];let l=[],a=(h,c,u,d)=>{if(c-h<r)return;let f=this.state.selection.main,p=[f.from];f.empty||p.push(f.to);for(let g of p)if(g>h&&g<c){a(h,g-10,u,d),a(g+10,c,u,d);return}let m=_x(e,g=>g.from>=u.from&&g.to<=u.to&&Math.abs(g.from-h)<r&&Math.abs(g.to-c)<r&&!p.some(b=>g.from<b&&g.to>b));if(!m){if(c<u.to&&t&&i&&t.visibleRanges.some(g=>g.from<=c&&g.to>=c)){let g=t.moveToLineBoundary(S.cursor(c),!1,!0).head;g>h&&(c=g)}m=new ah(h,c,this.gapSize(u,h,c,d))}l.push(m)};for(let h of this.viewportLines){if(h.length<o)continue;let c=Sx(h.from,h.to,this.stateDeco);if(c.total<o)continue;let u=this.scrollTarget?this.scrollTarget.range.head:null,d,f;if(i){let p=n/this.heightOracle.lineLength*this.heightOracle.lineHeight,m,g;if(u!=null){let b=Fo(c,u),v=((this.visibleBottom-this.visibleTop)/2+p)/h.height;m=b-v,g=b+v}else m=(this.visibleTop-h.top-p)/h.height,g=(this.visibleBottom-h.top+p)/h.height;d=Bo(c,m),f=Bo(c,g)}else{let p=c.total*this.heightOracle.charWidth,m=n*this.heightOracle.charWidth,g,b;if(u!=null){let v=Fo(c,u),C=((this.pixelViewport.right-this.pixelViewport.left)/2+m)/p;g=v-C,b=v+C}else g=(this.pixelViewport.left-m)/p,b=(this.pixelViewport.right+m)/p;d=Bo(c,g),f=Bo(c,b)}d>h.from&&a(h.from,d,h,c),f<h.to&&a(f,h.to,h,c)}return l}gapSize(e,t,i,n){let r=Fo(n,i)-Fo(n,t);return this.heightOracle.lineWrapping?e.height*r:n.total*this.heightOracle.charWidth*r}updateLineGaps(e){ah.same(e,this.lineGaps)||(this.lineGaps=e,this.lineGapDeco=F.set(e.map(t=>t.draw(this,this.heightOracle.lineWrapping))))}computeVisibleRanges(){let e=this.stateDeco;this.lineGaps.length&&(e=e.concat(this.lineGapDeco));let t=[];he.spans(e,this.viewport.from,this.viewport.to,{span(n,r){t.push({from:n,to:r})},point(){}},20);let i=t.length!=this.visibleRanges.length||this.visibleRanges.some((n,r)=>n.from!=t[r].from||n.to!=t[r].to);return this.visibleRanges=t,i?4:0}lineBlockAt(e){return e>=this.viewport.from&&e<=this.viewport.to&&this.viewportLines.find(t=>t.from<=e&&t.to>=e)||Rr(this.heightMap.lineAt(e,ke.ByPos,this.heightOracle,0,0),this.scaler)}lineBlockAtHeight(e){return Rr(this.heightMap.lineAt(this.scaler.fromDOM(e),ke.ByHeight,this.heightOracle,0,0),this.scaler)}scrollAnchorAt(e){let t=this.lineBlockAtHeight(e+8);return t.from>=this.viewport.from||this.viewportLines[0].top-e>200?t:this.viewportLines[0]}elementAtHeight(e){return Rr(this.heightMap.blockAt(this.scaler.fromDOM(e),this.heightOracle,0,0),this.scaler)}get docHeight(){return this.scaler.toDOM(this.heightMap.height)}get contentHeight(){return this.docHeight+this.paddingTop+this.paddingBottom}}class Io{constructor(e,t){this.from=e,this.to=t}}function Sx(s,e,t){let i=[],n=s,r=0;return he.spans(t,s,e,{span(){},point(o,l){o>n&&(i.push({from:n,to:o}),r+=o-n),n=l}},20),n<e&&(i.push({from:n,to:e}),r+=e-n),{total:r,ranges:i}}function Bo({total:s,ranges:e},t){if(t<=0)return e[0].from;if(t>=1)return e[e.length-1].to;let i=Math.floor(s*t);for(let n=0;;n++){let{from:r,to:o}=e[n],l=o-r;if(i<=l)return r+i;i-=l}}function Fo(s,e){let t=0;for(let{from:i,to:n}of s.ranges){if(e<=n){t+=e-i;break}t+=n-i}return t/s.total}function _x(s,e){for(let t of s)if(e(t))return t}const uf={toDOM(s){return s},fromDOM(s){return s},scale:1};class Rx{constructor(e,t,i){let n=0,r=0,o=0;this.viewports=i.map(({from:l,to:a})=>{let h=t.lineAt(l,ke.ByPos,e,0,0).top,c=t.lineAt(a,ke.ByPos,e,0,0).bottom;return n+=c-h,{from:l,to:a,top:h,bottom:c,domTop:0,domBottom:0}}),this.scale=(7e6-n)/(t.height-n);for(let l of this.viewports)l.domTop=o+(l.top-r)*this.scale,o=l.domBottom=l.domTop+(l.bottom-l.top),r=l.bottom}toDOM(e){for(let t=0,i=0,n=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.top)return n+(e-i)*this.scale;if(e<=r.bottom)return r.domTop+(e-r.top);i=r.bottom,n=r.domBottom}}fromDOM(e){for(let t=0,i=0,n=0;;t++){let r=t<this.viewports.length?this.viewports[t]:null;if(!r||e<r.domTop)return i+(e-n)/this.scale;if(e<=r.domBottom)return r.top+(e-r.domTop);i=r.bottom,n=r.domBottom}}}function Rr(s,e){if(e.scale==1)return s;let t=e.toDOM(s.top),i=e.toDOM(s.bottom);return new _i(s.from,s.length,t,i-t,Array.isArray(s._content)?s._content.map(n=>Rr(n,e)):s._content)}const Po=O.define({combine:s=>s.join(" ")}),yc=O.define({combine:s=>s.indexOf(!0)>-1}),vc=Ts.newName(),Bb=Ts.newName(),Fb=Ts.newName(),Pb={"&light":"."+Bb,"&dark":"."+Fb};function wc(s,e,t){return new Ts(e,{finish(i){return/&/.test(i)?i.replace(/&\w*/,n=>{if(n=="&")return s;if(!t||!t[n])throw new RangeError(`Unsupported selector: ${n}`);return t[n]}):s+" "+i}})}const Tx=wc("."+vc,{"&":{position:"relative !important",boxSizing:"border-box","&.cm-focused":{outline:"1px dotted #212121"},display:"flex !important",flexDirection:"column"},".cm-scroller":{display:"flex !important",alignItems:"flex-start !important",fontFamily:"monospace",lineHeight:1.4,height:"100%",overflowX:"auto",position:"relative",zIndex:0},".cm-content":{margin:0,flexGrow:2,flexShrink:0,display:"block",whiteSpace:"pre",wordWrap:"normal",boxSizing:"border-box",minHeight:"100%",padding:"4px 0",outline:"none","&[contenteditable=true]":{WebkitUserModify:"read-write-plaintext-only"}},".cm-lineWrapping":{whiteSpace_fallback:"pre-wrap",whiteSpace:"break-spaces",wordBreak:"break-word",overflowWrap:"anywhere",flexShrink:1},"&light .cm-content":{caretColor:"black"},"&dark .cm-content":{caretColor:"white"},".cm-line":{display:"block",padding:"0 2px 0 6px"},".cm-layer":{position:"absolute",left:0,top:0,contain:"size style","& > *":{position:"absolute"}},"&light .cm-selectionBackground":{background:"#d9d9d9"},"&dark .cm-selectionBackground":{background:"#222"},"&light.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#d7d4f0"},"&dark.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground":{background:"#233"},".cm-cursorLayer":{pointerEvents:"none"},"&.cm-focused > .cm-scroller > .cm-cursorLayer":{animation:"steps(1) cm-blink 1.2s infinite"},"@keyframes cm-blink":{"0%":{},"50%":{opacity:0},"100%":{}},"@keyframes cm-blink2":{"0%":{},"50%":{opacity:0},"100%":{}},".cm-cursor, .cm-dropCursor":{borderLeft:"1.2px solid black",marginLeft:"-0.6px",pointerEvents:"none"},".cm-cursor":{display:"none"},"&dark .cm-cursor":{borderLeftColor:"#444"},".cm-dropCursor":{position:"absolute"},"&.cm-focused > .cm-scroller > .cm-cursorLayer .cm-cursor":{display:"block"},".cm-iso":{unicodeBidi:"isolate"},".cm-announced":{position:"fixed",top:"-10000px"},"@media print":{".cm-announced":{display:"none"}},"&light .cm-activeLine":{backgroundColor:"#cceeff44"},"&dark .cm-activeLine":{backgroundColor:"#99eeff33"},"&light .cm-specialChar":{color:"red"},"&dark .cm-specialChar":{color:"#f78"},".cm-gutters":{flexShrink:0,display:"flex",height:"100%",boxSizing:"border-box",insetInlineStart:0,zIndex:200},"&light .cm-gutters":{backgroundColor:"#f5f5f5",color:"#6c6c6c",borderRight:"1px solid #ddd"},"&dark .cm-gutters":{backgroundColor:"#333338",color:"#ccc"},".cm-gutter":{display:"flex !important",flexDirection:"column",flexShrink:0,boxSizing:"border-box",minHeight:"100%",overflow:"hidden"},".cm-gutterElement":{boxSizing:"border-box"},".cm-lineNumbers .cm-gutterElement":{padding:"0 3px 0 5px",minWidth:"20px",textAlign:"right",whiteSpace:"nowrap"},"&light .cm-activeLineGutter":{backgroundColor:"#e2f2ff"},"&dark .cm-activeLineGutter":{backgroundColor:"#222227"},".cm-panels":{boxSizing:"border-box",position:"sticky",left:0,right:0},"&light .cm-panels":{backgroundColor:"#f5f5f5",color:"black"},"&light .cm-panels-top":{borderBottom:"1px solid #ddd"},"&light .cm-panels-bottom":{borderTop:"1px solid #ddd"},"&dark .cm-panels":{backgroundColor:"#333338",color:"white"},".cm-tab":{display:"inline-block",overflow:"hidden",verticalAlign:"bottom"},".cm-widgetBuffer":{verticalAlign:"text-top",height:"1em",width:0,display:"inline"},".cm-placeholder":{color:"#888",display:"inline-block",verticalAlign:"top"},".cm-highlightSpace:before":{content:"attr(data-display)",position:"absolute",pointerEvents:"none",color:"#888"},".cm-highlightTab":{backgroundImage:`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="20"><path stroke="%23888" stroke-width="1" fill="none" d="M1 10H196L190 5M190 15L196 10M197 4L197 16"/></svg>')`,backgroundSize:"auto 100%",backgroundPosition:"right 90%",backgroundRepeat:"no-repeat"},".cm-trailingSpace":{backgroundColor:"#ff332255"},".cm-button":{verticalAlign:"middle",color:"inherit",fontSize:"70%",padding:".2em 1em",borderRadius:"1px"},"&light .cm-button":{backgroundImage:"linear-gradient(#eff1f5, #d9d9df)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#b4b4b4, #d0d3d6)"}},"&dark .cm-button":{backgroundImage:"linear-gradient(#393939, #111)",border:"1px solid #888","&:active":{backgroundImage:"linear-gradient(#111, #333)"}},".cm-textfield":{verticalAlign:"middle",color:"inherit",fontSize:"70%",border:"1px solid silver",padding:".2em .5em"},"&light .cm-textfield":{backgroundColor:"white"},"&dark .cm-textfield":{border:"1px solid #555",backgroundColor:"inherit"}},Pb),Tr="";class Mx{constructor(e,t){this.points=e,this.text="",this.lineSeparator=t.facet(ae.lineSeparator)}append(e){this.text+=e}lineBreak(){this.text+=Tr}readRange(e,t){if(!e)return this;let i=e.parentNode;for(let n=e;;){this.findPointBefore(i,n);let r=this.text.length;this.readNode(n);let o=n.nextSibling;if(o==t)break;let l=Se.get(n),a=Se.get(o);(l&&a?l.breakAfter:(l?l.breakAfter:df(n))||df(o)&&(n.nodeName!="BR"||n.cmIgnore)&&this.text.length>r)&&this.lineBreak(),n=o}return this.findPointBefore(i,t),this}readTextNode(e){let t=e.nodeValue;for(let i of this.points)i.node==e&&(i.pos=this.text.length+Math.min(i.offset,t.length));for(let i=0,n=this.lineSeparator?null:/\r\n?|\n/g;;){let r=-1,o=1,l;if(this.lineSeparator?(r=t.indexOf(this.lineSeparator,i),o=this.lineSeparator.length):(l=n.exec(t))&&(r=l.index,o=l[0].length),this.append(t.slice(i,r<0?t.length:r)),r<0)break;if(this.lineBreak(),o>1)for(let a of this.points)a.node==e&&a.pos>this.text.length&&(a.pos-=o-1);i=r+o}}readNode(e){if(e.cmIgnore)return;let t=Se.get(e),i=t&&t.overrideDOMText;if(i!=null){this.findPointInside(e,i.length);for(let n=i.iter();!n.next().done;)n.lineBreak?this.lineBreak():this.append(n.value)}else e.nodeType==3?this.readTextNode(e):e.nodeName=="BR"?e.nextSibling&&this.lineBreak():e.nodeType==1&&this.readRange(e.firstChild,null)}findPointBefore(e,t){for(let i of this.points)i.node==e&&e.childNodes[i.offset]==t&&(i.pos=this.text.length)}findPointInside(e,t){for(let i of this.points)(e.nodeType==3?i.node==e:e.contains(i.node))&&(i.pos=this.text.length+(Dx(e,i.node,i.offset)?t:0))}}function Dx(s,e,t){for(;;){if(!e||t<Yi(e))return!1;if(e==s)return!0;t=Yr(e)+1,e=e.parentNode}}function df(s){return s.nodeType==1&&/^(DIV|P|LI|UL|OL|BLOCKQUOTE|DD|DT|H\d|SECTION|PRE)$/.test(s.nodeName)}class ff{constructor(e,t){this.node=e,this.offset=t,this.pos=-1}}class Ax{constructor(e,t,i,n){this.typeOver=n,this.bounds=null,this.text="";let{impreciseHead:r,impreciseAnchor:o}=e.docView;if(e.state.readOnly&&t>-1)this.newSel=null;else if(t>-1&&(this.bounds=e.docView.domBoundsAround(t,i,0))){let l=r||o?[]:Ix(e),a=new Mx(l,e.state);a.readRange(this.bounds.startDOM,this.bounds.endDOM),this.text=a.text,this.newSel=Bx(l,this.bounds.from)}else{let l=e.observer.selectionRange,a=r&&r.node==l.focusNode&&r.offset==l.focusOffset||!nc(e.contentDOM,l.focusNode)?e.state.selection.main.head:e.docView.posFromDOM(l.focusNode,l.focusOffset),h=o&&o.node==l.anchorNode&&o.offset==l.anchorOffset||!nc(e.contentDOM,l.anchorNode)?e.state.selection.main.anchor:e.docView.posFromDOM(l.anchorNode,l.anchorOffset),c=e.viewport;if((L.ios||L.chrome)&&e.state.selection.main.empty&&a!=h&&(c.from>0||c.to<e.state.doc.length)){let u=Math.min(a,h),d=Math.max(a,h),f=c.from-u,p=c.to-d;(f==0||f==1||u==0)&&(p==0||p==-1||d==e.state.doc.length)&&(a=0,h=e.state.doc.length)}this.newSel=S.single(h,a)}}}function Nb(s,e){let t,{newSel:i}=e,n=s.state.selection.main,r=s.inputState.lastKeyTime>Date.now()-100?s.inputState.lastKeyCode:-1;if(e.bounds){let{from:o,to:l}=e.bounds,a=n.from,h=null;(r===8||L.android&&e.text.length<l-o)&&(a=n.to,h="end");let c=Lx(s.state.doc.sliceString(o,l,Tr),e.text,a-o,h);c&&(L.chrome&&r==13&&c.toB==c.from+2&&e.text.slice(c.from,c.toB)==Tr+Tr&&c.toB--,t={from:o+c.from,to:o+c.toA,insert:de.of(e.text.slice(c.from,c.toB).split(Tr))})}else i&&(!s.hasFocus&&s.state.facet(Ra)||i.main.eq(n))&&(i=null);if(!t&&!i)return!1;if(!t&&e.typeOver&&!n.empty&&i&&i.main.empty?t={from:n.from,to:n.to,insert:s.state.doc.slice(n.from,n.to)}:t&&t.from>=n.from&&t.to<=n.to&&(t.from!=n.from||t.to!=n.to)&&n.to-n.from-(t.to-t.from)<=4?t={from:n.from,to:n.to,insert:s.state.doc.slice(n.from,t.from).append(t.insert).append(s.state.doc.slice(t.to,n.to))}:(L.mac||L.android)&&t&&t.from==t.to&&t.from==n.head-1&&/^\. ?$/.test(t.insert.toString())&&s.contentDOM.getAttribute("autocorrect")=="off"?(i&&t.insert.length==2&&(i=S.single(i.main.anchor-1,i.main.head-1)),t={from:n.from,to:n.to,insert:de.of([" "])}):L.chrome&&t&&t.from==t.to&&t.from==n.head&&t.insert.toString()==`
 `&&s.lineWrapping&&(i&&(i=S.single(i.main.anchor-1,i.main.head-1)),t={from:n.from,to:n.to,insert:de.of([" "])}),t){if(L.ios&&s.inputState.flushIOSKey()||L.android&&(t.from==n.from&&t.to==n.to&&t.insert.length==1&&t.insert.lines==2&&Pn(s.contentDOM,"Enter",13)||(t.from==n.from-1&&t.to==n.to&&t.insert.length==0||r==8&&t.insert.length<t.to-t.from&&t.to>n.head)&&Pn(s.contentDOM,"Backspace",8)||t.from==n.from&&t.to==n.to+1&&t.insert.length==0&&Pn(s.contentDOM,"Delete",46)))return!0;let o=t.insert.toString();s.inputState.composing>=0&&s.inputState.composing++;let l,a=()=>l||(l=Ox(s,t,i));return s.state.facet(fb).some(h=>h(s,t.from,t.to,o,a))||s.dispatch(a()),!0}else if(i&&!i.main.eq(n)){let o=!1,l="select";return s.inputState.lastSelectionTime>Date.now()-50&&(s.inputState.lastSelectionOrigin=="select"&&(o=!0),l=s.inputState.lastSelectionOrigin),s.dispatch({selection:i,scrollIntoView:o,userEvent:l}),!0}else return!1}function Ox(s,e,t){let i,n=s.state,r=n.selection.main;if(e.from>=r.from&&e.to<=r.to&&e.to-e.from>=(r.to-r.from)/3&&(!t||t.main.empty&&t.main.from==e.from+e.insert.length)&&s.inputState.composing<0){let l=r.from<e.from?n.sliceDoc(r.from,e.from):"",a=r.to>e.to?n.sliceDoc(e.to,r.to):"";i=n.replaceSelection(s.state.toText(l+e.insert.sliceString(0,void 0,s.state.lineBreak)+a))}else{let l=n.changes(e),a=t&&t.main.to<=l.newLength?t.main:void 0;if(n.selection.ranges.length>1&&s.inputState.composing>=0&&e.to<=r.to&&e.to>=r.to-10){let h=s.state.sliceDoc(e.from,e.to),c,u=t&&Eb(s,t.main.head);if(u){let p=e.insert.length-(e.to-e.from);c={from:u.from,to:u.to-p}}else c=s.state.doc.lineAt(r.head);let d=r.to-e.to,f=r.to-r.from;i=n.changeByRange(p=>{if(p.from==r.from&&p.to==r.to)return{changes:l,range:a||p.map(l)};let m=p.to-d,g=m-h.length;if(p.to-p.from!=f||s.state.sliceDoc(g,m)!=h||p.to>=c.from&&p.from<=c.to)return{range:p};let b=n.changes({from:g,to:m,insert:e.insert}),v=p.to-r.to;return{changes:b,range:a?S.range(Math.max(0,a.anchor+v),Math.max(0,a.head+v)):p.map(b)}})}else i={changes:l,selection:a&&n.selection.replaceRange(a)}}let o="input.type";return(s.composing||s.inputState.compositionPendingChange&&s.inputState.compositionEndedAt>Date.now()-50)&&(s.inputState.compositionPendingChange=!1,o+=".compose",s.inputState.compositionFirstChange&&(o+=".start",s.inputState.compositionFirstChange=!1)),n.update(i,{userEvent:o,scrollIntoView:!0})}function Lx(s,e,t,i){let n=Math.min(s.length,e.length),r=0;for(;r<n&&s.charCodeAt(r)==e.charCodeAt(r);)r++;if(r==n&&s.length==e.length)return null;let o=s.length,l=e.length;for(;o>0&&l>0&&s.charCodeAt(o-1)==e.charCodeAt(l-1);)o--,l--;if(i=="end"){let a=Math.max(0,r-Math.min(o,l));t-=o+a-r}if(o<r&&s.length<e.length){let a=t<=r&&t>=o?r-t:0;r-=a,l=r+(l-o),o=r}else if(l<r){let a=t<=r&&t>=l?r-t:0;r-=a,o=r+(o-l),l=r}return{from:r,toA:o,toB:l}}function Ix(s){let e=[];if(s.root.activeElement!=s.contentDOM)return e;let{anchorNode:t,anchorOffset:i,focusNode:n,focusOffset:r}=s.observer.selectionRange;return t&&(e.push(new ff(t,i)),(n!=t||r!=i)&&e.push(new ff(n,r))),e}function Bx(s,e){if(s.length==0)return null;let t=s[0].pos,i=s.length==2?s[1].pos:t;return t>-1&&i>-1?S.single(t+e,i+e):null}const Fx={childList:!0,characterData:!0,subtree:!0,attributes:!0,characterDataOldValue:!0},hh=L.ie&&L.ie_version<=11;class Px{constructor(e){this.view=e,this.active=!1,this.selectionRange=new wE,this.selectionChanged=!1,this.delayedFlush=-1,this.resizeTimeout=-1,this.queue=[],this.delayedAndroidKey=null,this.flushingAndroidKey=-1,this.lastChange=0,this.scrollTargets=[],this.intersection=null,this.resizeScroll=null,this.intersecting=!1,this.gapIntersection=null,this.gaps=[],this.parentCheck=-1,this.dom=e.contentDOM,this.observer=new MutationObserver(t=>{for(let i of t)this.queue.push(i);(L.ie&&L.ie_version<=11||L.ios&&e.composing)&&t.some(i=>i.type=="childList"&&i.removedNodes.length||i.type=="characterData"&&i.oldValue.length>i.target.nodeValue.length)?this.flushSoon():this.flush()}),hh&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this),this.onResize=this.onResize.bind(this),this.onPrint=this.onPrint.bind(this),this.onScroll=this.onScroll.bind(this),typeof ResizeObserver=="function"&&(this.resizeScroll=new ResizeObserver(()=>{var t;((t=this.view.docView)===null||t===void 0?void 0:t.lastUpdate)<Date.now()-75&&this.onResize()}),this.resizeScroll.observe(e.scrollDOM)),this.addWindowListeners(this.win=e.win),this.start(),typeof IntersectionObserver=="function"&&(this.intersection=new IntersectionObserver(t=>{this.parentCheck<0&&(this.parentCheck=setTimeout(this.listenForScroll.bind(this),1e3)),t.length>0&&t[t.length-1].intersectionRatio>0!=this.intersecting&&(this.intersecting=!this.intersecting,this.intersecting!=this.view.inView&&this.onScrollChanged(document.createEvent("Event")))},{threshold:[0,.001]}),this.intersection.observe(this.dom),this.gapIntersection=new IntersectionObserver(t=>{t.length>0&&t[t.length-1].intersectionRatio>0&&this.onScrollChanged(document.createEvent("Event"))},{})),this.listenForScroll(),this.readSelectionRange()}onScrollChanged(e){this.view.inputState.runHandlers("scroll",e),this.intersecting&&this.view.measure()}onScroll(e){this.intersecting&&this.flush(!1),this.onScrollChanged(e)}onResize(){this.resizeTimeout<0&&(this.resizeTimeout=setTimeout(()=>{this.resizeTimeout=-1,this.view.requestMeasure()},50))}onPrint(){this.view.viewState.printing=!0,this.view.measure(),setTimeout(()=>{this.view.viewState.printing=!1,this.view.requestMeasure()},500)}updateGaps(e){if(this.gapIntersection&&(e.length!=this.gaps.length||this.gaps.some((t,i)=>t!=e[i]))){this.gapIntersection.disconnect();for(let t of e)this.gapIntersection.observe(t);this.gaps=e}}onSelectionChange(e){let t=this.selectionChanged;if(!this.readSelectionRange()||this.delayedAndroidKey)return;let{view:i}=this,n=this.selectionRange;if(i.state.facet(Ra)?i.root.activeElement!=this.dom:!ll(i.dom,n))return;let r=n.anchorNode&&i.docView.nearest(n.anchorNode);if(r&&r.ignoreEvent(e)){t||(this.selectionChanged=!1);return}(L.ie&&L.ie_version<=11||L.android&&L.chrome)&&!i.state.selection.main.empty&&n.focusNode&&Br(n.focusNode,n.focusOffset,n.anchorNode,n.anchorOffset)?this.flushSoon():this.flush(!1)}readSelectionRange(){let{view:e}=this,t=L.safari&&e.root.nodeType==11&&gE(this.dom.ownerDocument)==this.dom&&Nx(this.view)||Yl(e.root);if(!t||this.selectionRange.eq(t))return!1;let i=ll(this.dom,t);return i&&!this.selectionChanged&&e.inputState.lastFocusTime>Date.now()-200&&e.inputState.lastTouchTime<Date.now()-300&&EE(this.dom,t)?(this.view.inputState.lastFocusTime=0,e.docView.updateSelection(),!1):(this.selectionRange.setRange(t),i&&(this.selectionChanged=!0),!0)}setSelectionRange(e,t){this.selectionRange.set(e.node,e.offset,t.node,t.offset),this.selectionChanged=!1}clearSelectionRange(){this.selectionRange.set(null,0,null,0)}listenForScroll(){this.parentCheck=-1;let e=0,t=null;for(let i=this.dom;i;)if(i.nodeType==1)!t&&e<this.scrollTargets.length&&this.scrollTargets[e]==i?e++:t||(t=this.scrollTargets.slice(0,e)),t&&t.push(i),i=i.assignedSlot||i.parentNode;else if(i.nodeType==11)i=i.host;else break;if(e<this.scrollTargets.length&&!t&&(t=this.scrollTargets.slice(0,e)),t){for(let i of this.scrollTargets)i.removeEventListener("scroll",this.onScroll);for(let i of this.scrollTargets=t)i.addEventListener("scroll",this.onScroll)}}ignore(e){if(!this.active)return e();try{return this.stop(),e()}finally{this.start(),this.clear()}}start(){this.active||(this.observer.observe(this.dom,Fx),hh&&this.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.active=!0)}stop(){this.active&&(this.active=!1,this.observer.disconnect(),hh&&this.dom.removeEventListener("DOMCharacterDataModified",this.onCharData))}clear(){this.processRecords(),this.queue.length=0,this.selectionChanged=!1}delayAndroidKey(e,t){var i;if(!this.delayedAndroidKey){let n=()=>{let r=this.delayedAndroidKey;r&&(this.clearDelayedAndroidKey(),this.view.inputState.lastKeyCode=r.keyCode,this.view.inputState.lastKeyTime=Date.now(),!this.flush()&&r.force&&Pn(this.dom,r.key,r.keyCode))};this.flushingAndroidKey=this.view.win.requestAnimationFrame(n)}(!this.delayedAndroidKey||e=="Enter")&&(this.delayedAndroidKey={key:e,keyCode:t,force:this.lastChange<Date.now()-50||!!(!((i=this.delayedAndroidKey)===null||i===void 0)&&i.force)})}clearDelayedAndroidKey(){this.win.cancelAnimationFrame(this.flushingAndroidKey),this.delayedAndroidKey=null,this.flushingAndroidKey=-1}flushSoon(){this.delayedFlush<0&&(this.delayedFlush=this.view.win.requestAnimationFrame(()=>{this.delayedFlush=-1,this.flush()}))}forceFlush(){this.delayedFlush>=0&&(this.view.win.cancelAnimationFrame(this.delayedFlush),this.delayedFlush=-1),this.flush()}pendingRecords(){for(let e of this.observer.takeRecords())this.queue.push(e);return this.queue}processRecords(){let e=this.pendingRecords();e.length&&(this.queue=[]);let t=-1,i=-1,n=!1;for(let r of e){let o=this.readMutation(r);o&&(o.typeOver&&(n=!0),t==-1?{from:t,to:i}=o:(t=Math.min(o.from,t),i=Math.max(o.to,i)))}return{from:t,to:i,typeOver:n}}readChange(){let{from:e,to:t,typeOver:i}=this.processRecords(),n=this.selectionChanged&&ll(this.dom,this.selectionRange);if(e<0&&!n)return null;e>-1&&(this.lastChange=Date.now()),this.view.inputState.lastFocusTime=0,this.selectionChanged=!1;let r=new Ax(this.view,e,t,i);return this.view.docView.domChanged={newSel:r.newSel?r.newSel.main:null},r}flush(e=!0){if(this.delayedFlush>=0||this.delayedAndroidKey)return!1;e&&this.readSelectionRange();let t=this.readChange();if(!t)return this.view.requestMeasure(),!1;let i=this.view.state,n=Nb(this.view,t);return this.view.state==i&&this.view.update([]),n}readMutation(e){let t=this.view.docView.nearest(e.target);if(!t||t.ignoreMutation(e))return null;if(t.markDirty(e.type=="attributes"),e.type=="attributes"&&(t.flags|=4),e.type=="childList"){let i=pf(t,e.previousSibling||e.target.previousSibling,-1),n=pf(t,e.nextSibling||e.target.nextSibling,1);return{from:i?t.posAfter(i):t.posAtStart,to:n?t.posBefore(n):t.posAtEnd,typeOver:!1}}else return e.type=="characterData"?{from:t.posAtStart,to:t.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}:null}setWindow(e){e!=this.win&&(this.removeWindowListeners(this.win),this.win=e,this.addWindowListeners(this.win))}addWindowListeners(e){e.addEventListener("resize",this.onResize),e.addEventListener("beforeprint",this.onPrint),e.addEventListener("scroll",this.onScroll),e.document.addEventListener("selectionchange",this.onSelectionChange)}removeWindowListeners(e){e.removeEventListener("scroll",this.onScroll),e.removeEventListener("resize",this.onResize),e.removeEventListener("beforeprint",this.onPrint),e.document.removeEventListener("selectionchange",this.onSelectionChange)}destroy(){var e,t,i;this.stop(),(e=this.intersection)===null||e===void 0||e.disconnect(),(t=this.gapIntersection)===null||t===void 0||t.disconnect(),(i=this.resizeScroll)===null||i===void 0||i.disconnect();for(let n of this.scrollTargets)n.removeEventListener("scroll",this.onScroll);this.removeWindowListeners(this.win),clearTimeout(this.parentCheck),clearTimeout(this.resizeTimeout),this.win.cancelAnimationFrame(this.delayedFlush),this.win.cancelAnimationFrame(this.flushingAndroidKey)}}function pf(s,e,t){for(;e;){let i=Se.get(e);if(i&&i.parent==s)return i;let n=e.parentNode;e=n!=s.dom?n:t>0?e.nextSibling:e.previousSibling}return null}function Nx(s){let e=null;function t(a){a.preventDefault(),a.stopImmediatePropagation(),e=a.getTargetRanges()[0]}if(s.contentDOM.addEventListener("beforeinput",t,!0),s.dom.ownerDocument.execCommand("indent"),s.contentDOM.removeEventListener("beforeinput",t,!0),!e)return null;let i=e.startContainer,n=e.startOffset,r=e.endContainer,o=e.endOffset,l=s.docView.domAtPos(s.state.selection.main.anchor);return Br(l.node,l.offset,r,o)&&([i,n,r,o]=[r,o,i,n]),{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:o}}class A{get state(){return this.viewState.state}get viewport(){return this.viewState.viewport}get visibleRanges(){return this.viewState.visibleRanges}get inView(){return this.viewState.inView}get composing(){return this.inputState.composing>0}get compositionStarted(){return this.inputState.composing>=0}get root(){return this._root}get win(){return this.dom.ownerDocument.defaultView||window}constructor(e={}){this.plugins=[],this.pluginMap=new Map,this.editorAttrs={},this.contentAttrs={},this.bidiCache=[],this.destroyed=!1,this.updateState=2,this.measureScheduled=-1,this.measureRequests=[],this.contentDOM=document.createElement("div"),this.scrollDOM=document.createElement("div"),this.scrollDOM.tabIndex=-1,this.scrollDOM.className="cm-scroller",this.scrollDOM.appendChild(this.contentDOM),this.announceDOM=document.createElement("div"),this.announceDOM.className="cm-announced",this.announceDOM.setAttribute("aria-live","polite"),this.dom=document.createElement("div"),this.dom.appendChild(this.announceDOM),this.dom.appendChild(this.scrollDOM),e.parent&&e.parent.appendChild(this.dom);let{dispatch:t}=e;this.dispatchTransactions=e.dispatchTransactions||t&&(i=>i.forEach(n=>t(n,this)))||(i=>this.update(i)),this.dispatch=this.dispatch.bind(this),this._root=e.root||CE(e.parent)||document,this.viewState=new cf(e.state||ae.create(e)),e.scrollTo&&e.scrollTo.is(Ao)&&(this.viewState.scrollTarget=e.scrollTo.value.clip(this.viewState.state)),this.plugins=this.state.facet(Sr).map(i=>new rh(i));for(let i of this.plugins)i.update(this);this.observer=new Px(this),this.inputState=new ZE(this),this.inputState.ensureHandlers(this.plugins),this.docView=new Gd(this),this.mountStyles(),this.updateAttrs(),this.updateState=0,this.requestMeasure()}dispatch(...e){let t=e.length==1&&e[0]instanceof Ge?e:e.length==1&&Array.isArray(e[0])?e[0]:[this.state.update(...e)];this.dispatchTransactions(t,this)}update(e){if(this.updateState!=0)throw new Error("Calls to EditorView.update are not allowed while an update is in progress");let t=!1,i=!1,n,r=this.state;for(let d of e){if(d.startState!=r)throw new RangeError("Trying to update state with a transaction that doesn't start from the previous state.");r=d.state}if(this.destroyed){this.viewState.state=r;return}let o=this.hasFocus,l=0,a=null;e.some(d=>d.annotation(Ab))?(this.inputState.notifiedFocused=o,l=1):o!=this.inputState.notifiedFocused&&(this.inputState.notifiedFocused=o,a=Ob(r,o),a||(l=1));let h=this.observer.delayedAndroidKey,c=null;if(h?(this.observer.clearDelayedAndroidKey(),c=this.observer.readChange(),(c&&!this.state.doc.eq(r.doc)||!this.state.selection.eq(r.selection))&&(c=null)):this.observer.clear(),r.facet(ae.phrases)!=this.state.facet(ae.phrases))return this.setState(r);n=Ql.create(this,r,e),n.flags|=l;let u=this.viewState.scrollTarget;try{this.updateState=2;for(let d of e){if(u&&(u=u.map(d.changes)),d.scrollIntoView){let{main:f}=d.state.selection;u=new Nn(f.empty?f:S.cursor(f.head,f.head>f.anchor?-1:1))}for(let f of d.effects)f.is(Ao)&&(u=f.value.clip(this.state))}this.viewState.update(n,u),this.bidiCache=Jl.update(this.bidiCache,n.changes),n.empty||(this.updatePlugins(n),this.inputState.update(n)),t=this.docView.update(n),this.state.facet(_r)!=this.styleModules&&this.mountStyles(),i=this.updateAttrs(),this.showAnnouncements(e),this.docView.updateSelection(t,e.some(d=>d.isUserEvent("select.pointer")))}finally{this.updateState=0}if(n.startState.facet(Po)!=n.state.facet(Po)&&(this.viewState.mustMeasureContent=!0),(t||i||u||this.viewState.mustEnforceCursorAssoc||this.viewState.mustMeasureContent)&&this.requestMeasure(),!n.empty)for(let d of this.state.facet(pc))try{d(n)}catch(f){Yt(this.state,f,"update listener")}(a||c)&&Promise.resolve().then(()=>{a&&this.state==a.startState&&this.dispatch(a),c&&!Nb(this,c)&&h.force&&Pn(this.contentDOM,h.key,h.keyCode)})}setState(e){if(this.updateState!=0)throw new Error("Calls to EditorView.setState are not allowed while an update is in progress");if(this.destroyed){this.viewState.state=e;return}this.updateState=2;let t=this.hasFocus;try{for(let i of this.plugins)i.destroy(this);this.viewState=new cf(e),this.plugins=e.facet(Sr).map(i=>new rh(i)),this.pluginMap.clear();for(let i of this.plugins)i.update(this);this.docView.destroy(),this.docView=new Gd(this),this.inputState.ensureHandlers(this.plugins),this.mountStyles(),this.updateAttrs(),this.bidiCache=[]}finally{this.updateState=0}t&&this.focus(),this.requestMeasure()}updatePlugins(e){let t=e.startState.facet(Sr),i=e.state.facet(Sr);if(t!=i){let n=[];for(let r of i){let o=t.indexOf(r);if(o<0)n.push(new rh(r));else{let l=this.plugins[o];l.mustUpdate=e,n.push(l)}}for(let r of this.plugins)r.mustUpdate!=e&&r.destroy(this);this.plugins=n,this.pluginMap.clear()}else for(let n of this.plugins)n.mustUpdate=e;for(let n=0;n<this.plugins.length;n++)this.plugins[n].update(this);t!=i&&this.inputState.ensureHandlers(this.plugins)}measure(e=!0){if(this.destroyed)return;if(this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.observer.delayedAndroidKey){this.measureScheduled=-1,this.requestMeasure();return}this.measureScheduled=0,e&&this.observer.forceFlush();let t=null,i=this.scrollDOM,n=i.scrollTop*this.scaleY,{scrollAnchorPos:r,scrollAnchorHeight:o}=this.viewState;Math.abs(n-this.viewState.scrollTop)>1&&(o=-1),this.viewState.scrollAnchorHeight=-1;try{for(let l=0;;l++){if(o<0)if(Kg(i))r=-1,o=this.viewState.heightMap.height;else{let f=this.viewState.scrollAnchorAt(n);r=f.from,o=f.top}this.updateState=1;let a=this.viewState.measure(this);if(!a&&!this.measureRequests.length&&this.viewState.scrollTarget==null)break;if(l>5){console.warn(this.measureRequests.length?"Measure loop restarted more than 5 times":"Viewport failed to stabilize");break}let h=[];a&4||([this.measureRequests,h]=[h,this.measureRequests]);let c=h.map(f=>{try{return f.read(this)}catch(p){return Yt(this.state,p),mf}}),u=Ql.create(this,this.state,[]),d=!1;u.flags|=a,t?t.flags|=a:t=u,this.updateState=2,u.empty||(this.updatePlugins(u),this.inputState.update(u),this.updateAttrs(),d=this.docView.update(u));for(let f=0;f<h.length;f++)if(c[f]!=mf)try{let p=h[f];p.write&&p.write(c[f],this)}catch(p){Yt(this.state,p)}if(d&&this.docView.updateSelection(!0),!u.viewportChanged&&this.measureRequests.length==0){if(this.viewState.editorHeight)if(this.viewState.scrollTarget){this.docView.scrollIntoView(this.viewState.scrollTarget),this.viewState.scrollTarget=null,o=-1;continue}else{let p=(r<0?this.viewState.heightMap.height:this.viewState.lineBlockAt(r).top)-o;if(p>1||p<-1){n=n+p,i.scrollTop=n/this.scaleY,o=-1;continue}}break}}}finally{this.updateState=0,this.measureScheduled=-1}if(t&&!t.empty)for(let l of this.state.facet(pc))l(t)}get themeClasses(){return vc+" "+(this.state.facet(yc)?Fb:Bb)+" "+this.state.facet(Po)}updateAttrs(){let e=gf(this,bb,{class:"cm-editor"+(this.hasFocus?" cm-focused ":" ")+this.themeClasses}),t={spellcheck:"false",autocorrect:"off",autocapitalize:"off",translate:"no",contenteditable:this.state.facet(Ra)?"true":"false",class:"cm-content",style:`${L.tabSize}: ${this.state.tabSize}`,role:"textbox","aria-multiline":"true"};this.state.readOnly&&(t["aria-readonly"]="true"),gf(this,Mu,t);let i=this.observer.ignore(()=>{let n=hc(this.contentDOM,this.contentAttrs,t),r=hc(this.dom,this.editorAttrs,e);return n||r});return this.editorAttrs=e,this.contentAttrs=t,i}showAnnouncements(e){let t=!0;for(let i of e)for(let n of i.effects)if(n.is(A.announce)){t&&(this.announceDOM.textContent=""),t=!1;let r=this.announceDOM.appendChild(document.createElement("div"));r.textContent=n.value}}mountStyles(){this.styleModules=this.state.facet(_r);let e=this.state.facet(A.cspNonce);Ts.mount(this.root,this.styleModules.concat(Tx).reverse(),e?{nonce:e}:void 0)}readMeasured(){if(this.updateState==2)throw new Error("Reading the editor layout isn't allowed during an update");this.updateState==0&&this.measureScheduled>-1&&this.measure(!1)}requestMeasure(e){if(this.measureScheduled<0&&(this.measureScheduled=this.win.requestAnimationFrame(()=>this.measure())),e){if(this.measureRequests.indexOf(e)>-1)return;if(e.key!=null){for(let t=0;t<this.measureRequests.length;t++)if(this.measureRequests[t].key===e.key){this.measureRequests[t]=e;return}}this.measureRequests.push(e)}}plugin(e){let t=this.pluginMap.get(e);return(t===void 0||t&&t.spec!=e)&&this.pluginMap.set(e,t=this.plugins.find(i=>i.spec==e)||null),t&&t.update(this).value}get documentTop(){return this.contentDOM.getBoundingClientRect().top+this.viewState.paddingTop}get documentPadding(){return{top:this.viewState.paddingTop,bottom:this.viewState.paddingBottom}}get scaleX(){return this.viewState.scaleX}get scaleY(){return this.viewState.scaleY}elementAtHeight(e){return this.readMeasured(),this.viewState.elementAtHeight(e)}lineBlockAtHeight(e){return this.readMeasured(),this.viewState.lineBlockAtHeight(e)}get viewportLineBlocks(){return this.viewState.viewportLines}lineBlockAt(e){return this.viewState.lineBlockAt(e)}get contentHeight(){return this.viewState.contentHeight}moveByChar(e,t,i){return lh(this,e,Jd(this,e,t,i))}moveByGroup(e,t){return lh(this,e,Jd(this,e,t,i=>JE(this,e.head,i)))}visualLineSide(e,t){let i=this.bidiSpans(e),n=this.textDirectionAt(e.from),r=i[t?i.length-1:0];return S.cursor(r.side(t,n)+e.from,r.forward(!t,n)?1:-1)}moveToLineBoundary(e,t,i=!0){return QE(this,e,t,i)}moveVertically(e,t,i){return lh(this,e,XE(this,e,t,i))}domAtPos(e){return this.docView.domAtPos(e)}posAtDOM(e,t=0){return this.docView.posFromDOM(e,t)}posAtCoords(e,t=!0){return this.readMeasured(),kb(this,e,t)}coordsAtPos(e,t=1){this.readMeasured();let i=this.docView.coordsAt(e,t);if(!i||i.left==i.right)return i;let n=this.state.doc.lineAt(e),r=this.bidiSpans(n),o=r[fs.find(r,e-n.from,-1,t)];return Sa(i,o.dir==_e.LTR==t>0)}coordsForChar(e){return this.readMeasured(),this.docView.coordsForChar(e)}get defaultCharacterWidth(){return this.viewState.heightOracle.charWidth}get defaultLineHeight(){return this.viewState.heightOracle.lineHeight}get textDirection(){return this.viewState.defaultTextDirection}textDirectionAt(e){return!this.state.facet(mb)||e<this.viewport.from||e>this.viewport.to?this.textDirection:(this.readMeasured(),this.docView.textDirectionAt(e))}get lineWrapping(){return this.viewState.heightOracle.lineWrapping}bidiSpans(e){if(e.length>zx)return lb(e.length);let t=this.textDirectionAt(e.from),i;for(let r of this.bidiCache)if(r.from==e.from&&r.dir==t&&(r.fresh||ob(r.isolates,i=jd(this,e))))return r.order;i||(i=jd(this,e));let n=IE(e.text,t,i);return this.bidiCache.push(new Jl(e.from,e.to,t,i,!0,n)),n}get hasFocus(){var e;return(this.dom.ownerDocument.hasFocus()||L.safari&&((e=this.inputState)===null||e===void 0?void 0:e.lastContextMenu)>Date.now()-3e4)&&this.root.activeElement==this.contentDOM}focus(){this.observer.ignore(()=>{qg(this.contentDOM),this.docView.updateSelection()})}setRoot(e){this._root!=e&&(this._root=e,this.observer.setWindow((e.nodeType==9?e:e.ownerDocument).defaultView||window),this.mountStyles())}destroy(){for(let e of this.plugins)e.destroy(this);this.plugins=[],this.inputState.destroy(),this.docView.destroy(),this.dom.remove(),this.observer.destroy(),this.measureScheduled>-1&&this.win.cancelAnimationFrame(this.measureScheduled),this.destroyed=!0}static scrollIntoView(e,t={}){return Ao.of(new Nn(typeof e=="number"?S.cursor(e):e,t.y,t.x,t.yMargin,t.xMargin))}scrollSnapshot(){let{scrollTop:e,scrollLeft:t}=this.scrollDOM,i=this.viewState.scrollAnchorAt(e);return Ao.of(new Nn(S.cursor(i.from),"start","start",i.top-e,t,!0))}static domEventHandlers(e){return Pe.define(()=>({}),{eventHandlers:e})}static domEventObservers(e){return Pe.define(()=>({}),{eventObservers:e})}static theme(e,t){let i=Ts.newName(),n=[Po.of(i),_r.of(wc(`.${i}`,e))];return t&&t.dark&&n.push(yc.of(!0)),n}static baseTheme(e){return or.lowest(_r.of(wc("."+vc,e,Pb)))}static findFromDOM(e){var t;let i=e.querySelector(".cm-content"),n=i&&Se.get(i)||Se.get(e);return((t=n==null?void 0:n.rootView)===null||t===void 0?void 0:t.view)||null}}A.styleModule=_r;A.inputHandler=fb;A.focusChangeEffect=pb;A.perLineTextDirection=mb;A.exceptionSink=db;A.updateListener=pc;A.editable=Ra;A.mouseSelectionStyle=ub;A.dragMovesSelection=cb;A.clickAddsSelectionRange=hb;A.decorations=Qr;A.outerDecorations=yb;A.atomicRanges=Du;A.bidiIsolatedRanges=vb;A.scrollMargins=wb;A.darkTheme=yc;A.cspNonce=O.define({combine:s=>s.length?s[0]:""});A.contentAttributes=Mu;A.editorAttributes=bb;A.lineWrapping=A.contentAttributes.of({class:"cm-lineWrapping"});A.announce=ee.define();const zx=4096,mf={};class Jl{constructor(e,t,i,n,r,o){this.from=e,this.to=t,this.dir=i,this.isolates=n,this.fresh=r,this.order=o}static update(e,t){if(t.empty&&!e.some(r=>r.fresh))return e;let i=[],n=e.length?e[e.length-1].dir:_e.LTR;for(let r=Math.max(0,e.length-10);r<e.length;r++){let o=e[r];o.dir==n&&!t.touchesRange(o.from,o.to)&&i.push(new Jl(t.mapPos(o.from,1),t.mapPos(o.to,-1),o.dir,o.isolates,!1,o.order))}return i}}function gf(s,e,t){for(let i=s.state.facet(e),n=i.length-1;n>=0;n--){let r=i[n],o=typeof r=="function"?r(s):r;o&&ac(o,t)}return t}const Hx=L.mac?"mac":L.windows?"win":L.linux?"linux":"key";function Vx(s,e){const t=s.split(/-(?!$)/);let i=t[t.length-1];i=="Space"&&(i=" ");let n,r,o,l;for(let a=0;a<t.length-1;++a){const h=t[a];if(/^(cmd|meta|m)$/i.test(h))l=!0;else if(/^a(lt)?$/i.test(h))n=!0;else if(/^(c|ctrl|control)$/i.test(h))r=!0;else if(/^s(hift)?$/i.test(h))o=!0;else if(/^mod$/i.test(h))e=="mac"?l=!0:r=!0;else throw new Error("Unrecognized modifier name: "+h)}return n&&(i="Alt-"+i),r&&(i="Ctrl-"+i),l&&(i="Meta-"+i),o&&(i="Shift-"+i),i}function No(s,e,t){return e.altKey&&(s="Alt-"+s),e.ctrlKey&&(s="Ctrl-"+s),e.metaKey&&(s="Meta-"+s),t!==!1&&e.shiftKey&&(s="Shift-"+s),s}const Wx=or.default(A.domEventHandlers({keydown(s,e){return Hb(zb(e.state),s,e,"editor")}})),Ta=O.define({enables:Wx}),bf=new WeakMap;function zb(s){let e=s.facet(Ta),t=bf.get(e);return t||bf.set(e,t=Gx(e.reduce((i,n)=>i.concat(n),[]))),t}function Ux(s,e,t){return Hb(zb(s.state),e,s,t)}let cs=null;const jx=4e3;function Gx(s,e=Hx){let t=Object.create(null),i=Object.create(null),n=(o,l)=>{let a=i[o];if(a==null)i[o]=l;else if(a!=l)throw new Error("Key binding "+o+" is used both as a regular binding and as a multi-stroke prefix")},r=(o,l,a,h,c)=>{var u,d;let f=t[o]||(t[o]=Object.create(null)),p=l.split(/ (?!$)/).map(b=>Vx(b,e));for(let b=1;b<p.length;b++){let v=p.slice(0,b).join(" ");n(v,!0),f[v]||(f[v]={preventDefault:!0,stopPropagation:!1,run:[C=>{let x=cs={view:C,prefix:v,scope:o};return setTimeout(()=>{cs==x&&(cs=null)},jx),!0}]})}let m=p.join(" ");n(m,!1);let g=f[m]||(f[m]={preventDefault:!1,stopPropagation:!1,run:((d=(u=f._any)===null||u===void 0?void 0:u.run)===null||d===void 0?void 0:d.slice())||[]});a&&g.run.push(a),h&&(g.preventDefault=!0),c&&(g.stopPropagation=!0)};for(let o of s){let l=o.scope?o.scope.split(" "):["editor"];if(o.any)for(let h of l){let c=t[h]||(t[h]=Object.create(null));c._any||(c._any={preventDefault:!1,stopPropagation:!1,run:[]});for(let u in c)c[u].run.push(o.any)}let a=o[e]||o.key;if(a)for(let h of l)r(h,a,o.run,o.preventDefault,o.stopPropagation),o.shift&&r(h,"Shift-"+a,o.shift,o.preventDefault,o.stopPropagation)}return t}function Hb(s,e,t,i){let n=mE(e),r=Qe(n,0),o=qt(r)==n.length&&n!=" ",l="",a=!1,h=!1,c=!1;cs&&cs.view==t&&cs.scope==i&&(l=cs.prefix+" ",_b.indexOf(e.keyCode)<0&&(h=!0,cs=null));let u=new Set,d=g=>{if(g){for(let b of g.run)if(!u.has(b)&&(u.add(b),b(t,e)))return g.stopPropagation&&(c=!0),!0;g.preventDefault&&(g.stopPropagation&&(c=!0),h=!0)}return!1},f=s[i],p,m;return f&&(d(f[l+No(n,e,!o)])?a=!0:o&&(e.altKey||e.metaKey||e.ctrlKey)&&!(L.windows&&e.ctrlKey&&e.altKey)&&(p=Ms[e.keyCode])&&p!=n?(d(f[l+No(p,e,!0)])||e.shiftKey&&(m=Kr[e.keyCode])!=n&&m!=p&&d(f[l+No(m,e,!1)]))&&(a=!0):o&&e.shiftKey&&d(f[l+No(n,e,!0)])&&(a=!0),!a&&d(f._any)&&(a=!0)),h&&(a=!0),a&&c&&e.stopPropagation(),a}class mo{constructor(e,t,i,n,r){this.className=e,this.left=t,this.top=i,this.width=n,this.height=r}draw(){let e=document.createElement("div");return e.className=this.className,this.adjust(e),e}update(e,t){return t.className!=this.className?!1:(this.adjust(e),!0)}adjust(e){e.style.left=this.left+"px",e.style.top=this.top+"px",this.width!=null&&(e.style.width=this.width+"px"),e.style.height=this.height+"px"}eq(e){return this.left==e.left&&this.top==e.top&&this.width==e.width&&this.height==e.height&&this.className==e.className}static forRange(e,t,i){if(i.empty){let n=e.coordsAtPos(i.head,i.assoc||1);if(!n)return[];let r=Vb(e);return[new mo(t,n.left-r.left,n.top-r.top,null,n.bottom-n.top)]}else return qx(e,t,i)}}function Vb(s){let e=s.scrollDOM.getBoundingClientRect();return{left:(s.textDirection==_e.LTR?e.left:e.right-s.scrollDOM.clientWidth*s.scaleX)-s.scrollDOM.scrollLeft*s.scaleX,top:e.top-s.scrollDOM.scrollTop*s.scaleY}}function yf(s,e,t){let i=S.cursor(e);return{from:Math.max(t.from,s.moveToLineBoundary(i,!1,!0).from),to:Math.min(t.to,s.moveToLineBoundary(i,!0,!0).from),type:dt.Text}}function qx(s,e,t){if(t.to<=s.viewport.from||t.from>=s.viewport.to)return[];let i=Math.max(t.from,s.viewport.from),n=Math.min(t.to,s.viewport.to),r=s.textDirection==_e.LTR,o=s.contentDOM,l=o.getBoundingClientRect(),a=Vb(s),h=o.querySelector(".cm-line"),c=h&&window.getComputedStyle(h),u=l.left+(c?parseInt(c.paddingLeft)+Math.min(0,parseInt(c.textIndent)):0),d=l.right-(c?parseInt(c.paddingRight):0),f=gc(s,i),p=gc(s,n),m=f.type==dt.Text?f:null,g=p.type==dt.Text?p:null;if(m&&(s.lineWrapping||f.widgetLineBreaks)&&(m=yf(s,i,m)),g&&(s.lineWrapping||p.widgetLineBreaks)&&(g=yf(s,n,g)),m&&g&&m.from==g.from)return v(C(t.from,t.to,m));{let w=m?C(t.from,null,m):x(f,!1),E=g?C(null,t.to,g):x(p,!0),k=[];return(m||f).to<(g||p).from-(m&&g?1:0)||f.widgetLineBreaks>1&&w.bottom+s.defaultLineHeight/2<E.top?k.push(b(u,w.bottom,d,E.top)):w.bottom<E.top&&s.elementAtHeight((w.bottom+E.top)/2).type==dt.Text&&(w.bottom=E.top=(w.bottom+E.top)/2),v(w).concat(k).concat(v(E))}function b(w,E,k,R){return new mo(e,w-a.left,E-a.top-.01,k-w,R-E+.01)}function v({top:w,bottom:E,horizontal:k}){let R=[];for(let P=0;P<k.length;P+=2)R.push(b(k[P],w,k[P+1],E));return R}function C(w,E,k){let R=1e9,P=-1e9,q=[];function N(X,be,qe,Ne,I){let M=s.coordsAtPos(X,X==k.to?-2:2),re=s.coordsAtPos(qe,qe==k.from?2:-2);!M||!re||(R=Math.min(M.top,re.top,R),P=Math.max(M.bottom,re.bottom,P),I==_e.LTR?q.push(r&&be?u:M.left,r&&Ne?d:re.right):q.push(!r&&Ne?u:re.left,!r&&be?d:M.right))}let D=w??k.from,ce=E??k.to;for(let X of s.visibleRanges)if(X.to>D&&X.from<ce)for(let be=Math.max(X.from,D),qe=Math.min(X.to,ce);;){let Ne=s.state.doc.lineAt(be);for(let I of s.bidiSpans(Ne)){let M=I.from+Ne.from,re=I.to+Ne.from;if(M>=qe)break;re>be&&N(Math.max(M,be),w==null&&M<=D,Math.min(re,qe),E==null&&re>=ce,I.dir)}if(be=Ne.to+1,be>=qe)break}return q.length==0&&N(D,w==null,ce,E==null,s.textDirection),{top:R,bottom:P,horizontal:q}}function x(w,E){let k=l.top+(E?w.top:w.bottom);return{top:k,bottom:k,horizontal:[]}}}function $x(s,e){return s.constructor==e.constructor&&s.eq(e)}class Kx{constructor(e,t){this.view=e,this.layer=t,this.drawn=[],this.scaleX=1,this.scaleY=1,this.measureReq={read:this.measure.bind(this),write:this.draw.bind(this)},this.dom=e.scrollDOM.appendChild(document.createElement("div")),this.dom.classList.add("cm-layer"),t.above&&this.dom.classList.add("cm-layer-above"),t.class&&this.dom.classList.add(t.class),this.scale(),this.dom.setAttribute("aria-hidden","true"),this.setOrder(e.state),e.requestMeasure(this.measureReq),t.mount&&t.mount(this.dom,e)}update(e){e.startState.facet(cl)!=e.state.facet(cl)&&this.setOrder(e.state),(this.layer.update(e,this.dom)||e.geometryChanged)&&(this.scale(),e.view.requestMeasure(this.measureReq))}setOrder(e){let t=0,i=e.facet(cl);for(;t<i.length&&i[t]!=this.layer;)t++;this.dom.style.zIndex=String((this.layer.above?150:-1)-t)}measure(){return this.layer.markers(this.view)}scale(){let{scaleX:e,scaleY:t}=this.view;(e!=this.scaleX||t!=this.scaleY)&&(this.scaleX=e,this.scaleY=t,this.dom.style.transform=`scale(${1/e}, ${1/t})`)}draw(e){if(e.length!=this.drawn.length||e.some((t,i)=>!$x(t,this.drawn[i]))){let t=this.dom.firstChild,i=0;for(let n of e)n.update&&t&&n.constructor&&this.drawn[i].constructor&&n.update(t,this.drawn[i])?(t=t.nextSibling,i++):this.dom.insertBefore(n.draw(),t);for(;t;){let n=t.nextSibling;t.remove(),t=n}this.drawn=e}}destroy(){this.layer.destroy&&this.layer.destroy(this.dom,this.view),this.dom.remove()}}const cl=O.define();function Wb(s){return[Pe.define(e=>new Kx(e,s)),cl.of(s)]}const Ub=!L.ios,Jr=O.define({combine(s){return Ni(s,{cursorBlinkRate:1200,drawRangeCursor:!0},{cursorBlinkRate:(e,t)=>Math.min(e,t),drawRangeCursor:(e,t)=>e||t})}});function Yx(s={}){return[Jr.of(s),Qx,Jx,Xx,gb.of(!0)]}function jb(s){return s.startState.facet(Jr)!=s.state.facet(Jr)}const Qx=Wb({above:!0,markers(s){let{state:e}=s,t=e.facet(Jr),i=[];for(let n of e.selection.ranges){let r=n==e.selection.main;if(n.empty?!r||Ub:t.drawRangeCursor){let o=r?"cm-cursor cm-cursor-primary":"cm-cursor cm-cursor-secondary",l=n.empty?n:S.cursor(n.head,n.head>n.anchor?-1:1);for(let a of mo.forRange(s,o,l))i.push(a)}}return i},update(s,e){s.transactions.some(i=>i.selection)&&(e.style.animationName=e.style.animationName=="cm-blink"?"cm-blink2":"cm-blink");let t=jb(s);return t&&vf(s.state,e),s.docChanged||s.selectionSet||t},mount(s,e){vf(e.state,s)},class:"cm-cursorLayer"});function vf(s,e){e.style.animationDuration=s.facet(Jr).cursorBlinkRate+"ms"}const Jx=Wb({above:!1,markers(s){return s.state.selection.ranges.map(e=>e.empty?[]:mo.forRange(s,"cm-selectionBackground",e)).reduce((e,t)=>e.concat(t))},update(s,e){return s.docChanged||s.selectionSet||s.viewportChanged||jb(s)},class:"cm-selectionLayer"}),Cc={".cm-line":{"& ::selection":{backgroundColor:"transparent !important"},"&::selection":{backgroundColor:"transparent !important"}}};Ub&&(Cc[".cm-line"].caretColor="transparent !important",Cc[".cm-content"]={caretColor:"transparent !important"});const Xx=or.highest(A.theme(Cc)),Gb=ee.define({map(s,e){return s==null?null:e.mapPos(s)}}),Mr=it.define({create(){return null},update(s,e){return s!=null&&(s=e.changes.mapPos(s)),e.effects.reduce((t,i)=>i.is(Gb)?i.value:t,s)}}),Zx=Pe.fromClass(class{constructor(s){this.view=s,this.cursor=null,this.measureReq={read:this.readPos.bind(this),write:this.drawCursor.bind(this)}}update(s){var e;let t=s.state.field(Mr);t==null?this.cursor!=null&&((e=this.cursor)===null||e===void 0||e.remove(),this.cursor=null):(this.cursor||(this.cursor=this.view.scrollDOM.appendChild(document.createElement("div")),this.cursor.className="cm-dropCursor"),(s.startState.field(Mr)!=t||s.docChanged||s.geometryChanged)&&this.view.requestMeasure(this.measureReq))}readPos(){let{view:s}=this,e=s.state.field(Mr),t=e!=null&&s.coordsAtPos(e);if(!t)return null;let i=s.scrollDOM.getBoundingClientRect();return{left:t.left-i.left+s.scrollDOM.scrollLeft*s.scaleX,top:t.top-i.top+s.scrollDOM.scrollTop*s.scaleY,height:t.bottom-t.top}}drawCursor(s){if(this.cursor){let{scaleX:e,scaleY:t}=this.view;s?(this.cursor.style.left=s.left/e+"px",this.cursor.style.top=s.top/t+"px",this.cursor.style.height=s.height/t+"px"):this.cursor.style.left="-100000px"}}destroy(){this.cursor&&this.cursor.remove()}setDropPos(s){this.view.state.field(Mr)!=s&&this.view.dispatch({effects:Gb.of(s)})}},{eventObservers:{dragover(s){this.setDropPos(this.view.posAtCoords({x:s.clientX,y:s.clientY}))},dragleave(s){(s.target==this.view.contentDOM||!this.view.contentDOM.contains(s.relatedTarget))&&this.setDropPos(null)},dragend(){this.setDropPos(null)},drop(){this.setDropPos(null)}}});function ek(){return[Mr,Zx]}function wf(s,e,t,i,n){e.lastIndex=0;for(let r=s.iterRange(t,i),o=t,l;!r.next().done;o+=r.value.length)if(!r.lineBreak)for(;l=e.exec(r.value);)n(o+l.index,l)}function tk(s,e){let t=s.visibleRanges;if(t.length==1&&t[0].from==s.viewport.from&&t[0].to==s.viewport.to)return t;let i=[];for(let{from:n,to:r}of t)n=Math.max(s.state.doc.lineAt(n).from,n-e),r=Math.min(s.state.doc.lineAt(r).to,r+e),i.length&&i[i.length-1].to>=n?i[i.length-1].to=r:i.push({from:n,to:r});return i}class ik{constructor(e){const{regexp:t,decoration:i,decorate:n,boundary:r,maxLength:o=1e3}=e;if(!t.global)throw new RangeError("The regular expression given to MatchDecorator should have its 'g' flag set");if(this.regexp=t,n)this.addMatch=(l,a,h,c)=>n(c,h,h+l[0].length,l,a);else if(typeof i=="function")this.addMatch=(l,a,h,c)=>{let u=i(l,a,h);u&&c(h,h+l[0].length,u)};else if(i)this.addMatch=(l,a,h,c)=>c(h,h+l[0].length,i);else throw new RangeError("Either 'decorate' or 'decoration' should be provided to MatchDecorator");this.boundary=r,this.maxLength=o}createDeco(e){let t=new Rs,i=t.add.bind(t);for(let{from:n,to:r}of tk(e,this.maxLength))wf(e.state.doc,this.regexp,n,r,(o,l)=>this.addMatch(l,e,o,i));return t.finish()}updateDeco(e,t){let i=1e9,n=-1;return e.docChanged&&e.changes.iterChanges((r,o,l,a)=>{a>e.view.viewport.from&&l<e.view.viewport.to&&(i=Math.min(l,i),n=Math.max(a,n))}),e.viewportChanged||n-i>1e3?this.createDeco(e.view):n>-1?this.updateRange(e.view,t.map(e.changes),i,n):t}updateRange(e,t,i,n){for(let r of e.visibleRanges){let o=Math.max(r.from,i),l=Math.min(r.to,n);if(l>o){let a=e.state.doc.lineAt(o),h=a.to<l?e.state.doc.lineAt(l):a,c=Math.max(r.from,a.from),u=Math.min(r.to,h.to);if(this.boundary){for(;o>a.from;o--)if(this.boundary.test(a.text[o-1-a.from])){c=o;break}for(;l<h.to;l++)if(this.boundary.test(h.text[l-h.from])){u=l;break}}let d=[],f,p=(m,g,b)=>d.push(b.range(m,g));if(a==h)for(this.regexp.lastIndex=c-a.from;(f=this.regexp.exec(a.text))&&f.index<u-a.from;)this.addMatch(f,e,f.index+a.from,p);else wf(e.state.doc,this.regexp,c,u,(m,g)=>this.addMatch(g,e,m,p));t=t.update({filterFrom:c,filterTo:u,filter:(m,g)=>m<c||g>u,add:d})}}return t}}const Ec=/x/.unicode!=null?"gu":"g",sk=new RegExp(`[\0-\b
--\u2028\u2029\uFEFF-]`,Ec),nk={0:"null",7:"bell",8:"backspace",10:"newline",11:"vertical tab",13:"carriage return",27:"escape",8203:"zero width space",8204:"zero width non-joiner",8205:"zero width joiner",8206:"left-to-right mark",8207:"right-to-left mark",8232:"line separator",8237:"left-to-right override",8238:"right-to-left override",8294:"left-to-right isolate",8295:"right-to-left isolate",8297:"pop directional isolate",8233:"paragraph separator",65279:"zero width no-break space",65532:"object replacement"};let ch=null;function rk(){var s;if(ch==null&&typeof document<"u"&&document.body){let e=document.body.style;ch=((s=e.tabSize)!==null&&s!==void 0?s:e.MozTabSize)!=null}return ch||!1}const ul=O.define({combine(s){let e=Ni(s,{render:null,specialChars:sk,addSpecialChars:null});return(e.replaceTabs=!rk())&&(e.specialChars=new RegExp("	|"+e.specialChars.source,Ec)),e.addSpecialChars&&(e.specialChars=new RegExp(e.specialChars.source+"|"+e.addSpecialChars.source,Ec)),e}});function ok(s={}){return[ul.of(s),lk()]}let Cf=null;function lk(){return Cf||(Cf=Pe.fromClass(class{constructor(s){this.view=s,this.decorations=F.none,this.decorationCache=Object.create(null),this.decorator=this.makeDecorator(s.state.facet(ul)),this.decorations=this.decorator.createDeco(s)}makeDecorator(s){return new ik({regexp:s.specialChars,decoration:(e,t,i)=>{let{doc:n}=t.state,r=Qe(e[0],0);if(r==9){let o=n.lineAt(i),l=t.state.tabSize,a=lr(o.text,l,i-o.from);return F.replace({widget:new uk((l-a%l)*this.view.defaultCharacterWidth/this.view.scaleX)})}return this.decorationCache[r]||(this.decorationCache[r]=F.replace({widget:new ck(s,r)}))},boundary:s.replaceTabs?void 0:/[^]/})}update(s){let e=s.state.facet(ul);s.startState.facet(ul)!=e?(this.decorator=this.makeDecorator(e),this.decorations=this.decorator.createDeco(s.view)):this.decorations=this.decorator.updateDeco(s,this.decorations)}},{decorations:s=>s.decorations}))}const ak="";function hk(s){return s>=32?ak:s==10?"":String.fromCharCode(9216+s)}class ck extends ss{constructor(e,t){super(),this.options=e,this.code=t}eq(e){return e.code==this.code}toDOM(e){let t=hk(this.code),i=e.state.phrase("Control character")+" "+(nk[this.code]||"0x"+this.code.toString(16)),n=this.options.render&&this.options.render(this.code,i,t);if(n)return n;let r=document.createElement("span");return r.textContent=t,r.title=i,r.setAttribute("aria-label",i),r.className="cm-specialChar",r}ignoreEvent(){return!1}}class uk extends ss{constructor(e){super(),this.width=e}eq(e){return e.width==this.width}toDOM(){let e=document.createElement("span");return e.textContent="	",e.className="cm-tab",e.style.width=this.width+"px",e}ignoreEvent(){return!1}}function dk(){return pk}const fk=F.line({class:"cm-activeLine"}),pk=Pe.fromClass(class{constructor(s){this.decorations=this.getDeco(s)}update(s){(s.docChanged||s.selectionSet)&&(this.decorations=this.getDeco(s.view))}getDeco(s){let e=-1,t=[];for(let i of s.state.selection.ranges){let n=s.lineBlockAt(i.head);n.from>e&&(t.push(fk.range(n.from)),e=n.from)}return F.set(t)}},{decorations:s=>s.decorations});class mk extends ss{constructor(e){super(),this.content=e}toDOM(){let e=document.createElement("span");return e.className="cm-placeholder",e.style.pointerEvents="none",e.appendChild(typeof this.content=="string"?document.createTextNode(this.content):this.content),typeof this.content=="string"?e.setAttribute("aria-label","placeholder "+this.content):e.setAttribute("aria-hidden","true"),e}coordsAt(e){let t=e.firstChild?Yn(e.firstChild):[];if(!t.length)return null;let i=window.getComputedStyle(e.parentNode),n=Sa(t[0],i.direction!="rtl"),r=parseInt(i.lineHeight);return n.bottom-n.top>r*1.5?{left:n.left,right:n.right,top:n.top,bottom:n.top+r}:n}ignoreEvent(){return!1}}function gk(s){return Pe.fromClass(class{constructor(e){this.view=e,this.placeholder=s?F.set([F.widget({widget:new mk(s),side:1}).range(0)]):F.none}get decorations(){return this.view.state.doc.length?F.none:this.placeholder}},{decorations:e=>e.decorations})}const xc=2e3;function bk(s,e,t){let i=Math.min(e.line,t.line),n=Math.max(e.line,t.line),r=[];if(e.off>xc||t.off>xc||e.col<0||t.col<0){let o=Math.min(e.off,t.off),l=Math.max(e.off,t.off);for(let a=i;a<=n;a++){let h=s.doc.line(a);h.length<=l&&r.push(S.range(h.from+o,h.to+l))}}else{let o=Math.min(e.col,t.col),l=Math.max(e.col,t.col);for(let a=i;a<=n;a++){let h=s.doc.line(a),c=tc(h.text,o,s.tabSize,!0);if(c<0)r.push(S.cursor(h.to));else{let u=tc(h.text,l,s.tabSize);r.push(S.range(h.from+c,h.from+u))}}}return r}function yk(s,e){let t=s.coordsAtPos(s.viewport.from);return t?Math.round(Math.abs((t.left-e)/s.defaultCharacterWidth)):-1}function Ef(s,e){let t=s.posAtCoords({x:e.clientX,y:e.clientY},!1),i=s.state.doc.lineAt(t),n=t-i.from,r=n>xc?-1:n==i.length?yk(s,e.clientX):lr(i.text,s.state.tabSize,t-i.from);return{line:i.number,col:r,off:n}}function vk(s,e){let t=Ef(s,e),i=s.state.selection;return t?{update(n){if(n.docChanged){let r=n.changes.mapPos(n.startState.doc.line(t.line).from),o=n.state.doc.lineAt(r);t={line:o.number,col:t.col,off:Math.min(t.off,o.length)},i=i.map(n.changes)}},get(n,r,o){let l=Ef(s,n);if(!l)return i;let a=bk(s.state,t,l);return a.length?o?S.create(a.concat(i.ranges)):S.create(a):i}}:null}function wk(s){let e=(s==null?void 0:s.eventFilter)||(t=>t.altKey&&t.button==0);return A.mouseSelectionStyle.of((t,i)=>e(i)?vk(t,i):null)}const Ck={Alt:[18,s=>!!s.altKey],Control:[17,s=>!!s.ctrlKey],Shift:[16,s=>!!s.shiftKey],Meta:[91,s=>!!s.metaKey]},Ek={style:"cursor: crosshair"};function xk(s={}){let[e,t]=Ck[s.key||"Alt"],i=Pe.fromClass(class{constructor(n){this.view=n,this.isDown=!1}set(n){this.isDown!=n&&(this.isDown=n,this.view.update([]))}},{eventObservers:{keydown(n){this.set(n.keyCode==e||t(n))},keyup(n){(n.keyCode==e||!t(n))&&this.set(!1)},mousemove(n){this.set(t(n))}}});return[i,A.contentAttributes.of(n=>{var r;return!((r=n.plugin(i))===null||r===void 0)&&r.isDown?Ek:null})]}const pr="-10000px";class qb{constructor(e,t,i,n){this.facet=t,this.createTooltipView=i,this.removeTooltipView=n,this.input=e.state.facet(t),this.tooltips=this.input.filter(o=>o);let r=null;this.tooltipViews=this.tooltips.map(o=>r=i(o,r))}update(e,t){var i;let n=e.state.facet(this.facet),r=n.filter(a=>a);if(n===this.input){for(let a of this.tooltipViews)a.update&&a.update(e);return!1}let o=[],l=t?[]:null;for(let a=0;a<r.length;a++){let h=r[a],c=-1;if(h){for(let u=0;u<this.tooltips.length;u++){let d=this.tooltips[u];d&&d.create==h.create&&(c=u)}if(c<0)o[a]=this.createTooltipView(h,a?o[a-1]:null),l&&(l[a]=!!h.above);else{let u=o[a]=this.tooltipViews[c];l&&(l[a]=t[c]),u.update&&u.update(e)}}}for(let a of this.tooltipViews)o.indexOf(a)<0&&(this.removeTooltipView(a),(i=a.destroy)===null||i===void 0||i.call(a));return t&&(l.forEach((a,h)=>t[h]=a),t.length=l.length),this.input=n,this.tooltips=r,this.tooltipViews=o,!0}}function kk(s){let{win:e}=s;return{top:0,left:0,bottom:e.innerHeight,right:e.innerWidth}}const uh=O.define({combine:s=>{var e,t,i;return{position:L.ios?"absolute":((e=s.find(n=>n.position))===null||e===void 0?void 0:e.position)||"fixed",parent:((t=s.find(n=>n.parent))===null||t===void 0?void 0:t.parent)||null,tooltipSpace:((i=s.find(n=>n.tooltipSpace))===null||i===void 0?void 0:i.tooltipSpace)||kk}}}),xf=new WeakMap,Ou=Pe.fromClass(class{constructor(s){this.view=s,this.above=[],this.inView=!0,this.madeAbsolute=!1,this.lastTransaction=0,this.measureTimeout=-1;let e=s.state.facet(uh);this.position=e.position,this.parent=e.parent,this.classes=s.themeClasses,this.createContainer(),this.measureReq={read:this.readMeasure.bind(this),write:this.writeMeasure.bind(this),key:this},this.resizeObserver=typeof ResizeObserver=="function"?new ResizeObserver(()=>this.measureSoon()):null,this.manager=new qb(s,Lu,(t,i)=>this.createTooltip(t,i),t=>{this.resizeObserver&&this.resizeObserver.unobserve(t.dom),t.dom.remove()}),this.above=this.manager.tooltips.map(t=>!!t.above),this.intersectionObserver=typeof IntersectionObserver=="function"?new IntersectionObserver(t=>{Date.now()>this.lastTransaction-50&&t.length>0&&t[t.length-1].intersectionRatio<1&&this.measureSoon()},{threshold:[1]}):null,this.observeIntersection(),s.win.addEventListener("resize",this.measureSoon=this.measureSoon.bind(this)),this.maybeMeasure()}createContainer(){this.parent?(this.container=document.createElement("div"),this.container.style.position="relative",this.container.className=this.view.themeClasses,this.parent.appendChild(this.container)):this.container=this.view.dom}observeIntersection(){if(this.intersectionObserver){this.intersectionObserver.disconnect();for(let s of this.manager.tooltipViews)this.intersectionObserver.observe(s.dom)}}measureSoon(){this.measureTimeout<0&&(this.measureTimeout=setTimeout(()=>{this.measureTimeout=-1,this.maybeMeasure()},50))}update(s){s.transactions.length&&(this.lastTransaction=Date.now());let e=this.manager.update(s,this.above);e&&this.observeIntersection();let t=e||s.geometryChanged,i=s.state.facet(uh);if(i.position!=this.position&&!this.madeAbsolute){this.position=i.position;for(let n of this.manager.tooltipViews)n.dom.style.position=this.position;t=!0}if(i.parent!=this.parent){this.parent&&this.container.remove(),this.parent=i.parent,this.createContainer();for(let n of this.manager.tooltipViews)this.container.appendChild(n.dom);t=!0}else this.parent&&this.view.themeClasses!=this.classes&&(this.classes=this.container.className=this.view.themeClasses);t&&this.maybeMeasure()}createTooltip(s,e){let t=s.create(this.view),i=e?e.dom:null;if(t.dom.classList.add("cm-tooltip"),s.arrow&&!t.dom.querySelector(".cm-tooltip > .cm-tooltip-arrow")){let n=document.createElement("div");n.className="cm-tooltip-arrow",t.dom.insertBefore(n,i)}return t.dom.style.position=this.position,t.dom.style.top=pr,t.dom.style.left="0px",this.container.insertBefore(t.dom,i),t.mount&&t.mount(this.view),this.resizeObserver&&this.resizeObserver.observe(t.dom),t}destroy(){var s,e,t;this.view.win.removeEventListener("resize",this.measureSoon);for(let i of this.manager.tooltipViews)i.dom.remove(),(s=i.destroy)===null||s===void 0||s.call(i);this.parent&&this.container.remove(),(e=this.resizeObserver)===null||e===void 0||e.disconnect(),(t=this.intersectionObserver)===null||t===void 0||t.disconnect(),clearTimeout(this.measureTimeout)}readMeasure(){let s=this.view.dom.getBoundingClientRect(),e=1,t=1,i=!1;if(this.position=="fixed"&&this.manager.tooltipViews.length){let{dom:n}=this.manager.tooltipViews[0];if(L.gecko)i=n.offsetParent!=this.container.ownerDocument.body;else if(n.style.top==pr&&n.style.left=="0px"){let r=n.getBoundingClientRect();i=Math.abs(r.top+1e4)>1||Math.abs(r.left)>1}}if(i||this.position=="absolute")if(this.parent){let n=this.parent.getBoundingClientRect();n.width&&n.height&&(e=n.width/this.parent.offsetWidth,t=n.height/this.parent.offsetHeight)}else({scaleX:e,scaleY:t}=this.view.viewState);return{editor:s,parent:this.parent?this.container.getBoundingClientRect():s,pos:this.manager.tooltips.map((n,r)=>{let o=this.manager.tooltipViews[r];return o.getCoords?o.getCoords(n.pos):this.view.coordsAtPos(n.pos)}),size:this.manager.tooltipViews.map(({dom:n})=>n.getBoundingClientRect()),space:this.view.state.facet(uh).tooltipSpace(this.view),scaleX:e,scaleY:t,makeAbsolute:i}}writeMeasure(s){var e;if(s.makeAbsolute){this.madeAbsolute=!0,this.position="absolute";for(let l of this.manager.tooltipViews)l.dom.style.position="absolute"}let{editor:t,space:i,scaleX:n,scaleY:r}=s,o=[];for(let l=0;l<this.manager.tooltips.length;l++){let a=this.manager.tooltips[l],h=this.manager.tooltipViews[l],{dom:c}=h,u=s.pos[l],d=s.size[l];if(!u||u.bottom<=Math.max(t.top,i.top)||u.top>=Math.min(t.bottom,i.bottom)||u.right<Math.max(t.left,i.left)-.1||u.left>Math.min(t.right,i.right)+.1){c.style.top=pr;continue}let f=a.arrow?h.dom.querySelector(".cm-tooltip-arrow"):null,p=f?7:0,m=d.right-d.left,g=(e=xf.get(h))!==null&&e!==void 0?e:d.bottom-d.top,b=h.offset||_k,v=this.view.textDirection==_e.LTR,C=d.width>i.right-i.left?v?i.left:i.right-d.width:v?Math.min(u.left-(f?14:0)+b.x,i.right-m):Math.max(i.left,u.left-m+(f?14:0)-b.x),x=this.above[l];!a.strictSide&&(x?u.top-(d.bottom-d.top)-b.y<i.top:u.bottom+(d.bottom-d.top)+b.y>i.bottom)&&x==i.bottom-u.bottom>u.top-i.top&&(x=this.above[l]=!x);let w=(x?u.top-i.top:i.bottom-u.bottom)-p;if(w<g&&h.resize!==!1){if(w<this.view.defaultLineHeight){c.style.top=pr;continue}xf.set(h,g),c.style.height=(g=w)/r+"px"}else c.style.height&&(c.style.height="");let E=x?u.top-g-p-b.y:u.bottom+p+b.y,k=C+m;if(h.overlap!==!0)for(let R of o)R.left<k&&R.right>C&&R.top<E+g&&R.bottom>E&&(E=x?R.top-g-2-p:R.bottom+p+2);if(this.position=="absolute"?(c.style.top=(E-s.parent.top)/r+"px",c.style.left=(C-s.parent.left)/n+"px"):(c.style.top=E/r+"px",c.style.left=C/n+"px"),f){let R=u.left+(v?b.x:-b.x)-(C+14-7);f.style.left=R/n+"px"}h.overlap!==!0&&o.push({left:C,top:E,right:k,bottom:E+g}),c.classList.toggle("cm-tooltip-above",x),c.classList.toggle("cm-tooltip-below",!x),h.positioned&&h.positioned(s.space)}}maybeMeasure(){if(this.manager.tooltips.length&&(this.view.inView&&this.view.requestMeasure(this.measureReq),this.inView!=this.view.inView&&(this.inView=this.view.inView,!this.inView)))for(let s of this.manager.tooltipViews)s.dom.style.top=pr}},{eventObservers:{scroll(){this.maybeMeasure()}}}),Sk=A.baseTheme({".cm-tooltip":{zIndex:100,boxSizing:"border-box"},"&light .cm-tooltip":{border:"1px solid #bbb",backgroundColor:"#f5f5f5"},"&light .cm-tooltip-section:not(:first-child)":{borderTop:"1px solid #bbb"},"&dark .cm-tooltip":{backgroundColor:"#333338",color:"white"},".cm-tooltip-arrow":{height:"7px",width:`${7*2}px`,position:"absolute",zIndex:-1,overflow:"hidden","&:before, &:after":{content:"''",position:"absolute",width:0,height:0,borderLeft:"7px solid transparent",borderRight:"7px solid transparent"},".cm-tooltip-above &":{bottom:"-7px","&:before":{borderTop:"7px solid #bbb"},"&:after":{borderTop:"7px solid #f5f5f5",bottom:"1px"}},".cm-tooltip-below &":{top:"-7px","&:before":{borderBottom:"7px solid #bbb"},"&:after":{borderBottom:"7px solid #f5f5f5",top:"1px"}}},"&dark .cm-tooltip .cm-tooltip-arrow":{"&:before":{borderTopColor:"#333338",borderBottomColor:"#333338"},"&:after":{borderTopColor:"transparent",borderBottomColor:"transparent"}}}),_k={x:0,y:0},Lu=O.define({enables:[Ou,Sk]}),Xl=O.define({combine:s=>s.reduce((e,t)=>e.concat(t),[])});class Ma{static create(e){return new Ma(e)}constructor(e){this.view=e,this.mounted=!1,this.dom=document.createElement("div"),this.dom.classList.add("cm-tooltip-hover"),this.manager=new qb(e,Xl,(t,i)=>this.createHostedView(t,i),t=>t.dom.remove())}createHostedView(e,t){let i=e.create(this.view);return i.dom.classList.add("cm-tooltip-section"),this.dom.insertBefore(i.dom,t?t.dom.nextSibling:this.dom.firstChild),this.mounted&&i.mount&&i.mount(this.view),i}mount(e){for(let t of this.manager.tooltipViews)t.mount&&t.mount(e);this.mounted=!0}positioned(e){for(let t of this.manager.tooltipViews)t.positioned&&t.positioned(e)}update(e){this.manager.update(e)}destroy(){var e;for(let t of this.manager.tooltipViews)(e=t.destroy)===null||e===void 0||e.call(t)}passProp(e){let t;for(let i of this.manager.tooltipViews){let n=i[e];if(n!==void 0){if(t===void 0)t=n;else if(t!==n)return}}return t}get offset(){return this.passProp("offset")}get getCoords(){return this.passProp("getCoords")}get overlap(){return this.passProp("overlap")}get resize(){return this.passProp("resize")}}const Rk=Lu.compute([Xl],s=>{let e=s.facet(Xl);return e.length===0?null:{pos:Math.min(...e.map(t=>t.pos)),end:Math.max(...e.map(t=>{var i;return(i=t.end)!==null&&i!==void 0?i:t.pos})),create:Ma.create,above:e[0].above,arrow:e.some(t=>t.arrow)}});class Tk{constructor(e,t,i,n,r){this.view=e,this.source=t,this.field=i,this.setHover=n,this.hoverTime=r,this.hoverTimeout=-1,this.restartTimeout=-1,this.pending=null,this.lastMove={x:0,y:0,target:e.dom,time:0},this.checkHover=this.checkHover.bind(this),e.dom.addEventListener("mouseleave",this.mouseleave=this.mouseleave.bind(this)),e.dom.addEventListener("mousemove",this.mousemove=this.mousemove.bind(this))}update(){this.pending&&(this.pending=null,clearTimeout(this.restartTimeout),this.restartTimeout=setTimeout(()=>this.startHover(),20))}get active(){return this.view.state.field(this.field)}checkHover(){if(this.hoverTimeout=-1,this.active.length)return;let e=Date.now()-this.lastMove.time;e<this.hoverTime?this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime-e):this.startHover()}startHover(){clearTimeout(this.restartTimeout);let{view:e,lastMove:t}=this,i=e.docView.nearest(t.target);if(!i)return;let n,r=1;if(i instanceof ds)n=i.posAtStart;else{if(n=e.posAtCoords(t),n==null)return;let l=e.coordsAtPos(n);if(!l||t.y<l.top||t.y>l.bottom||t.x<l.left-e.defaultCharacterWidth||t.x>l.right+e.defaultCharacterWidth)return;let a=e.bidiSpans(e.state.doc.lineAt(n)).find(c=>c.from<=n&&c.to>=n),h=a&&a.dir==_e.RTL?-1:1;r=t.x<l.left?-h:h}let o=this.source(e,n,r);if(o!=null&&o.then){let l=this.pending={pos:n};o.then(a=>{this.pending==l&&(this.pending=null,a&&!(Array.isArray(a)&&!a.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(a)?a:[a])}))},a=>Yt(e.state,a,"hover tooltip"))}else o&&!(Array.isArray(o)&&!o.length)&&e.dispatch({effects:this.setHover.of(Array.isArray(o)?o:[o])})}get tooltip(){let e=this.view.plugin(Ou),t=e?e.manager.tooltips.findIndex(i=>i.create==Ma.create):-1;return t>-1?e.manager.tooltipViews[t]:null}mousemove(e){var t,i;this.lastMove={x:e.clientX,y:e.clientY,target:e.target,time:Date.now()},this.hoverTimeout<0&&(this.hoverTimeout=setTimeout(this.checkHover,this.hoverTime));let{active:n,tooltip:r}=this;if(n.length&&r&&!Mk(r.dom,e)||this.pending){let{pos:o}=n[0]||this.pending,l=(i=(t=n[0])===null||t===void 0?void 0:t.end)!==null&&i!==void 0?i:o;(o==l?this.view.posAtCoords(this.lastMove)!=o:!Dk(this.view,o,l,e.clientX,e.clientY))&&(this.view.dispatch({effects:this.setHover.of([])}),this.pending=null)}}mouseleave(e){clearTimeout(this.hoverTimeout),this.hoverTimeout=-1;let{active:t}=this;if(t.length){let{tooltip:i}=this;i&&i.dom.contains(e.relatedTarget)?this.watchTooltipLeave(i.dom):this.view.dispatch({effects:this.setHover.of([])})}}watchTooltipLeave(e){let t=i=>{e.removeEventListener("mouseleave",t),this.active.length&&!this.view.dom.contains(i.relatedTarget)&&this.view.dispatch({effects:this.setHover.of([])})};e.addEventListener("mouseleave",t)}destroy(){clearTimeout(this.hoverTimeout),this.view.dom.removeEventListener("mouseleave",this.mouseleave),this.view.dom.removeEventListener("mousemove",this.mousemove)}}const zo=4;function Mk(s,e){let t=s.getBoundingClientRect();return e.clientX>=t.left-zo&&e.clientX<=t.right+zo&&e.clientY>=t.top-zo&&e.clientY<=t.bottom+zo}function Dk(s,e,t,i,n,r){let o=s.scrollDOM.getBoundingClientRect(),l=s.documentTop+s.documentPadding.top+s.contentHeight;if(o.left>i||o.right<i||o.top>n||Math.min(o.bottom,l)<n)return!1;let a=s.posAtCoords({x:i,y:n},!1);return a>=e&&a<=t}function Ak(s,e={}){let t=ee.define(),i=it.define({create(){return[]},update(n,r){if(n.length&&(e.hideOnChange&&(r.docChanged||r.selection)?n=[]:e.hideOn&&(n=n.filter(o=>!e.hideOn(r,o))),r.docChanged))for(let o of n){let l=r.changes.mapPos(o.pos,-1,ut.TrackDel);if(l!=null){let a=Object.assign(Object.create(null),o);a.pos=l,a.end!=null&&(a.end=r.changes.mapPos(a.end))}}for(let o of r.effects)o.is(t)&&(n=o.value),o.is(Ok)&&(n=[]);return n},provide:n=>Xl.from(n)});return[i,Pe.define(n=>new Tk(n,s,i,t,e.hoverTime||300)),Rk]}function $b(s,e){let t=s.plugin(Ou);if(!t)return null;let i=t.manager.tooltips.indexOf(e);return i<0?null:t.manager.tooltipViews[i]}const Ok=ee.define(),kf=O.define({combine(s){let e,t;for(let i of s)e=e||i.topContainer,t=t||i.bottomContainer;return{topContainer:e,bottomContainer:t}}});function Xr(s,e){let t=s.plugin(Kb),i=t?t.specs.indexOf(e):-1;return i>-1?t.panels[i]:null}const Kb=Pe.fromClass(class{constructor(s){this.input=s.state.facet(Zr),this.specs=this.input.filter(t=>t),this.panels=this.specs.map(t=>t(s));let e=s.state.facet(kf);this.top=new Ho(s,!0,e.topContainer),this.bottom=new Ho(s,!1,e.bottomContainer),this.top.sync(this.panels.filter(t=>t.top)),this.bottom.sync(this.panels.filter(t=>!t.top));for(let t of this.panels)t.dom.classList.add("cm-panel"),t.mount&&t.mount()}update(s){let e=s.state.facet(kf);this.top.container!=e.topContainer&&(this.top.sync([]),this.top=new Ho(s.view,!0,e.topContainer)),this.bottom.container!=e.bottomContainer&&(this.bottom.sync([]),this.bottom=new Ho(s.view,!1,e.bottomContainer)),this.top.syncClasses(),this.bottom.syncClasses();let t=s.state.facet(Zr);if(t!=this.input){let i=t.filter(a=>a),n=[],r=[],o=[],l=[];for(let a of i){let h=this.specs.indexOf(a),c;h<0?(c=a(s.view),l.push(c)):(c=this.panels[h],c.update&&c.update(s)),n.push(c),(c.top?r:o).push(c)}this.specs=i,this.panels=n,this.top.sync(r),this.bottom.sync(o);for(let a of l)a.dom.classList.add("cm-panel"),a.mount&&a.mount()}else for(let i of this.panels)i.update&&i.update(s)}destroy(){this.top.sync([]),this.bottom.sync([])}},{provide:s=>A.scrollMargins.of(e=>{let t=e.plugin(s);return t&&{top:t.top.scrollMargin(),bottom:t.bottom.scrollMargin()}})});class Ho{constructor(e,t,i){this.view=e,this.top=t,this.container=i,this.dom=void 0,this.classes="",this.panels=[],this.syncClasses()}sync(e){for(let t of this.panels)t.destroy&&e.indexOf(t)<0&&t.destroy();this.panels=e,this.syncDOM()}syncDOM(){if(this.panels.length==0){this.dom&&(this.dom.remove(),this.dom=void 0);return}if(!this.dom){this.dom=document.createElement("div"),this.dom.className=this.top?"cm-panels cm-panels-top":"cm-panels cm-panels-bottom",this.dom.style[this.top?"top":"bottom"]="0";let t=this.container||this.view.dom;t.insertBefore(this.dom,this.top?t.firstChild:null)}let e=this.dom.firstChild;for(let t of this.panels)if(t.dom.parentNode==this.dom){for(;e!=t.dom;)e=Sf(e);e=e.nextSibling}else this.dom.insertBefore(t.dom,e);for(;e;)e=Sf(e)}scrollMargin(){return!this.dom||this.container?0:Math.max(0,this.top?this.dom.getBoundingClientRect().bottom-Math.max(0,this.view.scrollDOM.getBoundingClientRect().top):Math.min(innerHeight,this.view.scrollDOM.getBoundingClientRect().bottom)-this.dom.getBoundingClientRect().top)}syncClasses(){if(!(!this.container||this.classes==this.view.themeClasses)){for(let e of this.classes.split(" "))e&&this.container.classList.remove(e);for(let e of(this.classes=this.view.themeClasses).split(" "))e&&this.container.classList.add(e)}}}function Sf(s){let e=s.nextSibling;return s.remove(),e}const Zr=O.define({enables:Kb});class Xi extends rn{compare(e){return this==e||this.constructor==e.constructor&&this.eq(e)}eq(e){return!1}destroy(e){}}Xi.prototype.elementClass="";Xi.prototype.toDOM=void 0;Xi.prototype.mapMode=ut.TrackBefore;Xi.prototype.startSide=Xi.prototype.endSide=-1;Xi.prototype.point=!0;const dl=O.define(),Lk={class:"",renderEmptyElements:!1,elementStyle:"",markers:()=>he.empty,lineMarker:()=>null,widgetMarker:()=>null,lineMarkerChange:null,initialSpacer:null,updateSpacer:null,domEventHandlers:{}},Pr=O.define();function Ik(s){return[Yb(),Pr.of(Object.assign(Object.assign({},Lk),s))]}const kc=O.define({combine:s=>s.some(e=>e)});function Yb(s){let e=[Bk];return s&&s.fixed===!1&&e.push(kc.of(!0)),e}const Bk=Pe.fromClass(class{constructor(s){this.view=s,this.prevViewport=s.viewport,this.dom=document.createElement("div"),this.dom.className="cm-gutters",this.dom.setAttribute("aria-hidden","true"),this.dom.style.minHeight=this.view.contentHeight/this.view.scaleY+"px",this.gutters=s.state.facet(Pr).map(e=>new Rf(s,e));for(let e of this.gutters)this.dom.appendChild(e.dom);this.fixed=!s.state.facet(kc),this.fixed&&(this.dom.style.position="sticky"),this.syncGutters(!1),s.scrollDOM.insertBefore(this.dom,s.contentDOM)}update(s){if(this.updateGutters(s)){let e=this.prevViewport,t=s.view.viewport,i=Math.min(e.to,t.to)-Math.max(e.from,t.from);this.syncGutters(i<(t.to-t.from)*.8)}s.geometryChanged&&(this.dom.style.minHeight=this.view.contentHeight+"px"),this.view.state.facet(kc)!=!this.fixed&&(this.fixed=!this.fixed,this.dom.style.position=this.fixed?"sticky":""),this.prevViewport=s.view.viewport}syncGutters(s){let e=this.dom.nextSibling;s&&this.dom.remove();let t=he.iter(this.view.state.facet(dl),this.view.viewport.from),i=[],n=this.gutters.map(r=>new Fk(r,this.view.viewport,-this.view.documentPadding.top));for(let r of this.view.viewportLineBlocks)if(i.length&&(i=[]),Array.isArray(r.type)){let o=!0;for(let l of r.type)if(l.type==dt.Text&&o){Sc(t,i,l.from);for(let a of n)a.line(this.view,l,i);o=!1}else if(l.widget)for(let a of n)a.widget(this.view,l)}else if(r.type==dt.Text){Sc(t,i,r.from);for(let o of n)o.line(this.view,r,i)}else if(r.widget)for(let o of n)o.widget(this.view,r);for(let r of n)r.finish();s&&this.view.scrollDOM.insertBefore(this.dom,e)}updateGutters(s){let e=s.startState.facet(Pr),t=s.state.facet(Pr),i=s.docChanged||s.heightChanged||s.viewportChanged||!he.eq(s.startState.facet(dl),s.state.facet(dl),s.view.viewport.from,s.view.viewport.to);if(e==t)for(let n of this.gutters)n.update(s)&&(i=!0);else{i=!0;let n=[];for(let r of t){let o=e.indexOf(r);o<0?n.push(new Rf(this.view,r)):(this.gutters[o].update(s),n.push(this.gutters[o]))}for(let r of this.gutters)r.dom.remove(),n.indexOf(r)<0&&r.destroy();for(let r of n)this.dom.appendChild(r.dom);this.gutters=n}return i}destroy(){for(let s of this.gutters)s.destroy();this.dom.remove()}},{provide:s=>A.scrollMargins.of(e=>{let t=e.plugin(s);return!t||t.gutters.length==0||!t.fixed?null:e.textDirection==_e.LTR?{left:t.dom.offsetWidth*e.scaleX}:{right:t.dom.offsetWidth*e.scaleX}})});function _f(s){return Array.isArray(s)?s:[s]}function Sc(s,e,t){for(;s.value&&s.from<=t;)s.from==t&&e.push(s.value),s.next()}class Fk{constructor(e,t,i){this.gutter=e,this.height=i,this.i=0,this.cursor=he.iter(e.markers,t.from)}addElement(e,t,i){let{gutter:n}=this,r=(t.top-this.height)/e.scaleY,o=t.height/e.scaleY;if(this.i==n.elements.length){let l=new Qb(e,o,r,i);n.elements.push(l),n.dom.appendChild(l.dom)}else n.elements[this.i].update(e,o,r,i);this.height=t.bottom,this.i++}line(e,t,i){let n=[];Sc(this.cursor,n,t.from),i.length&&(n=n.concat(i));let r=this.gutter.config.lineMarker(e,t,n);r&&n.unshift(r);let o=this.gutter;n.length==0&&!o.config.renderEmptyElements||this.addElement(e,t,n)}widget(e,t){let i=this.gutter.config.widgetMarker(e,t.widget,t);i&&this.addElement(e,t,[i])}finish(){let e=this.gutter;for(;e.elements.length>this.i;){let t=e.elements.pop();e.dom.removeChild(t.dom),t.destroy()}}}class Rf{constructor(e,t){this.view=e,this.config=t,this.elements=[],this.spacer=null,this.dom=document.createElement("div"),this.dom.className="cm-gutter"+(this.config.class?" "+this.config.class:"");for(let i in t.domEventHandlers)this.dom.addEventListener(i,n=>{let r=n.target,o;if(r!=this.dom&&this.dom.contains(r)){for(;r.parentNode!=this.dom;)r=r.parentNode;let a=r.getBoundingClientRect();o=(a.top+a.bottom)/2}else o=n.clientY;let l=e.lineBlockAtHeight(o-e.documentTop);t.domEventHandlers[i](e,l,n)&&n.preventDefault()});this.markers=_f(t.markers(e)),t.initialSpacer&&(this.spacer=new Qb(e,0,0,[t.initialSpacer(e)]),this.dom.appendChild(this.spacer.dom),this.spacer.dom.style.cssText+="visibility: hidden; pointer-events: none")}update(e){let t=this.markers;if(this.markers=_f(this.config.markers(e.view)),this.spacer&&this.config.updateSpacer){let n=this.config.updateSpacer(this.spacer.markers[0],e);n!=this.spacer.markers[0]&&this.spacer.update(e.view,0,0,[n])}let i=e.view.viewport;return!he.eq(this.markers,t,i.from,i.to)||(this.config.lineMarkerChange?this.config.lineMarkerChange(e):!1)}destroy(){for(let e of this.elements)e.destroy()}}class Qb{constructor(e,t,i,n){this.height=-1,this.above=0,this.markers=[],this.dom=document.createElement("div"),this.dom.className="cm-gutterElement",this.update(e,t,i,n)}update(e,t,i,n){this.height!=t&&(this.height=t,this.dom.style.height=t+"px"),this.above!=i&&(this.dom.style.marginTop=(this.above=i)?i+"px":""),Pk(this.markers,n)||this.setMarkers(e,n)}setMarkers(e,t){let i="cm-gutterElement",n=this.dom.firstChild;for(let r=0,o=0;;){let l=o,a=r<t.length?t[r++]:null,h=!1;if(a){let c=a.elementClass;c&&(i+=" "+c);for(let u=o;u<this.markers.length;u++)if(this.markers[u].compare(a)){l=u,h=!0;break}}else l=this.markers.length;for(;o<l;){let c=this.markers[o++];if(c.toDOM){c.destroy(n);let u=n.nextSibling;n.remove(),n=u}}if(!a)break;a.toDOM&&(h?n=n.nextSibling:this.dom.insertBefore(a.toDOM(e),n)),h&&o++}this.dom.className=i,this.markers=t}destroy(){this.setMarkers(null,[])}}function Pk(s,e){if(s.length!=e.length)return!1;for(let t=0;t<s.length;t++)if(!s[t].compare(e[t]))return!1;return!0}const Nk=O.define(),_n=O.define({combine(s){return Ni(s,{formatNumber:String,domEventHandlers:{}},{domEventHandlers(e,t){let i=Object.assign({},e);for(let n in t){let r=i[n],o=t[n];i[n]=r?(l,a,h)=>r(l,a,h)||o(l,a,h):o}return i}})}});class dh extends Xi{constructor(e){super(),this.number=e}eq(e){return this.number==e.number}toDOM(){return document.createTextNode(this.number)}}function fh(s,e){return s.state.facet(_n).formatNumber(e,s.state)}const zk=Pr.compute([_n],s=>({class:"cm-lineNumbers",renderEmptyElements:!1,markers(e){return e.state.facet(Nk)},lineMarker(e,t,i){return i.some(n=>n.toDOM)?null:new dh(fh(e,e.state.doc.lineAt(t.from).number))},widgetMarker:()=>null,lineMarkerChange:e=>e.startState.facet(_n)!=e.state.facet(_n),initialSpacer(e){return new dh(fh(e,Tf(e.state.doc.lines)))},updateSpacer(e,t){let i=fh(t.view,Tf(t.view.state.doc.lines));return i==e.number?e:new dh(i)},domEventHandlers:s.facet(_n).domEventHandlers}));function Hk(s={}){return[_n.of(s),Yb(),zk]}function Tf(s){let e=9;for(;e<s;)e=e*10+9;return e}const Vk=new class extends Xi{constructor(){super(...arguments),this.elementClass="cm-activeLineGutter"}},Wk=dl.compute(["selection"],s=>{let e=[],t=-1;for(let i of s.selection.ranges){let n=s.doc.lineAt(i.head).from;n>t&&(t=n,e.push(Vk.range(n)))}return he.of(e)});function Uk(){return Wk}const Jb=1024;let jk=0,ph=class{constructor(e,t){this.from=e,this.to=t}};class ne{constructor(e={}){this.id=jk++,this.perNode=!!e.perNode,this.deserialize=e.deserialize||(()=>{throw new Error("This node type doesn't define a deserialize function")})}add(e){if(this.perNode)throw new RangeError("Can't add per-node props to node types");return typeof e!="function"&&(e=Rt.match(e)),t=>{let i=e(t);return i===void 0?null:[this,i]}}}ne.closedBy=new ne({deserialize:s=>s.split(" ")});ne.openedBy=new ne({deserialize:s=>s.split(" ")});ne.group=new ne({deserialize:s=>s.split(" ")});ne.isolate=new ne({deserialize:s=>{if(s&&s!="rtl"&&s!="ltr"&&s!="auto")throw new RangeError("Invalid value for isolate: "+s);return s||"auto"}});ne.contextHash=new ne({perNode:!0});ne.lookAhead=new ne({perNode:!0});ne.mounted=new ne({perNode:!0});class Zl{constructor(e,t,i){this.tree=e,this.overlay=t,this.parser=i}static get(e){return e&&e.props&&e.props[ne.mounted.id]}}const Gk=Object.create(null);class Rt{constructor(e,t,i,n=0){this.name=e,this.props=t,this.id=i,this.flags=n}static define(e){let t=e.props&&e.props.length?Object.create(null):Gk,i=(e.top?1:0)|(e.skipped?2:0)|(e.error?4:0)|(e.name==null?8:0),n=new Rt(e.name||"",t,e.id,i);if(e.props){for(let r of e.props)if(Array.isArray(r)||(r=r(n)),r){if(r[0].perNode)throw new RangeError("Can't store a per-node prop on a node type");t[r[0].id]=r[1]}}return n}prop(e){return this.props[e.id]}get isTop(){return(this.flags&1)>0}get isSkipped(){return(this.flags&2)>0}get isError(){return(this.flags&4)>0}get isAnonymous(){return(this.flags&8)>0}is(e){if(typeof e=="string"){if(this.name==e)return!0;let t=this.prop(ne.group);return t?t.indexOf(e)>-1:!1}return this.id==e}static match(e){let t=Object.create(null);for(let i in e)for(let n of i.split(" "))t[n]=e[i];return i=>{for(let n=i.prop(ne.group),r=-1;r<(n?n.length:0);r++){let o=t[r<0?i.name:n[r]];if(o)return o}}}}Rt.none=new Rt("",Object.create(null),0,8);class Iu{constructor(e){this.types=e;for(let t=0;t<e.length;t++)if(e[t].id!=t)throw new RangeError("Node type ids should correspond to array positions when creating a node set")}extend(...e){let t=[];for(let i of this.types){let n=null;for(let r of e){let o=r(i);o&&(n||(n=Object.assign({},i.props)),n[o[0].id]=o[1])}t.push(n?new Rt(i.name,n,i.id,i.flags):i)}return new Iu(t)}}const Vo=new WeakMap,Mf=new WeakMap;var $e;(function(s){s[s.ExcludeBuffers=1]="ExcludeBuffers",s[s.IncludeAnonymous=2]="IncludeAnonymous",s[s.IgnoreMounts=4]="IgnoreMounts",s[s.IgnoreOverlays=8]="IgnoreOverlays"})($e||($e={}));class He{constructor(e,t,i,n,r){if(this.type=e,this.children=t,this.positions=i,this.length=n,this.props=null,r&&r.length){this.props=Object.create(null);for(let[o,l]of r)this.props[typeof o=="number"?o:o.id]=l}}toString(){let e=Zl.get(this);if(e&&!e.overlay)return e.tree.toString();let t="";for(let i of this.children){let n=i.toString();n&&(t&&(t+=","),t+=n)}return this.type.name?(/\W/.test(this.type.name)&&!this.type.isError?JSON.stringify(this.type.name):this.type.name)+(t.length?"("+t+")":""):t}cursor(e=0){return new Rc(this.topNode,e)}cursorAt(e,t=0,i=0){let n=Vo.get(this)||this.topNode,r=new Rc(n);return r.moveTo(e,t),Vo.set(this,r._tree),r}get topNode(){return new Jt(this,0,0,null)}resolve(e,t=0){let i=eo(Vo.get(this)||this.topNode,e,t,!1);return Vo.set(this,i),i}resolveInner(e,t=0){let i=eo(Mf.get(this)||this.topNode,e,t,!0);return Mf.set(this,i),i}resolveStack(e,t=0){return Kk(this,e,t)}iterate(e){let{enter:t,leave:i,from:n=0,to:r=this.length}=e,o=e.mode||0,l=(o&$e.IncludeAnonymous)>0;for(let a=this.cursor(o|$e.IncludeAnonymous);;){let h=!1;if(a.from<=r&&a.to>=n&&(!l&&a.type.isAnonymous||t(a)!==!1)){if(a.firstChild())continue;h=!0}for(;h&&i&&(l||!a.type.isAnonymous)&&i(a),!a.nextSibling();){if(!a.parent())return;h=!0}}}prop(e){return e.perNode?this.props?this.props[e.id]:void 0:this.type.prop(e)}get propValues(){let e=[];if(this.props)for(let t in this.props)e.push([+t,this.props[t]]);return e}balance(e={}){return this.children.length<=8?this:Pu(Rt.none,this.children,this.positions,0,this.children.length,0,this.length,(t,i,n)=>new He(this.type,t,i,n,this.propValues),e.makeTree||((t,i,n)=>new He(Rt.none,t,i,n)))}static build(e){return Yk(e)}}He.empty=new He(Rt.none,[],[],0);class Bu{constructor(e,t){this.buffer=e,this.index=t}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}get pos(){return this.index}next(){this.index-=4}fork(){return new Bu(this.buffer,this.index)}}class As{constructor(e,t,i){this.buffer=e,this.length=t,this.set=i}get type(){return Rt.none}toString(){let e=[];for(let t=0;t<this.buffer.length;)e.push(this.childString(t)),t=this.buffer[t+3];return e.join(",")}childString(e){let t=this.buffer[e],i=this.buffer[e+3],n=this.set.types[t],r=n.name;if(/\W/.test(r)&&!n.isError&&(r=JSON.stringify(r)),e+=4,i==e)return r;let o=[];for(;e<i;)o.push(this.childString(e)),e=this.buffer[e+3];return r+"("+o.join(",")+")"}findChild(e,t,i,n,r){let{buffer:o}=this,l=-1;for(let a=e;a!=t&&!(Xb(r,n,o[a+1],o[a+2])&&(l=a,i>0));a=o[a+3]);return l}slice(e,t,i){let n=this.buffer,r=new Uint16Array(t-e),o=0;for(let l=e,a=0;l<t;){r[a++]=n[l++],r[a++]=n[l++]-i;let h=r[a++]=n[l++]-i;r[a++]=n[l++]-e,o=Math.max(o,h)}return new As(r,o,this.set)}}function Xb(s,e,t,i){switch(s){case-2:return t<e;case-1:return i>=e&&t<e;case 0:return t<e&&i>e;case 1:return t<=e&&i>e;case 2:return i>e;case 4:return!0}}function eo(s,e,t,i){for(var n;s.from==s.to||(t<1?s.from>=e:s.from>e)||(t>-1?s.to<=e:s.to<e);){let o=!i&&s instanceof Jt&&s.index<0?null:s.parent;if(!o)return s;s=o}let r=i?0:$e.IgnoreOverlays;if(i)for(let o=s,l=o.parent;l;o=l,l=o.parent)o instanceof Jt&&o.index<0&&((n=l.enter(e,t,r))===null||n===void 0?void 0:n.from)!=o.from&&(s=l);for(;;){let o=s.enter(e,t,r);if(!o)return s;s=o}}class Zb{cursor(e=0){return new Rc(this,e)}getChild(e,t=null,i=null){let n=Df(this,e,t,i);return n.length?n[0]:null}getChildren(e,t=null,i=null){return Df(this,e,t,i)}resolve(e,t=0){return eo(this,e,t,!1)}resolveInner(e,t=0){return eo(this,e,t,!0)}matchContext(e){return _c(this,e)}enterUnfinishedNodesBefore(e){let t=this.childBefore(e),i=this;for(;t;){let n=t.lastChild;if(!n||n.to!=t.to)break;n.type.isError&&n.from==n.to?(i=t,t=n.prevSibling):t=n}return i}get node(){return this}get next(){return this.parent}}class Jt extends Zb{constructor(e,t,i,n){super(),this._tree=e,this.from=t,this.index=i,this._parent=n}get type(){return this._tree.type}get name(){return this._tree.type.name}get to(){return this.from+this._tree.length}nextChild(e,t,i,n,r=0){for(let o=this;;){for(let{children:l,positions:a}=o._tree,h=t>0?l.length:-1;e!=h;e+=t){let c=l[e],u=a[e]+o.from;if(Xb(n,i,u,u+c.length)){if(c instanceof As){if(r&$e.ExcludeBuffers)continue;let d=c.findChild(0,c.buffer.length,t,i-u,n);if(d>-1)return new ps(new qk(o,c,e,u),null,d)}else if(r&$e.IncludeAnonymous||!c.type.isAnonymous||Fu(c)){let d;if(!(r&$e.IgnoreMounts)&&(d=Zl.get(c))&&!d.overlay)return new Jt(d.tree,u,e,o);let f=new Jt(c,u,e,o);return r&$e.IncludeAnonymous||!f.type.isAnonymous?f:f.nextChild(t<0?c.children.length-1:0,t,i,n)}}}if(r&$e.IncludeAnonymous||!o.type.isAnonymous||(o.index>=0?e=o.index+t:e=t<0?-1:o._parent._tree.children.length,o=o._parent,!o))return null}}get firstChild(){return this.nextChild(0,1,0,4)}get lastChild(){return this.nextChild(this._tree.children.length-1,-1,0,4)}childAfter(e){return this.nextChild(0,1,e,2)}childBefore(e){return this.nextChild(this._tree.children.length-1,-1,e,-2)}enter(e,t,i=0){let n;if(!(i&$e.IgnoreOverlays)&&(n=Zl.get(this._tree))&&n.overlay){let r=e-this.from;for(let{from:o,to:l}of n.overlay)if((t>0?o<=r:o<r)&&(t<0?l>=r:l>r))return new Jt(n.tree,n.overlay[0].from+this.from,-1,this)}return this.nextChild(0,1,e,t,i)}nextSignificantParent(){let e=this;for(;e.type.isAnonymous&&e._parent;)e=e._parent;return e}get parent(){return this._parent?this._parent.nextSignificantParent():null}get nextSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index+1,1,0,4):null}get prevSibling(){return this._parent&&this.index>=0?this._parent.nextChild(this.index-1,-1,0,4):null}get tree(){return this._tree}toTree(){return this._tree}toString(){return this._tree.toString()}}function Df(s,e,t,i){let n=s.cursor(),r=[];if(!n.firstChild())return r;if(t!=null){for(let o=!1;!o;)if(o=n.type.is(t),!n.nextSibling())return r}for(;;){if(i!=null&&n.type.is(i))return r;if(n.type.is(e)&&r.push(n.node),!n.nextSibling())return i==null?r:[]}}function _c(s,e,t=e.length-1){for(let i=s.parent;t>=0;i=i.parent){if(!i)return!1;if(!i.type.isAnonymous){if(e[t]&&e[t]!=i.name)return!1;t--}}return!0}class qk{constructor(e,t,i,n){this.parent=e,this.buffer=t,this.index=i,this.start=n}}class ps extends Zb{get name(){return this.type.name}get from(){return this.context.start+this.context.buffer.buffer[this.index+1]}get to(){return this.context.start+this.context.buffer.buffer[this.index+2]}constructor(e,t,i){super(),this.context=e,this._parent=t,this.index=i,this.type=e.buffer.set.types[e.buffer.buffer[i]]}child(e,t,i){let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.context.start,i);return r<0?null:new ps(this.context,this,r)}get firstChild(){return this.child(1,0,4)}get lastChild(){return this.child(-1,0,4)}childAfter(e){return this.child(1,e,2)}childBefore(e){return this.child(-1,e,-2)}enter(e,t,i=0){if(i&$e.ExcludeBuffers)return null;let{buffer:n}=this.context,r=n.findChild(this.index+4,n.buffer[this.index+3],t>0?1:-1,e-this.context.start,t);return r<0?null:new ps(this.context,this,r)}get parent(){return this._parent||this.context.parent.nextSignificantParent()}externalSibling(e){return this._parent?null:this.context.parent.nextChild(this.context.index+e,e,0,4)}get nextSibling(){let{buffer:e}=this.context,t=e.buffer[this.index+3];return t<(this._parent?e.buffer[this._parent.index+3]:e.buffer.length)?new ps(this.context,this._parent,t):this.externalSibling(1)}get prevSibling(){let{buffer:e}=this.context,t=this._parent?this._parent.index+4:0;return this.index==t?this.externalSibling(-1):new ps(this.context,this._parent,e.findChild(t,this.index,-1,0,4))}get tree(){return null}toTree(){let e=[],t=[],{buffer:i}=this.context,n=this.index+4,r=i.buffer[this.index+3];if(r>n){let o=i.buffer[this.index+1];e.push(i.slice(n,r,o)),t.push(0)}return new He(this.type,e,t,this.to-this.from)}toString(){return this.context.buffer.childString(this.index)}}function ey(s){if(!s.length)return null;let e=0,t=s[0];for(let r=1;r<s.length;r++){let o=s[r];(o.from>t.from||o.to<t.to)&&(t=o,e=r)}let i=t instanceof Jt&&t.index<0?null:t.parent,n=s.slice();return i?n[e]=i:n.splice(e,1),new $k(n,t)}class $k{constructor(e,t){this.heads=e,this.node=t}get next(){return ey(this.heads)}}function Kk(s,e,t){let i=s.resolveInner(e,t),n=null;for(let r=i instanceof Jt?i:i.context.parent;r;r=r.parent)if(r.index<0){let o=r.parent;(n||(n=[i])).push(o.resolve(e,t)),r=o}else{let o=Zl.get(r.tree);if(o&&o.overlay&&o.overlay[0].from<=e&&o.overlay[o.overlay.length-1].to>=e){let l=new Jt(o.tree,o.overlay[0].from+r.from,-1,r);(n||(n=[i])).push(eo(l,e,t,!1))}}return n?ey(n):i}class Rc{get name(){return this.type.name}constructor(e,t=0){if(this.mode=t,this.buffer=null,this.stack=[],this.index=0,this.bufferNode=null,e instanceof Jt)this.yieldNode(e);else{this._tree=e.context.parent,this.buffer=e.context;for(let i=e._parent;i;i=i._parent)this.stack.unshift(i.index);this.bufferNode=e,this.yieldBuf(e.index)}}yieldNode(e){return e?(this._tree=e,this.type=e.type,this.from=e.from,this.to=e.to,!0):!1}yieldBuf(e,t){this.index=e;let{start:i,buffer:n}=this.buffer;return this.type=t||n.set.types[n.buffer[e]],this.from=i+n.buffer[e+1],this.to=i+n.buffer[e+2],!0}yield(e){return e?e instanceof Jt?(this.buffer=null,this.yieldNode(e)):(this.buffer=e.context,this.yieldBuf(e.index,e.type)):!1}toString(){return this.buffer?this.buffer.buffer.childString(this.index):this._tree.toString()}enterChild(e,t,i){if(!this.buffer)return this.yield(this._tree.nextChild(e<0?this._tree._tree.children.length-1:0,e,t,i,this.mode));let{buffer:n}=this.buffer,r=n.findChild(this.index+4,n.buffer[this.index+3],e,t-this.buffer.start,i);return r<0?!1:(this.stack.push(this.index),this.yieldBuf(r))}firstChild(){return this.enterChild(1,0,4)}lastChild(){return this.enterChild(-1,0,4)}childAfter(e){return this.enterChild(1,e,2)}childBefore(e){return this.enterChild(-1,e,-2)}enter(e,t,i=this.mode){return this.buffer?i&$e.ExcludeBuffers?!1:this.enterChild(1,e,t):this.yield(this._tree.enter(e,t,i))}parent(){if(!this.buffer)return this.yieldNode(this.mode&$e.IncludeAnonymous?this._tree._parent:this._tree.parent);if(this.stack.length)return this.yieldBuf(this.stack.pop());let e=this.mode&$e.IncludeAnonymous?this.buffer.parent:this.buffer.parent.nextSignificantParent();return this.buffer=null,this.yieldNode(e)}sibling(e){if(!this.buffer)return this._tree._parent?this.yield(this._tree.index<0?null:this._tree._parent.nextChild(this._tree.index+e,e,0,4,this.mode)):!1;let{buffer:t}=this.buffer,i=this.stack.length-1;if(e<0){let n=i<0?0:this.stack[i]+4;if(this.index!=n)return this.yieldBuf(t.findChild(n,this.index,-1,0,4))}else{let n=t.buffer[this.index+3];if(n<(i<0?t.buffer.length:t.buffer[this.stack[i]+3]))return this.yieldBuf(n)}return i<0?this.yield(this.buffer.parent.nextChild(this.buffer.index+e,e,0,4,this.mode)):!1}nextSibling(){return this.sibling(1)}prevSibling(){return this.sibling(-1)}atLastNode(e){let t,i,{buffer:n}=this;if(n){if(e>0){if(this.index<n.buffer.buffer.length)return!1}else for(let r=0;r<this.index;r++)if(n.buffer.buffer[r+3]<this.index)return!1;({index:t,parent:i}=n)}else({index:t,_parent:i}=this._tree);for(;i;{index:t,_parent:i}=i)if(t>-1)for(let r=t+e,o=e<0?-1:i._tree.children.length;r!=o;r+=e){let l=i._tree.children[r];if(this.mode&$e.IncludeAnonymous||l instanceof As||!l.type.isAnonymous||Fu(l))return!1}return!0}move(e,t){if(t&&this.enterChild(e,0,4))return!0;for(;;){if(this.sibling(e))return!0;if(this.atLastNode(e)||!this.parent())return!1}}next(e=!0){return this.move(1,e)}prev(e=!0){return this.move(-1,e)}moveTo(e,t=0){for(;(this.from==this.to||(t<1?this.from>=e:this.from>e)||(t>-1?this.to<=e:this.to<e))&&this.parent(););for(;this.enterChild(1,e,t););return this}get node(){if(!this.buffer)return this._tree;let e=this.bufferNode,t=null,i=0;if(e&&e.context==this.buffer)e:for(let n=this.index,r=this.stack.length;r>=0;){for(let o=e;o;o=o._parent)if(o.index==n){if(n==this.index)return o;t=o,i=r+1;break e}n=this.stack[--r]}for(let n=i;n<this.stack.length;n++)t=new ps(this.buffer,t,this.stack[n]);return this.bufferNode=new ps(this.buffer,t,this.index)}get tree(){return this.buffer?null:this._tree._tree}iterate(e,t){for(let i=0;;){let n=!1;if(this.type.isAnonymous||e(this)!==!1){if(this.firstChild()){i++;continue}this.type.isAnonymous||(n=!0)}for(;n&&t&&t(this),n=this.type.isAnonymous,!this.nextSibling();){if(!i)return;this.parent(),i--,n=!0}}}matchContext(e){if(!this.buffer)return _c(this.node,e);let{buffer:t}=this.buffer,{types:i}=t.set;for(let n=e.length-1,r=this.stack.length-1;n>=0;r--){if(r<0)return _c(this.node,e,n);let o=i[t.buffer[this.stack[r]]];if(!o.isAnonymous){if(e[n]&&e[n]!=o.name)return!1;n--}}return!0}}function Fu(s){return s.children.some(e=>e instanceof As||!e.type.isAnonymous||Fu(e))}function Yk(s){var e;let{buffer:t,nodeSet:i,maxBufferLength:n=Jb,reused:r=[],minRepeatType:o=i.types.length}=s,l=Array.isArray(t)?new Bu(t,t.length):t,a=i.types,h=0,c=0;function u(w,E,k,R,P,q){let{id:N,start:D,end:ce,size:X}=l,be=c;for(;X<0;)if(l.next(),X==-1){let re=r[N];k.push(re),R.push(D-w);return}else if(X==-3){h=N;return}else if(X==-4){c=N;return}else throw new RangeError(`Unrecognized record size: ${X}`);let qe=a[N],Ne,I,M=D-w;if(ce-D<=n&&(I=g(l.pos-E,P))){let re=new Uint16Array(I.size-I.skip),Ie=l.pos-I.size,Nt=re.length;for(;l.pos>Ie;)Nt=b(I.start,re,Nt);Ne=new As(re,ce-I.start,i),M=I.start-w}else{let re=l.pos-X;l.next();let Ie=[],Nt=[],hi=N>=o?N:-1,ns=0,mn=ce;for(;l.pos>re;)hi>=0&&l.id==hi&&l.size>=0?(l.end<=mn-n&&(p(Ie,Nt,D,ns,l.end,mn,hi,be),ns=Ie.length,mn=l.end),l.next()):q>2500?d(D,re,Ie,Nt):u(D,re,Ie,Nt,hi,q+1);if(hi>=0&&ns>0&&ns<Ie.length&&p(Ie,Nt,D,ns,D,mn,hi,be),Ie.reverse(),Nt.reverse(),hi>-1&&ns>0){let cr=f(qe);Ne=Pu(qe,Ie,Nt,0,Ie.length,0,ce-D,cr,cr)}else Ne=m(qe,Ie,Nt,ce-D,be-ce)}k.push(Ne),R.push(M)}function d(w,E,k,R){let P=[],q=0,N=-1;for(;l.pos>E;){let{id:D,start:ce,end:X,size:be}=l;if(be>4)l.next();else{if(N>-1&&ce<N)break;N<0&&(N=X-n),P.push(D,ce,X),q++,l.next()}}if(q){let D=new Uint16Array(q*4),ce=P[P.length-2];for(let X=P.length-3,be=0;X>=0;X-=3)D[be++]=P[X],D[be++]=P[X+1]-ce,D[be++]=P[X+2]-ce,D[be++]=be;k.push(new As(D,P[2]-ce,i)),R.push(ce-w)}}function f(w){return(E,k,R)=>{let P=0,q=E.length-1,N,D;if(q>=0&&(N=E[q])instanceof He){if(!q&&N.type==w&&N.length==R)return N;(D=N.prop(ne.lookAhead))&&(P=k[q]+N.length+D)}return m(w,E,k,R,P)}}function p(w,E,k,R,P,q,N,D){let ce=[],X=[];for(;w.length>R;)ce.push(w.pop()),X.push(E.pop()+k-P);w.push(m(i.types[N],ce,X,q-P,D-q)),E.push(P-k)}function m(w,E,k,R,P=0,q){if(h){let N=[ne.contextHash,h];q=q?[N].concat(q):[N]}if(P>25){let N=[ne.lookAhead,P];q=q?[N].concat(q):[N]}return new He(w,E,k,R,q)}function g(w,E){let k=l.fork(),R=0,P=0,q=0,N=k.end-n,D={size:0,start:0,skip:0};e:for(let ce=k.pos-w;k.pos>ce;){let X=k.size;if(k.id==E&&X>=0){D.size=R,D.start=P,D.skip=q,q+=4,R+=4,k.next();continue}let be=k.pos-X;if(X<0||be<ce||k.start<N)break;let qe=k.id>=o?4:0,Ne=k.start;for(k.next();k.pos>be;){if(k.size<0)if(k.size==-3)qe+=4;else break e;else k.id>=o&&(qe+=4);k.next()}P=Ne,R+=X,q+=qe}return(E<0||R==w)&&(D.size=R,D.start=P,D.skip=q),D.size>4?D:void 0}function b(w,E,k){let{id:R,start:P,end:q,size:N}=l;if(l.next(),N>=0&&R<o){let D=k;if(N>4){let ce=l.pos-(N-4);for(;l.pos>ce;)k=b(w,E,k)}E[--k]=D,E[--k]=q-w,E[--k]=P-w,E[--k]=R}else N==-3?h=R:N==-4&&(c=R);return k}let v=[],C=[];for(;l.pos>0;)u(s.start||0,s.bufferStart||0,v,C,-1,0);let x=(e=s.length)!==null&&e!==void 0?e:v.length?C[0]+v[0].length:0;return new He(a[s.topID],v.reverse(),C.reverse(),x)}const Af=new WeakMap;function fl(s,e){if(!s.isAnonymous||e instanceof As||e.type!=s)return 1;let t=Af.get(e);if(t==null){t=1;for(let i of e.children){if(i.type!=s||!(i instanceof He)){t=1;break}t+=fl(s,i)}Af.set(e,t)}return t}function Pu(s,e,t,i,n,r,o,l,a){let h=0;for(let p=i;p<n;p++)h+=fl(s,e[p]);let c=Math.ceil(h*1.5/8),u=[],d=[];function f(p,m,g,b,v){for(let C=g;C<b;){let x=C,w=m[C],E=fl(s,p[C]);for(C++;C<b;C++){let k=fl(s,p[C]);if(E+k>=c)break;E+=k}if(C==x+1){if(E>c){let k=p[x];f(k.children,k.positions,0,k.children.length,m[x]+v);continue}u.push(p[x])}else{let k=m[C-1]+p[C-1].length-w;u.push(Pu(s,p,m,x,C,w,k,null,a))}d.push(w+v-r)}}return f(e,t,i,n,0),(l||a)(u,d,o)}class tn{constructor(e,t,i,n,r=!1,o=!1){this.from=e,this.to=t,this.tree=i,this.offset=n,this.open=(r?1:0)|(o?2:0)}get openStart(){return(this.open&1)>0}get openEnd(){return(this.open&2)>0}static addTree(e,t=[],i=!1){let n=[new tn(0,e.length,e,0,!1,i)];for(let r of t)r.to>e.length&&n.push(r);return n}static applyChanges(e,t,i=128){if(!t.length)return e;let n=[],r=1,o=e.length?e[0]:null;for(let l=0,a=0,h=0;;l++){let c=l<t.length?t[l]:null,u=c?c.fromA:1e9;if(u-a>=i)for(;o&&o.from<u;){let d=o;if(a>=d.from||u<=d.to||h){let f=Math.max(d.from,a)-h,p=Math.min(d.to,u)-h;d=f>=p?null:new tn(f,p,d.tree,d.offset+h,l>0,!!c)}if(d&&n.push(d),o.to>u)break;o=r<e.length?e[r++]:null}if(!c)break;a=c.toA,h=c.toA-c.toB}return n}}class ty{startParse(e,t,i){return typeof e=="string"&&(e=new Qk(e)),i=i?i.length?i.map(n=>new ph(n.from,n.to)):[new ph(0,0)]:[new ph(0,e.length)],this.createParse(e,t||[],i)}parse(e,t,i){let n=this.startParse(e,t,i);for(;;){let r=n.advance();if(r)return r}}}class Qk{constructor(e){this.string=e}get length(){return this.string.length}chunk(e){return this.string.slice(e)}get lineChunks(){return!1}read(e,t){return this.string.slice(e,t)}}new ne({perNode:!0});let Jk=0;class bi{constructor(e,t,i){this.set=e,this.base=t,this.modified=i,this.id=Jk++}static define(e){if(e!=null&&e.base)throw new Error("Can not derive from a modified tag");let t=new bi([],null,[]);if(t.set.push(t),e)for(let i of e.set)t.set.push(i);return t}static defineModifier(){let e=new ea;return t=>t.modified.indexOf(e)>-1?t:ea.get(t.base||t,t.modified.concat(e).sort((i,n)=>i.id-n.id))}}let Xk=0;class ea{constructor(){this.instances=[],this.id=Xk++}static get(e,t){if(!t.length)return e;let i=t[0].instances.find(l=>l.base==e&&Zk(t,l.modified));if(i)return i;let n=[],r=new bi(n,e,t);for(let l of t)l.instances.push(r);let o=eS(t);for(let l of e.set)if(!l.modified.length)for(let a of o)n.push(ea.get(l,a));return r}}function Zk(s,e){return s.length==e.length&&s.every((t,i)=>t==e[i])}function eS(s){let e=[[]];for(let t=0;t<s.length;t++)for(let i=0,n=e.length;i<n;i++)e.push(e[i].concat(s[t]));return e.sort((t,i)=>i.length-t.length)}function iy(s){let e=Object.create(null);for(let t in s){let i=s[t];Array.isArray(i)||(i=[i]);for(let n of t.split(" "))if(n){let r=[],o=2,l=n;for(let u=0;;){if(l=="..."&&u>0&&u+3==n.length){o=1;break}let d=/^"(?:[^"\\]|\\.)*?"|[^\/!]+/.exec(l);if(!d)throw new RangeError("Invalid path: "+n);if(r.push(d[0]=="*"?"":d[0][0]=='"'?JSON.parse(d[0]):d[0]),u+=d[0].length,u==n.length)break;let f=n[u++];if(u==n.length&&f=="!"){o=0;break}if(f!="/")throw new RangeError("Invalid path: "+n);l=n.slice(u)}let a=r.length-1,h=r[a];if(!h)throw new RangeError("Invalid path: "+n);let c=new ta(i,o,a>0?r.slice(0,a):null);e[h]=c.sort(e[h])}}return sy.add(e)}const sy=new ne;class ta{constructor(e,t,i,n){this.tags=e,this.mode=t,this.context=i,this.next=n}get opaque(){return this.mode==0}get inherit(){return this.mode==1}sort(e){return!e||e.depth<this.depth?(this.next=e,this):(e.next=this.sort(e.next),e)}get depth(){return this.context?this.context.length:0}}ta.empty=new ta([],2,null);function ny(s,e){let t=Object.create(null);for(let r of s)if(!Array.isArray(r.tag))t[r.tag.id]=r.class;else for(let o of r.tag)t[o.id]=r.class;let{scope:i,all:n=null}=e||{};return{style:r=>{let o=n;for(let l of r)for(let a of l.set){let h=t[a.id];if(h){o=o?o+" "+h:h;break}}return o},scope:i}}function tS(s,e){let t=null;for(let i of s){let n=i.style(e);n&&(t=t?t+" "+n:n)}return t}function iS(s,e,t,i=0,n=s.length){let r=new sS(i,Array.isArray(e)?e:[e],t);r.highlightRange(s.cursor(),i,n,"",r.highlighters),r.flush(n)}class sS{constructor(e,t,i){this.at=e,this.highlighters=t,this.span=i,this.class=""}startSpan(e,t){t!=this.class&&(this.flush(e),e>this.at&&(this.at=e),this.class=t)}flush(e){e>this.at&&this.class&&this.span(this.at,e,this.class)}highlightRange(e,t,i,n,r){let{type:o,from:l,to:a}=e;if(l>=i||a<=t)return;o.isTop&&(r=this.highlighters.filter(f=>!f.scope||f.scope(o)));let h=n,c=nS(e)||ta.empty,u=tS(r,c.tags);if(u&&(h&&(h+=" "),h+=u,c.mode==1&&(n+=(n?" ":"")+u)),this.startSpan(Math.max(t,l),h),c.opaque)return;let d=e.tree&&e.tree.prop(ne.mounted);if(d&&d.overlay){let f=e.node.enter(d.overlay[0].from+l,1),p=this.highlighters.filter(g=>!g.scope||g.scope(d.tree.type)),m=e.firstChild();for(let g=0,b=l;;g++){let v=g<d.overlay.length?d.overlay[g]:null,C=v?v.from+l:a,x=Math.max(t,b),w=Math.min(i,C);if(x<w&&m)for(;e.from<w&&(this.highlightRange(e,x,w,n,r),this.startSpan(Math.min(w,e.to),h),!(e.to>=C||!e.nextSibling())););if(!v||C>i)break;b=v.to+l,b>t&&(this.highlightRange(f.cursor(),Math.max(t,v.from+l),Math.min(i,b),"",p),this.startSpan(Math.min(i,b),h))}m&&e.parent()}else if(e.firstChild()){d&&(n="");do if(!(e.to<=t)){if(e.from>=i)break;this.highlightRange(e,t,i,n,r),this.startSpan(Math.min(i,e.to),h)}while(e.nextSibling());e.parent()}}}function nS(s){let e=s.type.prop(sy);for(;e&&e.context&&!s.matchContext(e.context);)e=e.next;return e||null}const T=bi.define,Wo=T(),as=T(),Of=T(as),Lf=T(as),hs=T(),Uo=T(hs),mh=T(hs),pi=T(),Ps=T(pi),ui=T(),di=T(),Tc=T(),mr=T(Tc),jo=T(),_={comment:Wo,lineComment:T(Wo),blockComment:T(Wo),docComment:T(Wo),name:as,variableName:T(as),typeName:Of,tagName:T(Of),propertyName:Lf,attributeName:T(Lf),className:T(as),labelName:T(as),namespace:T(as),macroName:T(as),literal:hs,string:Uo,docString:T(Uo),character:T(Uo),attributeValue:T(Uo),number:mh,integer:T(mh),float:T(mh),bool:T(hs),regexp:T(hs),escape:T(hs),color:T(hs),url:T(hs),keyword:ui,self:T(ui),null:T(ui),atom:T(ui),unit:T(ui),modifier:T(ui),operatorKeyword:T(ui),controlKeyword:T(ui),definitionKeyword:T(ui),moduleKeyword:T(ui),operator:di,derefOperator:T(di),arithmeticOperator:T(di),logicOperator:T(di),bitwiseOperator:T(di),compareOperator:T(di),updateOperator:T(di),definitionOperator:T(di),typeOperator:T(di),controlOperator:T(di),punctuation:Tc,separator:T(Tc),bracket:mr,angleBracket:T(mr),squareBracket:T(mr),paren:T(mr),brace:T(mr),content:pi,heading:Ps,heading1:T(Ps),heading2:T(Ps),heading3:T(Ps),heading4:T(Ps),heading5:T(Ps),heading6:T(Ps),contentSeparator:T(pi),list:T(pi),quote:T(pi),emphasis:T(pi),strong:T(pi),link:T(pi),monospace:T(pi),strikethrough:T(pi),inserted:T(),deleted:T(),changed:T(),invalid:T(),meta:jo,documentMeta:T(jo),annotation:T(jo),processingInstruction:T(jo),definition:bi.defineModifier(),constant:bi.defineModifier(),function:bi.defineModifier(),standard:bi.defineModifier(),local:bi.defineModifier(),special:bi.defineModifier()};ny([{tag:_.link,class:"tok-link"},{tag:_.heading,class:"tok-heading"},{tag:_.emphasis,class:"tok-emphasis"},{tag:_.strong,class:"tok-strong"},{tag:_.keyword,class:"tok-keyword"},{tag:_.atom,class:"tok-atom"},{tag:_.bool,class:"tok-bool"},{tag:_.url,class:"tok-url"},{tag:_.labelName,class:"tok-labelName"},{tag:_.inserted,class:"tok-inserted"},{tag:_.deleted,class:"tok-deleted"},{tag:_.literal,class:"tok-literal"},{tag:_.string,class:"tok-string"},{tag:_.number,class:"tok-number"},{tag:[_.regexp,_.escape,_.special(_.string)],class:"tok-string2"},{tag:_.variableName,class:"tok-variableName"},{tag:_.local(_.variableName),class:"tok-variableName tok-local"},{tag:_.definition(_.variableName),class:"tok-variableName tok-definition"},{tag:_.special(_.variableName),class:"tok-variableName2"},{tag:_.definition(_.propertyName),class:"tok-propertyName tok-definition"},{tag:_.typeName,class:"tok-typeName"},{tag:_.namespace,class:"tok-namespace"},{tag:_.className,class:"tok-className"},{tag:_.macroName,class:"tok-macroName"},{tag:_.propertyName,class:"tok-propertyName"},{tag:_.operator,class:"tok-operator"},{tag:_.comment,class:"tok-comment"},{tag:_.meta,class:"tok-meta"},{tag:_.invalid,class:"tok-invalid"},{tag:_.punctuation,class:"tok-punctuation"}]);var gh;const Rn=new ne;function rS(s){return O.define({combine:s?e=>e.concat(s):void 0})}const oS=new ne;class ti{constructor(e,t,i=[],n=""){this.data=e,this.name=n,ae.prototype.hasOwnProperty("tree")||Object.defineProperty(ae.prototype,"tree",{get(){return Ke(this)}}),this.parser=t,this.extension=[Os.of(this),ae.languageData.of((r,o,l)=>{let a=If(r,o,l),h=a.type.prop(Rn);if(!h)return[];let c=r.facet(h),u=a.type.prop(oS);if(u){let d=a.resolve(o-a.from,l);for(let f of u)if(f.test(d,r)){let p=r.facet(f.facet);return f.type=="replace"?p:p.concat(c)}}return c})].concat(i)}isActiveAt(e,t,i=-1){return If(e,t,i).type.prop(Rn)==this.data}findRegions(e){let t=e.facet(Os);if((t==null?void 0:t.data)==this.data)return[{from:0,to:e.doc.length}];if(!t||!t.allowsNesting)return[];let i=[],n=(r,o)=>{if(r.prop(Rn)==this.data){i.push({from:o,to:o+r.length});return}let l=r.prop(ne.mounted);if(l){if(l.tree.prop(Rn)==this.data){if(l.overlay)for(let a of l.overlay)i.push({from:a.from+o,to:a.to+o});else i.push({from:o,to:o+r.length});return}else if(l.overlay){let a=i.length;if(n(l.tree,l.overlay[0].from+o),i.length>a)return}}for(let a=0;a<r.children.length;a++){let h=r.children[a];h instanceof He&&n(h,r.positions[a]+o)}};return n(Ke(e),0),i}get allowsNesting(){return!0}}ti.setState=ee.define();function If(s,e,t){let i=s.facet(Os),n=Ke(s).topNode;if(!i||i.allowsNesting)for(let r=n;r;r=r.enter(e,t,$e.ExcludeBuffers))r.type.isTop&&(n=r);return n}class ia extends ti{constructor(e,t,i){super(e,t,[],i),this.parser=t}static define(e){let t=rS(e.languageData);return new ia(t,e.parser.configure({props:[Rn.add(i=>i.isTop?t:void 0)]}),e.name)}configure(e,t){return new ia(this.data,this.parser.configure(e),t||this.name)}get allowsNesting(){return this.parser.hasWrappers()}}function Ke(s){let e=s.field(ti.state,!1);return e?e.tree:He.empty}class lS{constructor(e){this.doc=e,this.cursorPos=0,this.string="",this.cursor=e.iter()}get length(){return this.doc.length}syncTo(e){return this.string=this.cursor.next(e-this.cursorPos).value,this.cursorPos=e+this.string.length,this.cursorPos-this.string.length}chunk(e){return this.syncTo(e),this.string}get lineChunks(){return!0}read(e,t){let i=this.cursorPos-this.string.length;return e<i||t>=this.cursorPos?this.doc.sliceString(e,t):this.string.slice(e-i,t-i)}}let gr=null;class sa{constructor(e,t,i=[],n,r,o,l,a){this.parser=e,this.state=t,this.fragments=i,this.tree=n,this.treeLen=r,this.viewport=o,this.skipped=l,this.scheduleOn=a,this.parse=null,this.tempSkipped=[]}static create(e,t,i){return new sa(e,t,[],He.empty,0,i,[],null)}startParse(){return this.parser.startParse(new lS(this.state.doc),this.fragments)}work(e,t){return t!=null&&t>=this.state.doc.length&&(t=void 0),this.tree!=He.empty&&this.isDone(t??this.state.doc.length)?(this.takeTree(),!0):this.withContext(()=>{var i;if(typeof e=="number"){let n=Date.now()+e;e=()=>Date.now()>n}for(this.parse||(this.parse=this.startParse()),t!=null&&(this.parse.stoppedAt==null||this.parse.stoppedAt>t)&&t<this.state.doc.length&&this.parse.stopAt(t);;){let n=this.parse.advance();if(n)if(this.fragments=this.withoutTempSkipped(tn.addTree(n,this.fragments,this.parse.stoppedAt!=null)),this.treeLen=(i=this.parse.stoppedAt)!==null&&i!==void 0?i:this.state.doc.length,this.tree=n,this.parse=null,this.treeLen<(t??this.state.doc.length))this.parse=this.startParse();else return!0;if(e())return!1}})}takeTree(){let e,t;this.parse&&(e=this.parse.parsedPos)>=this.treeLen&&((this.parse.stoppedAt==null||this.parse.stoppedAt>e)&&this.parse.stopAt(e),this.withContext(()=>{for(;!(t=this.parse.advance()););}),this.treeLen=e,this.tree=t,this.fragments=this.withoutTempSkipped(tn.addTree(this.tree,this.fragments,!0)),this.parse=null)}withContext(e){let t=gr;gr=this;try{return e()}finally{gr=t}}withoutTempSkipped(e){for(let t;t=this.tempSkipped.pop();)e=Bf(e,t.from,t.to);return e}changes(e,t){let{fragments:i,tree:n,treeLen:r,viewport:o,skipped:l}=this;if(this.takeTree(),!e.empty){let a=[];if(e.iterChangedRanges((h,c,u,d)=>a.push({fromA:h,toA:c,fromB:u,toB:d})),i=tn.applyChanges(i,a),n=He.empty,r=0,o={from:e.mapPos(o.from,-1),to:e.mapPos(o.to,1)},this.skipped.length){l=[];for(let h of this.skipped){let c=e.mapPos(h.from,1),u=e.mapPos(h.to,-1);c<u&&l.push({from:c,to:u})}}}return new sa(this.parser,t,i,n,r,o,l,this.scheduleOn)}updateViewport(e){if(this.viewport.from==e.from&&this.viewport.to==e.to)return!1;this.viewport=e;let t=this.skipped.length;for(let i=0;i<this.skipped.length;i++){let{from:n,to:r}=this.skipped[i];n<e.to&&r>e.from&&(this.fragments=Bf(this.fragments,n,r),this.skipped.splice(i--,1))}return this.skipped.length>=t?!1:(this.reset(),!0)}reset(){this.parse&&(this.takeTree(),this.parse=null)}skipUntilInView(e,t){this.skipped.push({from:e,to:t})}static getSkippingParser(e){return new class extends ty{createParse(t,i,n){let r=n[0].from,o=n[n.length-1].to;return{parsedPos:r,advance(){let a=gr;if(a){for(let h of n)a.tempSkipped.push(h);e&&(a.scheduleOn=a.scheduleOn?Promise.all([a.scheduleOn,e]):e)}return this.parsedPos=o,new He(Rt.none,[],[],o-r)},stoppedAt:null,stopAt(){}}}}}isDone(e){e=Math.min(e,this.state.doc.length);let t=this.fragments;return this.treeLen>=e&&t.length&&t[0].from==0&&t[0].to>=e}static get(){return gr}}function Bf(s,e,t){return tn.applyChanges(s,[{fromA:e,toA:t,fromB:e,toB:t}])}class Jn{constructor(e){this.context=e,this.tree=e.tree}apply(e){if(!e.docChanged&&this.tree==this.context.tree)return this;let t=this.context.changes(e.changes,e.state),i=this.context.treeLen==e.startState.doc.length?void 0:Math.max(e.changes.mapPos(this.context.treeLen),t.viewport.to);return t.work(20,i)||t.takeTree(),new Jn(t)}static init(e){let t=Math.min(3e3,e.doc.length),i=sa.create(e.facet(Os).parser,e,{from:0,to:t});return i.work(20,t)||i.takeTree(),new Jn(i)}}ti.state=it.define({create:Jn.init,update(s,e){for(let t of e.effects)if(t.is(ti.setState))return t.value;return e.startState.facet(Os)!=e.state.facet(Os)?Jn.init(e.state):s.apply(e)}});let ry=s=>{let e=setTimeout(()=>s(),500);return()=>clearTimeout(e)};typeof requestIdleCallback<"u"&&(ry=s=>{let e=-1,t=setTimeout(()=>{e=requestIdleCallback(s,{timeout:400})},100);return()=>e<0?clearTimeout(t):cancelIdleCallback(e)});const bh=typeof navigator<"u"&&(!((gh=navigator.scheduling)===null||gh===void 0)&&gh.isInputPending)?()=>navigator.scheduling.isInputPending():null,aS=Pe.fromClass(class{constructor(e){this.view=e,this.working=null,this.workScheduled=0,this.chunkEnd=-1,this.chunkBudget=-1,this.work=this.work.bind(this),this.scheduleWork()}update(e){let t=this.view.state.field(ti.state).context;(t.updateViewport(e.view.viewport)||this.view.viewport.to>t.treeLen)&&this.scheduleWork(),(e.docChanged||e.selectionSet)&&(this.view.hasFocus&&(this.chunkBudget+=50),this.scheduleWork()),this.checkAsyncSchedule(t)}scheduleWork(){if(this.working)return;let{state:e}=this.view,t=e.field(ti.state);(t.tree!=t.context.tree||!t.context.isDone(e.doc.length))&&(this.working=ry(this.work))}work(e){this.working=null;let t=Date.now();if(this.chunkEnd<t&&(this.chunkEnd<0||this.view.hasFocus)&&(this.chunkEnd=t+3e4,this.chunkBudget=3e3),this.chunkBudget<=0)return;let{state:i,viewport:{to:n}}=this.view,r=i.field(ti.state);if(r.tree==r.context.tree&&r.context.isDone(n+1e5))return;let o=Date.now()+Math.min(this.chunkBudget,100,e&&!bh?Math.max(25,e.timeRemaining()-5):1e9),l=r.context.treeLen<n&&i.doc.length>n+1e3,a=r.context.work(()=>bh&&bh()||Date.now()>o,n+(l?0:1e5));this.chunkBudget-=Date.now()-t,(a||this.chunkBudget<=0)&&(r.context.takeTree(),this.view.dispatch({effects:ti.setState.of(new Jn(r.context))})),this.chunkBudget>0&&!(a&&!l)&&this.scheduleWork(),this.checkAsyncSchedule(r.context)}checkAsyncSchedule(e){e.scheduleOn&&(this.workScheduled++,e.scheduleOn.then(()=>this.scheduleWork()).catch(t=>Yt(this.view.state,t)).then(()=>this.workScheduled--),e.scheduleOn=null)}destroy(){this.working&&this.working()}isWorking(){return!!(this.working||this.workScheduled>0)}},{eventHandlers:{focus(){this.scheduleWork()}}}),Os=O.define({combine(s){return s.length?s[0]:null},enables:s=>[ti.state,aS,A.contentAttributes.compute([s],e=>{let t=e.facet(s);return t&&t.name?{"data-language":t.name}:{}})]});class hS{constructor(e,t=[]){this.language=e,this.support=t,this.extension=[e,t]}}const cS=O.define(),Da=O.define({combine:s=>{if(!s.length)return"  ";let e=s[0];if(!e||/\S/.test(e)||Array.from(e).some(t=>t!=e[0]))throw new Error("Invalid indent unit: "+JSON.stringify(s[0]));return e}});function na(s){let e=s.facet(Da);return e.charCodeAt(0)==9?s.tabSize*e.length:e.length}function to(s,e){let t="",i=s.tabSize,n=s.facet(Da)[0];if(n=="	"){for(;e>=i;)t+="	",e-=i;n=" "}for(let r=0;r<e;r++)t+=n;return t}function Nu(s,e){s instanceof ae&&(s=new Aa(s));for(let i of s.state.facet(cS)){let n=i(s,e);if(n!==void 0)return n}let t=Ke(s.state);return t.length>=e?uS(s,t,e):null}class Aa{constructor(e,t={}){this.state=e,this.options=t,this.unit=na(e)}lineAt(e,t=1){let i=this.state.doc.lineAt(e),{simulateBreak:n,simulateDoubleBreak:r}=this.options;return n!=null&&n>=i.from&&n<=i.to?r&&n==e?{text:"",from:e}:(t<0?n<e:n<=e)?{text:i.text.slice(n-i.from),from:n}:{text:i.text.slice(0,n-i.from),from:i.from}:i}textAfterPos(e,t=1){if(this.options.simulateDoubleBreak&&e==this.options.simulateBreak)return"";let{text:i,from:n}=this.lineAt(e,t);return i.slice(e-n,Math.min(i.length,e+100-n))}column(e,t=1){let{text:i,from:n}=this.lineAt(e,t),r=this.countColumn(i,e-n),o=this.options.overrideIndentation?this.options.overrideIndentation(n):-1;return o>-1&&(r+=o-this.countColumn(i,i.search(/\S|$/))),r}countColumn(e,t=e.length){return lr(e,this.state.tabSize,t)}lineIndent(e,t=1){let{text:i,from:n}=this.lineAt(e,t),r=this.options.overrideIndentation;if(r){let o=r(n);if(o>-1)return o}return this.countColumn(i,i.search(/\S|$/))}get simulatedBreak(){return this.options.simulateBreak||null}}const oy=new ne;function uS(s,e,t){let i=e.resolveStack(t),n=i.node.enterUnfinishedNodesBefore(t);if(n!=i.node){let r=[];for(let o=n;o!=i.node;o=o.parent)r.push(o);for(let o=r.length-1;o>=0;o--)i={node:r[o],next:i}}return ly(i,s,t)}function ly(s,e,t){for(let i=s;i;i=i.next){let n=fS(i.node);if(n)return n(zu.create(e,t,i))}return 0}function dS(s){return s.pos==s.options.simulateBreak&&s.options.simulateDoubleBreak}function fS(s){let e=s.type.prop(oy);if(e)return e;let t=s.firstChild,i;if(t&&(i=t.type.prop(ne.closedBy))){let n=s.lastChild,r=n&&i.indexOf(n.name)>-1;return o=>bS(o,!0,1,void 0,r&&!dS(o)?n.from:void 0)}return s.parent==null?pS:null}function pS(){return 0}class zu extends Aa{constructor(e,t,i){super(e.state,e.options),this.base=e,this.pos=t,this.context=i}get node(){return this.context.node}static create(e,t,i){return new zu(e,t,i)}get textAfter(){return this.textAfterPos(this.pos)}get baseIndent(){return this.baseIndentFor(this.node)}baseIndentFor(e){let t=this.state.doc.lineAt(e.from);for(;;){let i=e.resolve(t.from);for(;i.parent&&i.parent.from==i.from;)i=i.parent;if(mS(i,e))break;t=this.state.doc.lineAt(i.from)}return this.lineIndent(t.from)}continue(){return ly(this.context.next,this.base,this.pos)}}function mS(s,e){for(let t=e;t;t=t.parent)if(s==t)return!0;return!1}function gS(s){let e=s.node,t=e.childAfter(e.from),i=e.lastChild;if(!t)return null;let n=s.options.simulateBreak,r=s.state.doc.lineAt(t.from),o=n==null||n<=r.from?r.to:Math.min(r.to,n);for(let l=t.to;;){let a=e.childAfter(l);if(!a||a==i)return null;if(!a.type.isSkipped)return a.from<o?t:null;l=a.to}}function bS(s,e,t,i,n){let r=s.textAfter,o=r.match(/^\s*/)[0].length,l=i&&r.slice(o,o+i.length)==i||n==s.pos+o,a=e?gS(s):null;return a?l?s.column(a.from):s.column(a.to):s.baseIndent+(l?0:s.unit*t)}function yS({except:s,units:e=1}={}){return t=>{let i=s&&s.test(t.textAfter);return t.baseIndent+(i?0:e*t.unit)}}const vS=200;function wS(){return ae.transactionFilter.of(s=>{if(!s.docChanged||!s.isUserEvent("input.type")&&!s.isUserEvent("input.complete"))return s;let e=s.startState.languageDataAt("indentOnInput",s.startState.selection.main.head);if(!e.length)return s;let t=s.newDoc,{head:i}=s.newSelection.main,n=t.lineAt(i);if(i>n.from+vS)return s;let r=t.sliceString(n.from,i);if(!e.some(h=>h.test(r)))return s;let{state:o}=s,l=-1,a=[];for(let{head:h}of o.selection.ranges){let c=o.doc.lineAt(h);if(c.from==l)continue;l=c.from;let u=Nu(o,c.from);if(u==null)continue;let d=/^\s*/.exec(c.text)[0],f=to(o,u);d!=f&&a.push({from:c.from,to:c.from+d.length,insert:f})}return a.length?[s,{changes:a,sequential:!0}]:s})}const CS=O.define(),ay=new ne;function ES(s,e,t){let i=Ke(s);if(i.length<t)return null;let n=i.resolveStack(t,1),r=null;for(let o=n;o;o=o.next){let l=o.node;if(l.to<=t||l.from>t)continue;if(r&&l.from<e)break;let a=l.type.prop(ay);if(a&&(l.to<i.length-50||i.length==s.doc.length||!xS(l))){let h=a(l,s);h&&h.from<=t&&h.from>=e&&h.to>t&&(r=h)}}return r}function xS(s){let e=s.lastChild;return e&&e.to==s.to&&e.type.isError}function ra(s,e,t){for(let i of s.facet(CS)){let n=i(s,e,t);if(n)return n}return ES(s,e,t)}function hy(s,e){let t=e.mapPos(s.from,1),i=e.mapPos(s.to,-1);return t>=i?void 0:{from:t,to:i}}const Oa=ee.define({map:hy}),go=ee.define({map:hy});function cy(s){let e=[];for(let{head:t}of s.state.selection.ranges)e.some(i=>i.from<=t&&i.to>=t)||e.push(s.lineBlockAt(t));return e}const an=it.define({create(){return F.none},update(s,e){s=s.map(e.changes);for(let t of e.effects)if(t.is(Oa)&&!kS(s,t.value.from,t.value.to)){let{preparePlaceholder:i}=e.state.facet(Hu),n=i?F.replace({widget:new AS(i(e.state,t.value))}):Ff;s=s.update({add:[n.range(t.value.from,t.value.to)]})}else t.is(go)&&(s=s.update({filter:(i,n)=>t.value.from!=i||t.value.to!=n,filterFrom:t.value.from,filterTo:t.value.to}));if(e.selection){let t=!1,{head:i}=e.selection.main;s.between(i,i,(n,r)=>{n<i&&r>i&&(t=!0)}),t&&(s=s.update({filterFrom:i,filterTo:i,filter:(n,r)=>r<=i||n>=i}))}return s},provide:s=>A.decorations.from(s),toJSON(s,e){let t=[];return s.between(0,e.doc.length,(i,n)=>{t.push(i,n)}),t},fromJSON(s){if(!Array.isArray(s)||s.length%2)throw new RangeError("Invalid JSON for fold state");let e=[];for(let t=0;t<s.length;){let i=s[t++],n=s[t++];if(typeof i!="number"||typeof n!="number")throw new RangeError("Invalid JSON for fold state");e.push(Ff.range(i,n))}return F.set(e,!0)}});function oa(s,e,t){var i;let n=null;return(i=s.field(an,!1))===null||i===void 0||i.between(e,t,(r,o)=>{(!n||n.from>r)&&(n={from:r,to:o})}),n}function kS(s,e,t){let i=!1;return s.between(e,e,(n,r)=>{n==e&&r==t&&(i=!0)}),i}function uy(s,e){return s.field(an,!1)?e:e.concat(ee.appendConfig.of(fy()))}const SS=s=>{for(let e of cy(s)){let t=ra(s.state,e.from,e.to);if(t)return s.dispatch({effects:uy(s.state,[Oa.of(t),dy(s,t)])}),!0}return!1},_S=s=>{if(!s.state.field(an,!1))return!1;let e=[];for(let t of cy(s)){let i=oa(s.state,t.from,t.to);i&&e.push(go.of(i),dy(s,i,!1))}return e.length&&s.dispatch({effects:e}),e.length>0};function dy(s,e,t=!0){let i=s.state.doc.lineAt(e.from).number,n=s.state.doc.lineAt(e.to).number;return A.announce.of(`${s.state.phrase(t?"Folded lines":"Unfolded lines")} ${i} ${s.state.phrase("to")} ${n}.`)}const RS=s=>{let{state:e}=s,t=[];for(let i=0;i<e.doc.length;){let n=s.lineBlockAt(i),r=ra(e,n.from,n.to);r&&t.push(Oa.of(r)),i=(r?s.lineBlockAt(r.to):n).to+1}return t.length&&s.dispatch({effects:uy(s.state,t)}),!!t.length},TS=s=>{let e=s.state.field(an,!1);if(!e||!e.size)return!1;let t=[];return e.between(0,s.state.doc.length,(i,n)=>{t.push(go.of({from:i,to:n}))}),s.dispatch({effects:t}),!0},MS=[{key:"Ctrl-Shift-[",mac:"Cmd-Alt-[",run:SS},{key:"Ctrl-Shift-]",mac:"Cmd-Alt-]",run:_S},{key:"Ctrl-Alt-[",run:RS},{key:"Ctrl-Alt-]",run:TS}],DS={placeholderDOM:null,preparePlaceholder:null,placeholderText:""},Hu=O.define({combine(s){return Ni(s,DS)}});function fy(s){let e=[an,IS];return s&&e.push(Hu.of(s)),e}function py(s,e){let{state:t}=s,i=t.facet(Hu),n=o=>{let l=s.lineBlockAt(s.posAtDOM(o.target)),a=oa(s.state,l.from,l.to);a&&s.dispatch({effects:go.of(a)}),o.preventDefault()};if(i.placeholderDOM)return i.placeholderDOM(s,n,e);let r=document.createElement("span");return r.textContent=i.placeholderText,r.setAttribute("aria-label",t.phrase("folded code")),r.title=t.phrase("unfold"),r.className="cm-foldPlaceholder",r.onclick=n,r}const Ff=F.replace({widget:new class extends ss{toDOM(s){return py(s,null)}}});class AS extends ss{constructor(e){super(),this.value=e}eq(e){return this.value==e.value}toDOM(e){return py(e,this.value)}}const OS={openText:"",closedText:"",markerDOM:null,domEventHandlers:{},foldingChanged:()=>!1};class yh extends Xi{constructor(e,t){super(),this.config=e,this.open=t}eq(e){return this.config==e.config&&this.open==e.open}toDOM(e){if(this.config.markerDOM)return this.config.markerDOM(this.open);let t=document.createElement("span");return t.textContent=this.open?this.config.openText:this.config.closedText,t.title=e.state.phrase(this.open?"Fold line":"Unfold line"),t}}function LS(s={}){let e=Object.assign(Object.assign({},OS),s),t=new yh(e,!0),i=new yh(e,!1),n=Pe.fromClass(class{constructor(o){this.from=o.viewport.from,this.markers=this.buildMarkers(o)}update(o){(o.docChanged||o.viewportChanged||o.startState.facet(Os)!=o.state.facet(Os)||o.startState.field(an,!1)!=o.state.field(an,!1)||Ke(o.startState)!=Ke(o.state)||e.foldingChanged(o))&&(this.markers=this.buildMarkers(o.view))}buildMarkers(o){let l=new Rs;for(let a of o.viewportLineBlocks){let h=oa(o.state,a.from,a.to)?i:ra(o.state,a.from,a.to)?t:null;h&&l.add(a.from,a.from,h)}return l.finish()}}),{domEventHandlers:r}=e;return[n,Ik({class:"cm-foldGutter",markers(o){var l;return((l=o.plugin(n))===null||l===void 0?void 0:l.markers)||he.empty},initialSpacer(){return new yh(e,!1)},domEventHandlers:Object.assign(Object.assign({},r),{click:(o,l,a)=>{if(r.click&&r.click(o,l,a))return!0;let h=oa(o.state,l.from,l.to);if(h)return o.dispatch({effects:go.of(h)}),!0;let c=ra(o.state,l.from,l.to);return c?(o.dispatch({effects:Oa.of(c)}),!0):!1}})}),fy()]}const IS=A.baseTheme({".cm-foldPlaceholder":{backgroundColor:"#eee",border:"1px solid #ddd",color:"#888",borderRadius:".2em",margin:"0 1px",padding:"0 1px",cursor:"pointer"},".cm-foldGutter span":{padding:"0 1px",cursor:"pointer"}});class La{constructor(e,t){this.specs=e;let i;function n(l){let a=Ts.newName();return(i||(i=Object.create(null)))["."+a]=l,a}const r=typeof t.all=="string"?t.all:t.all?n(t.all):void 0,o=t.scope;this.scope=o instanceof ti?l=>l.prop(Rn)==o.data:o?l=>l==o:void 0,this.style=ny(e.map(l=>({tag:l.tag,class:l.class||n(Object.assign({},l,{tag:null}))})),{all:r}).style,this.module=i?new Ts(i):null,this.themeType=t.themeType}static define(e,t){return new La(e,t||{})}}const Mc=O.define(),my=O.define({combine(s){return s.length?[s[0]]:null}});function vh(s){let e=s.facet(Mc);return e.length?e:s.facet(my)}function BS(s,e){let t=[PS],i;return s instanceof La&&(s.module&&t.push(A.styleModule.of(s.module)),i=s.themeType),e!=null&&e.fallback?t.push(my.of(s)):i?t.push(Mc.computeN([A.darkTheme],n=>n.facet(A.darkTheme)==(i=="dark")?[s]:[])):t.push(Mc.of(s)),t}class FS{constructor(e){this.markCache=Object.create(null),this.tree=Ke(e.state),this.decorations=this.buildDeco(e,vh(e.state)),this.decoratedTo=e.viewport.to}update(e){let t=Ke(e.state),i=vh(e.state),n=i!=vh(e.startState),{viewport:r}=e.view,o=e.changes.mapPos(this.decoratedTo,1);t.length<r.to&&!n&&t.type==this.tree.type&&o>=r.to?(this.decorations=this.decorations.map(e.changes),this.decoratedTo=o):(t!=this.tree||e.viewportChanged||n)&&(this.tree=t,this.decorations=this.buildDeco(e.view,i),this.decoratedTo=r.to)}buildDeco(e,t){if(!t||!this.tree.length)return F.none;let i=new Rs;for(let{from:n,to:r}of e.visibleRanges)iS(this.tree,t,(o,l,a)=>{i.add(o,l,this.markCache[a]||(this.markCache[a]=F.mark({class:a})))},n,r);return i.finish()}}const PS=or.high(Pe.fromClass(FS,{decorations:s=>s.decorations})),NS=La.define([{tag:_.meta,color:"#404740"},{tag:_.link,textDecoration:"underline"},{tag:_.heading,textDecoration:"underline",fontWeight:"bold"},{tag:_.emphasis,fontStyle:"italic"},{tag:_.strong,fontWeight:"bold"},{tag:_.strikethrough,textDecoration:"line-through"},{tag:_.keyword,color:"#708"},{tag:[_.atom,_.bool,_.url,_.contentSeparator,_.labelName],color:"#219"},{tag:[_.literal,_.inserted],color:"#164"},{tag:[_.string,_.deleted],color:"#a11"},{tag:[_.regexp,_.escape,_.special(_.string)],color:"#e40"},{tag:_.definition(_.variableName),color:"#00f"},{tag:_.local(_.variableName),color:"#30a"},{tag:[_.typeName,_.namespace],color:"#085"},{tag:_.className,color:"#167"},{tag:[_.special(_.variableName),_.macroName],color:"#256"},{tag:_.definition(_.propertyName),color:"#00c"},{tag:_.comment,color:"#940"},{tag:_.invalid,color:"#f00"}]),zS=A.baseTheme({"&.cm-focused .cm-matchingBracket":{backgroundColor:"#328c8252"},"&.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bb555544"}}),gy=1e4,by="()[]{}",yy=O.define({combine(s){return Ni(s,{afterCursor:!0,brackets:by,maxScanDistance:gy,renderMatch:WS})}}),HS=F.mark({class:"cm-matchingBracket"}),VS=F.mark({class:"cm-nonmatchingBracket"});function WS(s){let e=[],t=s.matched?HS:VS;return e.push(t.range(s.start.from,s.start.to)),s.end&&e.push(t.range(s.end.from,s.end.to)),e}const US=it.define({create(){return F.none},update(s,e){if(!e.docChanged&&!e.selection)return s;let t=[],i=e.state.facet(yy);for(let n of e.state.selection.ranges){if(!n.empty)continue;let r=Mi(e.state,n.head,-1,i)||n.head>0&&Mi(e.state,n.head-1,1,i)||i.afterCursor&&(Mi(e.state,n.head,1,i)||n.head<e.state.doc.length&&Mi(e.state,n.head+1,-1,i));r&&(t=t.concat(i.renderMatch(r,e.state)))}return F.set(t,!0)},provide:s=>A.decorations.from(s)}),jS=[US,zS];function GS(s={}){return[yy.of(s),jS]}const qS=new ne;function Dc(s,e,t){let i=s.prop(e<0?ne.openedBy:ne.closedBy);if(i)return i;if(s.name.length==1){let n=t.indexOf(s.name);if(n>-1&&n%2==(e<0?1:0))return[t[n+e]]}return null}function Ac(s){let e=s.type.prop(qS);return e?e(s.node):s}function Mi(s,e,t,i={}){let n=i.maxScanDistance||gy,r=i.brackets||by,o=Ke(s),l=o.resolveInner(e,t);for(let a=l;a;a=a.parent){let h=Dc(a.type,t,r);if(h&&a.from<a.to){let c=Ac(a);if(c&&(t>0?e>=c.from&&e<c.to:e>c.from&&e<=c.to))return $S(s,e,t,a,c,h,r)}}return KS(s,e,t,o,l.type,n,r)}function $S(s,e,t,i,n,r,o){let l=i.parent,a={from:n.from,to:n.to},h=0,c=l==null?void 0:l.cursor();if(c&&(t<0?c.childBefore(i.from):c.childAfter(i.to)))do if(t<0?c.to<=i.from:c.from>=i.to){if(h==0&&r.indexOf(c.type.name)>-1&&c.from<c.to){let u=Ac(c);return{start:a,end:u?{from:u.from,to:u.to}:void 0,matched:!0}}else if(Dc(c.type,t,o))h++;else if(Dc(c.type,-t,o)){if(h==0){let u=Ac(c);return{start:a,end:u&&u.from<u.to?{from:u.from,to:u.to}:void 0,matched:!1}}h--}}while(t<0?c.prevSibling():c.nextSibling());return{start:a,matched:!1}}function KS(s,e,t,i,n,r,o){let l=t<0?s.sliceDoc(e-1,e):s.sliceDoc(e,e+1),a=o.indexOf(l);if(a<0||a%2==0!=t>0)return null;let h={from:t<0?e-1:e,to:t>0?e+1:e},c=s.doc.iterRange(e,t>0?s.doc.length:0),u=0;for(let d=0;!c.next().done&&d<=r;){let f=c.value;t<0&&(d+=f.length);let p=e+d*t;for(let m=t>0?0:f.length-1,g=t>0?f.length:-1;m!=g;m+=t){let b=o.indexOf(f[m]);if(!(b<0||i.resolveInner(p+m,1).type!=n))if(b%2==0==t>0)u++;else{if(u==1)return{start:h,end:{from:p+m,to:p+m+1},matched:b>>1==a>>1};u--}}t>0&&(d+=f.length)}return c.done?{start:h,matched:!1}:null}const YS=Object.create(null),Pf=[Rt.none],Nf=[],zf=Object.create(null),QS=Object.create(null);for(let[s,e]of[["variable","variableName"],["variable-2","variableName.special"],["string-2","string.special"],["def","variableName.definition"],["tag","tagName"],["attribute","attributeName"],["type","typeName"],["builtin","variableName.standard"],["qualifier","modifier"],["error","invalid"],["header","heading"],["property","propertyName"]])QS[s]=JS(YS,e);function wh(s,e){Nf.indexOf(s)>-1||(Nf.push(s),console.warn(e))}function JS(s,e){let t=[];for(let l of e.split(" ")){let a=[];for(let h of l.split(".")){let c=s[h]||_[h];c?typeof c=="function"?a.length?a=a.map(c):wh(h,`Modifier ${h} used at start of tag`):a.length?wh(h,`Tag ${h} used as modifier`):a=Array.isArray(c)?c:[c]:wh(h,`Unknown highlighting tag ${h}`)}for(let h of a)t.push(h)}if(!t.length)return 0;let i=e.replace(/ /g,"_"),n=i+" "+t.map(l=>l.id),r=zf[n];if(r)return r.id;let o=zf[n]=Rt.define({id:Pf.length,name:i,props:[iy({[i]:t})]});return Pf.push(o),o.id}_e.RTL,_e.LTR;const XS=s=>{let{state:e}=s,t=e.doc.lineAt(e.selection.main.from),i=Wu(s.state,t.from);return i.line?ZS(s):i.block?t_(s):!1};function Vu(s,e){return({state:t,dispatch:i})=>{if(t.readOnly)return!1;let n=s(e,t);return n?(i(t.update(n)),!0):!1}}const ZS=Vu(n_,0),e_=Vu(vy,0),t_=Vu((s,e)=>vy(s,e,s_(e)),0);function Wu(s,e){let t=s.languageDataAt("commentTokens",e);return t.length?t[0]:{}}const br=50;function i_(s,{open:e,close:t},i,n){let r=s.sliceDoc(i-br,i),o=s.sliceDoc(n,n+br),l=/\s*$/.exec(r)[0].length,a=/^\s*/.exec(o)[0].length,h=r.length-l;if(r.slice(h-e.length,h)==e&&o.slice(a,a+t.length)==t)return{open:{pos:i-l,margin:l&&1},close:{pos:n+a,margin:a&&1}};let c,u;n-i<=2*br?c=u=s.sliceDoc(i,n):(c=s.sliceDoc(i,i+br),u=s.sliceDoc(n-br,n));let d=/^\s*/.exec(c)[0].length,f=/\s*$/.exec(u)[0].length,p=u.length-f-t.length;return c.slice(d,d+e.length)==e&&u.slice(p,p+t.length)==t?{open:{pos:i+d+e.length,margin:/\s/.test(c.charAt(d+e.length))?1:0},close:{pos:n-f-t.length,margin:/\s/.test(u.charAt(p-1))?1:0}}:null}function s_(s){let e=[];for(let t of s.selection.ranges){let i=s.doc.lineAt(t.from),n=t.to<=i.to?i:s.doc.lineAt(t.to),r=e.length-1;r>=0&&e[r].to>i.from?e[r].to=n.to:e.push({from:i.from+/^\s*/.exec(i.text)[0].length,to:n.to})}return e}function vy(s,e,t=e.selection.ranges){let i=t.map(r=>Wu(e,r.from).block);if(!i.every(r=>r))return null;let n=t.map((r,o)=>i_(e,i[o],r.from,r.to));if(s!=2&&!n.every(r=>r))return{changes:e.changes(t.map((r,o)=>n[o]?[]:[{from:r.from,insert:i[o].open+" "},{from:r.to,insert:" "+i[o].close}]))};if(s!=1&&n.some(r=>r)){let r=[];for(let o=0,l;o<n.length;o++)if(l=n[o]){let a=i[o],{open:h,close:c}=l;r.push({from:h.pos-a.open.length,to:h.pos+h.margin},{from:c.pos-c.margin,to:c.pos+a.close.length})}return{changes:r}}return null}function n_(s,e,t=e.selection.ranges){let i=[],n=-1;for(let{from:r,to:o}of t){let l=i.length,a=1e9,h=Wu(e,r).line;if(h){for(let c=r;c<=o;){let u=e.doc.lineAt(c);if(u.from>n&&(r==o||o>u.from)){n=u.from;let d=/^\s*/.exec(u.text)[0].length,f=d==u.length,p=u.text.slice(d,d+h.length)==h?d:-1;d<u.text.length&&d<a&&(a=d),i.push({line:u,comment:p,token:h,indent:d,empty:f,single:!1})}c=u.to+1}if(a<1e9)for(let c=l;c<i.length;c++)i[c].indent<i[c].line.text.length&&(i[c].indent=a);i.length==l+1&&(i[l].single=!0)}}if(s!=2&&i.some(r=>r.comment<0&&(!r.empty||r.single))){let r=[];for(let{line:l,token:a,indent:h,empty:c,single:u}of i)(u||!c)&&r.push({from:l.from+h,insert:a+" "});let o=e.changes(r);return{changes:o,selection:e.selection.map(o,1)}}else if(s!=1&&i.some(r=>r.comment>=0)){let r=[];for(let{line:o,comment:l,token:a}of i)if(l>=0){let h=o.from+l,c=h+a.length;o.text[c-o.from]==" "&&c++,r.push({from:h,to:c})}return{changes:r}}return null}const Oc=is.define(),r_=is.define(),o_=O.define(),wy=O.define({combine(s){return Ni(s,{minDepth:100,newGroupDelay:500,joinToEvent:(e,t)=>t},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(e,t)=>(i,n)=>e(i,n)||t(i,n)})}}),Cy=it.define({create(){return Di.empty},update(s,e){let t=e.state.facet(wy),i=e.annotation(Oc);if(i){let a=xt.fromTransaction(e,i.selection),h=i.side,c=h==0?s.undone:s.done;return a?c=la(c,c.length,t.minDepth,a):c=ky(c,e.startState.selection),new Di(h==0?i.rest:c,h==0?c:i.rest)}let n=e.annotation(r_);if((n=="full"||n=="before")&&(s=s.isolate()),e.annotation(Ge.addToHistory)===!1)return e.changes.empty?s:s.addMapping(e.changes.desc);let r=xt.fromTransaction(e),o=e.annotation(Ge.time),l=e.annotation(Ge.userEvent);return r?s=s.addChanges(r,o,l,t,e):e.selection&&(s=s.addSelection(e.startState.selection,o,l,t.newGroupDelay)),(n=="full"||n=="after")&&(s=s.isolate()),s},toJSON(s){return{done:s.done.map(e=>e.toJSON()),undone:s.undone.map(e=>e.toJSON())}},fromJSON(s){return new Di(s.done.map(xt.fromJSON),s.undone.map(xt.fromJSON))}});function l_(s={}){return[Cy,wy.of(s),A.domEventHandlers({beforeinput(e,t){let i=e.inputType=="historyUndo"?Ey:e.inputType=="historyRedo"?Lc:null;return i?(e.preventDefault(),i(t)):!1}})]}function Ia(s,e){return function({state:t,dispatch:i}){if(!e&&t.readOnly)return!1;let n=t.field(Cy,!1);if(!n)return!1;let r=n.pop(s,t,e);return r?(i(r),!0):!1}}const Ey=Ia(0,!1),Lc=Ia(1,!1),a_=Ia(0,!0),h_=Ia(1,!0);class xt{constructor(e,t,i,n,r){this.changes=e,this.effects=t,this.mapped=i,this.startSelection=n,this.selectionsAfter=r}setSelAfter(e){return new xt(this.changes,this.effects,this.mapped,this.startSelection,e)}toJSON(){var e,t,i;return{changes:(e=this.changes)===null||e===void 0?void 0:e.toJSON(),mapped:(t=this.mapped)===null||t===void 0?void 0:t.toJSON(),startSelection:(i=this.startSelection)===null||i===void 0?void 0:i.toJSON(),selectionsAfter:this.selectionsAfter.map(n=>n.toJSON())}}static fromJSON(e){return new xt(e.changes&&Ue.fromJSON(e.changes),[],e.mapped&&Li.fromJSON(e.mapped),e.startSelection&&S.fromJSON(e.startSelection),e.selectionsAfter.map(S.fromJSON))}static fromTransaction(e,t){let i=$t;for(let n of e.startState.facet(o_)){let r=n(e);r.length&&(i=i.concat(r))}return!i.length&&e.changes.empty?null:new xt(e.changes.invert(e.startState.doc),i,void 0,t||e.startState.selection,$t)}static selection(e){return new xt(void 0,$t,void 0,void 0,e)}}function la(s,e,t,i){let n=e+1>t+20?e-t-1:0,r=s.slice(n,e);return r.push(i),r}function c_(s,e){let t=[],i=!1;return s.iterChangedRanges((n,r)=>t.push(n,r)),e.iterChangedRanges((n,r,o,l)=>{for(let a=0;a<t.length;){let h=t[a++],c=t[a++];l>=h&&o<=c&&(i=!0)}}),i}function u_(s,e){return s.ranges.length==e.ranges.length&&s.ranges.filter((t,i)=>t.empty!=e.ranges[i].empty).length===0}function xy(s,e){return s.length?e.length?s.concat(e):s:e}const $t=[],d_=200;function ky(s,e){if(s.length){let t=s[s.length-1],i=t.selectionsAfter.slice(Math.max(0,t.selectionsAfter.length-d_));return i.length&&i[i.length-1].eq(e)?s:(i.push(e),la(s,s.length-1,1e9,t.setSelAfter(i)))}else return[xt.selection([e])]}function f_(s){let e=s[s.length-1],t=s.slice();return t[s.length-1]=e.setSelAfter(e.selectionsAfter.slice(0,e.selectionsAfter.length-1)),t}function Ch(s,e){if(!s.length)return s;let t=s.length,i=$t;for(;t;){let n=p_(s[t-1],e,i);if(n.changes&&!n.changes.empty||n.effects.length){let r=s.slice(0,t);return r[t-1]=n,r}else e=n.mapped,t--,i=n.selectionsAfter}return i.length?[xt.selection(i)]:$t}function p_(s,e,t){let i=xy(s.selectionsAfter.length?s.selectionsAfter.map(l=>l.map(e)):$t,t);if(!s.changes)return xt.selection(i);let n=s.changes.map(e),r=e.mapDesc(s.changes,!0),o=s.mapped?s.mapped.composeDesc(r):r;return new xt(n,ee.mapEffects(s.effects,e),o,s.startSelection.map(r),i)}const m_=/^(input\.type|delete)($|\.)/;class Di{constructor(e,t,i=0,n=void 0){this.done=e,this.undone=t,this.prevTime=i,this.prevUserEvent=n}isolate(){return this.prevTime?new Di(this.done,this.undone):this}addChanges(e,t,i,n,r){let o=this.done,l=o[o.length-1];return l&&l.changes&&!l.changes.empty&&e.changes&&(!i||m_.test(i))&&(!l.selectionsAfter.length&&t-this.prevTime<n.newGroupDelay&&n.joinToEvent(r,c_(l.changes,e.changes))||i=="input.type.compose")?o=la(o,o.length-1,n.minDepth,new xt(e.changes.compose(l.changes),xy(e.effects,l.effects),l.mapped,l.startSelection,$t)):o=la(o,o.length,n.minDepth,e),new Di(o,$t,t,i)}addSelection(e,t,i,n){let r=this.done.length?this.done[this.done.length-1].selectionsAfter:$t;return r.length>0&&t-this.prevTime<n&&i==this.prevUserEvent&&i&&/^select($|\.)/.test(i)&&u_(r[r.length-1],e)?this:new Di(ky(this.done,e),this.undone,t,i)}addMapping(e){return new Di(Ch(this.done,e),Ch(this.undone,e),this.prevTime,this.prevUserEvent)}pop(e,t,i){let n=e==0?this.done:this.undone;if(n.length==0)return null;let r=n[n.length-1],o=r.selectionsAfter[0]||t.selection;if(i&&r.selectionsAfter.length)return t.update({selection:r.selectionsAfter[r.selectionsAfter.length-1],annotations:Oc.of({side:e,rest:f_(n),selection:o}),userEvent:e==0?"select.undo":"select.redo",scrollIntoView:!0});if(r.changes){let l=n.length==1?$t:n.slice(0,n.length-1);return r.mapped&&(l=Ch(l,r.mapped)),t.update({changes:r.changes,selection:r.startSelection,effects:r.effects,annotations:Oc.of({side:e,rest:l,selection:o}),filter:!1,userEvent:e==0?"undo":"redo",scrollIntoView:!0})}else return null}}Di.empty=new Di($t,$t);const g_=[{key:"Mod-z",run:Ey,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:Lc,preventDefault:!0},{linux:"Ctrl-Shift-z",run:Lc,preventDefault:!0},{key:"Mod-u",run:a_,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:h_,preventDefault:!0}];function ar(s,e){return S.create(s.ranges.map(e),s.mainIndex)}function zi(s,e){return s.update({selection:e,scrollIntoView:!0,userEvent:"select"})}function ai({state:s,dispatch:e},t){let i=ar(s.selection,t);return i.eq(s.selection,!0)?!1:(e(zi(s,i)),!0)}function Ba(s,e){return S.cursor(e?s.to:s.from)}function Sy(s,e){return ai(s,t=>t.empty?s.moveByChar(t,e):Ba(t,e))}function rt(s){return s.textDirectionAt(s.state.selection.main.head)==_e.LTR}const _y=s=>Sy(s,!rt(s)),Ry=s=>Sy(s,rt(s));function Ty(s,e){return ai(s,t=>t.empty?s.moveByGroup(t,e):Ba(t,e))}const b_=s=>Ty(s,!rt(s)),y_=s=>Ty(s,rt(s));function v_(s,e,t){if(e.type.prop(t))return!0;let i=e.to-e.from;return i&&(i>2||/[^\s,.;:]/.test(s.sliceDoc(e.from,e.to)))||e.firstChild}function Fa(s,e,t){let i=Ke(s).resolveInner(e.head),n=t?ne.closedBy:ne.openedBy;for(let a=e.head;;){let h=t?i.childAfter(a):i.childBefore(a);if(!h)break;v_(s,h,n)?i=h:a=t?h.to:h.from}let r=i.type.prop(n),o,l;return r&&(o=t?Mi(s,i.from,1):Mi(s,i.to,-1))&&o.matched?l=t?o.end.to:o.end.from:l=t?i.to:i.from,S.cursor(l,t?-1:1)}const w_=s=>ai(s,e=>Fa(s.state,e,!rt(s))),C_=s=>ai(s,e=>Fa(s.state,e,rt(s)));function My(s,e){return ai(s,t=>{if(!t.empty)return Ba(t,e);let i=s.moveVertically(t,e);return i.head!=t.head?i:s.moveToLineBoundary(t,e)})}const Dy=s=>My(s,!1),Ay=s=>My(s,!0);function Oy(s){let e=s.scrollDOM.clientHeight<s.scrollDOM.scrollHeight-2,t=0,i=0,n;if(e){for(let r of s.state.facet(A.scrollMargins)){let o=r(s);o!=null&&o.top&&(t=Math.max(o==null?void 0:o.top,t)),o!=null&&o.bottom&&(i=Math.max(o==null?void 0:o.bottom,i))}n=s.scrollDOM.clientHeight-t-i}else n=(s.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:t,marginBottom:i,selfScroll:e,height:Math.max(s.defaultLineHeight,n-5)}}function Ly(s,e){let t=Oy(s),{state:i}=s,n=ar(i.selection,o=>o.empty?s.moveVertically(o,e,t.height):Ba(o,e));if(n.eq(i.selection))return!1;let r;if(t.selfScroll){let o=s.coordsAtPos(i.selection.main.head),l=s.scrollDOM.getBoundingClientRect(),a=l.top+t.marginTop,h=l.bottom-t.marginBottom;o&&o.top>a&&o.bottom<h&&(r=A.scrollIntoView(n.main.head,{y:"start",yMargin:o.top-a}))}return s.dispatch(zi(i,n),{effects:r}),!0}const Hf=s=>Ly(s,!1),Ic=s=>Ly(s,!0);function Bs(s,e,t){let i=s.lineBlockAt(e.head),n=s.moveToLineBoundary(e,t);if(n.head==e.head&&n.head!=(t?i.to:i.from)&&(n=s.moveToLineBoundary(e,t,!1)),!t&&n.head==i.from&&i.length){let r=/^\s*/.exec(s.state.sliceDoc(i.from,Math.min(i.from+100,i.to)))[0].length;r&&e.head!=i.from+r&&(n=S.cursor(i.from+r))}return n}const E_=s=>ai(s,e=>Bs(s,e,!0)),x_=s=>ai(s,e=>Bs(s,e,!1)),k_=s=>ai(s,e=>Bs(s,e,!rt(s))),S_=s=>ai(s,e=>Bs(s,e,rt(s))),__=s=>ai(s,e=>S.cursor(s.lineBlockAt(e.head).from,1)),R_=s=>ai(s,e=>S.cursor(s.lineBlockAt(e.head).to,-1));function T_(s,e,t){let i=!1,n=ar(s.selection,r=>{let o=Mi(s,r.head,-1)||Mi(s,r.head,1)||r.head>0&&Mi(s,r.head-1,1)||r.head<s.doc.length&&Mi(s,r.head+1,-1);if(!o||!o.end)return r;i=!0;let l=o.start.from==r.head?o.end.to:o.end.from;return t?S.range(r.anchor,l):S.cursor(l)});return i?(e(zi(s,n)),!0):!1}const M_=({state:s,dispatch:e})=>T_(s,e,!1);function Zt(s,e){let t=ar(s.state.selection,i=>{let n=e(i);return S.range(i.anchor,n.head,n.goalColumn,n.bidiLevel||void 0)});return t.eq(s.state.selection)?!1:(s.dispatch(zi(s.state,t)),!0)}function Iy(s,e){return Zt(s,t=>s.moveByChar(t,e))}const By=s=>Iy(s,!rt(s)),Fy=s=>Iy(s,rt(s));function Py(s,e){return Zt(s,t=>s.moveByGroup(t,e))}const D_=s=>Py(s,!rt(s)),A_=s=>Py(s,rt(s)),O_=s=>Zt(s,e=>Fa(s.state,e,!rt(s))),L_=s=>Zt(s,e=>Fa(s.state,e,rt(s)));function Ny(s,e){return Zt(s,t=>s.moveVertically(t,e))}const zy=s=>Ny(s,!1),Hy=s=>Ny(s,!0);function Vy(s,e){return Zt(s,t=>s.moveVertically(t,e,Oy(s).height))}const Vf=s=>Vy(s,!1),Wf=s=>Vy(s,!0),I_=s=>Zt(s,e=>Bs(s,e,!0)),B_=s=>Zt(s,e=>Bs(s,e,!1)),F_=s=>Zt(s,e=>Bs(s,e,!rt(s))),P_=s=>Zt(s,e=>Bs(s,e,rt(s))),N_=s=>Zt(s,e=>S.cursor(s.lineBlockAt(e.head).from)),z_=s=>Zt(s,e=>S.cursor(s.lineBlockAt(e.head).to)),Uf=({state:s,dispatch:e})=>(e(zi(s,{anchor:0})),!0),jf=({state:s,dispatch:e})=>(e(zi(s,{anchor:s.doc.length})),!0),Gf=({state:s,dispatch:e})=>(e(zi(s,{anchor:s.selection.main.anchor,head:0})),!0),qf=({state:s,dispatch:e})=>(e(zi(s,{anchor:s.selection.main.anchor,head:s.doc.length})),!0),H_=({state:s,dispatch:e})=>(e(s.update({selection:{anchor:0,head:s.doc.length},userEvent:"select"})),!0),V_=({state:s,dispatch:e})=>{let t=Pa(s).map(({from:i,to:n})=>S.range(i,Math.min(n+1,s.doc.length)));return e(s.update({selection:S.create(t),userEvent:"select"})),!0},W_=({state:s,dispatch:e})=>{let t=ar(s.selection,i=>{var n;let r=Ke(s).resolveStack(i.from,1);for(let o=r;o;o=o.next){let{node:l}=o;if((l.from<i.from&&l.to>=i.to||l.to>i.to&&l.from<=i.from)&&(!((n=l.parent)===null||n===void 0)&&n.parent))return S.range(l.to,l.from)}return i});return e(zi(s,t)),!0},U_=({state:s,dispatch:e})=>{let t=s.selection,i=null;return t.ranges.length>1?i=S.create([t.main]):t.main.empty||(i=S.create([S.cursor(t.main.head)])),i?(e(zi(s,i)),!0):!1};function bo(s,e){if(s.state.readOnly)return!1;let t="delete.selection",{state:i}=s,n=i.changeByRange(r=>{let{from:o,to:l}=r;if(o==l){let a=e(r);a<o?(t="delete.backward",a=Go(s,a,!1)):a>o&&(t="delete.forward",a=Go(s,a,!0)),o=Math.min(o,a),l=Math.max(l,a)}else o=Go(s,o,!1),l=Go(s,l,!0);return o==l?{range:r}:{changes:{from:o,to:l},range:S.cursor(o,o<r.head?-1:1)}});return n.changes.empty?!1:(s.dispatch(i.update(n,{scrollIntoView:!0,userEvent:t,effects:t=="delete.selection"?A.announce.of(i.phrase("Selection deleted")):void 0})),!0)}function Go(s,e,t){if(s instanceof A)for(let i of s.state.facet(A.atomicRanges).map(n=>n(s)))i.between(e,e,(n,r)=>{n<e&&r>e&&(e=t?r:n)});return e}const Wy=(s,e)=>bo(s,t=>{let i=t.from,{state:n}=s,r=n.doc.lineAt(i),o,l;if(!e&&i>r.from&&i<r.from+200&&!/[^ \t]/.test(o=r.text.slice(0,i-r.from))){if(o[o.length-1]=="	")return i-1;let a=lr(o,n.tabSize),h=a%na(n)||na(n);for(let c=0;c<h&&o[o.length-1-c]==" ";c++)i--;l=i}else l=tt(r.text,i-r.from,e,e)+r.from,l==i&&r.number!=(e?n.doc.lines:1)?l+=e?1:-1:!e&&/[\ufe00-\ufe0f]/.test(r.text.slice(l-r.from,i-r.from))&&(l=tt(r.text,l-r.from,!1,!1)+r.from);return l}),Bc=s=>Wy(s,!1),Uy=s=>Wy(s,!0),jy=(s,e)=>bo(s,t=>{let i=t.head,{state:n}=s,r=n.doc.lineAt(i),o=n.charCategorizer(i);for(let l=null;;){if(i==(e?r.to:r.from)){i==t.head&&r.number!=(e?n.doc.lines:1)&&(i+=e?1:-1);break}let a=tt(r.text,i-r.from,e)+r.from,h=r.text.slice(Math.min(i,a)-r.from,Math.max(i,a)-r.from),c=o(h);if(l!=null&&c!=l)break;(h!=" "||i!=t.head)&&(l=c),i=a}return i}),Gy=s=>jy(s,!1),j_=s=>jy(s,!0),G_=s=>bo(s,e=>{let t=s.lineBlockAt(e.head).to;return e.head<t?t:Math.min(s.state.doc.length,e.head+1)}),q_=s=>bo(s,e=>{let t=s.moveToLineBoundary(e,!1).head;return e.head>t?t:Math.max(0,e.head-1)}),$_=s=>bo(s,e=>{let t=s.moveToLineBoundary(e,!0).head;return e.head<t?t:Math.min(s.state.doc.length,e.head+1)}),K_=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let t=s.changeByRange(i=>({changes:{from:i.from,to:i.to,insert:de.of(["",""])},range:S.cursor(i.from)}));return e(s.update(t,{scrollIntoView:!0,userEvent:"input"})),!0},Y_=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let t=s.changeByRange(i=>{if(!i.empty||i.from==0||i.from==s.doc.length)return{range:i};let n=i.from,r=s.doc.lineAt(n),o=n==r.from?n-1:tt(r.text,n-r.from,!1)+r.from,l=n==r.to?n+1:tt(r.text,n-r.from,!0)+r.from;return{changes:{from:o,to:l,insert:s.doc.slice(n,l).append(s.doc.slice(o,n))},range:S.cursor(l)}});return t.changes.empty?!1:(e(s.update(t,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function Pa(s){let e=[],t=-1;for(let i of s.selection.ranges){let n=s.doc.lineAt(i.from),r=s.doc.lineAt(i.to);if(!i.empty&&i.to==r.from&&(r=s.doc.lineAt(i.to-1)),t>=n.number){let o=e[e.length-1];o.to=r.to,o.ranges.push(i)}else e.push({from:n.from,to:r.to,ranges:[i]});t=r.number+1}return e}function qy(s,e,t){if(s.readOnly)return!1;let i=[],n=[];for(let r of Pa(s)){if(t?r.to==s.doc.length:r.from==0)continue;let o=s.doc.lineAt(t?r.to+1:r.from-1),l=o.length+1;if(t){i.push({from:r.to,to:o.to},{from:r.from,insert:o.text+s.lineBreak});for(let a of r.ranges)n.push(S.range(Math.min(s.doc.length,a.anchor+l),Math.min(s.doc.length,a.head+l)))}else{i.push({from:o.from,to:r.from},{from:r.to,insert:s.lineBreak+o.text});for(let a of r.ranges)n.push(S.range(a.anchor-l,a.head-l))}}return i.length?(e(s.update({changes:i,scrollIntoView:!0,selection:S.create(n,s.selection.mainIndex),userEvent:"move.line"})),!0):!1}const Q_=({state:s,dispatch:e})=>qy(s,e,!1),J_=({state:s,dispatch:e})=>qy(s,e,!0);function $y(s,e,t){if(s.readOnly)return!1;let i=[];for(let n of Pa(s))t?i.push({from:n.from,insert:s.doc.slice(n.from,n.to)+s.lineBreak}):i.push({from:n.to,insert:s.lineBreak+s.doc.slice(n.from,n.to)});return e(s.update({changes:i,scrollIntoView:!0,userEvent:"input.copyline"})),!0}const X_=({state:s,dispatch:e})=>$y(s,e,!1),Z_=({state:s,dispatch:e})=>$y(s,e,!0),eR=s=>{if(s.state.readOnly)return!1;let{state:e}=s,t=e.changes(Pa(e).map(({from:n,to:r})=>(n>0?n--:r<e.doc.length&&r++,{from:n,to:r}))),i=ar(e.selection,n=>s.moveVertically(n,!0)).map(t);return s.dispatch({changes:t,selection:i,scrollIntoView:!0,userEvent:"delete.line"}),!0};function tR(s,e){if(/\(\)|\[\]|\{\}/.test(s.sliceDoc(e-1,e+1)))return{from:e,to:e};let t=Ke(s).resolveInner(e),i=t.childBefore(e),n=t.childAfter(e),r;return i&&n&&i.to<=e&&n.from>=e&&(r=i.type.prop(ne.closedBy))&&r.indexOf(n.name)>-1&&s.doc.lineAt(i.to).from==s.doc.lineAt(n.from).from&&!/\S/.test(s.sliceDoc(i.to,n.from))?{from:i.to,to:n.from}:null}const iR=Ky(!1),sR=Ky(!0);function Ky(s){return({state:e,dispatch:t})=>{if(e.readOnly)return!1;let i=e.changeByRange(n=>{let{from:r,to:o}=n,l=e.doc.lineAt(r),a=!s&&r==o&&tR(e,r);s&&(r=o=(o<=l.to?l:e.doc.lineAt(o)).to);let h=new Aa(e,{simulateBreak:r,simulateDoubleBreak:!!a}),c=Nu(h,r);for(c==null&&(c=lr(/^\s*/.exec(e.doc.lineAt(r).text)[0],e.tabSize));o<l.to&&/\s/.test(l.text[o-l.from]);)o++;a?{from:r,to:o}=a:r>l.from&&r<l.from+100&&!/\S/.test(l.text.slice(0,r))&&(r=l.from);let u=["",to(e,c)];return a&&u.push(to(e,h.lineIndent(l.from,-1))),{changes:{from:r,to:o,insert:de.of(u)},range:S.cursor(r+1+u[1].length)}});return t(e.update(i,{scrollIntoView:!0,userEvent:"input"})),!0}}function Uu(s,e){let t=-1;return s.changeByRange(i=>{let n=[];for(let o=i.from;o<=i.to;){let l=s.doc.lineAt(o);l.number>t&&(i.empty||i.to>l.from)&&(e(l,n,i),t=l.number),o=l.to+1}let r=s.changes(n);return{changes:n,range:S.range(r.mapPos(i.anchor,1),r.mapPos(i.head,1))}})}const nR=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let t=Object.create(null),i=new Aa(s,{overrideIndentation:r=>{let o=t[r];return o??-1}}),n=Uu(s,(r,o,l)=>{let a=Nu(i,r.from);if(a==null)return;/\S/.test(r.text)||(a=0);let h=/^\s*/.exec(r.text)[0],c=to(s,a);(h!=c||l.from<r.from+h.length)&&(t[r.from]=a,o.push({from:r.from,to:r.from+h.length,insert:c}))});return n.changes.empty||e(s.update(n,{userEvent:"indent"})),!0},Yy=({state:s,dispatch:e})=>s.readOnly?!1:(e(s.update(Uu(s,(t,i)=>{i.push({from:t.from,insert:s.facet(Da)})}),{userEvent:"input.indent"})),!0),Qy=({state:s,dispatch:e})=>s.readOnly?!1:(e(s.update(Uu(s,(t,i)=>{let n=/^\s*/.exec(t.text)[0];if(!n)return;let r=lr(n,s.tabSize),o=0,l=to(s,Math.max(0,r-na(s)));for(;o<n.length&&o<l.length&&n.charCodeAt(o)==l.charCodeAt(o);)o++;i.push({from:t.from+o,to:t.from+n.length,insert:l.slice(o)})}),{userEvent:"delete.dedent"})),!0),rR=[{key:"Ctrl-b",run:_y,shift:By,preventDefault:!0},{key:"Ctrl-f",run:Ry,shift:Fy},{key:"Ctrl-p",run:Dy,shift:zy},{key:"Ctrl-n",run:Ay,shift:Hy},{key:"Ctrl-a",run:__,shift:N_},{key:"Ctrl-e",run:R_,shift:z_},{key:"Ctrl-d",run:Uy},{key:"Ctrl-h",run:Bc},{key:"Ctrl-k",run:G_},{key:"Ctrl-Alt-h",run:Gy},{key:"Ctrl-o",run:K_},{key:"Ctrl-t",run:Y_},{key:"Ctrl-v",run:Ic}],oR=[{key:"ArrowLeft",run:_y,shift:By,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:b_,shift:D_,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:k_,shift:F_,preventDefault:!0},{key:"ArrowRight",run:Ry,shift:Fy,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:y_,shift:A_,preventDefault:!0},{mac:"Cmd-ArrowRight",run:S_,shift:P_,preventDefault:!0},{key:"ArrowUp",run:Dy,shift:zy,preventDefault:!0},{mac:"Cmd-ArrowUp",run:Uf,shift:Gf},{mac:"Ctrl-ArrowUp",run:Hf,shift:Vf},{key:"ArrowDown",run:Ay,shift:Hy,preventDefault:!0},{mac:"Cmd-ArrowDown",run:jf,shift:qf},{mac:"Ctrl-ArrowDown",run:Ic,shift:Wf},{key:"PageUp",run:Hf,shift:Vf},{key:"PageDown",run:Ic,shift:Wf},{key:"Home",run:x_,shift:B_,preventDefault:!0},{key:"Mod-Home",run:Uf,shift:Gf},{key:"End",run:E_,shift:I_,preventDefault:!0},{key:"Mod-End",run:jf,shift:qf},{key:"Enter",run:iR},{key:"Mod-a",run:H_},{key:"Backspace",run:Bc,shift:Bc},{key:"Delete",run:Uy},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Gy},{key:"Mod-Delete",mac:"Alt-Delete",run:j_},{mac:"Mod-Backspace",run:q_},{mac:"Mod-Delete",run:$_}].concat(rR.map(s=>({mac:s.key,run:s.run,shift:s.shift}))),lR=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:w_,shift:O_},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:C_,shift:L_},{key:"Alt-ArrowUp",run:Q_},{key:"Shift-Alt-ArrowUp",run:X_},{key:"Alt-ArrowDown",run:J_},{key:"Shift-Alt-ArrowDown",run:Z_},{key:"Escape",run:U_},{key:"Mod-Enter",run:sR},{key:"Alt-l",mac:"Ctrl-l",run:V_},{key:"Mod-i",run:W_,preventDefault:!0},{key:"Mod-[",run:Qy},{key:"Mod-]",run:Yy},{key:"Mod-Alt-\\",run:nR},{key:"Shift-Mod-k",run:eR},{key:"Shift-Mod-\\",run:M_},{key:"Mod-/",run:XS},{key:"Alt-A",run:e_}].concat(oR),aR={key:"Tab",run:Yy,shift:Qy};function xe(){var s=arguments[0];typeof s=="string"&&(s=document.createElement(s));var e=1,t=arguments[1];if(t&&typeof t=="object"&&t.nodeType==null&&!Array.isArray(t)){for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var n=t[i];typeof n=="string"?s.setAttribute(i,n):n!=null&&(s[i]=n)}e++}for(;e<arguments.length;e++)Jy(s,arguments[e]);return s}function Jy(s,e){if(typeof e=="string")s.appendChild(document.createTextNode(e));else if(e!=null)if(e.nodeType!=null)s.appendChild(e);else if(Array.isArray(e))for(var t=0;t<e.length;t++)Jy(s,e[t]);else throw new RangeError("Unsupported child node: "+e)}const $f=typeof String.prototype.normalize=="function"?s=>s.normalize("NFKD"):s=>s;class Xn{constructor(e,t,i=0,n=e.length,r,o){this.test=o,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,n),this.bufferStart=i,this.normalize=r?l=>r($f(l)):$f,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Qe(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=Eu(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=qt(e);let n=this.normalize(t);for(let r=0,o=i;;r++){let l=n.charCodeAt(r),a=this.match(l,o,this.bufferPos+this.bufferStart);if(r==n.length-1){if(a)return this.value=a,this;break}o==i&&r<t.length&&t.charCodeAt(r)==l&&o++}}}match(e,t,i){let n=null;for(let r=0;r<this.matches.length;r+=2){let o=this.matches[r],l=!1;this.query.charCodeAt(o)==e&&(o==this.query.length-1?n={from:this.matches[r+1],to:i}:(this.matches[r]++,l=!0)),l||(this.matches.splice(r,2),r-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?n={from:t,to:i}:this.matches.push(1,t)),n&&this.test&&!this.test(n.from,n.to,this.buffer,this.bufferStart)&&(n=null),n}}typeof Symbol<"u"&&(Xn.prototype[Symbol.iterator]=function(){return this});const Xy={from:-1,to:-1,match:/.*/.exec("")},ju="gm"+(/x/.unicode==null?"":"u");class Zy{constructor(e,t,i,n=0,r=e.length){if(this.text=e,this.to=r,this.curLine="",this.done=!1,this.value=Xy,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new ev(e,t,i,n,r);this.re=new RegExp(t,ju+(i!=null&&i.ignoreCase?"i":"")),this.test=i==null?void 0:i.test,this.iter=e.iter();let o=e.lineAt(n);this.curLineStart=o.from,this.matchPos=aa(e,n),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,n=i+t[0].length;if(this.matchPos=aa(this.text,n+(i==n?1:0)),i==this.curLineStart+this.curLine.length&&this.nextLine(),(i<n||i>this.value.to)&&(!this.test||this.test(i,n,t)))return this.value={from:i,to:n,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const Eh=new WeakMap;class zn{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let n=Eh.get(e);if(!n||n.from>=i||n.to<=t){let l=new zn(t,e.sliceString(t,i));return Eh.set(e,l),l}if(n.from==t&&n.to==i)return n;let{text:r,from:o}=n;return o>t&&(r=e.sliceString(t,o)+r,o=t),n.to<i&&(r+=e.sliceString(n.to,i)),Eh.set(e,new zn(o,r)),new zn(t,r.slice(t-o,i-o))}}class ev{constructor(e,t,i,n,r){this.text=e,this.to=r,this.done=!1,this.value=Xy,this.matchPos=aa(e,n),this.re=new RegExp(t,ju+(i!=null&&i.ignoreCase?"i":"")),this.test=i==null?void 0:i.test,this.flat=zn.get(e,n,this.chunkEnd(n+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let i=this.flat.from+t.index,n=i+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(i,n,t)))return this.value={from:i,to:n,match:t},this.matchPos=aa(this.text,n+(i==n?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=zn.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(Zy.prototype[Symbol.iterator]=ev.prototype[Symbol.iterator]=function(){return this});function hR(s){try{return new RegExp(s,ju),!0}catch{return!1}}function aa(s,e){if(e>=s.length)return e;let t=s.lineAt(e),i;for(;e<t.to&&(i=t.text.charCodeAt(e-t.from))>=56320&&i<57344;)e++;return e}function Fc(s){let e=String(s.state.doc.lineAt(s.state.selection.main.head).number),t=xe("input",{class:"cm-textfield",name:"line",value:e}),i=xe("form",{class:"cm-gotoLine",onkeydown:r=>{r.keyCode==27?(r.preventDefault(),s.dispatch({effects:ha.of(!1)}),s.focus()):r.keyCode==13&&(r.preventDefault(),n())},onsubmit:r=>{r.preventDefault(),n()}},xe("label",s.state.phrase("Go to line"),": ",t)," ",xe("button",{class:"cm-button",type:"submit"},s.state.phrase("go")));function n(){let r=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!r)return;let{state:o}=s,l=o.doc.lineAt(o.selection.main.head),[,a,h,c,u]=r,d=c?+c.slice(1):0,f=h?+h:l.number;if(h&&u){let g=f/100;a&&(g=g*(a=="-"?-1:1)+l.number/o.doc.lines),f=Math.round(o.doc.lines*g)}else h&&a&&(f=f*(a=="-"?-1:1)+l.number);let p=o.doc.line(Math.max(1,Math.min(o.doc.lines,f))),m=S.cursor(p.from+Math.max(0,Math.min(d,p.length)));s.dispatch({effects:[ha.of(!1),A.scrollIntoView(m.from,{y:"center"})],selection:m}),s.focus()}return{dom:i}}const ha=ee.define(),Kf=it.define({create(){return!0},update(s,e){for(let t of e.effects)t.is(ha)&&(s=t.value);return s},provide:s=>Zr.from(s,e=>e?Fc:null)}),cR=s=>{let e=Xr(s,Fc);if(!e){let t=[ha.of(!0)];s.state.field(Kf,!1)==null&&t.push(ee.appendConfig.of([Kf,uR])),s.dispatch({effects:t}),e=Xr(s,Fc)}return e&&e.dom.querySelector("input").select(),!0},uR=A.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),dR={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},tv=O.define({combine(s){return Ni(s,dR,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function fR(s){let e=[yR,bR];return s&&e.push(tv.of(s)),e}const pR=F.mark({class:"cm-selectionMatch"}),mR=F.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Yf(s,e,t,i){return(t==0||s(e.sliceDoc(t-1,t))!=De.Word)&&(i==e.doc.length||s(e.sliceDoc(i,i+1))!=De.Word)}function gR(s,e,t,i){return s(e.sliceDoc(t,t+1))==De.Word&&s(e.sliceDoc(i-1,i))==De.Word}const bR=Pe.fromClass(class{constructor(s){this.decorations=this.getDeco(s)}update(s){(s.selectionSet||s.docChanged||s.viewportChanged)&&(this.decorations=this.getDeco(s.view))}getDeco(s){let e=s.state.facet(tv),{state:t}=s,i=t.selection;if(i.ranges.length>1)return F.none;let n=i.main,r,o=null;if(n.empty){if(!e.highlightWordAroundCursor)return F.none;let a=t.wordAt(n.head);if(!a)return F.none;o=t.charCategorizer(n.head),r=t.sliceDoc(a.from,a.to)}else{let a=n.to-n.from;if(a<e.minSelectionLength||a>200)return F.none;if(e.wholeWords){if(r=t.sliceDoc(n.from,n.to),o=t.charCategorizer(n.head),!(Yf(o,t,n.from,n.to)&&gR(o,t,n.from,n.to)))return F.none}else if(r=t.sliceDoc(n.from,n.to),!r)return F.none}let l=[];for(let a of s.visibleRanges){let h=new Xn(t.doc,r,a.from,a.to);for(;!h.next().done;){let{from:c,to:u}=h.value;if((!o||Yf(o,t,c,u))&&(n.empty&&c<=n.from&&u>=n.to?l.push(mR.range(c,u)):(c>=n.to||u<=n.from)&&l.push(pR.range(c,u)),l.length>e.maxMatches))return F.none}}return F.set(l)}},{decorations:s=>s.decorations}),yR=A.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),vR=({state:s,dispatch:e})=>{let{selection:t}=s,i=S.create(t.ranges.map(n=>s.wordAt(n.head)||S.cursor(n.head)),t.mainIndex);return i.eq(t)?!1:(e(s.update({selection:i})),!0)};function wR(s,e){let{main:t,ranges:i}=s.selection,n=s.wordAt(t.head),r=n&&n.from==t.from&&n.to==t.to;for(let o=!1,l=new Xn(s.doc,e,i[i.length-1].to);;)if(l.next(),l.done){if(o)return null;l=new Xn(s.doc,e,0,Math.max(0,i[i.length-1].from-1)),o=!0}else{if(o&&i.some(a=>a.from==l.value.from))continue;if(r){let a=s.wordAt(l.value.from);if(!a||a.from!=l.value.from||a.to!=l.value.to)continue}return l.value}}const CR=({state:s,dispatch:e})=>{let{ranges:t}=s.selection;if(t.some(r=>r.from===r.to))return vR({state:s,dispatch:e});let i=s.sliceDoc(t[0].from,t[0].to);if(s.selection.ranges.some(r=>s.sliceDoc(r.from,r.to)!=i))return!1;let n=wR(s,i);return n?(e(s.update({selection:s.selection.addRange(S.range(n.from,n.to),!1),effects:A.scrollIntoView(n.to)})),!0):!1},hr=O.define({combine(s){return Ni(s,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new LR(e),scrollToMatch:e=>A.scrollIntoView(e)})}});class iv{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||hR(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,i)=>i=="n"?`
`:i=="r"?"\r":i=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new SR(this):new xR(this)}getCursor(e,t=0,i){let n=e.doc?e:ae.create({doc:e});return i==null&&(i=n.doc.length),this.regexp?kn(this,n,t,i):xn(this,n,t,i)}}class sv{constructor(e){this.spec=e}}function xn(s,e,t,i){return new Xn(e.doc,s.unquoted,t,i,s.caseSensitive?void 0:n=>n.toLowerCase(),s.wholeWord?ER(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function ER(s,e){return(t,i,n,r)=>((r>t||r+n.length<i)&&(r=Math.max(0,t-2),n=s.sliceString(r,Math.min(s.length,i+2))),(e(ca(n,t-r))!=De.Word||e(ua(n,t-r))!=De.Word)&&(e(ua(n,i-r))!=De.Word||e(ca(n,i-r))!=De.Word))}class xR extends sv{constructor(e){super(e)}nextMatch(e,t,i){let n=xn(this.spec,e,i,e.doc.length).nextOverlapping();return n.done&&(n=xn(this.spec,e,0,t).nextOverlapping()),n.done?null:n.value}prevMatchInRange(e,t,i){for(let n=i;;){let r=Math.max(t,n-1e4-this.spec.unquoted.length),o=xn(this.spec,e,r,n),l=null;for(;!o.nextOverlapping().done;)l=o.value;if(l)return l;if(r==t)return null;n-=1e4}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let i=xn(this.spec,e,0,e.doc.length),n=[];for(;!i.next().done;){if(n.length>=t)return null;n.push(i.value)}return n}highlight(e,t,i,n){let r=xn(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.doc.length));for(;!r.next().done;)n(r.value.from,r.value.to)}}function kn(s,e,t,i){return new Zy(e.doc,s.search,{ignoreCase:!s.caseSensitive,test:s.wholeWord?kR(e.charCategorizer(e.selection.main.head)):void 0},t,i)}function ca(s,e){return s.slice(tt(s,e,!1),e)}function ua(s,e){return s.slice(e,tt(s,e))}function kR(s){return(e,t,i)=>!i[0].length||(s(ca(i.input,i.index))!=De.Word||s(ua(i.input,i.index))!=De.Word)&&(s(ua(i.input,i.index+i[0].length))!=De.Word||s(ca(i.input,i.index+i[0].length))!=De.Word)}class SR extends sv{nextMatch(e,t,i){let n=kn(this.spec,e,i,e.doc.length).next();return n.done&&(n=kn(this.spec,e,0,t).next()),n.done?null:n.value}prevMatchInRange(e,t,i){for(let n=1;;n++){let r=Math.max(t,i-n*1e4),o=kn(this.spec,e,r,i),l=null;for(;!o.next().done;)l=o.value;if(l&&(r==t||l.from>r+10))return l;if(r==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g,(t,i)=>i=="$"?"$":i=="&"?e.match[0]:i!="0"&&+i<e.match.length?e.match[i]:t)}matchAll(e,t){let i=kn(this.spec,e,0,e.doc.length),n=[];for(;!i.next().done;){if(n.length>=t)return null;n.push(i.value)}return n}highlight(e,t,i,n){let r=kn(this.spec,e,Math.max(0,t-250),Math.min(i+250,e.doc.length));for(;!r.next().done;)n(r.value.from,r.value.to)}}const io=ee.define(),Gu=ee.define(),bs=it.define({create(s){return new xh(Pc(s).create(),null)},update(s,e){for(let t of e.effects)t.is(io)?s=new xh(t.value.create(),s.panel):t.is(Gu)&&(s=new xh(s.query,t.value?qu:null));return s},provide:s=>Zr.from(s,e=>e.panel)});class xh{constructor(e,t){this.query=e,this.panel=t}}const _R=F.mark({class:"cm-searchMatch"}),RR=F.mark({class:"cm-searchMatch cm-searchMatch-selected"}),TR=Pe.fromClass(class{constructor(s){this.view=s,this.decorations=this.highlight(s.state.field(bs))}update(s){let e=s.state.field(bs);(e!=s.startState.field(bs)||s.docChanged||s.selectionSet||s.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:s,panel:e}){if(!e||!s.spec.valid)return F.none;let{view:t}=this,i=new Rs;for(let n=0,r=t.visibleRanges,o=r.length;n<o;n++){let{from:l,to:a}=r[n];for(;n<o-1&&a>r[n+1].from-2*250;)a=r[++n].to;s.highlight(t.state,l,a,(h,c)=>{let u=t.state.selection.ranges.some(d=>d.from==h&&d.to==c);i.add(h,c,u?RR:_R)})}return i.finish()}},{decorations:s=>s.decorations});function yo(s){return e=>{let t=e.state.field(bs,!1);return t&&t.query.spec.valid?s(e,t):ov(e)}}const da=yo((s,{query:e})=>{let{to:t}=s.state.selection.main,i=e.nextMatch(s.state,t,t);if(!i)return!1;let n=S.single(i.from,i.to),r=s.state.facet(hr);return s.dispatch({selection:n,effects:[$u(s,i),r.scrollToMatch(n.main,s)],userEvent:"select.search"}),rv(s),!0}),fa=yo((s,{query:e})=>{let{state:t}=s,{from:i}=t.selection.main,n=e.prevMatch(t,i,i);if(!n)return!1;let r=S.single(n.from,n.to),o=s.state.facet(hr);return s.dispatch({selection:r,effects:[$u(s,n),o.scrollToMatch(r.main,s)],userEvent:"select.search"}),rv(s),!0}),MR=yo((s,{query:e})=>{let t=e.matchAll(s.state,1e3);return!t||!t.length?!1:(s.dispatch({selection:S.create(t.map(i=>S.range(i.from,i.to))),userEvent:"select.search.matches"}),!0)}),DR=({state:s,dispatch:e})=>{let t=s.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:i,to:n}=t.main,r=[],o=0;for(let l=new Xn(s.doc,s.sliceDoc(i,n));!l.next().done;){if(r.length>1e3)return!1;l.value.from==i&&(o=r.length),r.push(S.range(l.value.from,l.value.to))}return e(s.update({selection:S.create(r,o),userEvent:"select.search.matches"})),!0},Qf=yo((s,{query:e})=>{let{state:t}=s,{from:i,to:n}=t.selection.main;if(t.readOnly)return!1;let r=e.nextMatch(t,i,i);if(!r)return!1;let o=[],l,a,h=[];if(r.from==i&&r.to==n&&(a=t.toText(e.getReplacement(r)),o.push({from:r.from,to:r.to,insert:a}),r=e.nextMatch(t,r.from,r.to),h.push(A.announce.of(t.phrase("replaced match on line $",t.doc.lineAt(i).number)+"."))),r){let c=o.length==0||o[0].from>=r.to?0:r.to-r.from-a.length;l=S.single(r.from-c,r.to-c),h.push($u(s,r)),h.push(t.facet(hr).scrollToMatch(l.main,s))}return s.dispatch({changes:o,selection:l,effects:h,userEvent:"input.replace"}),!0}),AR=yo((s,{query:e})=>{if(s.state.readOnly)return!1;let t=e.matchAll(s.state,1e9).map(n=>{let{from:r,to:o}=n;return{from:r,to:o,insert:e.getReplacement(n)}});if(!t.length)return!1;let i=s.state.phrase("replaced $ matches",t.length)+".";return s.dispatch({changes:t,effects:A.announce.of(i),userEvent:"input.replace.all"}),!0});function qu(s){return s.state.facet(hr).createPanel(s)}function Pc(s,e){var t,i,n,r,o;let l=s.selection.main,a=l.empty||l.to>l.from+100?"":s.sliceDoc(l.from,l.to);if(e&&!a)return e;let h=s.facet(hr);return new iv({search:((t=e==null?void 0:e.literal)!==null&&t!==void 0?t:h.literal)?a:a.replace(/\n/g,"\\n"),caseSensitive:(i=e==null?void 0:e.caseSensitive)!==null&&i!==void 0?i:h.caseSensitive,literal:(n=e==null?void 0:e.literal)!==null&&n!==void 0?n:h.literal,regexp:(r=e==null?void 0:e.regexp)!==null&&r!==void 0?r:h.regexp,wholeWord:(o=e==null?void 0:e.wholeWord)!==null&&o!==void 0?o:h.wholeWord})}function nv(s){let e=Xr(s,qu);return e&&e.dom.querySelector("[main-field]")}function rv(s){let e=nv(s);e&&e==s.root.activeElement&&e.select()}const ov=s=>{let e=s.state.field(bs,!1);if(e&&e.panel){let t=nv(s);if(t&&t!=s.root.activeElement){let i=Pc(s.state,e.query.spec);i.valid&&s.dispatch({effects:io.of(i)}),t.focus(),t.select()}}else s.dispatch({effects:[Gu.of(!0),e?io.of(Pc(s.state,e.query.spec)):ee.appendConfig.of(BR)]});return!0},lv=s=>{let e=s.state.field(bs,!1);if(!e||!e.panel)return!1;let t=Xr(s,qu);return t&&t.dom.contains(s.root.activeElement)&&s.focus(),s.dispatch({effects:Gu.of(!1)}),!0},OR=[{key:"Mod-f",run:ov,scope:"editor search-panel"},{key:"F3",run:da,shift:fa,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:da,shift:fa,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:lv,scope:"editor search-panel"},{key:"Mod-Shift-l",run:DR},{key:"Mod-Alt-g",run:cR},{key:"Mod-d",run:CR,preventDefault:!0}];class LR{constructor(e){this.view=e;let t=this.query=e.state.field(bs).query.spec;this.commit=this.commit.bind(this),this.searchField=xe("input",{value:t.search,placeholder:Tt(e,"Find"),"aria-label":Tt(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=xe("input",{value:t.replace,placeholder:Tt(e,"Replace"),"aria-label":Tt(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=xe("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=xe("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=xe("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function i(n,r,o){return xe("button",{class:"cm-button",name:n,onclick:r,type:"button"},o)}this.dom=xe("div",{onkeydown:n=>this.keydown(n),class:"cm-search"},[this.searchField,i("next",()=>da(e),[Tt(e,"next")]),i("prev",()=>fa(e),[Tt(e,"previous")]),i("select",()=>MR(e),[Tt(e,"all")]),xe("label",null,[this.caseField,Tt(e,"match case")]),xe("label",null,[this.reField,Tt(e,"regexp")]),xe("label",null,[this.wordField,Tt(e,"by word")]),...e.state.readOnly?[]:[xe("br"),this.replaceField,i("replace",()=>Qf(e),[Tt(e,"replace")]),i("replaceAll",()=>AR(e),[Tt(e,"replace all")])],xe("button",{name:"close",onclick:()=>lv(e),"aria-label":Tt(e,"close"),type:"button"},[""])])}commit(){let e=new iv({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:io.of(e)}))}keydown(e){Ux(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?fa:da)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),Qf(this.view))}update(e){for(let t of e.transactions)for(let i of t.effects)i.is(io)&&!i.value.eq(this.query)&&this.setQuery(i.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(hr).top}}function Tt(s,e){return s.state.phrase(e)}const qo=30,$o=/[\s\.,:;?!]/;function $u(s,{from:e,to:t}){let i=s.state.doc.lineAt(e),n=s.state.doc.lineAt(t).to,r=Math.max(i.from,e-qo),o=Math.min(n,t+qo),l=s.state.sliceDoc(r,o);if(r!=i.from){for(let a=0;a<qo;a++)if(!$o.test(l[a+1])&&$o.test(l[a])){l=l.slice(a);break}}if(o!=n){for(let a=l.length-1;a>l.length-qo;a--)if(!$o.test(l[a-1])&&$o.test(l[a])){l=l.slice(0,a);break}}return A.announce.of(`${s.state.phrase("current match")}. ${l} ${s.state.phrase("on line")} ${i.number}.`)}const IR=A.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),BR=[bs,or.low(TR),IR];class av{constructor(e,t,i){this.state=e,this.pos=t,this.explicit=i,this.abortListeners=[]}tokenBefore(e){let t=Ke(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),n=t.text.slice(i-t.from,this.pos-t.from),r=n.search(cv(e,!1));return r<0?null:{from:i+r,to:this.pos,text:n.slice(r)}}get aborted(){return this.abortListeners==null}addEventListener(e,t){e=="abort"&&this.abortListeners&&this.abortListeners.push(t)}}function Jf(s){let e=Object.keys(s).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function FR(s){let e=Object.create(null),t=Object.create(null);for(let{label:n}of s){e[n[0]]=!0;for(let r=1;r<n.length;r++)t[n[r]]=!0}let i=Jf(e)+Jf(t)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function hv(s){let e=s.map(n=>typeof n=="string"?{label:n}:n),[t,i]=e.every(n=>/^\w+$/.test(n.label))?[/\w*$/,/\w+$/]:FR(e);return n=>{let r=n.matchBefore(i);return r||n.explicit?{from:r?r.from:n.pos,options:e,validFor:t}:null}}function PR(s,e){return t=>{for(let i=Ke(t.state).resolveInner(t.pos,-1);i;i=i.parent){if(s.indexOf(i.name)>-1)return null;if(i.type.isTop)break}return e(t)}}class Xf{constructor(e,t,i,n){this.completion=e,this.source=t,this.match=i,this.score=n}}function ys(s){return s.selection.main.from}function cv(s,e){var t;let{source:i}=s,n=e&&i[0]!="^",r=i[i.length-1]!="$";return!n&&!r?s:new RegExp(`${n?"^":""}(?:${i})${r?"$":""}`,(t=s.flags)!==null&&t!==void 0?t:s.ignoreCase?"i":"")}const NR=is.define();function zR(s,e,t,i){let{main:n}=s.selection,r=t-n.from,o=i-n.from;return Object.assign(Object.assign({},s.changeByRange(l=>l!=n&&t!=i&&s.sliceDoc(l.from+r,l.from+o)!=s.sliceDoc(t,i)?{range:l}:{changes:{from:l.from+r,to:i==n.from?l.to:l.from+o,insert:e},range:S.cursor(l.from+r+e.length)})),{scrollIntoView:!0,userEvent:"input.complete"})}const Zf=new WeakMap;function HR(s){if(!Array.isArray(s))return s;let e=Zf.get(s);return e||Zf.set(s,e=hv(s)),e}const pa=ee.define(),so=ee.define();class VR{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let i=Qe(e,t),n=qt(i);this.chars.push(i);let r=e.slice(t,t+n),o=r.toUpperCase();this.folded.push(Qe(o==r?r.toLowerCase():o,0)),t+=n}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,!0}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return!1;let{chars:t,folded:i,any:n,precise:r,byWord:o}=this;if(t.length==1){let v=Qe(e,0),C=qt(v),x=C==e.length?0:-100;if(v!=t[0])if(v==i[0])x+=-200;else return!1;return this.ret(x,[0,C])}let l=e.indexOf(this.pattern);if(l==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let a=t.length,h=0;if(l<0){for(let v=0,C=Math.min(e.length,200);v<C&&h<a;){let x=Qe(e,v);(x==t[h]||x==i[h])&&(n[h++]=v),v+=qt(x)}if(h<a)return!1}let c=0,u=0,d=!1,f=0,p=-1,m=-1,g=/[a-z]/.test(e),b=!0;for(let v=0,C=Math.min(e.length,200),x=0;v<C&&u<a;){let w=Qe(e,v);l<0&&(c<a&&w==t[c]&&(r[c++]=v),f<a&&(w==t[f]||w==i[f]?(f==0&&(p=v),m=v+1,f++):f=0));let E,k=w<255?w>=48&&w<=57||w>=97&&w<=122?2:w>=65&&w<=90?1:0:(E=Eu(w))!=E.toLowerCase()?1:E!=E.toUpperCase()?2:0;(!v||k==1&&g||x==0&&k!=0)&&(t[u]==w||i[u]==w&&(d=!0)?o[u++]=v:o.length&&(b=!1)),x=k,v+=qt(w)}return u==a&&o[0]==0&&b?this.result(-100+(d?-200:0),o,e):f==a&&p==0?this.ret(-200-e.length+(m==e.length?0:-100),[0,m]):l>-1?this.ret(-700-e.length,[l,l+this.pattern.length]):f==a?this.ret(-900-e.length,[p,m]):u==a?this.result(-100+(d?-200:0)+-700+(b?0:-1100),o,e):t.length==2?!1:this.result((n[0]?-700:0)+-200+-1100,n,e)}result(e,t,i){let n=[],r=0;for(let o of t){let l=o+(this.astral?qt(Qe(i,o)):1);r&&n[r-1]==o?n[r-1]=l:(n[r++]=o,n[r++]=l)}return this.ret(e-i.length,n)}}const et=O.define({combine(s){return Ni(s,{activateOnTyping:!0,activateOnTypingDelay:100,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:WR,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>i=>ep(e(i),t(i)),optionClass:(e,t)=>i=>ep(e(i),t(i)),addToOptions:(e,t)=>e.concat(t)})}});function ep(s,e){return s?e?s+" "+e:s:e}function WR(s,e,t,i,n,r){let o=s.textDirection==_e.RTL,l=o,a=!1,h="top",c,u,d=e.left-n.left,f=n.right-e.right,p=i.right-i.left,m=i.bottom-i.top;if(l&&d<Math.min(p,f)?l=!1:!l&&f<Math.min(p,d)&&(l=!0),p<=(l?d:f))c=Math.max(n.top,Math.min(t.top,n.bottom-m))-e.top,u=Math.min(400,l?d:f);else{a=!0,u=Math.min(400,(o?e.right:n.right-e.left)-30);let v=n.bottom-e.bottom;v>=m||v>e.top?c=t.bottom-e.top:(h="bottom",c=e.bottom-t.top)}let g=(e.bottom-e.top)/r.offsetHeight,b=(e.right-e.left)/r.offsetWidth;return{style:`${h}: ${c/g}px; max-width: ${u/b}px`,class:"cm-completionInfo-"+(a?o?"left-narrow":"right-narrow":l?"left":"right")}}function UR(s){let e=s.addToOptions.slice();return s.icons&&e.push({render(t){let i=document.createElement("div");return i.classList.add("cm-completionIcon"),t.type&&i.classList.add(...t.type.split(/\s+/g).map(n=>"cm-completionIcon-"+n)),i.setAttribute("aria-hidden","true"),i},position:20}),e.push({render(t,i,n,r){let o=document.createElement("span");o.className="cm-completionLabel";let l=t.displayLabel||t.label,a=0;for(let h=0;h<r.length;){let c=r[h++],u=r[h++];c>a&&o.appendChild(document.createTextNode(l.slice(a,c)));let d=o.appendChild(document.createElement("span"));d.appendChild(document.createTextNode(l.slice(c,u))),d.className="cm-completionMatchedText",a=u}return a<l.length&&o.appendChild(document.createTextNode(l.slice(a))),o},position:50},{render(t){if(!t.detail)return null;let i=document.createElement("span");return i.className="cm-completionDetail",i.textContent=t.detail,i},position:80}),e.sort((t,i)=>t.position-i.position).map(t=>t.render)}function kh(s,e,t){if(s<=t)return{from:0,to:s};if(e<0&&(e=0),e<=s>>1){let n=Math.floor(e/t);return{from:n*t,to:(n+1)*t}}let i=Math.floor((s-e)/t);return{from:s-(i+1)*t,to:s-i*t}}class jR{constructor(e,t,i){this.view=e,this.stateField=t,this.applyCompletion=i,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:a=>this.placeInfo(a),key:this},this.space=null,this.currentClass="";let n=e.state.field(t),{options:r,selected:o}=n.open,l=e.state.facet(et);this.optionContent=UR(l),this.optionClass=l.optionClass,this.tooltipClass=l.tooltipClass,this.range=kh(r.length,o,l.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",a=>{let{options:h}=e.state.field(t).open;for(let c=a.target,u;c&&c!=this.dom;c=c.parentNode)if(c.nodeName=="LI"&&(u=/-(\d+)$/.exec(c.id))&&+u[1]<h.length){this.applyCompletion(e,h[+u[1]]),a.preventDefault();return}}),this.dom.addEventListener("focusout",a=>{let h=e.state.field(this.stateField,!1);h&&h.tooltip&&e.state.facet(et).closeOnBlur&&a.relatedTarget!=e.contentDOM&&e.dispatch({effects:so.of(null)})}),this.showOptions(r,n.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let i=e.state.field(this.stateField),n=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),i!=n){let{options:r,selected:o,disabled:l}=i.open;(!n.open||n.open.options!=r)&&(this.range=kh(r.length,o,e.state.facet(et).maxRenderedOptions),this.showOptions(r,i.id)),this.updateSel(),l!=((t=n.open)===null||t===void 0?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!l)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let i of this.currentClass.split(" "))i&&this.dom.classList.remove(i);for(let i of t.split(" "))i&&this.dom.classList.add(i);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=kh(t.options.length,t.selected,this.view.state.facet(et).maxRenderedOptions),this.showOptions(t.options,e.id)),this.updateSelectedOption(t.selected)){this.destroyInfo();let{completion:i}=t.options[t.selected],{info:n}=i;if(!n)return;let r=typeof n=="string"?document.createTextNode(n):n(i);if(!r)return;"then"in r?r.then(o=>{o&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(o,i)}).catch(o=>Yt(this.view.state,o,"completion info")):this.addInfoPane(r,i)}}addInfoPane(e,t){this.destroyInfo();let i=this.info=document.createElement("div");if(i.className="cm-tooltip cm-completionInfo",e.nodeType!=null)i.appendChild(e),this.infoDestroy=null;else{let{dom:n,destroy:r}=e;i.appendChild(n),this.infoDestroy=r||null}this.dom.appendChild(i),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,n=this.range.from;i;i=i.nextSibling,n++)i.nodeName!="LI"||!i.id?n--:n==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return t&&qR(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),n=e.getBoundingClientRect(),r=this.space;if(!r){let o=this.dom.ownerDocument.defaultView||window;r={left:0,top:0,right:o.innerWidth,bottom:o.innerHeight}}return n.top>Math.min(r.bottom,t.bottom)-10||n.bottom<Math.max(r.top,t.top)+10?null:this.view.state.facet(et).positionInfo(this.view,t,n,i,r,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,i){const n=document.createElement("ul");n.id=t,n.setAttribute("role","listbox"),n.setAttribute("aria-expanded","true"),n.setAttribute("aria-label",this.view.state.phrase("Completions"));let r=null;for(let o=i.from;o<i.to;o++){let{completion:l,match:a}=e[o],{section:h}=l;if(h){let d=typeof h=="string"?h:h.name;if(d!=r&&(o>i.from||i.from==0))if(r=d,typeof h!="string"&&h.header)n.appendChild(h.header(h));else{let f=n.appendChild(document.createElement("completion-section"));f.textContent=d}}const c=n.appendChild(document.createElement("li"));c.id=t+"-"+o,c.setAttribute("role","option");let u=this.optionClass(l);u&&(c.className=u);for(let d of this.optionContent){let f=d(l,this.view.state,this.view,a);f&&c.appendChild(f)}}return i.from&&n.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&n.classList.add("cm-completionListIncompleteBottom"),n}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function GR(s,e){return t=>new jR(t,s,e)}function qR(s,e){let t=s.getBoundingClientRect(),i=e.getBoundingClientRect(),n=t.height/s.offsetHeight;i.top<t.top?s.scrollTop-=(t.top-i.top)/n:i.bottom>t.bottom&&(s.scrollTop+=(i.bottom-t.bottom)/n)}function tp(s){return(s.boost||0)*100+(s.apply?10:0)+(s.info?5:0)+(s.type?1:0)}function $R(s,e){let t=[],i=null,n=a=>{t.push(a);let{section:h}=a.completion;if(h){i||(i=[]);let c=typeof h=="string"?h:h.name;i.some(u=>u.name==c)||i.push(typeof h=="string"?{name:c}:h)}};for(let a of s)if(a.hasResult()){let h=a.result.getMatch;if(a.result.filter===!1)for(let c of a.result.options)n(new Xf(c,a.source,h?h(c):[],1e9-t.length));else{let c=new VR(e.sliceDoc(a.from,a.to));for(let u of a.result.options)if(c.match(u.label)){let d=u.displayLabel?h?h(u,c.matched):[]:c.matched;n(new Xf(u,a.source,d,c.score+(u.boost||0)))}}}if(i){let a=Object.create(null),h=0,c=(u,d)=>{var f,p;return((f=u.rank)!==null&&f!==void 0?f:1e9)-((p=d.rank)!==null&&p!==void 0?p:1e9)||(u.name<d.name?-1:1)};for(let u of i.sort(c))h-=1e5,a[u.name]=h;for(let u of t){let{section:d}=u.completion;d&&(u.score+=a[typeof d=="string"?d:d.name])}}let r=[],o=null,l=e.facet(et).compareCompletions;for(let a of t.sort((h,c)=>c.score-h.score||l(h.completion,c.completion))){let h=a.completion;!o||o.label!=h.label||o.detail!=h.detail||o.type!=null&&h.type!=null&&o.type!=h.type||o.apply!=h.apply||o.boost!=h.boost?r.push(a):tp(a.completion)>tp(o)&&(r[r.length-1]=a),o=a.completion}return r}class Tn{constructor(e,t,i,n,r,o){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=n,this.selected=r,this.disabled=o}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new Tn(this.options,ip(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,i,n,r){let o=$R(e,t);if(!o.length)return n&&e.some(a=>a.state==1)?new Tn(n.options,n.attrs,n.tooltip,n.timestamp,n.selected,!0):null;let l=t.facet(et).selectOnOpen?0:-1;if(n&&n.selected!=l&&n.selected!=-1){let a=n.options[n.selected].completion;for(let h=0;h<o.length;h++)if(o[h].completion==a){l=h;break}}return new Tn(o,ip(i,l),{pos:e.reduce((a,h)=>h.hasResult()?Math.min(a,h.from):a,1e8),create:XR,above:r.aboveCursor},n?n.timestamp:Date.now(),l,!1)}map(e){return new Tn(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class ma{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new ma(QR,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,i=t.facet(et),r=(i.override||t.languageDataAt("autocomplete",ys(t)).map(HR)).map(l=>(this.active.find(h=>h.source==l)||new Et(l,this.active.some(h=>h.state!=0)?1:0)).update(e,i));r.length==this.active.length&&r.every((l,a)=>l==this.active[a])&&(r=this.active);let o=this.open;o&&e.docChanged&&(o=o.map(e.changes)),e.selection||r.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!KR(r,this.active)?o=Tn.build(r,t,this.id,o,i):o&&o.disabled&&!r.some(l=>l.state==1)&&(o=null),!o&&r.every(l=>l.state!=1)&&r.some(l=>l.hasResult())&&(r=r.map(l=>l.hasResult()?new Et(l.source,0):l));for(let l of e.effects)l.is(dv)&&(o=o&&o.setSelected(l.value,this.id));return r==this.active&&o==this.open?this:new ma(r,this.id,o)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:YR}}function KR(s,e){if(s==e)return!0;for(let t=0,i=0;;){for(;t<s.length&&!s[t].hasResult;)t++;for(;i<e.length&&!e[i].hasResult;)i++;let n=t==s.length,r=i==e.length;if(n||r)return n==r;if(s[t++].result!=e[i++].result)return!1}}const YR={"aria-autocomplete":"list"};function ip(s,e){let t={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":s};return e>-1&&(t["aria-activedescendant"]=s+"-"+e),t}const QR=[];function Nc(s){return s.isUserEvent("input.type")?"input":s.isUserEvent("delete.backward")?"delete":null}class Et{constructor(e,t,i=-1){this.source=e,this.state=t,this.explicitPos=i}hasResult(){return!1}update(e,t){let i=Nc(e),n=this;i?n=n.handleUserEvent(e,i,t):e.docChanged?n=n.handleChange(e):e.selection&&n.state!=0&&(n=new Et(n.source,0));for(let r of e.effects)if(r.is(pa))n=new Et(n.source,1,r.value?ys(e.state):-1);else if(r.is(so))n=new Et(n.source,0);else if(r.is(uv))for(let o of r.value)o.source==n.source&&(n=o);return n}handleUserEvent(e,t,i){return t=="delete"||!i.activateOnTyping?this.map(e.changes):new Et(this.source,1)}handleChange(e){return e.changes.touchesRange(ys(e.startState))?new Et(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new Et(this.source,this.state,e.mapPos(this.explicitPos))}}class Hn extends Et{constructor(e,t,i,n,r){super(e,2,t),this.result=i,this.from=n,this.to=r}hasResult(){return!0}handleUserEvent(e,t,i){var n;let r=e.changes.mapPos(this.from),o=e.changes.mapPos(this.to,1),l=ys(e.state);if((this.explicitPos<0?l<=r:l<this.from)||l>o||t=="delete"&&ys(e.startState)==this.from)return new Et(this.source,t=="input"&&i.activateOnTyping?1:0);let a=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),h;return JR(this.result.validFor,e.state,r,o)?new Hn(this.source,a,this.result,r,o):this.result.update&&(h=this.result.update(this.result,r,o,new av(e.state,l,a>=0)))?new Hn(this.source,a,h,h.from,(n=h.to)!==null&&n!==void 0?n:ys(e.state)):new Et(this.source,1,a)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new Et(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new Hn(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}function JR(s,e,t,i){if(!s)return!1;let n=e.sliceDoc(t,i);return typeof s=="function"?s(n,t,i,e):cv(s,!0).test(n)}const uv=ee.define({map(s,e){return s.map(t=>t.map(e))}}),dv=ee.define(),It=it.define({create(){return ma.start()},update(s,e){return s.update(e)},provide:s=>[Lu.from(s,e=>e.tooltip),A.contentAttributes.from(s,e=>e.attrs)]});function fv(s,e){const t=e.completion.apply||e.completion.label;let i=s.state.field(It).active.find(n=>n.source==e.source);return i instanceof Hn?(typeof t=="string"?s.dispatch(Object.assign(Object.assign({},zR(s.state,t,i.from,i.to)),{annotations:NR.of(e.completion)})):t(s,e.completion,i.from,i.to),!0):!1}const XR=GR(It,fv);function Ko(s,e="option"){return t=>{let i=t.state.field(It,!1);if(!i||!i.open||i.open.disabled||Date.now()-i.open.timestamp<t.state.facet(et).interactionDelay)return!1;let n=1,r;e=="page"&&(r=$b(t,i.open.tooltip))&&(n=Math.max(2,Math.floor(r.dom.offsetHeight/r.dom.querySelector("li").offsetHeight)-1));let{length:o}=i.open.options,l=i.open.selected>-1?i.open.selected+n*(s?1:-1):s?0:o-1;return l<0?l=e=="page"?0:o-1:l>=o&&(l=e=="page"?o-1:0),t.dispatch({effects:dv.of(l)}),!0}}const ZR=s=>{let e=s.state.field(It,!1);return s.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<s.state.facet(et).interactionDelay?!1:fv(s,e.open.options[e.open.selected])},eT=s=>s.state.field(It,!1)?(s.dispatch({effects:pa.of(!0)}),!0):!1,tT=s=>{let e=s.state.field(It,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(s.dispatch({effects:so.of(null)}),!0)};class iT{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const sT=50,nT=1e3,rT=Pe.fromClass(class{constructor(s){this.view=s,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.pendingStart=!1,this.composing=0;for(let e of s.state.field(It).active)e.state==1&&this.startQuery(e)}update(s){let e=s.state.field(It);if(!s.selectionSet&&!s.docChanged&&s.startState.field(It)==e)return;let t=s.transactions.some(n=>(n.selection||n.docChanged)&&!Nc(n));for(let n=0;n<this.running.length;n++){let r=this.running[n];if(t||r.updates.length+s.transactions.length>sT&&Date.now()-r.time>nT){for(let o of r.context.abortListeners)try{o()}catch(l){Yt(this.view.state,l)}r.context.abortListeners=null,this.running.splice(n--,1)}else r.updates.push(...s.transactions)}this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),s.transactions.some(n=>n.effects.some(r=>r.is(pa)))&&(this.pendingStart=!0);let i=this.pendingStart?50:s.state.facet(et).activateOnTypingDelay;if(this.debounceUpdate=e.active.some(n=>n.state==1&&!this.running.some(r=>r.active.source==n.source))?setTimeout(()=>this.startUpdate(),i):-1,this.composing!=0)for(let n of s.transactions)Nc(n)=="input"?this.composing=2:this.composing==2&&n.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1,this.pendingStart=!1;let{state:s}=this.view,e=s.field(It);for(let t of e.active)t.state==1&&!this.running.some(i=>i.active.source==t.source)&&this.startQuery(t)}startQuery(s){let{state:e}=this.view,t=ys(e),i=new av(e,t,s.explicitPos==t),n=new iT(s,i);this.running.push(n),Promise.resolve(s.source(i)).then(r=>{n.context.aborted||(n.done=r||null,this.scheduleAccept())},r=>{this.view.dispatch({effects:so.of(null)}),Yt(this.view.state,r)})}scheduleAccept(){this.running.every(s=>s.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(et).updateSyncTime))}accept(){var s;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(et);for(let i=0;i<this.running.length;i++){let n=this.running[i];if(n.done===void 0)continue;if(this.running.splice(i--,1),n.done){let o=new Hn(n.active.source,n.active.explicitPos,n.done,n.done.from,(s=n.done.to)!==null&&s!==void 0?s:ys(n.updates.length?n.updates[0].startState:this.view.state));for(let l of n.updates)o=o.update(l,t);if(o.hasResult()){e.push(o);continue}}let r=this.view.state.field(It).active.find(o=>o.source==n.active.source);if(r&&r.state==1)if(n.done==null){let o=new Et(n.active.source,0);for(let l of n.updates)o=o.update(l,t);o.state!=1&&e.push(o)}else this.startQuery(r)}e.length&&this.view.dispatch({effects:uv.of(e)})}},{eventHandlers:{blur(s){let e=this.view.state.field(It,!1);if(e&&e.tooltip&&this.view.state.facet(et).closeOnBlur){let t=e.open&&$b(this.view,e.open.tooltip);(!t||!t.dom.contains(s.relatedTarget))&&setTimeout(()=>this.view.dispatch({effects:so.of(null)}),10)}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:pa.of(!1)}),20),this.composing=0}}}),oT=A.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'""',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"''"}},".cm-completionIcon-class":{"&:after":{content:"''"}},".cm-completionIcon-interface":{"&:after":{content:"''"}},".cm-completionIcon-variable":{"&:after":{content:"''"}},".cm-completionIcon-constant":{"&:after":{content:"''"}},".cm-completionIcon-type":{"&:after":{content:"''"}},".cm-completionIcon-enum":{"&:after":{content:"''"}},".cm-completionIcon-property":{"&:after":{content:"''"}},".cm-completionIcon-keyword":{"&:after":{content:"''"}},".cm-completionIcon-namespace":{"&:after":{content:"''"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),no={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},Ys=ee.define({map(s,e){let t=e.mapPos(s,-1,ut.TrackAfter);return t??void 0}}),Ku=new class extends rn{};Ku.startSide=1;Ku.endSide=-1;const pv=it.define({create(){return he.empty},update(s,e){if(s=s.map(e.changes),e.selection){let t=e.state.doc.lineAt(e.selection.main.head);s=s.update({filter:i=>i>=t.from&&i<=t.to})}for(let t of e.effects)t.is(Ys)&&(s=s.update({add:[Ku.range(t.value,t.value+1)]}));return s}});function lT(){return[hT,pv]}const Sh="()[]{}<>";function mv(s){for(let e=0;e<Sh.length;e+=2)if(Sh.charCodeAt(e)==s)return Sh.charAt(e+1);return Eu(s<128?s:s+1)}function gv(s,e){return s.languageDataAt("closeBrackets",e)[0]||no}const aT=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),hT=A.inputHandler.of((s,e,t,i)=>{if((aT?s.composing:s.compositionStarted)||s.state.readOnly)return!1;let n=s.state.selection.main;if(i.length>2||i.length==2&&qt(Qe(i,0))==1||e!=n.from||t!=n.to)return!1;let r=dT(s.state,i);return r?(s.dispatch(r),!0):!1}),cT=({state:s,dispatch:e})=>{if(s.readOnly)return!1;let i=gv(s,s.selection.main.head).brackets||no.brackets,n=null,r=s.changeByRange(o=>{if(o.empty){let l=fT(s.doc,o.head);for(let a of i)if(a==l&&Na(s.doc,o.head)==mv(Qe(a,0)))return{changes:{from:o.head-a.length,to:o.head+a.length},range:S.cursor(o.head-a.length)}}return{range:n=o}});return n||e(s.update(r,{scrollIntoView:!0,userEvent:"delete.backward"})),!n},uT=[{key:"Backspace",run:cT}];function dT(s,e){let t=gv(s,s.selection.main.head),i=t.brackets||no.brackets;for(let n of i){let r=mv(Qe(n,0));if(e==n)return r==n?gT(s,n,i.indexOf(n+n+n)>-1,t):pT(s,n,r,t.before||no.before);if(e==r&&bv(s,s.selection.main.from))return mT(s,n,r)}return null}function bv(s,e){let t=!1;return s.field(pv).between(0,s.doc.length,i=>{i==e&&(t=!0)}),t}function Na(s,e){let t=s.sliceString(e,e+2);return t.slice(0,qt(Qe(t,0)))}function fT(s,e){let t=s.sliceString(e-2,e);return qt(Qe(t,0))==t.length?t:t.slice(1)}function pT(s,e,t,i){let n=null,r=s.changeByRange(o=>{if(!o.empty)return{changes:[{insert:e,from:o.from},{insert:t,from:o.to}],effects:Ys.of(o.to+e.length),range:S.range(o.anchor+e.length,o.head+e.length)};let l=Na(s.doc,o.head);return!l||/\s/.test(l)||i.indexOf(l)>-1?{changes:{insert:e+t,from:o.head},effects:Ys.of(o.head+e.length),range:S.cursor(o.head+e.length)}:{range:n=o}});return n?null:s.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function mT(s,e,t){let i=null,n=s.changeByRange(r=>r.empty&&Na(s.doc,r.head)==t?{changes:{from:r.head,to:r.head+t.length,insert:t},range:S.cursor(r.head+t.length)}:i={range:r});return i?null:s.update(n,{scrollIntoView:!0,userEvent:"input.type"})}function gT(s,e,t,i){let n=i.stringPrefixes||no.stringPrefixes,r=null,o=s.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:e,from:l.to}],effects:Ys.of(l.to+e.length),range:S.range(l.anchor+e.length,l.head+e.length)};let a=l.head,h=Na(s.doc,a),c;if(h==e){if(sp(s,a))return{changes:{insert:e+e,from:a},effects:Ys.of(a+e.length),range:S.cursor(a+e.length)};if(bv(s,a)){let d=t&&s.sliceDoc(a,a+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:a,to:a+d.length,insert:d},range:S.cursor(a+d.length)}}}else{if(t&&s.sliceDoc(a-2*e.length,a)==e+e&&(c=np(s,a-2*e.length,n))>-1&&sp(s,c))return{changes:{insert:e+e+e+e,from:a},effects:Ys.of(a+e.length),range:S.cursor(a+e.length)};if(s.charCategorizer(a)(h)!=De.Word&&np(s,a,n)>-1&&!bT(s,a,e,n))return{changes:{insert:e+e,from:a},effects:Ys.of(a+e.length),range:S.cursor(a+e.length)}}return{range:r=l}});return r?null:s.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function sp(s,e){let t=Ke(s).resolveInner(e+1);return t.parent&&t.from==e}function bT(s,e,t,i){let n=Ke(s).resolveInner(e,-1),r=i.reduce((o,l)=>Math.max(o,l.length),0);for(let o=0;o<5;o++){let l=s.sliceDoc(n.from,Math.min(n.to,n.from+t.length+r)),a=l.indexOf(t);if(!a||a>-1&&i.indexOf(l.slice(0,a))>-1){let c=n.firstChild;for(;c&&c.from==n.from&&c.to-c.from>t.length+a;){if(s.sliceDoc(c.to-t.length,c.to)==t)return!1;c=c.firstChild}return!0}let h=n.to==e&&n.parent;if(!h)break;n=h}return!1}function np(s,e,t){let i=s.charCategorizer(e);if(i(s.sliceDoc(e-1,e))!=De.Word)return e;for(let n of t){let r=e-n.length;if(s.sliceDoc(r,e)==n&&i(s.sliceDoc(r-1,r))!=De.Word)return r}return-1}function yT(s={}){return[It,et.of(s),rT,vT,oT]}const yv=[{key:"Ctrl-Space",run:eT},{key:"Escape",run:tT},{key:"ArrowDown",run:Ko(!0)},{key:"ArrowUp",run:Ko(!1)},{key:"PageDown",run:Ko(!0,"page")},{key:"PageUp",run:Ko(!1,"page")},{key:"Enter",run:ZR}],vT=or.highest(Ta.computeN([et],s=>s.facet(et).defaultKeymap?[yv]:[]));class wT{constructor(e,t,i){this.from=e,this.to=t,this.diagnostic=i}}class Ws{constructor(e,t,i){this.diagnostics=e,this.panel=t,this.selected=i}static init(e,t,i){let n=e,r=i.facet(Cv).markerFilter;r&&(n=r(n,i));let o=F.set(n.map(l=>l.from==l.to||l.from==l.to-1&&i.doc.lineAt(l.from).to==l.from?F.widget({widget:new MT(l),diagnostic:l}).range(l.from):F.mark({attributes:{class:"cm-lintRange cm-lintRange-"+l.severity+(l.markClass?" "+l.markClass:"")},diagnostic:l,inclusive:!0}).range(l.from,l.to)),!0);return new Ws(o,t,Zn(o))}}function Zn(s,e=null,t=0){let i=null;return s.between(t,1e9,(n,r,{spec:o})=>{if(!(e&&o.diagnostic!=e))return i=new wT(n,r,o.diagnostic),!1}),i}function CT(s,e){let t=s.startState.doc.lineAt(e.pos);return!!(s.effects.some(i=>i.is(vv))||s.changes.touchesRange(t.from,t.to))}function ET(s,e){return s.field(Ft,!1)?e:e.concat(ee.appendConfig.of(OT))}const vv=ee.define(),Yu=ee.define(),wv=ee.define(),Ft=it.define({create(){return new Ws(F.none,null,null)},update(s,e){if(e.docChanged){let t=s.diagnostics.map(e.changes),i=null;if(s.selected){let n=e.changes.mapPos(s.selected.from,1);i=Zn(t,s.selected.diagnostic,n)||Zn(t,null,n)}s=new Ws(t,s.panel,i)}for(let t of e.effects)t.is(vv)?s=Ws.init(t.value,s.panel,e.state):t.is(Yu)?s=new Ws(s.diagnostics,t.value?za.open:null,s.selected):t.is(wv)&&(s=new Ws(s.diagnostics,s.panel,t.value));return s},provide:s=>[Zr.from(s,e=>e.panel),A.decorations.from(s,e=>e.diagnostics)]}),xT=F.mark({class:"cm-lintRange cm-lintRange-active",inclusive:!0});function kT(s,e,t){let{diagnostics:i}=s.state.field(Ft),n=[],r=2e8,o=0;i.between(e-(t<0?1:0),e+(t>0?1:0),(a,h,{spec:c})=>{e>=a&&e<=h&&(a==h||(e>a||t>0)&&(e<h||t<0))&&(n.push(c.diagnostic),r=Math.min(a,r),o=Math.max(h,o))});let l=s.state.facet(Cv).tooltipFilter;return l&&(n=l(n,s.state)),n.length?{pos:r,end:o,above:s.state.doc.lineAt(r).to<o,create(){return{dom:ST(s,n)}}}:null}function ST(s,e){return xe("ul",{class:"cm-tooltip-lint"},e.map(t=>xv(s,t,!1)))}const _T=s=>{let e=s.state.field(Ft,!1);(!e||!e.panel)&&s.dispatch({effects:ET(s.state,[Yu.of(!0)])});let t=Xr(s,za.open);return t&&t.dom.querySelector(".cm-panel-lint ul").focus(),!0},rp=s=>{let e=s.state.field(Ft,!1);return!e||!e.panel?!1:(s.dispatch({effects:Yu.of(!1)}),!0)},RT=s=>{let e=s.state.field(Ft,!1);if(!e)return!1;let t=s.state.selection.main,i=e.diagnostics.iter(t.to+1);return!i.value&&(i=e.diagnostics.iter(0),!i.value||i.from==t.from&&i.to==t.to)?!1:(s.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0}),!0)},TT=[{key:"Mod-Shift-m",run:_T,preventDefault:!0},{key:"F8",run:RT}],Cv=O.define({combine(s){return Object.assign({sources:s.map(e=>e.source).filter(e=>e!=null)},Ni(s.map(e=>e.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null},{needsRefresh:(e,t)=>e?t?i=>e(i)||t(i):e:t}))}});function Ev(s){let e=[];if(s)e:for(let{name:t}of s){for(let i=0;i<t.length;i++){let n=t[i];if(/[a-zA-Z]/.test(n)&&!e.some(r=>r.toLowerCase()==n.toLowerCase())){e.push(n);continue e}}e.push("")}return e}function xv(s,e,t){var i;let n=t?Ev(e.actions):[];return xe("li",{class:"cm-diagnostic cm-diagnostic-"+e.severity},xe("span",{class:"cm-diagnosticText"},e.renderMessage?e.renderMessage():e.message),(i=e.actions)===null||i===void 0?void 0:i.map((r,o)=>{let l=!1,a=d=>{if(d.preventDefault(),l)return;l=!0;let f=Zn(s.state.field(Ft).diagnostics,e);f&&r.apply(s,f.from,f.to)},{name:h}=r,c=n[o]?h.indexOf(n[o]):-1,u=c<0?h:[h.slice(0,c),xe("u",h.slice(c,c+1)),h.slice(c+1)];return xe("button",{type:"button",class:"cm-diagnosticAction",onclick:a,onmousedown:a,"aria-label":` Action: ${h}${c<0?"":` (access key "${n[o]})"`}.`},u)}),e.source&&xe("div",{class:"cm-diagnosticSource"},e.source))}class MT extends ss{constructor(e){super(),this.diagnostic=e}eq(e){return e.diagnostic==this.diagnostic}toDOM(){return xe("span",{class:"cm-lintPoint cm-lintPoint-"+this.diagnostic.severity})}}class op{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=xv(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}}class za{constructor(e){this.view=e,this.items=[];let t=n=>{if(n.keyCode==27)rp(this.view),this.view.focus();else if(n.keyCode==38||n.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(n.keyCode==40||n.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(n.keyCode==36)this.moveSelection(0);else if(n.keyCode==35)this.moveSelection(this.items.length-1);else if(n.keyCode==13)this.view.focus();else if(n.keyCode>=65&&n.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:r}=this.items[this.selectedIndex],o=Ev(r.actions);for(let l=0;l<o.length;l++)if(o[l].toUpperCase().charCodeAt(0)==n.keyCode){let a=Zn(this.view.state.field(Ft).diagnostics,r);a&&r.actions[l].apply(e,a.from,a.to)}}else return;n.preventDefault()},i=n=>{for(let r=0;r<this.items.length;r++)this.items[r].dom.contains(n.target)&&this.moveSelection(r)};this.list=xe("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:t,onclick:i}),this.dom=xe("div",{class:"cm-panel-lint"},this.list,xe("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>rp(this.view)},"")),this.update()}get selectedIndex(){let e=this.view.state.field(Ft).selected;if(!e)return-1;for(let t=0;t<this.items.length;t++)if(this.items[t].diagnostic==e.diagnostic)return t;return-1}update(){let{diagnostics:e,selected:t}=this.view.state.field(Ft),i=0,n=!1,r=null;for(e.between(0,this.view.state.doc.length,(o,l,{spec:a})=>{let h=-1,c;for(let u=i;u<this.items.length;u++)if(this.items[u].diagnostic==a.diagnostic){h=u;break}h<0?(c=new op(this.view,a.diagnostic),this.items.splice(i,0,c),n=!0):(c=this.items[h],h>i&&(this.items.splice(i,h-i),n=!0)),t&&c.diagnostic==t.diagnostic?c.dom.hasAttribute("aria-selected")||(c.dom.setAttribute("aria-selected","true"),r=c):c.dom.hasAttribute("aria-selected")&&c.dom.removeAttribute("aria-selected"),i++});i<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)n=!0,this.items.pop();this.items.length==0&&(this.items.push(new op(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),n=!0),r?(this.list.setAttribute("aria-activedescendant",r.id),this.view.requestMeasure({key:this,read:()=>({sel:r.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:o,panel:l})=>{let a=l.height/this.list.offsetHeight;o.top<l.top?this.list.scrollTop-=(l.top-o.top)/a:o.bottom>l.bottom&&(this.list.scrollTop+=(o.bottom-l.bottom)/a)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),n&&this.sync()}sync(){let e=this.list.firstChild;function t(){let i=e;e=i.nextSibling,i.remove()}for(let i of this.items)if(i.dom.parentNode==this.list){for(;e!=i.dom;)t();e=i.dom.nextSibling}else this.list.insertBefore(i.dom,e);for(;e;)t()}moveSelection(e){if(this.selectedIndex<0)return;let t=this.view.state.field(Ft),i=Zn(t.diagnostics,this.items[e].diagnostic);i&&this.view.dispatch({selection:{anchor:i.from,head:i.to},scrollIntoView:!0,effects:wv.of(i)})}static open(e){return new za(e)}}function DT(s,e='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${e}>${encodeURIComponent(s)}</svg>')`}function Yo(s){return DT(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${s}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}const AT=A.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:Yo("#d11")},".cm-lintRange-warning":{backgroundImage:Yo("orange")},".cm-lintRange-info":{backgroundImage:Yo("#999")},".cm-lintRange-hint":{backgroundImage:Yo("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}}),OT=[Ft,A.decorations.compute([Ft],s=>{let{selected:e,panel:t}=s.field(Ft);return!e||!t||e.from==e.to?F.none:F.set([xT.range(e.from,e.to)])}),Ak(kT,{hideOn:CT}),AT],LT=[Hk(),Uk(),ok(),l_(),LS(),Yx(),ek(),ae.allowMultipleSelections.of(!0),wS(),BS(NS,{fallback:!0}),GS(),lT(),yT(),wk(),xk(),dk(),fR(),Ta.of([...uT,...lR,...OR,...g_,...MS,...yv,...TT])];function IT(s,e,t=!1){let i;return function(...r){const o=this;i?clearTimeout(i):t&&s.apply(o,r),i=setTimeout(l,e||100);function l(){t||s.apply(o,r),i=null}}}function BT(s){let e,t,i='<div class="scm-loading__spinner svelte-kcx0g9"></div> <p class="scm-loading__text svelte-kcx0g9">Loading editor...</p>',n,r,o,l;return{c(){e=Ae("div"),t=Ae("div"),t.innerHTML=i,n=Vt(),r=Ae("pre"),o=jc(s[0]),this.h()},l(a){e=Oe(a,"DIV",{class:!0});var h=ze(e);t=Oe(h,"DIV",{class:!0,"data-svelte-h":!0}),Hs(t)!=="svelte-1pxusly"&&(t.innerHTML=i),n=Wt(h),r=Oe(h,"PRE",{class:!0});var c=ze(r);o=Gc(c,s[0]),c.forEach(ie),h.forEach(ie),this.h()},h(){J(t,"class","scm-waiting__loading scm-loading svelte-kcx0g9"),J(r,"class","scm-pre cm-editor svelte-kcx0g9"),J(e,"class",l="scm-waiting "+s[1]+" svelte-kcx0g9")},m(a,h){Xe(a,e,h),ve(e,t),ve(e,n),ve(e,r),ve(r,o)},p(a,h){h[0]&1&&qc(o,a[0]),h[0]&2&&l!==(l="scm-waiting "+a[1]+" svelte-kcx0g9")&&J(e,"class",l)},d(a){a&&ie(e)}}}function FT(s){let e,t;return{c(){e=Ae("div"),this.h()},l(i){e=Oe(i,"DIV",{class:!0}),ze(e).forEach(ie),this.h()},h(){J(e,"class",t="codemirror-wrapper "+s[1]+" svelte-kcx0g9")},m(i,n){Xe(i,e,n),s[18](e)},p(i,n){n[0]&2&&t!==(t="codemirror-wrapper "+i[1]+" svelte-kcx0g9")&&J(e,"class",t)},d(i){i&&ie(e),s[18](null)}}}function PT(s){let e;function t(r,o){return r[3]?FT:BT}let n=t(s)(s);return{c(){n.c(),e=ml()},l(r){n.l(r),e=ml()},m(r,o){n.m(r,o),Xe(r,e,o)},p(r,o){n.p(r,o)},i:at,o:at,d(r){r&&ie(e),n.d(r)}}}function NT(s,e,t){let i,n,{class:r=""}=e,{value:o=""}=e,{basic:l=!0}=e,{lang:a=void 0}=e,{theme:h=void 0}=e,{extensions:c=[]}=e,{useTab:u=!0}=e,{tabSize:d=2}=e,{styles:f=void 0}=e,{lineWrapping:p=!1}=e,{editable:m=!0}=e,{readonly:g=!1}=e,{placeholder:b=void 0}=e,{nodebounce:v=!1}=e;const C=typeof window<"u",x=hw();let w,E,k=!1,R=!1,P=!0,q=!0;xp(()=>t(16,E=N())),cw(()=>E==null?void 0:E.destroy());function N(){return new A({parent:w,state:be(o),dispatch(M){E.update([M]),!k&&M.docChanged&&n()}})}function D(){if(P){P=!1;return}E.dispatch({effects:ee.reconfigure.of(i)})}function ce(M){if(q){q=!1;return}if(R){R=!1;return}k=!0,E.setState(be(M)),k=!1}function X(){const M=E.state.doc.toString();M!==o&&(R=!0,t(0,o=M),x("change",o))}function be(M){return ae.create({doc:M??void 0,extensions:i})}function qe(M,re,Ie,Nt,hi,ns,mn,cr){const gn=[Da.of(" ".repeat(Ie)),A.editable.of(ns),ae.readOnly.of(mn)];return M&&gn.push(LT),re&&gn.push(Ta.of([aR])),hi&&gn.push(gk(hi)),cr&&gn.push(cr),Nt&&gn.push(A.lineWrapping),gn}function Ne(M,re){const Ie=[];return re&&Ie.push(A.theme(re)),M&&Ie.push(M),Ie}function I(M){Us[M?"unshift":"push"](()=>{w=M,t(2,w)})}return s.$$set=M=>{"class"in M&&t(1,r=M.class),"value"in M&&t(0,o=M.value),"basic"in M&&t(4,l=M.basic),"lang"in M&&t(5,a=M.lang),"theme"in M&&t(6,h=M.theme),"extensions"in M&&t(7,c=M.extensions),"useTab"in M&&t(8,u=M.useTab),"tabSize"in M&&t(9,d=M.tabSize),"styles"in M&&t(10,f=M.styles),"lineWrapping"in M&&t(11,p=M.lineWrapping),"editable"in M&&t(12,m=M.editable),"readonly"in M&&t(13,g=M.readonly),"placeholder"in M&&t(14,b=M.placeholder),"nodebounce"in M&&t(15,v=M.nodebounce)},s.$$.update=()=>{s.$$.dirty[0]&32752&&t(17,i=[...qe(l,u,d,p,b,m,g,a),...Ne(h,f),...c]),s.$$.dirty[0]&65537&&E&&ce(o),s.$$.dirty[0]&196608&&E&&i&&D(),s.$$.dirty[0]&32768&&(n=v?X:IT(X,300))},[o,r,w,C,l,a,h,c,u,d,f,p,m,g,b,v,E,i,I]}class zT extends fn{constructor(e){super(),pn(this,e,NT,PT,dn,{class:1,value:0,basic:4,lang:5,theme:6,extensions:7,useTab:8,tabSize:9,styles:10,lineWrapping:11,editable:12,readonly:13,placeholder:14,nodebounce:15},null,[-1,-1])}}var lp={};class ga{constructor(e,t,i,n,r,o,l,a,h,c=0,u){this.p=e,this.stack=t,this.state=i,this.reducePos=n,this.pos=r,this.score=o,this.buffer=l,this.bufferBase=a,this.curContext=h,this.lookAhead=c,this.parent=u}toString(){return`[${this.stack.filter((e,t)=>t%3==0).concat(this.state)}]@${this.pos}${this.score?"!"+this.score:""}`}static start(e,t,i=0){let n=e.parser.context;return new ga(e,[],t,i,i,0,[],0,n?new ap(n,n.start):null,0,null)}get context(){return this.curContext?this.curContext.context:null}pushState(e,t){this.stack.push(this.state,t,this.bufferBase+this.buffer.length),this.state=e}reduce(e){var t;let i=e>>19,n=e&65535,{parser:r}=this.p,o=r.dynamicPrecedence(n);if(o&&(this.score+=o),i==0){this.pushState(r.getGoto(this.state,n,!0),this.reducePos),n<r.minRepeatTerm&&this.storeNode(n,this.reducePos,this.reducePos,4,!0),this.reduceContext(n,this.reducePos);return}let l=this.stack.length-(i-1)*3-(e&262144?6:0),a=l?this.stack[l-2]:this.p.ranges[0].from,h=this.reducePos-a;h>=2e3&&!(!((t=this.p.parser.nodeSet.types[n])===null||t===void 0)&&t.isAnonymous)&&(a==this.p.lastBigReductionStart?(this.p.bigReductionCount++,this.p.lastBigReductionSize=h):this.p.lastBigReductionSize<h&&(this.p.bigReductionCount=1,this.p.lastBigReductionStart=a,this.p.lastBigReductionSize=h));let c=l?this.stack[l-1]:0,u=this.bufferBase+this.buffer.length-c;if(n<r.minRepeatTerm||e&131072){let d=r.stateFlag(this.state,1)?this.pos:this.reducePos;this.storeNode(n,a,d,u+4,!0)}if(e&262144)this.state=this.stack[l];else{let d=this.stack[l-3];this.state=r.getGoto(d,n,!0)}for(;this.stack.length>l;)this.stack.pop();this.reduceContext(n,a)}storeNode(e,t,i,n=4,r=!1){if(e==0&&(!this.stack.length||this.stack[this.stack.length-1]<this.buffer.length+this.bufferBase)){let o=this,l=this.buffer.length;if(l==0&&o.parent&&(l=o.bufferBase-o.parent.bufferBase,o=o.parent),l>0&&o.buffer[l-4]==0&&o.buffer[l-1]>-1){if(t==i)return;if(o.buffer[l-2]>=t){o.buffer[l-2]=i;return}}}if(!r||this.pos==i)this.buffer.push(e,t,i,n);else{let o=this.buffer.length;if(o>0&&this.buffer[o-4]!=0)for(;o>0&&this.buffer[o-2]>i;)this.buffer[o]=this.buffer[o-4],this.buffer[o+1]=this.buffer[o-3],this.buffer[o+2]=this.buffer[o-2],this.buffer[o+3]=this.buffer[o-1],o-=4,n>4&&(n-=4);this.buffer[o]=e,this.buffer[o+1]=t,this.buffer[o+2]=i,this.buffer[o+3]=n}}shift(e,t,i,n){if(e&131072)this.pushState(e&65535,this.pos);else if(e&262144)this.pos=n,this.shiftContext(t,i),t<=this.p.parser.maxNode&&this.buffer.push(t,i,n,4);else{let r=e,{parser:o}=this.p;(n>this.pos||t<=o.maxNode)&&(this.pos=n,o.stateFlag(r,1)||(this.reducePos=n)),this.pushState(r,i),this.shiftContext(t,i),t<=o.maxNode&&this.buffer.push(t,i,n,4)}}apply(e,t,i,n){e&65536?this.reduce(e):this.shift(e,t,i,n)}useNode(e,t){let i=this.p.reused.length-1;(i<0||this.p.reused[i]!=e)&&(this.p.reused.push(e),i++);let n=this.pos;this.reducePos=this.pos=n+e.length,this.pushState(t,n),this.buffer.push(i,n,this.reducePos,-1),this.curContext&&this.updateContext(this.curContext.tracker.reuse(this.curContext.context,e,this,this.p.stream.reset(this.pos-e.length)))}split(){let e=this,t=e.buffer.length;for(;t>0&&e.buffer[t-2]>e.reducePos;)t-=4;let i=e.buffer.slice(t),n=e.bufferBase+t;for(;e&&n==e.bufferBase;)e=e.parent;return new ga(this.p,this.stack.slice(),this.state,this.reducePos,this.pos,this.score,i,n,this.curContext,this.lookAhead,e)}recoverByDelete(e,t){let i=e<=this.p.parser.maxNode;i&&this.storeNode(e,this.pos,t,4),this.storeNode(0,this.pos,t,i?8:4),this.pos=this.reducePos=t,this.score-=190}canShift(e){for(let t=new HT(this);;){let i=this.p.parser.stateSlot(t.state,4)||this.p.parser.hasAction(t.state,e);if(i==0)return!1;if(!(i&65536))return!0;t.reduce(i)}}recoverByInsert(e){if(this.stack.length>=300)return[];let t=this.p.parser.nextStates(this.state);if(t.length>8||this.stack.length>=120){let n=[];for(let r=0,o;r<t.length;r+=2)(o=t[r+1])!=this.state&&this.p.parser.hasAction(o,e)&&n.push(t[r],o);if(this.stack.length<120)for(let r=0;n.length<8&&r<t.length;r+=2){let o=t[r+1];n.some((l,a)=>a&1&&l==o)||n.push(t[r],o)}t=n}let i=[];for(let n=0;n<t.length&&i.length<4;n+=2){let r=t[n+1];if(r==this.state)continue;let o=this.split();o.pushState(r,this.pos),o.storeNode(0,o.pos,o.pos,4,!0),o.shiftContext(t[n],this.pos),o.reducePos=this.pos,o.score-=200,i.push(o)}return i}forceReduce(){let{parser:e}=this.p,t=e.stateSlot(this.state,5);if(!(t&65536))return!1;if(!e.validAction(this.state,t)){let i=t>>19,n=t&65535,r=this.stack.length-i*3;if(r<0||e.getGoto(this.stack[r],n,!1)<0){let o=this.findForcedReduction();if(o==null)return!1;t=o}this.storeNode(0,this.pos,this.pos,4,!0),this.score-=100}return this.reducePos=this.pos,this.reduce(t),!0}findForcedReduction(){let{parser:e}=this.p,t=[],i=(n,r)=>{if(!t.includes(n))return t.push(n),e.allActions(n,o=>{if(!(o&393216))if(o&65536){let l=(o>>19)-r;if(l>1){let a=o&65535,h=this.stack.length-l*3;if(h>=0&&e.getGoto(this.stack[h],a,!1)>=0)return l<<19|65536|a}}else{let l=i(o,r+1);if(l!=null)return l}})};return i(this.state,0)}forceAll(){for(;!this.p.parser.stateFlag(this.state,2);)if(!this.forceReduce()){this.storeNode(0,this.pos,this.pos,4,!0);break}return this}get deadEnd(){if(this.stack.length!=3)return!1;let{parser:e}=this.p;return e.data[e.stateSlot(this.state,1)]==65535&&!e.stateSlot(this.state,4)}restart(){this.storeNode(0,this.pos,this.pos,4,!0),this.state=this.stack[0],this.stack.length=0}sameState(e){if(this.state!=e.state||this.stack.length!=e.stack.length)return!1;for(let t=0;t<this.stack.length;t+=3)if(this.stack[t]!=e.stack[t])return!1;return!0}get parser(){return this.p.parser}dialectEnabled(e){return this.p.parser.dialect.flags[e]}shiftContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.shift(this.curContext.context,e,this,this.p.stream.reset(t)))}reduceContext(e,t){this.curContext&&this.updateContext(this.curContext.tracker.reduce(this.curContext.context,e,this,this.p.stream.reset(t)))}emitContext(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-3)&&this.buffer.push(this.curContext.hash,this.pos,this.pos,-3)}emitLookAhead(){let e=this.buffer.length-1;(e<0||this.buffer[e]!=-4)&&this.buffer.push(this.lookAhead,this.pos,this.pos,-4)}updateContext(e){if(e!=this.curContext.context){let t=new ap(this.curContext.tracker,e);t.hash!=this.curContext.hash&&this.emitContext(),this.curContext=t}}setLookAhead(e){e>this.lookAhead&&(this.emitLookAhead(),this.lookAhead=e)}close(){this.curContext&&this.curContext.tracker.strict&&this.emitContext(),this.lookAhead>0&&this.emitLookAhead()}}class ap{constructor(e,t){this.tracker=e,this.context=t,this.hash=e.strict?e.hash(t):0}}class HT{constructor(e){this.start=e,this.state=e.state,this.stack=e.stack,this.base=this.stack.length}reduce(e){let t=e&65535,i=e>>19;i==0?(this.stack==this.start.stack&&(this.stack=this.stack.slice()),this.stack.push(this.state,0,0),this.base+=3):this.base-=(i-1)*3;let n=this.start.p.parser.getGoto(this.stack[this.base-3],t,!0);this.state=n}}class ba{constructor(e,t,i){this.stack=e,this.pos=t,this.index=i,this.buffer=e.buffer,this.index==0&&this.maybeNext()}static create(e,t=e.bufferBase+e.buffer.length){return new ba(e,t,t-e.bufferBase)}maybeNext(){let e=this.stack.parent;e!=null&&(this.index=this.stack.bufferBase-e.bufferBase,this.stack=e,this.buffer=e.buffer)}get id(){return this.buffer[this.index-4]}get start(){return this.buffer[this.index-3]}get end(){return this.buffer[this.index-2]}get size(){return this.buffer[this.index-1]}next(){this.index-=4,this.pos-=4,this.index==0&&this.maybeNext()}fork(){return new ba(this.stack,this.pos,this.index)}}function Qo(s,e=Uint16Array){if(typeof s!="string")return s;let t=null;for(let i=0,n=0;i<s.length;){let r=0;for(;;){let o=s.charCodeAt(i++),l=!1;if(o==126){r=65535;break}o>=92&&o--,o>=34&&o--;let a=o-32;if(a>=46&&(a-=46,l=!0),r+=a,l)break;r*=46}t?t[n++]=r:t=new e(r)}return t}class pl{constructor(){this.start=-1,this.value=-1,this.end=-1,this.extended=-1,this.lookAhead=0,this.mask=0,this.context=0}}const hp=new pl;class VT{constructor(e,t){this.input=e,this.ranges=t,this.chunk="",this.chunkOff=0,this.chunk2="",this.chunk2Pos=0,this.next=-1,this.token=hp,this.rangeIndex=0,this.pos=this.chunkPos=t[0].from,this.range=t[0],this.end=t[t.length-1].to,this.readNext()}resolveOffset(e,t){let i=this.range,n=this.rangeIndex,r=this.pos+e;for(;r<i.from;){if(!n)return null;let o=this.ranges[--n];r-=i.from-o.to,i=o}for(;t<0?r>i.to:r>=i.to;){if(n==this.ranges.length-1)return null;let o=this.ranges[++n];r+=o.from-i.to,i=o}return r}clipPos(e){if(e>=this.range.from&&e<this.range.to)return e;for(let t of this.ranges)if(t.to>e)return Math.max(e,t.from);return this.end}peek(e){let t=this.chunkOff+e,i,n;if(t>=0&&t<this.chunk.length)i=this.pos+e,n=this.chunk.charCodeAt(t);else{let r=this.resolveOffset(e,1);if(r==null)return-1;if(i=r,i>=this.chunk2Pos&&i<this.chunk2Pos+this.chunk2.length)n=this.chunk2.charCodeAt(i-this.chunk2Pos);else{let o=this.rangeIndex,l=this.range;for(;l.to<=i;)l=this.ranges[++o];this.chunk2=this.input.chunk(this.chunk2Pos=i),i+this.chunk2.length>l.to&&(this.chunk2=this.chunk2.slice(0,l.to-i)),n=this.chunk2.charCodeAt(0)}}return i>=this.token.lookAhead&&(this.token.lookAhead=i+1),n}acceptToken(e,t=0){let i=t?this.resolveOffset(t,-1):this.pos;if(i==null||i<this.token.start)throw new RangeError("Token end out of bounds");this.token.value=e,this.token.end=i}acceptTokenTo(e,t){this.token.value=e,this.token.end=t}getChunk(){if(this.pos>=this.chunk2Pos&&this.pos<this.chunk2Pos+this.chunk2.length){let{chunk:e,chunkPos:t}=this;this.chunk=this.chunk2,this.chunkPos=this.chunk2Pos,this.chunk2=e,this.chunk2Pos=t,this.chunkOff=this.pos-this.chunkPos}else{this.chunk2=this.chunk,this.chunk2Pos=this.chunkPos;let e=this.input.chunk(this.pos),t=this.pos+e.length;this.chunk=t>this.range.to?e.slice(0,this.range.to-this.pos):e,this.chunkPos=this.pos,this.chunkOff=0}}readNext(){return this.chunkOff>=this.chunk.length&&(this.getChunk(),this.chunkOff==this.chunk.length)?this.next=-1:this.next=this.chunk.charCodeAt(this.chunkOff)}advance(e=1){for(this.chunkOff+=e;this.pos+e>=this.range.to;){if(this.rangeIndex==this.ranges.length-1)return this.setDone();e-=this.range.to-this.pos,this.range=this.ranges[++this.rangeIndex],this.pos=this.range.from}return this.pos+=e,this.pos>=this.token.lookAhead&&(this.token.lookAhead=this.pos+1),this.readNext()}setDone(){return this.pos=this.chunkPos=this.end,this.range=this.ranges[this.rangeIndex=this.ranges.length-1],this.chunk="",this.next=-1}reset(e,t){if(t?(this.token=t,t.start=e,t.lookAhead=e+1,t.value=t.extended=-1):this.token=hp,this.pos!=e){if(this.pos=e,e==this.end)return this.setDone(),this;for(;e<this.range.from;)this.range=this.ranges[--this.rangeIndex];for(;e>=this.range.to;)this.range=this.ranges[++this.rangeIndex];e>=this.chunkPos&&e<this.chunkPos+this.chunk.length?this.chunkOff=e-this.chunkPos:(this.chunk="",this.chunkOff=0),this.readNext()}return this}read(e,t){if(e>=this.chunkPos&&t<=this.chunkPos+this.chunk.length)return this.chunk.slice(e-this.chunkPos,t-this.chunkPos);if(e>=this.chunk2Pos&&t<=this.chunk2Pos+this.chunk2.length)return this.chunk2.slice(e-this.chunk2Pos,t-this.chunk2Pos);if(e>=this.range.from&&t<=this.range.to)return this.input.read(e,t);let i="";for(let n of this.ranges){if(n.from>=t)break;n.to>e&&(i+=this.input.read(Math.max(n.from,e),Math.min(n.to,t)))}return i}}class Vn{constructor(e,t){this.data=e,this.id=t}token(e,t){let{parser:i}=t.p;UT(this.data,e,t,this.id,i.data,i.tokenPrecTable)}}Vn.prototype.contextual=Vn.prototype.fallback=Vn.prototype.extend=!1;Vn.prototype.fallback=Vn.prototype.extend=!1;class WT{constructor(e,t={}){this.token=e,this.contextual=!!t.contextual,this.fallback=!!t.fallback,this.extend=!!t.extend}}function UT(s,e,t,i,n,r){let o=0,l=1<<i,{dialect:a}=t.p.parser;e:for(;l&s[o];){let h=s[o+1];for(let f=o+3;f<h;f+=2)if((s[f+1]&l)>0){let p=s[f];if(a.allows(p)&&(e.token.value==-1||e.token.value==p||jT(p,e.token.value,n,r))){e.acceptToken(p);break}}let c=e.next,u=0,d=s[o+2];if(e.next<0&&d>u&&s[h+d*3-3]==65535){o=s[h+d*3-1];continue e}for(;u<d;){let f=u+d>>1,p=h+f+(f<<1),m=s[p],g=s[p+1]||65536;if(c<m)d=f;else if(c>=g)u=f+1;else{o=s[p+2],e.advance();continue e}}break}}function cp(s,e,t){for(let i=e,n;(n=s[i])!=65535;i++)if(n==t)return i-e;return-1}function jT(s,e,t,i){let n=cp(t,i,e);return n<0||cp(t,i,s)<n}const Mt=typeof process<"u"&&lp&&/\bparse\b/.test(lp.LOG);let _h=null;function up(s,e,t){let i=s.cursor($e.IncludeAnonymous);for(i.moveTo(e);;)if(!(t<0?i.childBefore(e):i.childAfter(e)))for(;;){if((t<0?i.to<e:i.from>e)&&!i.type.isError)return t<0?Math.max(0,Math.min(i.to-1,e-25)):Math.min(s.length,Math.max(i.from+1,e+25));if(t<0?i.prevSibling():i.nextSibling())break;if(!i.parent())return t<0?0:s.length}}class GT{constructor(e,t){this.fragments=e,this.nodeSet=t,this.i=0,this.fragment=null,this.safeFrom=-1,this.safeTo=-1,this.trees=[],this.start=[],this.index=[],this.nextFragment()}nextFragment(){let e=this.fragment=this.i==this.fragments.length?null:this.fragments[this.i++];if(e){for(this.safeFrom=e.openStart?up(e.tree,e.from+e.offset,1)-e.offset:e.from,this.safeTo=e.openEnd?up(e.tree,e.to+e.offset,-1)-e.offset:e.to;this.trees.length;)this.trees.pop(),this.start.pop(),this.index.pop();this.trees.push(e.tree),this.start.push(-e.offset),this.index.push(0),this.nextStart=this.safeFrom}else this.nextStart=1e9}nodeAt(e){if(e<this.nextStart)return null;for(;this.fragment&&this.safeTo<=e;)this.nextFragment();if(!this.fragment)return null;for(;;){let t=this.trees.length-1;if(t<0)return this.nextFragment(),null;let i=this.trees[t],n=this.index[t];if(n==i.children.length){this.trees.pop(),this.start.pop(),this.index.pop();continue}let r=i.children[n],o=this.start[t]+i.positions[n];if(o>e)return this.nextStart=o,null;if(r instanceof He){if(o==e){if(o<this.safeFrom)return null;let l=o+r.length;if(l<=this.safeTo){let a=r.prop(ne.lookAhead);if(!a||l+a<this.fragment.to)return r}}this.index[t]++,o+r.length>=Math.max(this.safeFrom,e)&&(this.trees.push(r),this.start.push(o),this.index.push(0))}else this.index[t]++,this.nextStart=o+r.length}}}class qT{constructor(e,t){this.stream=t,this.tokens=[],this.mainToken=null,this.actions=[],this.tokens=e.tokenizers.map(i=>new pl)}getActions(e){let t=0,i=null,{parser:n}=e.p,{tokenizers:r}=n,o=n.stateSlot(e.state,3),l=e.curContext?e.curContext.hash:0,a=0;for(let h=0;h<r.length;h++){if(!(1<<h&o))continue;let c=r[h],u=this.tokens[h];if(!(i&&!c.fallback)&&((c.contextual||u.start!=e.pos||u.mask!=o||u.context!=l)&&(this.updateCachedToken(u,c,e),u.mask=o,u.context=l),u.lookAhead>u.end+25&&(a=Math.max(u.lookAhead,a)),u.value!=0)){let d=t;if(u.extended>-1&&(t=this.addActions(e,u.extended,u.end,t)),t=this.addActions(e,u.value,u.end,t),!c.extend&&(i=u,t>d))break}}for(;this.actions.length>t;)this.actions.pop();return a&&e.setLookAhead(a),!i&&e.pos==this.stream.end&&(i=new pl,i.value=e.p.parser.eofTerm,i.start=i.end=e.pos,t=this.addActions(e,i.value,i.end,t)),this.mainToken=i,this.actions}getMainToken(e){if(this.mainToken)return this.mainToken;let t=new pl,{pos:i,p:n}=e;return t.start=i,t.end=Math.min(i+1,n.stream.end),t.value=i==n.stream.end?n.parser.eofTerm:0,t}updateCachedToken(e,t,i){let n=this.stream.clipPos(i.pos);if(t.token(this.stream.reset(n,e),i),e.value>-1){let{parser:r}=i.p;for(let o=0;o<r.specialized.length;o++)if(r.specialized[o]==e.value){let l=r.specializers[o](this.stream.read(e.start,e.end),i);if(l>=0&&i.p.parser.dialect.allows(l>>1)){l&1?e.extended=l>>1:e.value=l>>1;break}}}else e.value=0,e.end=this.stream.clipPos(n+1)}putAction(e,t,i,n){for(let r=0;r<n;r+=3)if(this.actions[r]==e)return n;return this.actions[n++]=e,this.actions[n++]=t,this.actions[n++]=i,n}addActions(e,t,i,n){let{state:r}=e,{parser:o}=e.p,{data:l}=o;for(let a=0;a<2;a++)for(let h=o.stateSlot(r,a?2:1);;h+=3){if(l[h]==65535)if(l[h+1]==1)h=ji(l,h+2);else{n==0&&l[h+1]==2&&(n=this.putAction(ji(l,h+2),t,i,n));break}l[h]==t&&(n=this.putAction(ji(l,h+1),t,i,n))}return n}}class $T{constructor(e,t,i,n){this.parser=e,this.input=t,this.ranges=n,this.recovering=0,this.nextStackID=9812,this.minStackPos=0,this.reused=[],this.stoppedAt=null,this.lastBigReductionStart=-1,this.lastBigReductionSize=0,this.bigReductionCount=0,this.stream=new VT(t,n),this.tokens=new qT(e,this.stream),this.topTerm=e.top[1];let{from:r}=n[0];this.stacks=[ga.start(this,e.top[0],r)],this.fragments=i.length&&this.stream.end-r>e.bufferLength*4?new GT(i,e.nodeSet):null}get parsedPos(){return this.minStackPos}advance(){let e=this.stacks,t=this.minStackPos,i=this.stacks=[],n,r;if(this.bigReductionCount>300&&e.length==1){let[o]=e;for(;o.forceReduce()&&o.stack.length&&o.stack[o.stack.length-2]>=this.lastBigReductionStart;);this.bigReductionCount=this.lastBigReductionSize=0}for(let o=0;o<e.length;o++){let l=e[o];for(;;){if(this.tokens.mainToken=null,l.pos>t)i.push(l);else{if(this.advanceStack(l,i,e))continue;{n||(n=[],r=[]),n.push(l);let a=this.tokens.getMainToken(l);r.push(a.value,a.end)}}break}}if(!i.length){let o=n&&YT(n);if(o)return Mt&&console.log("Finish with "+this.stackID(o)),this.stackToTree(o);if(this.parser.strict)throw Mt&&n&&console.log("Stuck with token "+(this.tokens.mainToken?this.parser.getName(this.tokens.mainToken.value):"none")),new SyntaxError("No parse at "+t);this.recovering||(this.recovering=5)}if(this.recovering&&n){let o=this.stoppedAt!=null&&n[0].pos>this.stoppedAt?n[0]:this.runRecovery(n,r,i);if(o)return Mt&&console.log("Force-finish "+this.stackID(o)),this.stackToTree(o.forceAll())}if(this.recovering){let o=this.recovering==1?1:this.recovering*3;if(i.length>o)for(i.sort((l,a)=>a.score-l.score);i.length>o;)i.pop();i.some(l=>l.reducePos>t)&&this.recovering--}else if(i.length>1){e:for(let o=0;o<i.length-1;o++){let l=i[o];for(let a=o+1;a<i.length;a++){let h=i[a];if(l.sameState(h)||l.buffer.length>500&&h.buffer.length>500)if((l.score-h.score||l.buffer.length-h.buffer.length)>0)i.splice(a--,1);else{i.splice(o--,1);continue e}}}i.length>12&&i.splice(12,i.length-12)}this.minStackPos=i[0].pos;for(let o=1;o<i.length;o++)i[o].pos<this.minStackPos&&(this.minStackPos=i[o].pos);return null}stopAt(e){if(this.stoppedAt!=null&&this.stoppedAt<e)throw new RangeError("Can't move stoppedAt forward");this.stoppedAt=e}advanceStack(e,t,i){let n=e.pos,{parser:r}=this,o=Mt?this.stackID(e)+" -> ":"";if(this.stoppedAt!=null&&n>this.stoppedAt)return e.forceReduce()?e:null;if(this.fragments){let h=e.curContext&&e.curContext.tracker.strict,c=h?e.curContext.hash:0;for(let u=this.fragments.nodeAt(n);u;){let d=this.parser.nodeSet.types[u.type.id]==u.type?r.getGoto(e.state,u.type.id):-1;if(d>-1&&u.length&&(!h||(u.prop(ne.contextHash)||0)==c))return e.useNode(u,d),Mt&&console.log(o+this.stackID(e)+` (via reuse of ${r.getName(u.type.id)})`),!0;if(!(u instanceof He)||u.children.length==0||u.positions[0]>0)break;let f=u.children[0];if(f instanceof He&&u.positions[0]==0)u=f;else break}}let l=r.stateSlot(e.state,4);if(l>0)return e.reduce(l),Mt&&console.log(o+this.stackID(e)+` (via always-reduce ${r.getName(l&65535)})`),!0;if(e.stack.length>=8400)for(;e.stack.length>6e3&&e.forceReduce(););let a=this.tokens.getActions(e);for(let h=0;h<a.length;){let c=a[h++],u=a[h++],d=a[h++],f=h==a.length||!i,p=f?e:e.split(),m=this.tokens.mainToken;if(p.apply(c,u,m?m.start:p.pos,d),Mt&&console.log(o+this.stackID(p)+` (via ${c&65536?`reduce of ${r.getName(c&65535)}`:"shift"} for ${r.getName(u)} @ ${n}${p==e?"":", split"})`),f)return!0;p.pos>n?t.push(p):i.push(p)}return!1}advanceFully(e,t){let i=e.pos;for(;;){if(!this.advanceStack(e,null,null))return!1;if(e.pos>i)return dp(e,t),!0}}runRecovery(e,t,i){let n=null,r=!1;for(let o=0;o<e.length;o++){let l=e[o],a=t[o<<1],h=t[(o<<1)+1],c=Mt?this.stackID(l)+" -> ":"";if(l.deadEnd&&(r||(r=!0,l.restart(),Mt&&console.log(c+this.stackID(l)+" (restarted)"),this.advanceFully(l,i))))continue;let u=l.split(),d=c;for(let f=0;u.forceReduce()&&f<10&&(Mt&&console.log(d+this.stackID(u)+" (via force-reduce)"),!this.advanceFully(u,i));f++)Mt&&(d=this.stackID(u)+" -> ");for(let f of l.recoverByInsert(a))Mt&&console.log(c+this.stackID(f)+" (via recover-insert)"),this.advanceFully(f,i);this.stream.end>l.pos?(h==l.pos&&(h++,a=0),l.recoverByDelete(a,h),Mt&&console.log(c+this.stackID(l)+` (via recover-delete ${this.parser.getName(a)})`),dp(l,i)):(!n||n.score<l.score)&&(n=l)}return n}stackToTree(e){return e.close(),He.build({buffer:ba.create(e),nodeSet:this.parser.nodeSet,topID:this.topTerm,maxBufferLength:this.parser.bufferLength,reused:this.reused,start:this.ranges[0].from,length:e.pos-this.ranges[0].from,minRepeatType:this.parser.minRepeatTerm})}stackID(e){let t=(_h||(_h=new WeakMap)).get(e);return t||_h.set(e,t=String.fromCodePoint(this.nextStackID++)),t+e}}function dp(s,e){for(let t=0;t<e.length;t++){let i=e[t];if(i.pos==s.pos&&i.sameState(s)){e[t].score<s.score&&(e[t]=s);return}}e.push(s)}class KT{constructor(e,t,i){this.source=e,this.flags=t,this.disabled=i}allows(e){return!this.disabled||this.disabled[e]==0}}class ya extends ty{constructor(e){if(super(),this.wrappers=[],e.version!=14)throw new RangeError(`Parser version (${e.version}) doesn't match runtime version (14)`);let t=e.nodeNames.split(" ");this.minRepeatTerm=t.length;for(let l=0;l<e.repeatNodeCount;l++)t.push("");let i=Object.keys(e.topRules).map(l=>e.topRules[l][1]),n=[];for(let l=0;l<t.length;l++)n.push([]);function r(l,a,h){n[l].push([a,a.deserialize(String(h))])}if(e.nodeProps)for(let l of e.nodeProps){let a=l[0];typeof a=="string"&&(a=ne[a]);for(let h=1;h<l.length;){let c=l[h++];if(c>=0)r(c,a,l[h++]);else{let u=l[h+-c];for(let d=-c;d>0;d--)r(l[h++],a,u);h++}}}this.nodeSet=new Iu(t.map((l,a)=>Rt.define({name:a>=this.minRepeatTerm?void 0:l,id:a,props:n[a],top:i.indexOf(a)>-1,error:a==0,skipped:e.skippedNodes&&e.skippedNodes.indexOf(a)>-1}))),e.propSources&&(this.nodeSet=this.nodeSet.extend(...e.propSources)),this.strict=!1,this.bufferLength=Jb;let o=Qo(e.tokenData);this.context=e.context,this.specializerSpecs=e.specialized||[],this.specialized=new Uint16Array(this.specializerSpecs.length);for(let l=0;l<this.specializerSpecs.length;l++)this.specialized[l]=this.specializerSpecs[l].term;this.specializers=this.specializerSpecs.map(fp),this.states=Qo(e.states,Uint32Array),this.data=Qo(e.stateData),this.goto=Qo(e.goto),this.maxTerm=e.maxTerm,this.tokenizers=e.tokenizers.map(l=>typeof l=="number"?new Vn(o,l):l),this.topRules=e.topRules,this.dialects=e.dialects||{},this.dynamicPrecedences=e.dynamicPrecedences||null,this.tokenPrecTable=e.tokenPrec,this.termNames=e.termNames||null,this.maxNode=this.nodeSet.types.length-1,this.dialect=this.parseDialect(),this.top=this.topRules[Object.keys(this.topRules)[0]]}createParse(e,t,i){let n=new $T(this,e,t,i);for(let r of this.wrappers)n=r(n,e,t,i);return n}getGoto(e,t,i=!1){let n=this.goto;if(t>=n[0])return-1;for(let r=n[t+1];;){let o=n[r++],l=o&1,a=n[r++];if(l&&i)return a;for(let h=r+(o>>1);r<h;r++)if(n[r]==e)return a;if(l)return-1}}hasAction(e,t){let i=this.data;for(let n=0;n<2;n++)for(let r=this.stateSlot(e,n?2:1),o;;r+=3){if((o=i[r])==65535)if(i[r+1]==1)o=i[r=ji(i,r+2)];else{if(i[r+1]==2)return ji(i,r+2);break}if(o==t||o==0)return ji(i,r+1)}return 0}stateSlot(e,t){return this.states[e*6+t]}stateFlag(e,t){return(this.stateSlot(e,0)&t)>0}validAction(e,t){return!!this.allActions(e,i=>i==t?!0:null)}allActions(e,t){let i=this.stateSlot(e,4),n=i?t(i):void 0;for(let r=this.stateSlot(e,1);n==null;r+=3){if(this.data[r]==65535)if(this.data[r+1]==1)r=ji(this.data,r+2);else break;n=t(ji(this.data,r+1))}return n}nextStates(e){let t=[];for(let i=this.stateSlot(e,1);;i+=3){if(this.data[i]==65535)if(this.data[i+1]==1)i=ji(this.data,i+2);else break;if(!(this.data[i+2]&1)){let n=this.data[i+1];t.some((r,o)=>o&1&&r==n)||t.push(this.data[i],n)}}return t}configure(e){let t=Object.assign(Object.create(ya.prototype),this);if(e.props&&(t.nodeSet=this.nodeSet.extend(...e.props)),e.top){let i=this.topRules[e.top];if(!i)throw new RangeError(`Invalid top rule name ${e.top}`);t.top=i}return e.tokenizers&&(t.tokenizers=this.tokenizers.map(i=>{let n=e.tokenizers.find(r=>r.from==i);return n?n.to:i})),e.specializers&&(t.specializers=this.specializers.slice(),t.specializerSpecs=this.specializerSpecs.map((i,n)=>{let r=e.specializers.find(l=>l.from==i.external);if(!r)return i;let o=Object.assign(Object.assign({},i),{external:r.to});return t.specializers[n]=fp(o),o})),e.contextTracker&&(t.context=e.contextTracker),e.dialect&&(t.dialect=this.parseDialect(e.dialect)),e.strict!=null&&(t.strict=e.strict),e.wrap&&(t.wrappers=t.wrappers.concat(e.wrap)),e.bufferLength!=null&&(t.bufferLength=e.bufferLength),t}hasWrappers(){return this.wrappers.length>0}getName(e){return this.termNames?this.termNames[e]:String(e<=this.maxNode&&this.nodeSet.types[e].name||e)}get eofTerm(){return this.maxNode+1}get topNode(){return this.nodeSet.types[this.top[1]]}dynamicPrecedence(e){let t=this.dynamicPrecedences;return t==null?0:t[e]||0}parseDialect(e){let t=Object.keys(this.dialects),i=t.map(()=>!1);if(e)for(let r of e.split(" ")){let o=t.indexOf(r);o>=0&&(i[o]=!0)}let n=null;for(let r=0;r<t.length;r++)if(!i[r])for(let o=this.dialects[t[r]],l;(l=this.data[o++])!=65535;)(n||(n=new Uint8Array(this.maxTerm+1)))[l]=1;return new KT(e,i,n)}static deserialize(e){return new ya(e)}}function ji(s,e){return s[e]|s[e+1]<<16}function YT(s){let e=null;for(let t of s){let i=t.p.stoppedAt;(t.pos==t.p.stream.end||i!=null&&t.pos>i)&&t.p.parser.stateFlag(t.state,2)&&(!e||e.score<t.score)&&(e=t)}return e}function fp(s){if(s.external){let e=s.extend?1:0;return(t,i)=>s.external(t,i)<<1|e}return s.get}const QT=36,pp=1,JT=2,yr=3,Rh=4,XT=5,ZT=6,eM=7,tM=8,iM=9,sM=10,nM=11,rM=12,oM=13,lM=14,aM=15,hM=16,cM=17,mp=18,uM=19,kv=20,Sv=21,gp=22,dM=23,fM=24;function zc(s){return s>=65&&s<=90||s>=97&&s<=122||s>=48&&s<=57}function pM(s){return s>=48&&s<=57||s>=97&&s<=102||s>=65&&s<=70}function zs(s,e,t){for(let i=!1;;){if(s.next<0)return;if(s.next==e&&!i){s.advance();return}i=t&&!i&&s.next==92,s.advance()}}function mM(s){for(;;){if(s.next<0||s.peek(1)<0)return;if(s.next==36&&s.peek(1)==36){s.advance(2);return}s.advance()}}function gM(s,e){let t="[{<(".indexOf(String.fromCharCode(e)),i=t<0?e:"]}>)".charCodeAt(t);for(;;){if(s.next<0)return;if(s.next==i&&s.peek(1)==39){s.advance(2);return}s.advance()}}function _v(s,e){for(;!(s.next!=95&&!zc(s.next));)e!=null&&(e+=String.fromCharCode(s.next)),s.advance();return e}function bM(s){if(s.next==39||s.next==34||s.next==96){let e=s.next;s.advance(),zs(s,e,!1)}else _v(s)}function bp(s,e){for(;s.next==48||s.next==49;)s.advance();e&&s.next==e&&s.advance()}function yp(s,e){for(;;){if(s.next==46){if(e)break;e=!0}else if(s.next<48||s.next>57)break;s.advance()}if(s.next==69||s.next==101)for(s.advance(),(s.next==43||s.next==45)&&s.advance();s.next>=48&&s.next<=57;)s.advance()}function vp(s){for(;!(s.next<0||s.next==10);)s.advance()}function Ns(s,e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)==s)return!0;return!1}const Th=` 	\r
`;function Rv(s,e,t){let i=Object.create(null);i.true=i.false=XT,i.null=i.unknown=ZT;for(let n of s.split(" "))n&&(i[n]=kv);for(let n of e.split(" "))n&&(i[n]=Sv);for(let n of(t||"").split(" "))n&&(i[n]=fM);return i}const yM="array binary bit boolean char character clob date decimal double float int integer interval large national nchar nclob numeric object precision real smallint time timestamp varchar varying ",vM="absolute action add after all allocate alter and any are as asc assertion at authorization before begin between both breadth by call cascade cascaded case cast catalog check close collate collation column commit condition connect connection constraint constraints constructor continue corresponding count create cross cube current current_date current_default_transform_group current_transform_group_for_type current_path current_role current_time current_timestamp current_user cursor cycle data day deallocate declare default deferrable deferred delete depth deref desc describe descriptor deterministic diagnostics disconnect distinct do domain drop dynamic each else elseif end end-exec equals escape except exception exec execute exists exit external fetch first for foreign found from free full function general get global go goto grant group grouping handle having hold hour identity if immediate in indicator initially inner inout input insert intersect into is isolation join key language last lateral leading leave left level like limit local localtime localtimestamp locator loop map match method minute modifies module month names natural nesting new next no none not of old on only open option or order ordinality out outer output overlaps pad parameter partial path prepare preserve primary prior privileges procedure public read reads recursive redo ref references referencing relative release repeat resignal restrict result return returns revoke right role rollback rollup routine row rows savepoint schema scroll search second section select session session_user set sets signal similar size some space specific specifictype sql sqlexception sqlstate sqlwarning start state static system_user table temporary then timezone_hour timezone_minute to trailing transaction translation treat trigger under undo union unique unnest until update usage user using value values view when whenever where while with without work write year zone ",Hc={backslashEscapes:!1,hashComments:!1,spaceAfterDashes:!1,slashComments:!1,doubleQuotedStrings:!1,doubleDollarQuotedStrings:!1,unquotedBitLiterals:!1,treatBitsAsBytes:!1,charSetCasts:!1,plsqlQuotingMechanism:!1,operatorChars:"*+-%<>!=&|~^/",specialVar:"?",identifierQuotes:'"',words:Rv(vM,yM)};function wM(s,e,t,i){let n={};for(let r in Hc)n[r]=(s.hasOwnProperty(r)?s:Hc)[r];return e&&(n.words=Rv(e,t||"",i)),n}function Tv(s){return new WT(e=>{var t;let{next:i}=e;if(e.advance(),Ns(i,Th)){for(;Ns(e.next,Th);)e.advance();e.acceptToken(QT)}else if(i==36&&e.next==36&&s.doubleDollarQuotedStrings)mM(e),e.acceptToken(yr);else if(i==39||i==34&&s.doubleQuotedStrings)zs(e,i,s.backslashEscapes),e.acceptToken(yr);else if(i==35&&s.hashComments||i==47&&e.next==47&&s.slashComments)vp(e),e.acceptToken(pp);else if(i==45&&e.next==45&&(!s.spaceAfterDashes||e.peek(1)==32))vp(e),e.acceptToken(pp);else if(i==47&&e.next==42){e.advance();for(let n=1;;){let r=e.next;if(e.next<0)break;if(e.advance(),r==42&&e.next==47){if(n--,e.advance(),!n)break}else r==47&&e.next==42&&(n++,e.advance())}e.acceptToken(JT)}else if((i==101||i==69)&&e.next==39)e.advance(),zs(e,39,!0);else if((i==110||i==78)&&e.next==39&&s.charSetCasts)e.advance(),zs(e,39,s.backslashEscapes),e.acceptToken(yr);else if(i==95&&s.charSetCasts)for(let n=0;;n++){if(e.next==39&&n>1){e.advance(),zs(e,39,s.backslashEscapes),e.acceptToken(yr);break}if(!zc(e.next))break;e.advance()}else if(s.plsqlQuotingMechanism&&(i==113||i==81)&&e.next==39&&e.peek(1)>0&&!Ns(e.peek(1),Th)){let n=e.peek(1);e.advance(2),gM(e,n),e.acceptToken(yr)}else if(i==40)e.acceptToken(eM);else if(i==41)e.acceptToken(tM);else if(i==123)e.acceptToken(iM);else if(i==125)e.acceptToken(sM);else if(i==91)e.acceptToken(nM);else if(i==93)e.acceptToken(rM);else if(i==59)e.acceptToken(oM);else if(s.unquotedBitLiterals&&i==48&&e.next==98)e.advance(),bp(e),e.acceptToken(gp);else if((i==98||i==66)&&(e.next==39||e.next==34)){const n=e.next;e.advance(),s.treatBitsAsBytes?(zs(e,n,s.backslashEscapes),e.acceptToken(dM)):(bp(e,n),e.acceptToken(gp))}else if(i==48&&(e.next==120||e.next==88)||(i==120||i==88)&&e.next==39){let n=e.next==39;for(e.advance();pM(e.next);)e.advance();n&&e.next==39&&e.advance(),e.acceptToken(Rh)}else if(i==46&&e.next>=48&&e.next<=57)yp(e,!0),e.acceptToken(Rh);else if(i==46)e.acceptToken(lM);else if(i>=48&&i<=57)yp(e,!1),e.acceptToken(Rh);else if(Ns(i,s.operatorChars)){for(;Ns(e.next,s.operatorChars);)e.advance();e.acceptToken(aM)}else if(Ns(i,s.specialVar))e.next==i&&e.advance(),bM(e),e.acceptToken(cM);else if(Ns(i,s.identifierQuotes))zs(e,i,!1),e.acceptToken(uM);else if(i==58||i==44)e.acceptToken(hM);else if(zc(i)){let n=_v(e,String.fromCharCode(i));e.acceptToken(e.next==46?mp:(t=s.words[n.toLowerCase()])!==null&&t!==void 0?t:mp)}})}const Mv=Tv(Hc),CM=ya.deserialize({version:14,states:"%vQ]QQOOO#wQRO'#DSO$OQQO'#CwO%eQQO'#CxO%lQQO'#CyO%sQQO'#CzOOQQ'#DS'#DSOOQQ'#C}'#C}O'UQRO'#C{OOQQ'#Cv'#CvOOQQ'#C|'#C|Q]QQOOQOQQOOO'`QQO'#DOO(xQRO,59cO)PQQO,59cO)UQQO'#DSOOQQ,59d,59dO)cQQO,59dOOQQ,59e,59eO)jQQO,59eOOQQ,59f,59fO)qQQO,59fOOQQ-E6{-E6{OOQQ,59b,59bOOQQ-E6z-E6zOOQQ,59j,59jOOQQ-E6|-E6|O+VQRO1G.}O+^QQO,59cOOQQ1G/O1G/OOOQQ1G/P1G/POOQQ1G/Q1G/QP+kQQO'#C}O+rQQO1G.}O)PQQO,59cO,PQQO'#Cw",stateData:",[~OtOSPOSQOS~ORUOSUOTUOUUOVROXSOZTO]XO^QO_UO`UOaPObPOcPOdUOeUOfUOgUOhUO~O^]ORvXSvXTvXUvXVvXXvXZvX]vX_vX`vXavXbvXcvXdvXevXfvXgvXhvX~OsvX~P!jOa_Ob_Oc_O~ORUOSUOTUOUUOVROXSOZTO^tO_UO`UOa`Ob`Oc`OdUOeUOfUOgUOhUO~OWaO~P$ZOYcO~P$ZO[eO~P$ZORUOSUOTUOUUOVROXSOZTO^QO_UO`UOaPObPOcPOdUOeUOfUOgUOhUO~O]hOsoX~P%zOajObjOcjO~O^]ORkaSkaTkaUkaVkaXkaZka]ka_ka`kaakabkackadkaekafkagkahka~Oska~P'kO^]O~OWvXYvX[vX~P!jOWnO~P$ZOYoO~P$ZO[pO~P$ZO^]ORkiSkiTkiUkiVkiXkiZki]ki_ki`kiakibkickidkiekifkigkihki~Oski~P)xOWkaYka[ka~P'kO]hO~P$ZOWkiYki[ki~P)xOasObsOcsO~O",goto:"#hwPPPPPPPPPPPPPPPPPPPPPPPPPPx||||!Y!^!d!xPPP#[TYOZeUORSTWZbdfqT[OZQZORiZSWOZQbRQdSQfTZgWbdfqQ^PWk^lmrQl_Qm`RrseVORSTWZbdfq",nodeNames:" LineComment BlockComment String Number Bool Null ( ) { } [ ] ; . Operator Punctuation SpecialVar Identifier QuotedIdentifier Keyword Type Bits Bytes Builtin Script Statement CompositeIdentifier Parens Braces Brackets Statement",maxTerm:38,nodeProps:[["isolate",-4,1,2,3,19,""]],skippedNodes:[0,1,2],repeatNodeCount:3,tokenData:"RORO",tokenizers:[0,Mv],topRules:{Script:[0,25]},tokenPrec:0});function Vc(s){let e=s.cursor().moveTo(s.from,-1);for(;/Comment/.test(e.name);)e.moveTo(e.from,-1);return e.node}function ro(s,e){let t=s.sliceString(e.from,e.to),i=/^([`'"])(.*)\1$/.exec(t);return i?i[2]:t}function va(s){return s&&(s.name=="Identifier"||s.name=="QuotedIdentifier")}function EM(s,e){if(e.name=="CompositeIdentifier"){let t=[];for(let i=e.firstChild;i;i=i.nextSibling)va(i)&&t.push(ro(s,i));return t}return[ro(s,e)]}function wp(s,e){for(let t=[];;){if(!e||e.name!=".")return t;let i=Vc(e);if(!va(i))return t;t.unshift(ro(s,i)),e=Vc(i)}}function xM(s,e){let t=Ke(s).resolveInner(e,-1),i=SM(s.doc,t);return t.name=="Identifier"||t.name=="QuotedIdentifier"||t.name=="Keyword"?{from:t.from,quoted:t.name=="QuotedIdentifier"?s.doc.sliceString(t.from,t.from+1):null,parents:wp(s.doc,Vc(t)),aliases:i}:t.name=="."?{from:e,quoted:null,parents:wp(s.doc,t),aliases:i}:{from:e,quoted:null,parents:[],empty:!0,aliases:i}}const kM=new Set("where group having order union intersect except all distinct limit offset fetch for".split(" "));function SM(s,e){let t;for(let n=e;!t;n=n.parent){if(!n)return null;n.name=="Statement"&&(t=n)}let i=null;for(let n=t.firstChild,r=!1,o=null;n;n=n.nextSibling){let l=n.name=="Keyword"?s.sliceString(n.from,n.to).toLowerCase():null,a=null;if(!r)r=l=="from";else if(l=="as"&&o&&va(n.nextSibling))a=ro(s,n.nextSibling);else{if(l&&kM.has(l))break;o&&va(n)&&(a=ro(s,n))}a&&(i||(i=Object.create(null)),i[a]=EM(s,o)),o=/Identifier$/.test(n.name)?n:null}return i}function _M(s,e){return s?e.map(t=>Object.assign(Object.assign({},t),{label:t.label[0]==s?t.label:s+t.label+s,apply:void 0})):e}const RM=/^\w*$/,TM=/^[`'"]?\w*[`'"]?$/;class Qu{constructor(){this.list=[],this.children=void 0}child(e,t){let i=this.children||(this.children=Object.create(null)),n=i[e];return n||(e&&this.list.push(Dv(e,"type",t)),i[e]=new Qu)}addCompletions(e){for(let t of e){let i=this.list.findIndex(n=>n.label==t.label);i>-1?this.list[i]=t:this.list.push(t)}}}function Dv(s,e,t){return/^[a-z_][a-z_\d]*$/.test(s)?{label:s,type:e}:{label:s,type:e,apply:t+s+t}}function MM(s,e,t,i,n,r){var o;let l=new Qu,a=((o=r==null?void 0:r.spec.identifierQuotes)===null||o===void 0?void 0:o[0])||'"',h=l.child(n||"",a);for(let c in s){let u=c.replace(/\\?\./g,f=>f=="."?"\0":f).split("\0"),d=u.length==1?h:l;for(let f of u)d=d.child(f.replace(/\\\./g,"."),a);for(let f of s[c])f&&d.list.push(typeof f=="string"?Dv(f,"property",a):f)}return e&&h.addCompletions(e),t&&l.addCompletions(t),l.addCompletions(h.list),i&&l.addCompletions(h.child(i,a).list),c=>{let{parents:u,from:d,quoted:f,empty:p,aliases:m}=xM(c.state,c.pos);if(p&&!c.explicit)return null;m&&u.length==1&&(u=m[u[0]]||u);let g=l;for(let C of u){for(;!g.children||!g.children[C];)if(g==l)g=h;else if(g==h&&i)g=g.child(i,a);else return null;g=g.child(C,a)}let b=f&&c.state.sliceDoc(c.pos,c.pos+1)==f,v=g.list;return g==l&&m&&(v=v.concat(Object.keys(m).map(C=>({label:C,type:"constant"})))),{from:d,to:b?c.pos+1:void 0,options:_M(f,v),validFor:f?TM:RM}}}function DM(s,e){let t=Object.keys(s).map(i=>({label:e?i.toUpperCase():i,type:s[i]==Sv?"type":s[i]==kv?"keyword":"variable",boost:-1}));return PR(["QuotedIdentifier","SpecialVar","String","LineComment","BlockComment","."],hv(t))}let AM=CM.configure({props:[oy.add({Statement:yS()}),ay.add({Statement(s){return{from:s.firstChild.to,to:s.to}},BlockComment(s){return{from:s.from+2,to:s.to-2}}}),iy({Keyword:_.keyword,Type:_.typeName,Builtin:_.standard(_.name),Bits:_.number,Bytes:_.string,Bool:_.bool,Null:_.null,Number:_.number,String:_.string,Identifier:_.name,QuotedIdentifier:_.special(_.string),SpecialVar:_.special(_.name),LineComment:_.lineComment,BlockComment:_.blockComment,Operator:_.operator,"Semi Punctuation":_.punctuation,"( )":_.paren,"{ }":_.brace,"[ ]":_.squareBracket})]});class Ha{constructor(e,t,i){this.dialect=e,this.language=t,this.spec=i}get extension(){return this.language.extension}static define(e){let t=wM(e,e.keywords,e.types,e.builtin),i=ia.define({name:"sql",parser:AM.configure({tokenizers:[{from:Mv,to:Tv(t)}]}),languageData:{commentTokens:{line:"--",block:{open:"/*",close:"*/"}},closeBrackets:{brackets:["(","[","{","'",'"',"`"]}}});return new Ha(t,i,e)}}function OM(s,e=!1){return DM(s.dialect.words,e)}function LM(s,e=!1){return s.language.data.of({autocomplete:OM(s,e)})}function IM(s){return s.schema?MM(s.schema,s.tables,s.schemas,s.defaultTable,s.defaultSchema,s.dialect||Ju):()=>null}function BM(s){return s.schema?(s.dialect||Ju).language.data.of({autocomplete:IM(s)}):[]}function FM(s={}){let e=s.dialect||Ju;return new hS(e.language,[BM(s),LM(e,!!s.upperCaseKeywords)])}const Ju=Ha.define({}),PM="percentile_cont row_number rank dense_rank rank_dense percent_rank cume_dist ntile lag lead first_value last_value nth_value first last",NM={operatorChars:"*+-%<>!=&|^",charSetCasts:!0,doubleQuotedStrings:!1,unquotedBitLiterals:!0,hashComments:!1,spaceAfterDashes:!1,specialVar:"@?",identifierQuotes:"`",keywords:PM+" !__postfix !~~ !~~* % & * ** + - / // << >> @ ^ ^@ abort abs absolute access access_mode acos action add admin after age aggregate alias all all_profiling_output allow_unsigned_extensions also alter always analyse analyze and anti any any_value apply approx_count_distinct approx_quantile arbitrary arg_max arg_min argmax argmin array array_agg array_aggr array_aggregate array_append array_apply array_cat array_concat array_contains array_distinct array_extract array_filter array_has array_indexof array_length array_pop_back array_pop_front array_position array_prepend array_push_back array_push_front array_reverse_sort array_slice array_sort array_to_string array_transform array_unique arrow_large_buffer_size arrow_scan arrow_scan_dumb as asc ascii asin asof assertion assignment asymmetric at atan atan2 attach attribute authorization avg backward bar base64 before begin between bigint bin binary binary_as_string bit bit_and bit_count bit_length bit_or bit_xor bitstring_agg blob bool bool_and bool_or boolean both bpchar by bytea cache call called cardinality cascade cascaded case cast catalog cbrt ceil ceiling century chain char character characteristics check checkpoint checkpoint_threshold chr class close cluster coalesce col_description collate collation collations column columns combine comment comments commit committed compression concat_ws concurrently configuration conflict connection constant_or_null constraint constraints content continue conversion copy corr cos cost count count_if count_star covar_pop covar_samp create create_fts_index cross csv cube current current_catalog current_database current_date current_query current_role current_schema current_schemas current_setting current_user currval custom_extension_repository cycle damerau_levenshtein data database database_list database_size date date_add date_diff date_part date_sub date_trunc datediff datepart datesub datetime datetrunc day dayname dayofmonth dayofweek dayofyear days deallocate debug_asof_iejoin debug_checkpoint_abort debug_force_external debug_force_no_cross_product dec decade declare decode default default_collation default_null_order default_order defaults deferrable definer degrees delimiters depends desc describe detach dictionary disable disable_checkpoint_on_shutdown disable_object_cache disable_optimizer disable_print_progress_bar disable_profile disable_profiling disable_progress_bar disable_verification disable_verify_external disable_verify_parallelism disable_verify_serializer disabled_optimizers discard distinct divide do document domain double drop drop_fts_index duckdb_columns duckdb_constraints duckdb_databases duckdb_dependencies duckdb_extensions duckdb_functions duckdb_indexes duckdb_keywords duckdb_schemas duckdb_sequences duckdb_settings duckdb_tables duckdb_temporary_files duckdb_views each editdist3 element_at else enable enable_checkpoint_on_shutdown enable_external_access enable_fsst_vectors enable_object_cache enable_optimizer enable_print_progress_bar enable_profile enable_progress_bar enable_progress_bar_print enable_verification encode encoding encrypted end entropy enum enum_code enum_first enum_last enum_range enum_range_boundary epoch epoch_ms era error escape even event except exclude excluding exclusive execute exists exp experimental_parallel_csv explain explain_output export export_state extension extension_directory external external_threads extract false family fdiv fetch file_search_path filter finalize flatten float float4 float8 floor fmod following for force force_bitpacking_mode force_checkpoint force_compression force_index_join foreign format formatReadableDecimalSize format_bytes format_pg_type format_type forward freeze from from_base64 from_binary from_hex full function functions gamma gcd gen_random_uuid generate_series generate_subscripts generated get_bit get_current_time get_current_timestamp glob global grant granted greatest greatest_common_divisor group grouping grouping_id guid hamming handler has_any_column_privilege has_column_privilege has_database_privilege has_foreign_data_wrapper_privilege has_function_privilege has_language_privilege has_schema_privilege has_sequence_privilege has_server_privilege has_table_privilege hash having header hex histogram hold home_directory hour hugeint identity if ignore ilike ilike_escape immediate immediate_transaction_mode implicit import in include including increment index index_scan indexes inet_client_addr inet_client_port inet_server_addr inherits initially inline inner inout input insensitive insert install instr int int1 int128 int16 int2 int32 int4 int64 int8 integer integer_division integral intersect interval into invoker is isinf isnull isodow isolation isoyear jaccard jaro_similarity jaro_winkler_similarity join json kahan_sum key kurtosis label language large last last_day lateral lcase lcm leading leakproof least least_common_multiple left len length_grapheme level levenshtein lgamma like like_escape limit list list_any_value list_append list_approx_count_distinct list_avg list_bit_or list_bit_xor list_bool_and list_bool_or list_concat list_contains list_count list_distinct list_entropy list_extract list_filter list_has list_histogram list_indexof list_kurtosis list_last list_mad list_max list_median list_min list_mode list_pack list_position list_prepend list_product list_reverse_sort list_skewness list_slice list_sort list_stddev_pop list_stddev_samp list_string_agg list_sum list_transform list_unique list_value list_var_pop list_var_samp listen ln load local location lock lock_configuration locked log log2 log_query_path logged logical long lower lpad macro mad make_date make_time make_timestamp map map_concat map_entries map_from_entries map_keys mapping materialized max max_by max_expression_depth max_memory maxvalue md5 md5_number md5_number_lower md5_number_upper mean median memory_limit microseconds millennium millisecond milliseconds min_by minute minutes minvalue mismatches mod mode month monthname months move name names natural new nextafter no none not not_ilike_escape not_like_escape notify notnull now nowait null null_order nullif numeric object octet_length of off offset oid oids old only operator option options or order ordinality outer over overlaps overlay overriding owned owner parallel parquet_metadata parquet_scan parquet_schema parser partial partition password percent perfect_ht_threshold pg_conversion_is_visible pg_function_is_visible pg_get_constraintdef pg_get_expr pg_has_role pg_is_other_temp_schema pg_my_temp_schema pg_opclass_is_visible pg_operator_is_visible pg_postmaster_start_time pg_size_pretty pg_table_is_visible pg_ts_config_is_visible pg_ts_dict_is_visible pg_ts_parser_is_visible pg_ts_template_is_visible pg_type_is_visible pg_typeof pivot pivot_longer pivot_wider placing plans policy position pow power pragma_collations pragma_database_size pragma_detailed_profiling_output pragma_last_profiling_output pragma_storage_info pragma_table_info pragma_version preceding precision prepare preserve preserve_insertion_order primary printf prior privileges procedure product profiler_history_size profiling_mode profiling_output program publication qualify quantile_cont quote radians random range read read_csv_auto read_parquet real reassign recheck recursive ref references referencing refresh regexp_extract_all regexp_full_match regexp_replace regexp_split_to_array regr_avgx regr_count regr_intercept regr_r2 regr_slope regr_sxx reindex relative release rename repeat repeat_row repeatable replica reservoir_quantile reset restart restrict returning returns reverse revoke rollback rollup round round_even roundbankers row rows rpad rtrim rule s3_endpoint s3_region s3_secret_access_key s3_session_token sample savepoint schema scroll search second seconds security semi seq_scan sequence sequences serializable server session session_user set_bit setof sets shobj_description show show_databases show_tables show_tables_expanded sign signbit signed sin skip smallint snapshot split split_part stable standalone start starts_with statement statistics stddev stddev_pop stdin stdout storage storage_info str_split strict string string_agg string_split string_split_regex string_to_array strip strip_accents strpos strptime struct struct_extract struct_insert struct_pack subscription substr subtract suffix sum sum_no_overflow sumkahan summarize summary symmetric sysid system table table_info tables tablesample tablespace tan temp template temporary test_all_types test_vector_types text then time_bucket timestamp timestamp_ms timetz timezone timezone_hour tinyint to to_base64 to_days to_hex to_hours to_microseconds to_milliseconds to_minutes to_months to_seconds to_timestamp to_years today trailing transaction transaction_timestamp transform treat trim true trunc trusted try_cast try_strptime txid_current type typeof types ubigint ucase uint16 uint32 uint64 uint8 uinteger unbounded uncommitted unencrypted unhex unicode union_extract union_tag union_value unknown unlisten unlogged unnest unpivot update upper use user using usmallint utinyint uuid vacuum validate validator value values var_pop var_samp varchar variadic varying verbose verify_external verify_parallelism views virtual volatile wal_autocheckpoint week weekday weekofyear when where whitespace window within without work worker_threads write xml xmlconcat xmlelement xmlexists xmlforest xmlnamespaces xmlparse xmlpi xmlroot year years yearweek yes | || ~ ~~ ~~* bit_position contains cot cursor debug_window_mode decimal deferred duckdb_types enable_http_metadata_cache first fsum group_concat has_tablespace_privilege hours immutable in_search_path inet_server_port instead isfinite isnan left_grapheme length list_aggr list_aggregate list_apply list_bit_and list_cat list_element list_first list_sem log10 ltrim map_extract match microsecond min multiply national nchar next nextval nfc_normalize nothing nulls nvarchar obj_description on ord out passing pg_collation_is_visible pg_conf_load_time pi pivot_limit positional pragma preserve_identifier_case procedural progress_bar_time quantile_disc read_csv regexp_matches regr_avgy regr_sxy regr_syy s3_access_key_id schemas select sem setseed short similar some sql stats stored str_split_regex strftime strlen substring substring_grapheme temp_directory timestamp_ns to_binary translate trigger truncate unbin union unique until username valid variance verify_serializer view with wrapper xmlattributes xmltable xor zone ~~~ delete delimiter enable_profiling favg import_database inherit map_values pg_get_viewdef pg_opfamily_is_visible prefix prepared quantile regexp_extract right_grapheme role search_path share skewness sqrt threads timestamp_s timezone_minute version bitstring concat factorial quarter replace right stddev_samp stem timestamp_us method respect simple time varbinary xmlserialize profile_output set timestamptz ordered_aggregate_threshold",types:"double float null guid bitstring bit union map boolean list bool struct uint8 int1 tinyint short timestamp_us int32 integral signed string int timestamptz int4 integer logical nvarchar uint64 uint32 ubigint timestamp int64 text oid row date int16 bigint float8 int128 smallint hugeint binary dec bpchar real varbinary uinteger uint16 interval varchar decimal timetz uuid char timestamp_ns timestamp_s time utinyint blob datetime int8 enum usmallint numeric float4 bytea int2 long timestamp_ms"},zM=Ha.define(NM);class gt{constructor(e){this.table=e}reloadData(e,t,i){return this.table.dataLoader.load(e,void 0,void 0,void 0,t,i)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,t){return typeof t<"u"&&(this.table.options[e]=t),this.table.options[e]}deprecationCheck(e,t,i){return this.table.deprecationAdvisor.check(e,t,i)}deprecationCheckMsg(e,t){return this.table.deprecationAdvisor.checkMsg(e,t)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class Te{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,t,i){var n=e?t.split(e):[t],r=n.length,o;for(let l=0;l<r&&(i=i[n[l]],o=i,!!i);l++);return o}static deepClone(e,t,i=[]){var n={}.__proto__,r=[].__proto__;t||(t=Object.assign(Array.isArray(e)?[]:{},e));for(var o in e){let l=e[o],a,h;l!=null&&typeof l=="object"&&(l.__proto__===n||l.__proto__===r)&&(a=i.findIndex(c=>c.subject===l),a>-1?t[o]=i[a].copy:(h=Object.assign(Array.isArray(l)?[]:{},l),i.unshift({subject:l,copy:h}),t[o]=this.deepClone(l,h,i)))}return t}}class Xu extends gt{constructor(e,t,i){super(e),this.element=t,this.container=this._lookupContainer(),this.parent=i,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,t=this.table.element){return e===t?!0:t.parentNode?this._checkContainerIsParent(e,t.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var t=!(e instanceof MouseEvent),i=t?e.touches[0].pageX:e.pageX,n=t?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let r=Te.elOffset(this.container);i-=r.left,n-=r.top}return{x:i,y:n}}elementPositionCoords(e,t="right"){var i=Te.elOffset(e),n,r,o;switch(this.container!==document.body&&(n=Te.elOffset(this.container),i.left-=n.left,i.top-=n.top),t){case"right":r=i.left+e.offsetWidth,o=i.top-1;break;case"bottom":r=i.left,o=i.top+e.offsetHeight;break;case"left":r=i.left,o=i.top-1;break;case"top":r=i.left,o=i.top;break;case"center":r=i.left+e.offsetWidth/2,o=i.top+e.offsetHeight/2;break}return{x:r,y:o,offset:i}}show(e,t){var i,n,r,o,l;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(r=e,l=this.elementPositionCoords(e,t),o=l.offset,i=l.x,n=l.y):typeof e=="number"?(o={top:0,left:0},i=e,n=t):(l=this.containerEventCoords(e),i=l.x,n=l.y,this.reversedX=!1),this.element.style.top=n+"px",this.element.style.left=i+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(i,n,r,o,t),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",a=>{a.stopPropagation()}),this)}_fitToScreen(e,t,i,n,r){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;if((e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",i?this.element.style.right=this.container.offsetWidth-n.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0),t+this.element.offsetHeight>Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0))if(i)switch(r){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-i.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+i.offsetHeight+1+"px"}else this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new Xu(this.table,e,this),this.childPopup}}class se extends gt{constructor(e,t){super(e),this._handler=null}initialize(){}registerTableOption(e,t){this.table.optionsList.register(e,t)}registerColumnOption(e,t){this.table.columnManager.optionsList.register(e,t)}registerTableFunction(e,t){typeof this.table[e]>"u"?this.table[e]=(...i)=>(this.table.initGuard(e),t(...i)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,t,i){return this.table.componentFunctionBinder.bind(e,t,i)}registerDataHandler(e,t){this.table.rowManager.registerDataPipelineHandler(e,t),this._handler=e}registerDisplayHandler(e,t){this.table.rowManager.registerDisplayPipelineHandler(e,t),this._handler=e}displayRows(e){var t=this.table.rowManager.displayRows.length-1,i;if(this._handler&&(i=this.table.rowManager.displayPipeline.findIndex(n=>n.handler===this._handler),i>-1&&(t=i)),e&&(t=t+e),this._handler)return t>-1?this.table.rowManager.getDisplayRows(t):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,t){t||(t=this._handler),t&&this.table.rowManager.refreshActiveData(t,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,t){return new Xu(this.table,e,t)}alert(e,t){return this.table.alertManager.alert(e,t)}clearAlert(){return this.table.alertManager.clear()}}var HM={};class er extends se{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var t=!1,i={};this.allowedTypes.forEach(n=>{var r="accessor"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[r]&&(o=this.lookupAccessor(e.definition[r]),o&&(t=!0,i[r]={accessor:o,params:e.definition[r+"Params"]||{}}))}),t&&(e.modules.accessor=i)}lookupAccessor(e){var t=!1;switch(typeof e){case"string":er.accessors[e]?t=er.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":t=e;break}return t}transformRow(e,t){var i="accessor"+(t.charAt(0).toUpperCase()+t.slice(1)),n=e.getComponent(),r=Te.deepClone(e.data||{});return this.table.columnManager.traverse(function(o){var l,a,h,c;o.modules.accessor&&(a=o.modules.accessor[i]||o.modules.accessor.accessor||!1,a&&(l=o.getFieldValue(r),l!="undefined"&&(c=o.getComponent(),h=typeof a.params=="function"?a.params(l,r,t,c,n):a.params,o.setFieldValue(r,a.accessor(l,r,t,h,c,n)))))}),r}}er.moduleName="accessor";er.accessors=HM;var VM={method:"GET"};function Wc(s,e){var t=[];if(e=e||"",Array.isArray(s))s.forEach((n,r)=>{t=t.concat(Wc(n,e?e+"["+r+"]":r))});else if(typeof s=="object")for(var i in s)t=t.concat(Wc(s[i],e?e+"["+i+"]":i));else t.push({key:e,value:s});return t}function WM(s){var e=Wc(s),t=[];return e.forEach(function(i){t.push(encodeURIComponent(i.key)+"="+encodeURIComponent(i.value))}),t.join("&")}function Av(s,e,t){return s&&t&&Object.keys(t).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",s+=(s.includes("?")?"&":"?")+WM(t)),s}function UM(s,e,t){var i;return new Promise((n,r)=>{if(s=this.urlGenerator.call(this.table,s,e,t),e.method.toUpperCase()!="GET")if(i=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],i){for(var o in i.headers)e.headers||(e.headers={}),typeof e.headers[o]>"u"&&(e.headers[o]=i.headers[o]);e.body=i.body.call(this,s,e,t)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);s?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(s,e).then(l=>{l.ok?l.json().then(a=>{n(a)}).catch(a=>{r(a),console.warn("Ajax Load Error - Invalid JSON returned",a)}):(console.error("Ajax Load Error - Connection Error: "+l.status,l.statusText),r(l))}).catch(l=>{console.error("Ajax Load Error - Connection Error: ",l),r(l)})):(console.warn("Ajax Load Error - No URL Set"),n([]))})}function Uc(s,e){var t=[];if(e=e||"",Array.isArray(s))s.forEach((n,r)=>{t=t.concat(Uc(n,e?e+"["+r+"]":r))});else if(typeof s=="object")for(var i in s)t=t.concat(Uc(s[i],e?e+"["+i+"]":i));else t.push({key:e,value:s});return t}var jM={json:{headers:{"Content-Type":"application/json"},body:function(s,e,t){return JSON.stringify(t)}},form:{headers:{},body:function(s,e,t){var i=Uc(t),n=new FormData;return i.forEach(function(r){n.append(r.key,r.value)}),n}}};class ii extends se{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=ii.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||ii.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||ii.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,t,i,n){var r=this.table.options.ajaxParams;return r&&(typeof r=="function"&&(r=r.call(this.table)),n=Object.assign(Object.assign({},r),n)),n}requestDataCheck(e,t,i,n){return!!(!e&&this.url||typeof e=="string")}requestData(e,t,i,n,r){var o;return!r&&this.requestDataCheck(e)?(e&&this.setUrl(e),o=this.generateConfig(i),this.sendRequest(this.url,t,o)):r}setDefaultConfig(e={}){this.config=Object.assign({},ii.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var t=Object.assign({},this.config);return typeof e=="string"?t.method=e:Object.assign(t,e),t}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,t,i){return this.table.options.ajaxRequesting.call(this.table,e,t)!==!1?this.loaderPromise(e,i,t).then(n=>(this.table.options.ajaxResponse&&(n=this.table.options.ajaxResponse.call(this.table,e,t,n)),n)):Promise.reject()}}ii.moduleName="ajax";ii.defaultConfig=VM;ii.defaultURLGenerator=Av;ii.defaultLoaderPromise=UM;ii.contentTypeFormatters=jM;var GM={replace:function(s){return this.table.setData(s)},update:function(s){return this.table.updateOrAddData(s)},insert:function(s){return this.table.addData(s)},range:function(s){var e=[],t=this.table.modules.selectRange.activeRange,i=!1,n,r,o,l,a;return a=s.length,t&&(n=t.getBounds(),r=n.start,n.start===n.end&&(i=!0),r&&(e=this.table.rowManager.activeRows.slice(),o=e.indexOf(r.row),i?l=s.length:l=e.indexOf(n.end.row)-o+1,o>-1&&(this.table.blockRedraw(),e=e.slice(o,o+l),e.forEach((h,c)=>{h.updateData(s[c%a])}),this.table.restoreRedraw()))),e}},qM={table:function(s){var e=[],t=!0,i=this.table.columnManager.columns,n=[],r=[];return s=s.split(`
`),s.forEach(function(o){e.push(o.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(o){var l=i.find(function(a){return o&&a.definition.title&&o.trim()&&a.definition.title.trim()===o.trim()});l?n.push(l):t=!1}),t||(t=!0,n=[],e[0].forEach(function(o){var l=i.find(function(a){return o&&a.field&&o.trim()&&a.field.trim()===o.trim()});l?n.push(l):t=!1}),t||(n=this.table.columnManager.columnsByIndex)),t&&e.shift(),e.forEach(function(o){var l={};o.forEach(function(a,h){n[h]&&(l[n[h].field]=a)}),r.push(l)}),r):!1},range:function(s){var e=[],t=[],i=this.table.modules.selectRange.activeRange,n=!1,r,o,l,a,h;return i&&(r=i.getBounds(),o=r.start,r.start===r.end&&(n=!0),o&&(s=s.split(`
`),s.forEach(function(c){e.push(c.split("	"))}),e.length&&(a=this.table.columnManager.getVisibleColumnsByIndex(),h=a.indexOf(o.column),h>-1)))?(n?l=e[0].length:l=a.indexOf(r.end.column)-h+1,a=a.slice(h,h+l),e.forEach(c=>{var u={},d=c.length;a.forEach(function(f,p){u[f.field]=c[p%d]}),t.push(u)}),t):!1}};class hn extends se{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var t,i,n;this.blocked||(e.preventDefault(),this.customSelection?(t=this.customSelection,this.table.options.clipboardCopyFormatter&&(t=this.table.options.clipboardCopyFormatter("plain",t))):(n=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),i=this.table.modules.export.generateHTMLTable(n),t=i?this.generatePlainContent(n):"",this.table.options.clipboardCopyFormatter&&(t=this.table.options.clipboardCopyFormatter("plain",t),i=this.table.options.clipboardCopyFormatter("html",i))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",t):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",t),i&&e.clipboardData.setData("text/html",i)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",t),i&&e.originalEvent.clipboardData.setData("text/html",i)),this.dispatchExternal("clipboardCopied",t,i),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var t=[];return e.forEach(i=>{var n=[];i.columns.forEach(r=>{var o="";if(r)if(i.type==="group"&&(r.value=r.component.getKey()),r.value===null)o="";else switch(typeof r.value){case"object":o=JSON.stringify(r.value);break;case"undefined":o="";break;default:o=r.value}n.push(o)}),t.push(n.join("	"))}),t.join(`
`)}copy(e,t){var i,n;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),i=window.getSelection(),i.toString()&&t&&(this.customSelection=i.toString()),i.removeAllRanges(),i.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(n=document.body.createTextRange(),n.moveToElementText(this.table.element),n.select()),document.execCommand("copy"),i&&i.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=hn.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=hn.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var t,i,n;this.checkPasteOrigin(e)&&(t=this.getPasteData(e),i=this.pasteParser.call(this,t),i?(e.preventDefault(),this.table.modExists("mutator")&&(i=this.mutateData(i)),n=this.pasteAction.call(this,i),this.dispatchExternal("clipboardPasted",t,i,n)):this.dispatchExternal("clipboardPasteError",t))}mutateData(e){var t=[];return Array.isArray(e)?e.forEach(i=>{t.push(this.table.modules.mutator.transformRow(i,"clipboard"))}):t=e,t}checkPasteOrigin(e){var t=!0,i=this.confirm("clipboard-paste",[e]);return(i||!["DIV","SPAN"].includes(e.target.tagName))&&(t=!1),t}getPasteData(e){var t;return window.clipboardData&&window.clipboardData.getData?t=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?t=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(t=e.originalEvent.clipboardData.getData("text/plain")),t}}hn.moduleName="clipboard";hn.pasteActions=GM;hn.pasteParsers=qM;class $M{constructor(e){return this._row=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._row.table.componentFunctionBinder.handle("row",t._row,i)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(t){e.push(t.getComponent())}),e}getCell(e){var t=this._row.getCell(e);return t?t.getComponent():!1}_getSelf(){return this._row}}class Ov{constructor(e){return this._cell=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._cell.table.componentFunctionBinder.handle("cell",t._cell,i)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,t){typeof t>"u"&&(t=!0),this._cell.setValue(e,t)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class vo extends gt{constructor(e,t){super(e.table),this.table=e.table,this.column=e,this.row=t,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell")}_configureCell(){var e=this.element,t=this.column.getField(),i={top:"flex-start",bottom:"flex-end",middle:"center"},n={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=i[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=n[this.column.hozAlign]||"")),t&&e.setAttribute("tabulator-field",t),this.column.definition.cssClass){var r=this.column.definition.cssClass.split(" ");r.forEach(o=>{e.classList.add(o)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,t,i){var n=this.setValueProcessData(e,t,i);n&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,t,i){var n=!1;return(this.value!==e||i)&&(n=!0,t&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),n&&this.dispatch("cell-value-changed",this),n}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new Ov(this)),this.component}}class Lv{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._column.table.componentFunctionBinder.handle("column",t._column,i)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(t){e.push(t.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(t){e.push(t.getComponent())}),e}getParentColumn(){return this._column.parent instanceof Ii?this._column.parent.getComponent():!1}_getSelf(){return this._column}scrollTo(e,t){return this._column.table.columnManager.scrollToColumn(this._column,e,t)}getTable(){return this._column.table}move(e,t){var i=this._column.table.columnManager.findColumn(e);i?this._column.table.columnManager.moveColumn(this._column,i,t):console.warn("Move Error - No matching column found:",i)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var t;return e===!0?t=this._column.reinitializeWidth(!0):t=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),t}}var Iv={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class Ii extends gt{constructor(e,t){super(t.table),this.definition=e,this.parent=t,this.type="column",this.columns=[],this.cells=[],this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.isGroup=!1,this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((i,n)=>{var r=new Ii(i,this);this.attachColumn(r)}),this.checkColumnVisibility()):t.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let t in e)typeof this.definition[t]>"u"&&(this.definition[t]=e[t]);this.definition=this.table.columnManager.optionsList.generate(Ii.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{Ii.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var t=e.cssClass.split(" ");t.forEach(i=>{this.element.classList.add(i)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,t=document.createElement("div");if(t.classList.add("tabulator-col-title"),e.headerWordWrap&&t.classList.add("tabulator-col-title-wrap"),e.editableTitle){var i=document.createElement("input");i.classList.add("tabulator-title-editor"),i.addEventListener("click",n=>{n.stopPropagation(),i.focus()}),i.addEventListener("change",()=>{e.title=i.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),t.appendChild(i),e.field?this.langBind("columns|"+e.field,n=>{i.value=n||e.title||"&nbsp;"}):i.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,n=>{this._formatColumnHeaderTitle(t,n||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(t,e.title||"&nbsp;");return t}_formatColumnHeaderTitle(e,t){var i=this.chain("column-format",[this,t,e],null,()=>t);switch(typeof i){case"object":i instanceof Node?e.appendChild(i):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",i));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=i}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(t=>{this.element.classList.add(t)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var t=e,i=this.fieldStructure,n=i.length,r;for(let o=0;o<n&&(t=t[i[o]],r=t,!!t);o++);return r}_setFlatData(e,t){this.field&&(e[this.field]=t)}_setNestedData(e,t){var i=e,n=this.fieldStructure,r=n.length;for(let o=0;o<r;o++)if(o==r-1)i[n[o]]=t;else{if(!i[n[o]])if(typeof t<"u")i[n[o]]={};else break;i=i[n[o]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,t){var i=this.parent.isGroup?this.parent.getGroupElement().clientHeight:t||this.parent.getHeadersElement().clientHeight;this.element.style.height=i+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=i-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(n){n.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var t=[];return e?this.columns.forEach(i=>{t.push(i),t=t.concat(i.getColumns(!0))}):t=this.columns,t}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var t=[];return this.isGroup&&e&&(this.columns.forEach(function(i){t.push(i.getDefinition(!0))}),this.definition.columns=t),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(t){t.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,t){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(i){i.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,t),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,t){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(i){i.hide()}),this.dispatch("column-hide",this,t),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(t){t.visible&&(e+=t.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var t=this.columns.indexOf(e);t>-1&&this.columns.splice(t,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(t){t.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this)}checkCellHeights(){var e=[];this.cells.forEach(function(t){t.row.heightInitialized&&(t.row.getElement().offsetParent!==null?(e.push(t.row),t.row.clearCellHeight()):t.row.heightInitialized=!1)}),e.forEach(function(t){t.calcHeight()}),e.forEach(function(t){t.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(t){t.visible&&(e+=t.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(t){t.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(t){t.setMaxWidth()})}delete(){return new Promise((e,t)=>{this.isGroup&&this.columns.forEach(function(n){n.delete()}),this.dispatch("column-delete",this);var i=this.cells.length;for(let n=0;n<i;n++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var t=new vo(this,e);return this.cells.push(t),t}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var t=this.table.columnManager.getColumnByIndex(e);return!t||t.visible?t:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var t=this.table.columnManager.getColumnByIndex(e);return!t||t.visible?t:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(n=>{n.clearWidth()}));var t=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(n=>{var r=n.getWidth();r>t&&(t=r)}),t)){var i=t+1;this.maxInitialWidth&&!e&&(i=Math.min(i,this.maxInitialWidth)),this.setWidthActual(i)}}}updateDefinition(e){var t;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(t=Object.assign({},this.getDefinition()),t=Object.assign(t,e),this.table.columnManager.addColumn(t,!1,this).then(i=>(t.field==this.field&&(this.field=!1),this.delete().then(()=>i.getComponent()))))}deleteCell(e){var t=this.cells.indexOf(e);t>-1&&this.cells.splice(t,1)}getComponent(){return this.component||(this.component=new Lv(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}}Ii.defaultOptionList=Iv;class Va{constructor(e){return this._row=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._row.table.componentFunctionBinder.handle("row",t._row,i)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(t){e.push(t.getComponent())}),e}getCell(e){var t=this._row.getCell(e);return t?t.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,t){return this._row.table.rowManager.scrollToRow(this._row,e,t)}move(e,t){this._row.moveToRow(e,t)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class lt extends gt{constructor(e,t,i="row"){super(t.table),this.parent=t,this.data={},this.type=i,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,t){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,t),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,t)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var t=0,i;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(i=this.table.options.resizableRows?this.element.clientHeight:0,this.cells.forEach(function(n){var r=n.getHeight();r>t&&(t=r)}),e?this.height=Math.max(t,i):this.height=this.manualHeight?this.height:Math.max(t,i)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,t){(this.height!=e||t)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var t=this.cells.indexOf(e);t>-1&&this.cells.splice(t,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var t=this.element&&Te.elVisible(this.element),i={},n;return new Promise((r,o)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(i=Object.assign(i,this.data),i=Object.assign(i,e)),n=this.chain("row-data-changing",[this,i,e],null,e);for(let l in n)this.data[l]=n[l];this.dispatch("row-data-save-after",this);for(let l in e)this.table.columnManager.getColumnsByFieldRoot(l).forEach(h=>{let c=this.getCell(h.getField());if(c){let u=h.getFieldValue(n);c.getValue()!==u&&(c.setValueProcessData(u),t&&c.cellRendered())}});t?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,t,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),r()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var t=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),t=this.cells.find(function(i){return i.column===e}),t}getCellIndex(e){return this.cells.findIndex(function(t){return t===e})}findCell(e){return this.cells.find(t=>t.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,t){var i=this.table.rowManager.findRow(e);i?(this.table.rowManager.moveRowActual(this,i,!t),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let t=0;t<e;t++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(t=>{t(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new Va(this)),this.component}}var KM={avg:function(s,e,t){var i=0,n=typeof t.precision<"u"?t.precision:2;return s.length&&(i=s.reduce(function(r,o){return Number(r)+Number(o)}),i=i/s.length,i=n!==!1?i.toFixed(n):i),parseFloat(i).toString()},max:function(s,e,t){var i=null,n=typeof t.precision<"u"?t.precision:!1;return s.forEach(function(r){r=Number(r),(r>i||i===null)&&(i=r)}),i!==null?n!==!1?i.toFixed(n):i:""},min:function(s,e,t){var i=null,n=typeof t.precision<"u"?t.precision:!1;return s.forEach(function(r){r=Number(r),(r<i||i===null)&&(i=r)}),i!==null?n!==!1?i.toFixed(n):i:""},sum:function(s,e,t){var i=0,n=typeof t.precision<"u"?t.precision:!1;return s.length&&s.forEach(function(r){r=Number(r),i+=isNaN(r)?0:Number(r)}),n!==!1?i.toFixed(n):i},concat:function(s,e,t){var i=0;return s.length&&(i=s.reduce(function(n,r){return String(n)+String(r)})),i},count:function(s,e,t){var i=0;return s.length&&s.forEach(function(n){n&&i++}),i},unique:function(s,e,t){var i=s.filter((n,r)=>(s||n===0)&&s.indexOf(n)===r);return i.length}};class ms extends se{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new Ii({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,t){return this.topRow&&t.unshift(this.topRow),this.botRow&&t.push(this.botRow),t}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var t=e.definition,i={topCalcParams:t.topCalcParams||{},botCalcParams:t.bottomCalcParams||{}};if(t.topCalc){switch(typeof t.topCalc){case"string":ms.calculations[t.topCalc]?i.topCalc=ms.calculations[t.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",t.topCalc);break;case"function":i.topCalc=t.topCalc;break}i.topCalc&&(e.modules.columnCalcs=i,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(t.bottomCalc){switch(typeof t.bottomCalc){case"string":ms.calculations[t.bottomCalc]?i.botCalc=ms.calculations[t.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",t.bottomCalc);break;case"function":i.botCalc=t.bottomCalc;break}i.botCalc&&(e.modules.columnCalcs=i,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var t,i;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(t=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),i=this.generateRow("top",t),this.topRow=i;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(i.getElement()),i.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),i=this.generateRow("bottom",t),this.botRow=i;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(i.getElement()),i.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(t=>{this.recalcGroup(t)})}}recalcGroup(e){var t,i;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(t=this.rowsToData(e.rows),i=this.generateRowData("bottom",t),e.calcs.bottom.updateData(i),e.calcs.bottom.reinitialize()),e.calcs.top&&(t=this.rowsToData(e.rows),i=this.generateRowData("top",t),e.calcs.top.updateData(i),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var t=[];return e.forEach(i=>{if(t.push(i.getData()),this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs&&i.modules.dataTree&&i.modules.dataTree.open){var n=this.rowsToData(this.table.modules.dataTree.getFilteredTreeChildren(i));t=t.concat(n)}}),t}generateRow(e,t){var i=this.generateRowData(e,t),n;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),n=new lt(i,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),n.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),n.component=!1,n.getComponent=()=>(n.component||(n.component=new $M(n)),n.component),n.generateCells=()=>{var r=[];this.table.columnManager.columnsByIndex.forEach(o=>{this.genColumn.setField(o.getField()),this.genColumn.hozAlign=o.hozAlign,o.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(o.definition[e+"CalcFormatter"]),params:o.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=o.definition.cssClass;var l=new vo(this.genColumn,n);l.getElement(),l.column=o,l.setWidth(),o.cells.push(l),r.push(l),o.visible||l.hide()}),n.cells=r},n}generateRowData(e,t){var i={},n=e=="top"?this.topCalcs:this.botCalcs,r=e=="top"?"topCalc":"botCalc",o,l;return n.forEach(function(a){var h=[];a.modules.columnCalcs&&a.modules.columnCalcs[r]&&(t.forEach(function(c){h.push(a.getFieldValue(c))}),l=r+"Params",o=typeof a.modules.columnCalcs[l]=="function"?a.modules.columnCalcs[l](h,t):a.modules.columnCalcs[l],a.setFieldValue(i,a.modules.columnCalcs[r](h,t,o)))}),i}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},t;return this.table.options.groupBy&&this.table.modExists("groupRows")?(t=this.table.modules.groupRows.getGroups(!0),t.forEach(i=>{e[i.getKey()]=this.getGroupResults(i)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var t=e._getSelf(),i=e.getSubGroups(),n={},r={};return i.forEach(o=>{n[o.getKey()]=this.getGroupResults(o)}),r={top:t.calcs.top?t.calcs.top.getData():{},bottom:t.calcs.bottom?t.calcs.bottom.getData():{},groups:n},r}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}ms.moduleName="columnCalcs";ms.calculations=KM;class Bv extends se{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,t=this.table.options;switch(this.field=t.dataTreeChildField,this.indent=t.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),t.dataTreeBranchElement?t.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof t.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=t.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=t.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),t.dataTreeCollapseElement?typeof t.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=t.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=t.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),t.dataTreeExpandElement?typeof t.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=t.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=t.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof t.dataTreeStartExpanded){case"boolean":this.startOpen=function(i,n){return t.dataTreeStartExpanded};break;case"function":this.startOpen=t.dataTreeStartExpanded;break;default:this.startOpen=function(i,n){return t.dataTreeStartExpanded[n]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var t;e&&(t=this.table.rowManager.getRows(),t.forEach(i=>{this.reinitializeRowChildren(i)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(t=>{e=e.concat(this.getTreeChildren(t,!1,!0))}),e}rowDataChanged(e,t,i){this.redrawNeeded(i)&&(this.initializeRow(e),t&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var t=e.column.getField();t===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var t=e.getData()[this.field],i=Array.isArray(t),n=i||!i&&typeof t=="object"&&t!==null;!n&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!n&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:n?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&n?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&n?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:n}}reinitializeRowChildren(e){var t=this.getTreeChildren(e,!1,!0);t.forEach(function(i){i.reinitialize(!0)})}layoutRow(e){var t=this.elementField?e.getCell(this.elementField):e.getCells()[0],i=t.getElement(),n=e.modules.dataTree;n.branchEl&&(n.branchEl.parentNode&&n.branchEl.parentNode.removeChild(n.branchEl),n.branchEl=!1),n.controlEl&&(n.controlEl.parentNode&&n.controlEl.parentNode.removeChild(n.controlEl),n.controlEl=!1),this.generateControlElement(e,i),e.getElement().classList.add("tabulator-tree-level-"+n.index),n.index&&(this.branchEl?(n.branchEl=this.branchEl.cloneNode(!0),i.insertBefore(n.branchEl,i.firstChild),this.table.rtl?n.branchEl.style.marginRight=(n.branchEl.offsetWidth+n.branchEl.style.marginLeft)*(n.index-1)+n.index*this.indent+"px":n.branchEl.style.marginLeft=(n.branchEl.offsetWidth+n.branchEl.style.marginRight)*(n.index-1)+n.index*this.indent+"px"):this.table.rtl?i.style.paddingRight=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-right"))+n.index*this.indent+"px":i.style.paddingLeft=parseInt(window.getComputedStyle(i,null).getPropertyValue("padding-left"))+n.index*this.indent+"px")}generateControlElement(e,t){var i=e.modules.dataTree,n=i.controlEl;t=t||e.getCells()[0].getElement(),i.children!==!1&&(i.open?(i.controlEl=this.collapseEl.cloneNode(!0),i.controlEl.addEventListener("click",r=>{r.stopPropagation(),this.collapseRow(e)})):(i.controlEl=this.expandEl.cloneNode(!0),i.controlEl.addEventListener("click",r=>{r.stopPropagation(),this.expandRow(e)})),i.controlEl.addEventListener("mousedown",r=>{r.stopPropagation()}),n&&n.parentNode===t?n.parentNode.replaceChild(i.controlEl,n):t.insertBefore(i.controlEl,t.firstChild))}getRows(e){var t=[];return e.forEach((i,n)=>{var r,o;t.push(i),i instanceof lt&&(i.create(),r=i.modules.dataTree,!r.index&&r.children!==!1&&(o=this.getChildren(i),o.forEach(l=>{l.create(),t.push(l)})))}),t}getChildren(e,t){var i=e.modules.dataTree,n=[],r=[];return i.children!==!1&&(i.open||t)&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(i.children):n=i.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(n),n.forEach(o=>{r.push(o);var l=this.getChildren(o);l.forEach(a=>{r.push(a)})})),r}generateChildren(e){var t=[],i=e.getData()[this.field];return Array.isArray(i)||(i=[i]),i.forEach(n=>{var r=new lt(n||{},this.table.rowManager);r.create(),r.modules.dataTree.index=e.modules.dataTree.index+1,r.modules.dataTree.parent=e,r.modules.dataTree.children&&(r.modules.dataTree.open=this.startOpen(r.getComponent(),r.modules.dataTree.index)),t.push(r)}),t}expandRow(e,t){var i=e.modules.dataTree;i.children!==!1&&(i.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var t=e.modules.dataTree;t.children!==!1&&(t.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var t=e.modules.dataTree;t.children!==!1&&(t.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var t=e.modules.dataTree,i=[],n;return t.children&&(Array.isArray(t.children)||(t.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?n=this.table.modules.filter.filter(t.children):n=t.children,n.forEach(r=>{r instanceof lt&&i.push(r)})),i}rowDelete(e){var t=e.modules.dataTree.parent,i;t&&(i=this.findChildIndex(e,t),i!==!1&&t.data[this.field].splice(i,1),t.data[this.field].length||delete t.data[this.field],this.initializeRow(t),this.layoutRow(t)),this.refreshData(!0)}addTreeChildRow(e,t,i,n){var r=!1;typeof t=="string"&&(t=JSON.parse(t)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof n<"u"&&(r=this.findChildIndex(n,e),r!==!1&&e.data[this.field].splice(i?r:r+1,0,t)),r===!1&&(i?e.data[this.field].unshift(t):e.data[this.field].push(t)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,t){var i=!1;return typeof e=="object"?e instanceof lt?i=e.data:e instanceof Va?i=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?t.modules.dataTree&&(i=t.modules.dataTree.children.find(n=>n instanceof lt?n.element===e:!1),i&&(i=i.data)):e===null&&(i=!1):typeof e>"u"?i=!1:i=t.data[this.field].find(n=>n.data[this.table.options.index]==e),i&&(Array.isArray(t.data[this.field])&&(i=t.data[this.field].indexOf(i)),i==-1&&(i=!1)),i}getTreeChildren(e,t,i){var n=e.modules.dataTree,r=[];return n&&n.children&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),n.children.forEach(o=>{o instanceof lt&&(r.push(t?o.getComponent():o),i&&(r=r.concat(this.getTreeChildren(o,t,i))))})),r}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}Bv.moduleName="dataTree";function YM(s,e={},t){var i=e.delimiter?e.delimiter:",",n=[],r=[];s.forEach(o=>{var l=[];switch(o.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":o.columns.forEach((a,h)=>{a&&a.depth===1&&(r[h]=typeof a.value>"u"||a.value===null?"":'"'+String(a.value).split('"').join('""')+'"')});break;case"row":o.columns.forEach(a=>{if(a){switch(typeof a.value){case"object":a.value=a.value!==null?JSON.stringify(a.value):"";break;case"undefined":a.value="";break}l.push('"'+String(a.value).split('"').join('""')+'"')}}),n.push(l.join(i));break}}),r.length&&n.unshift(r.join(i)),n=n.join(`
`),e.bom&&(n="\uFEFF"+n),t(n,"text/csv")}function QM(s,e,t){var i=[];s.forEach(n=>{var r={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(r[o.component.getTitleDownload()||o.component.getField()]=o.value)}),i.push(r);break}}),i=JSON.stringify(i,null,"	"),t(i,"application/json")}function JM(s,e={},t){var i=[],n=[],r={},o=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},l=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},a=e.jsPDF||{},h=e.title?e.title:"";a.orientation||(a.orientation=e.orientation||"landscape"),a.unit||(a.unit="pt"),s.forEach(d=>{switch(d.type){case"header":i.push(c(d));break;case"group":n.push(c(d,o));break;case"calc":n.push(c(d,l));break;case"row":n.push(c(d));break}});function c(d,f){var p=[];return d.columns.forEach(m=>{var g;if(m){switch(typeof m.value){case"object":m.value=m.value!==null?JSON.stringify(m.value):"";break;case"undefined":m.value="";break}g={content:m.value,colSpan:m.width,rowSpan:m.height},f&&(g.styles=f),p.push(g)}}),p}var u=new jspdf.jsPDF(a);e.autoTable&&(typeof e.autoTable=="function"?r=e.autoTable(u)||{}:r=e.autoTable),h&&(r.didDrawPage=function(d){u.text(h,40,30)}),r.head=i,r.body=n,u.autoTable(r),e.documentProcessing&&e.documentProcessing(u),t(u.output("arraybuffer"),"application/pdf")}function XM(s,e,t){var i=this,n=e.sheetName||"Sheet1",r=XLSX.utils.book_new(),o=new gt(this),l="compress"in e?e.compress:!0,a=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:l},h;a.type="binary",r.SheetNames=[],r.Sheets={};function c(){var f=[],p=[],m={},g={s:{c:0,r:0},e:{c:s[0]?s[0].columns.reduce((b,v)=>b+(v&&v.width?v.width:1),0):0,r:s.length}};return s.forEach((b,v)=>{var C=[];b.columns.forEach(function(x,w){x?(C.push(!(x.value instanceof Date)&&typeof x.value=="object"?JSON.stringify(x.value):x.value),(x.width>1||x.height>-1)&&(x.height>1||x.width>1)&&p.push({s:{r:v,c:w},e:{r:v+x.height-1,c:w+x.width-1}})):C.push("")}),f.push(C)}),XLSX.utils.sheet_add_aoa(m,f),m["!ref"]=XLSX.utils.encode_range(g),p.length&&(m["!merges"]=p),m}if(e.sheetOnly){t(c());return}if(e.sheets)for(var u in e.sheets)e.sheets[u]===!0?(r.SheetNames.push(u),r.Sheets[u]=c()):(r.SheetNames.push(u),o.commsSend(e.sheets[u],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:i.active,intercept:function(f){r.Sheets[u]=f}}));else r.SheetNames.push(n),r.Sheets[n]=c();e.documentProcessing&&(r=e.documentProcessing(r));function d(f){for(var p=new ArrayBuffer(f.length),m=new Uint8Array(p),g=0;g!=f.length;++g)m[g]=f.charCodeAt(g)&255;return p}h=XLSX.write(r,a),t(d(h),"application/octet-stream")}function ZM(s,e,t){this.modExists("export",!0)&&t(this.modules.export.generateHTMLTable(s),"text/html")}function eD(s,e,t){const i=[];s.forEach(n=>{const r={};switch(n.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":n.columns.forEach(o=>{o&&(r[o.component.getTitleDownload()||o.component.getField()]=o.value)}),i.push(JSON.stringify(r));break}}),t(i.join(`
`),"application/x-ndjson")}var tD={csv:YM,json:QM,jsonLines:eD,pdf:JM,xlsx:XM,html:ZM};class tr extends se{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(t,i){return new Blob([t],{type:i})}),this.registerTableOption("downloadReady",void 0),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){this.deprecationCheck("downloadReady","downloadEncoder")}downloadToTab(e,t,i,n){this.download(e,t,i,n,!0)}download(e,t,i,n,r){var o=!1;function l(h,c){r?r===!0?this.triggerDownload(h,c,e,t,!0):r(h):this.triggerDownload(h,c,e,t)}if(typeof e=="function"?o=e:tr.downloaders[e]?o=tr.downloaders[e]:console.warn("Download Error - No such download type found: ",e),o){var a=this.generateExportList(n);o.call(this.table,a,i||{},l.bind(this))}}generateExportList(e){var t=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),i=this.table.options.groupHeaderDownload;return i&&!Array.isArray(i)&&(i=[i]),t.forEach(n=>{var r;n.type==="group"&&(r=n.columns[0],i&&i[n.indent]&&(r.value=i[n.indent](r.value,n.component._group.getRowCount(),n.component._group.getData(),n.component)))}),t}triggerDownload(e,t,i,n,r){var o=document.createElement("a"),l=this.table.options.downloadEncoder(e,t);l&&(r?window.open(window.URL.createObjectURL(l)):(n=n||"Tabulator."+(typeof i=="function"?"txt":i),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(l,n):(o.setAttribute("href",window.URL.createObjectURL(l)),o.setAttribute("download",n),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o))),this.dispatchExternal("downloadComplete"))}commsReceived(e,t,i){switch(t){case"intercept":this.download(i.type,"",i.options,i.active,i.intercept);break}}}tr.moduleName="download";tr.downloaders=tD;function Wa(s,e){var t=e.mask,i=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",n=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",r=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function o(l){var a=t[l];typeof a<"u"&&a!==r&&a!==i&&a!==n&&(s.value=s.value+""+a,o(l+1))}s.addEventListener("keydown",l=>{var a=s.value.length,h=l.key;if(l.keyCode>46&&!l.ctrlKey&&!l.metaKey){if(a>=t.length)return l.preventDefault(),l.stopPropagation(),!1;switch(t[a]){case i:if(h.toUpperCase()==h.toLowerCase())return l.preventDefault(),l.stopPropagation(),!1;break;case n:if(isNaN(h))return l.preventDefault(),l.stopPropagation(),!1;break;case r:break;default:if(h!==t[a])return l.preventDefault(),l.stopPropagation(),!1}}}),s.addEventListener("keyup",l=>{l.keyCode>46&&e.maskAutoFill&&o(s.value.length)}),s.placeholder||(s.placeholder=t),e.maskAutoFill&&o(s.value.length)}function iD(s,e,t,i,n){var r=s.getValue(),o=document.createElement("input");if(o.setAttribute("type",n.search?"search":"text"),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let a in n.elementAttributes)a.charAt(0)=="+"?(a=a.slice(1),o.setAttribute(a,o.getAttribute(a)+n.elementAttributes["+"+a])):o.setAttribute(a,n.elementAttributes[a]);o.value=typeof r<"u"?r:"",e(function(){s.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%",n.selectContents&&o.select())});function l(a){(r===null||typeof r>"u")&&o.value!==""||o.value!==r?t(o.value)&&(r=o.value):i()}return o.addEventListener("change",l),o.addEventListener("blur",l),o.addEventListener("keydown",function(a){switch(a.keyCode){case 13:l();break;case 27:i();break;case 35:case 36:a.stopPropagation();break}}),n.mask&&Wa(o,n),o}function sD(s,e,t,i,n){var r=s.getValue(),o=n.verticalNavigation||"hybrid",l=String(r!==null&&typeof r<"u"?r:""),a=document.createElement("textarea"),h=0;if(a.style.display="block",a.style.padding="2px",a.style.height="100%",a.style.width="100%",a.style.boxSizing="border-box",a.style.whiteSpace="pre-wrap",a.style.resize="none",n.elementAttributes&&typeof n.elementAttributes=="object")for(let u in n.elementAttributes)u.charAt(0)=="+"?(u=u.slice(1),a.setAttribute(u,a.getAttribute(u)+n.elementAttributes["+"+u])):a.setAttribute(u,n.elementAttributes[u]);a.value=l,e(function(){s.getType()==="cell"&&(a.focus({preventScroll:!0}),a.style.height="100%",a.scrollHeight,a.style.height=a.scrollHeight+"px",s.getRow().normalizeHeight(),n.selectContents&&a.select())});function c(u){(r===null||typeof r>"u")&&a.value!==""||a.value!==r?(t(a.value)&&(r=a.value),setTimeout(function(){s.getRow().normalizeHeight()},300)):i()}return a.addEventListener("change",c),a.addEventListener("blur",c),a.addEventListener("keyup",function(){a.style.height="";var u=a.scrollHeight;a.style.height=u+"px",u!=h&&(h=u,s.getRow().normalizeHeight())}),a.addEventListener("keydown",function(u){switch(u.keyCode){case 13:u.shiftKey&&n.shiftEnterSubmit&&c();break;case 27:i();break;case 38:(o=="editor"||o=="hybrid"&&a.selectionStart)&&(u.stopImmediatePropagation(),u.stopPropagation());break;case 40:(o=="editor"||o=="hybrid"&&a.selectionStart!==a.value.length)&&(u.stopImmediatePropagation(),u.stopPropagation());break;case 35:case 36:u.stopPropagation();break}}),n.mask&&Wa(a,n),a}function nD(s,e,t,i,n){var r=s.getValue(),o=n.verticalNavigation||"editor",l=document.createElement("input");if(l.setAttribute("type","number"),typeof n.max<"u"&&l.setAttribute("max",n.max),typeof n.min<"u"&&l.setAttribute("min",n.min),typeof n.step<"u"&&l.setAttribute("step",n.step),l.style.padding="4px",l.style.width="100%",l.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let c in n.elementAttributes)c.charAt(0)=="+"?(c=c.slice(1),l.setAttribute(c,l.getAttribute(c)+n.elementAttributes["+"+c])):l.setAttribute(c,n.elementAttributes[c]);l.value=r;var a=function(c){h()};e(function(){s.getType()==="cell"&&(l.removeEventListener("blur",a),l.focus({preventScroll:!0}),l.style.height="100%",l.addEventListener("blur",a),n.selectContents&&l.select())});function h(){var c=l.value;!isNaN(c)&&c!==""&&(c=Number(c)),c!==r?t(c)&&(r=c):i()}return l.addEventListener("keydown",function(c){switch(c.keyCode){case 13:h();break;case 27:i();break;case 38:case 40:o=="editor"&&(c.stopImmediatePropagation(),c.stopPropagation());break;case 35:case 36:c.stopPropagation();break}}),n.mask&&Wa(l,n),l}function rD(s,e,t,i,n){var r=s.getValue(),o=document.createElement("input");if(o.setAttribute("type","range"),typeof n.max<"u"&&o.setAttribute("max",n.max),typeof n.min<"u"&&o.setAttribute("min",n.min),typeof n.step<"u"&&o.setAttribute("step",n.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let a in n.elementAttributes)a.charAt(0)=="+"?(a=a.slice(1),o.setAttribute(a,o.getAttribute(a)+n.elementAttributes["+"+a])):o.setAttribute(a,n.elementAttributes[a]);o.value=r,e(function(){s.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%")});function l(){var a=o.value;!isNaN(a)&&a!==""&&(a=Number(a)),a!=r?t(a)&&(r=a):i()}return o.addEventListener("blur",function(a){l()}),o.addEventListener("keydown",function(a){switch(a.keyCode){case 13:l();break;case 27:i();break}}),o}function oD(s,e,t,i,n){var r=n.format,o=n.verticalNavigation||"editor",l=r?window.DateTime||luxon.DateTime:null,a=s.getValue(),h=document.createElement("input");function c(d){var f;return l.isDateTime(d)?f=d:r==="iso"?f=l.fromISO(String(d)):f=l.fromFormat(String(d),r),f.toFormat("yyyy-MM-dd")}if(h.type="date",h.style.padding="4px",h.style.width="100%",h.style.boxSizing="border-box",n.max&&h.setAttribute("max",r?c(n.max):n.max),n.min&&h.setAttribute("min",r?c(n.min):n.min),n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),h.setAttribute(d,h.getAttribute(d)+n.elementAttributes["+"+d])):h.setAttribute(d,n.elementAttributes[d]);a=typeof a<"u"?a:"",r&&(l?a=c(a):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),h.value=a,e(function(){s.getType()==="cell"&&(h.focus({preventScroll:!0}),h.style.height="100%",n.selectContents&&h.select())});function u(){var d=h.value,f;if((a===null||typeof a>"u")&&d!==""||d!==a){if(d&&r)switch(f=l.fromFormat(String(d),"yyyy-MM-dd"),r){case!0:d=f;break;case"iso":d=f.toISO();break;default:d=f.toFormat(r)}t(d)&&(a=h.value)}else i()}return h.addEventListener("blur",function(d){(d.relatedTarget||d.rangeParent||d.explicitOriginalTarget!==h)&&u()}),h.addEventListener("keydown",function(d){switch(d.keyCode){case 13:u();break;case 27:i();break;case 35:case 36:d.stopPropagation();break;case 38:case 40:o=="editor"&&(d.stopImmediatePropagation(),d.stopPropagation());break}}),h}function lD(s,e,t,i,n){var r=n.format,o=n.verticalNavigation||"editor",l=r?window.DateTime||luxon.DateTime:null,a,h=s.getValue(),c=document.createElement("input");if(c.type="time",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),c.setAttribute(d,c.getAttribute(d)+n.elementAttributes["+"+d])):c.setAttribute(d,n.elementAttributes[d]);h=typeof h<"u"?h:"",r&&(l?(l.isDateTime(h)?a=h:r==="iso"?a=l.fromISO(String(h)):a=l.fromFormat(String(h),r),h=a.toFormat("hh:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=h,e(function(){s.getType()=="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function u(){var d=c.value,f;if((h===null||typeof h>"u")&&d!==""||d!==h){if(d&&r)switch(f=l.fromFormat(String(d),"hh:mm"),r){case!0:d=f;break;case"iso":d=f.toISO();break;default:d=f.toFormat(r)}t(d)&&(h=c.value)}else i()}return c.addEventListener("blur",function(d){(d.relatedTarget||d.rangeParent||d.explicitOriginalTarget!==c)&&u()}),c.addEventListener("keydown",function(d){switch(d.keyCode){case 13:u();break;case 27:i();break;case 35:case 36:d.stopPropagation();break;case 38:case 40:o=="editor"&&(d.stopImmediatePropagation(),d.stopPropagation());break}}),c}function aD(s,e,t,i,n){var r=n.format,o=n.verticalNavigation||"editor",l=r?window.DateTime||luxon.DateTime:null,a,h=s.getValue(),c=document.createElement("input");if(c.type="datetime-local",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let d in n.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),c.setAttribute(d,c.getAttribute(d)+n.elementAttributes["+"+d])):c.setAttribute(d,n.elementAttributes[d]);h=typeof h<"u"?h:"",r&&(l?(l.isDateTime(h)?a=h:r==="iso"?a=l.fromISO(String(h)):a=l.fromFormat(String(h),r),h=a.toFormat("yyyy-MM-dd")+"T"+a.toFormat("hh:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=h,e(function(){s.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",n.selectContents&&c.select())});function u(){var d=c.value,f;if((h===null||typeof h>"u")&&d!==""||d!==h){if(d&&r)switch(f=l.fromISO(String(d)),r){case!0:d=f;break;case"iso":d=f.toISO();break;default:d=f.toFormat(r)}t(d)&&(h=c.value)}else i()}return c.addEventListener("blur",function(d){(d.relatedTarget||d.rangeParent||d.explicitOriginalTarget!==c)&&u()}),c.addEventListener("keydown",function(d){switch(d.keyCode){case 13:u();break;case 27:i();break;case 35:case 36:d.stopPropagation();break;case 38:case 40:o=="editor"&&(d.stopImmediatePropagation(),d.stopPropagation());break}}),c}class Zu{constructor(e,t,i,n,r,o){this.edit=e,this.table=e.table,this.cell=t,this.params=this._initializeParams(o),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=t.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:n,cancel:r},this._deprecatedOptionsCheck(),this._initializeValue(),i(this._onRendered.bind(this))}_deprecatedOptionsCheck(){this.params.listItemFormatter&&this.cell.getTable().deprecationAdvisor.msg("The listItemFormatter editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.sortValuesList&&this.cell.getTable().deprecationAdvisor.msg("The sortValuesList editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchFunc&&this.cell.getTable().deprecationAdvisor.msg("The searchFunc editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchingPlaceholder&&this.cell.getTable().deprecationAdvisor.msg("The searchingPlaceholder editor param has been deprecated, please see the latest editor documentation for updated options")}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function t(i){i.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",t),setTimeout(()=>{e.removeEventListener("click",t)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,t=document.createElement("input");if(t.setAttribute("type",this.params.clearable?"search":"text"),t.style.padding="4px",t.style.width="100%",t.style.boxSizing="border-box",this.params.autocomplete||(t.style.cursor="default",t.style.caretColor="transparent"),e&&typeof e=="object")for(let i in e)i.charAt(0)=="+"?(i=i.slice(1),t.setAttribute(i,t.getAttribute(i)+e["+"+i])):t.setAttribute(i,e[i]);return this.params.mask&&Wa(t,this.params),this._bindInputEvents(t),t}_initializeParams(e){var t=["values","valuesURL","valuesLookup"],i;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",i=Object.keys(e).filter(n=>t.includes(n)).length,i?i>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var t=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&t)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),t>0&&this._focusItem(this.displayItems[t-1]))}_keyDown(e){var t=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&t<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),t<this.displayItems.length-1&&(t==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[t+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var t=String.fromCharCode(e).toLowerCase();this.filterTerm+=t.toLowerCase();var i=this.displayItems.find(n=>typeof n.label<"u"&&n.label.toLowerCase().startsWith(this.filterTerm));i&&this._focusItem(i),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var t=[],i=++this.listIteration;return this.filtered=!1,this.params.values?t=this.params.values:this.params.valuesURL?t=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?t=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(t=this._uniqueColumnValues(this.params.valuesLookupField)),t instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),t.then().then(n=>this.listIteration===i?this._parseList(n):Promise.reject(i))):Promise.resolve(this._parseList(t))}_addPlaceholder(e){var t=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?t=e:(t.classList.add("tabulator-edit-list-placeholder"),t.innerHTML=e),this.listEl.appendChild(t),this._showList())}_ajaxRequest(e,t){var i=this.params.filterRemote?{term:t}:{};return e=Av(e,{},i),fetch(e).then(n=>n.ok?n.json().catch(r=>(console.warn("List Ajax Load Error - Invalid JSON returned",r),Promise.reject(r))):(console.error("List Ajax Load Error - Connection Error: "+n.status,n.statusText),Promise.reject(n))).catch(n=>(console.error("List Ajax Load Error - Connection Error: ",n),Promise.reject(n)))}_uniqueColumnValues(e){var t={},i=this.table.getData(this.params.valuesLookup),n;return e?n=this.table.columnManager.getColumnByField(e):n=this.cell.getColumn()._getSelf(),n?i.forEach(r=>{var o=n.getFieldValue(r);o!==null&&typeof o<"u"&&o!==""&&(t[o]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),t=[]),Object.keys(t)}_parseList(e){var t=[];return Array.isArray(e)||(e=Object.entries(e).map(([i,n])=>({label:n,value:i}))),e.forEach(i=>{typeof i!="object"&&(i={label:i,value:i}),this._parseListItem(i,t,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=t,t}_parseListItem(e,t,i){var n={};e.options?n=this._parseListGroup(e,i+1):(n={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:i,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(n,!0)),t.push(n)}_parseListGroup(e,t){var i={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:t,options:[],original:e};return e.options.forEach(n=>{this._parseListItem(n,i.options,t)}),i}_sortOptions(e){var t;return this.params.sort&&(t=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(t,e)),e}_sortGroup(e,t){t.sort((i,n)=>e(i.label,n.label,i.value,n.value,i.original,n.original)),t.forEach(i=>{i.group&&this._sortGroup(e,i.options)})}_defaultSortFunction(e,t){var i,n,r,o,l=0,a,h=/(\d+)|(\D+)/g,c=/\d/,u=0;if(this.params.sort==="desc"&&([e,t]=[t,e]),!e&&e!==0)u=!t&&t!==0?0:-1;else if(!t&&t!==0)u=1;else{if(isFinite(e)&&isFinite(t))return e-t;if(i=String(e).toLowerCase(),n=String(t).toLowerCase(),i===n)return 0;if(!(c.test(i)&&c.test(n)))return i>n?1:-1;for(i=i.match(h),n=n.match(h),a=i.length>n.length?n.length:i.length;l<a;)if(r=i[l],o=n[l++],r!==o)return isFinite(r)&&isFinite(o)?(r.charAt(0)==="0"&&(r="."+r),o.charAt(0)==="0"&&(o="."+o),r-o):r>o?1:-1;return i.length>n.length}return u}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,t=this.input.value;return t?(this.filtered=!0,this.data.forEach(i=>{this._filterItem(e,t,i)})):this.filtered=!1,this.data}_filterItem(e,t,i){var n=!1;return i.group?(i.options.forEach(r=>{this._filterItem(e,t,r)&&(n=!0)}),i.visible=n):i.visible=e(t,i.label,i.value,i.original),i.visible}_defaultFilterFunc(e,t,i,n){return e=String(e).toLowerCase(),t!==null&&typeof t<"u"&&(String(t).toLowerCase().indexOf(e)>-1||String(i).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(t=>{this._buildItem(t)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var t=e.element,i;if(!this.filtered||e.visible){if(!t){if(t=document.createElement("div"),t.tabIndex=0,i=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,t):e.label,i instanceof HTMLElement?t.appendChild(i):t.innerHTML=i,e.group?t.classList.add("tabulator-edit-list-group"):t.classList.add("tabulator-edit-list-item"),t.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let n in e.elementAttributes)n.charAt(0)=="+"?(n=n.slice(1),t.setAttribute(n,this.input.getAttribute(n)+e.elementAttributes["+"+n])):t.setAttribute(n,e.elementAttributes[n]);e.group?t.addEventListener("click",this._groupClick.bind(this,e)):t.addEventListener("click",this._itemClick.bind(this,e)),t.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=t}this._styleItem(e),this.listEl.appendChild(t),e.group?e.options.forEach(n=>{this._buildItem(n)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,t){t.stopPropagation(),this._chooseItem(e)}_groupClick(e,t){t.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,t){var i;this.typing=!1,this.params.multiselect?(i=this.currentItems.indexOf(e),i>-1?(this.currentItems.splice(i,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(n=>n.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),t||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var t,i;if(this.popup&&this.popup.hide(!0),this.params.multiselect)t=this.currentItems.map(n=>n.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")t=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?t=this.currentItems[0].value:(i=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,i===null||typeof i>"u"||i===""?t=i:t=this.params.emptyValue);t===""&&(t=this.params.emptyValue),this.actions.success(t),this.isFilter&&(this.initialValues=t&&!Array.isArray(t)?[t]:t,this.currentItems=[])}}function hD(s,e,t,i,n){this.deprecationMsg("The select editor has been deprecated, please use the new list editor");var r=new Zu(this,s,e,t,i,n);return r.input}function cD(s,e,t,i,n){var r=new Zu(this,s,e,t,i,n);return r.input}function uD(s,e,t,i,n){this.deprecationMsg("The autocomplete editor has been deprecated, please use the new list editor with the 'autocomplete' editorParam"),n.autocomplete=!0;var r=new Zu(this,s,e,t,i,n);return r.input}function dD(s,e,t,i,n){var r=this,o=s.getElement(),l=s.getValue(),a=o.getElementsByTagName("svg").length||5,h=o.getElementsByTagName("svg")[0]?o.getElementsByTagName("svg")[0].getAttribute("width"):14,c=[],u=document.createElement("div"),d=document.createElementNS("http://www.w3.org/2000/svg","svg");function f(b){c.forEach(function(v,C){C<b?(r.table.browser=="ie"?v.setAttribute("class","tabulator-star-active"):v.classList.replace("tabulator-star-inactive","tabulator-star-active"),v.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(r.table.browser=="ie"?v.setAttribute("class","tabulator-star-inactive"):v.classList.replace("tabulator-star-active","tabulator-star-inactive"),v.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function p(b){var v=document.createElement("span"),C=d.cloneNode(!0);c.push(C),v.addEventListener("mouseenter",function(x){x.stopPropagation(),x.stopImmediatePropagation(),f(b)}),v.addEventListener("mousemove",function(x){x.stopPropagation(),x.stopImmediatePropagation()}),v.addEventListener("click",function(x){x.stopPropagation(),x.stopImmediatePropagation(),t(b),o.blur()}),v.appendChild(C),u.appendChild(v)}function m(b){l=b,f(b)}if(o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",u.style.verticalAlign="middle",u.style.display="inline-block",u.style.padding="4px",d.setAttribute("width",h),d.setAttribute("height",h),d.setAttribute("viewBox","0 0 512 512"),d.setAttribute("xml:space","preserve"),d.style.padding="0 1px",n.elementAttributes&&typeof n.elementAttributes=="object")for(let b in n.elementAttributes)b.charAt(0)=="+"?(b=b.slice(1),u.setAttribute(b,u.getAttribute(b)+n.elementAttributes["+"+b])):u.setAttribute(b,n.elementAttributes[b]);for(var g=1;g<=a;g++)p(g);return l=Math.min(parseInt(l),a),f(l),u.addEventListener("mousemove",function(b){f(0)}),u.addEventListener("click",function(b){t(0)}),o.addEventListener("blur",function(b){i()}),o.addEventListener("keydown",function(b){switch(b.keyCode){case 39:m(l+1);break;case 37:m(l-1);break;case 13:t(l);break;case 27:i();break}}),u}function fD(s,e,t,i,n){var r=s.getElement(),o=typeof n.max>"u"?r.getElementsByTagName("div")[0]&&r.getElementsByTagName("div")[0].getAttribute("max")||100:n.max,l=typeof n.min>"u"?r.getElementsByTagName("div")[0]&&r.getElementsByTagName("div")[0].getAttribute("min")||0:n.min,a=(o-l)/100,h=s.getValue()||0,c=document.createElement("div"),u=document.createElement("div"),d,f;function p(){var m=window.getComputedStyle(r,null),g=a*Math.round(u.offsetWidth/((r.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+l;t(g),r.setAttribute("aria-valuenow",g),r.setAttribute("aria-label",h)}if(c.style.position="absolute",c.style.right="0",c.style.top="0",c.style.bottom="0",c.style.width="5px",c.classList.add("tabulator-progress-handle"),u.style.display="inline-block",u.style.position="relative",u.style.height="100%",u.style.backgroundColor="#488CE9",u.style.maxWidth="100%",u.style.minWidth="0%",n.elementAttributes&&typeof n.elementAttributes=="object")for(let m in n.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),u.setAttribute(m,u.getAttribute(m)+n.elementAttributes["+"+m])):u.setAttribute(m,n.elementAttributes[m]);return r.style.padding="4px 4px",h=Math.min(parseFloat(h),o),h=Math.max(parseFloat(h),l),h=Math.round((h-l)/a),u.style.width=h+"%",r.setAttribute("aria-valuemin",l),r.setAttribute("aria-valuemax",o),u.appendChild(c),c.addEventListener("mousedown",function(m){d=m.screenX,f=u.offsetWidth}),c.addEventListener("mouseover",function(){c.style.cursor="ew-resize"}),r.addEventListener("mousemove",function(m){d&&(u.style.width=f+m.screenX-d+"px")}),r.addEventListener("mouseup",function(m){d&&(m.stopPropagation(),m.stopImmediatePropagation(),d=!1,f=!1,p())}),r.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),u.style.width=u.clientWidth+r.clientWidth/100+"px";break;case 37:m.preventDefault(),u.style.width=u.clientWidth-r.clientWidth/100+"px";break;case 9:case 13:p();break;case 27:i();break}}),r.addEventListener("blur",function(){i()}),u}function pD(s,e,t,i,n){var r=s.getValue(),o=document.createElement("input"),l=n.tristate,a=typeof n.indeterminateValue>"u"?null:n.indeterminateValue,h=!1,c=Object.keys(n).includes("trueValue"),u=Object.keys(n).includes("falseValue");if(o.setAttribute("type","checkbox"),o.style.marginTop="5px",o.style.boxSizing="border-box",n.elementAttributes&&typeof n.elementAttributes=="object")for(let f in n.elementAttributes)f.charAt(0)=="+"?(f=f.slice(1),o.setAttribute(f,o.getAttribute(f)+n.elementAttributes["+"+f])):o.setAttribute(f,n.elementAttributes[f]);o.value=r,l&&(typeof r>"u"||r===a||r==="")&&(h=!0,o.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){s.getType()==="cell"&&o.focus({preventScroll:!0})}),o.checked=c?r===n.trueValue:r===!0||r==="true"||r==="True"||r===1;function d(f){var p=o.checked;return c&&p?p=n.trueValue:u&&!p&&(p=n.falseValue),l?f?h?a:p:o.checked&&!h?(o.checked=!1,o.indeterminate=!0,h=!0,a):(h=!1,p):p}return o.addEventListener("change",function(f){t(d())}),o.addEventListener("blur",function(f){t(d(!0))}),o.addEventListener("keydown",function(f){f.keyCode==13&&t(d()),f.keyCode==27&&i()}),o}var mD={input:iD,textarea:sD,number:nD,range:rD,date:oD,time:lD,datetime:aD,select:hD,list:cD,autocomplete:uD,star:dD,progress:fD,tickCross:pD};class wo extends se{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.editors=wo.editors,this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableOption("editTriggerEvent","focus"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0))}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var t=this.currentCell,i=this.options("tabEndNewRow");t&&(this.navigateNext(t,e)||i&&(t.getElement().firstChild.blur(),this.invalidEdit||(i===!0?i=this.table.addRow({}):typeof i=="function"?i=this.table.addRow(i(t.row.getComponent())):i=this.table.addRow(Object.assign({},i)),i.then(()=>{setTimeout(()=>{t.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(t=>{this.table.modules.edit.clearEdited(t._getSelf())})}navigatePrev(e=this.currentCell,t){var i,n;if(e){if(t&&t.preventDefault(),i=this.navigateLeft(),i)return!0;if(n=this.table.rowManager.prevDisplayRow(e.row,!0),n&&(i=this.findPrevEditableCell(n,n.cells.length),i))return i.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,t){var i,n;if(e){if(t&&t.preventDefault(),i=this.navigateRight(),i)return!0;if(n=this.table.rowManager.nextDisplayRow(e.row,!0),n&&(i=this.findNextEditableCell(n,-1),i))return i.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.findPrevEditableCell(e.row,i),n)?(n.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.findNextEditableCell(e.row,i),n)?(n.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.table.rowManager.prevDisplayRow(e.row,!0),n)?(n.cells[i].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,t){var i,n;return e&&(t&&t.preventDefault(),i=e.getIndex(),n=this.table.rowManager.nextDisplayRow(e.row,!0),n)?(n.cells[i].getComponent().edit(),!0):!1}findNextEditableCell(e,t){var i=!1;if(t<e.cells.length-1)for(var n=t+1;n<e.cells.length;n++){let r=e.cells[n];if(r.column.modules.edit&&Te.elVisible(r.getElement())&&this.allowEdit(r)){i=r;break}}return i}findPrevEditableCell(e,t){var i=!1;if(t>0)for(var n=t-1;n>=0;n--){let r=e.cells[n];if(r.column.modules.edit&&Te.elVisible(r.getElement())&&this.allowEdit(r)){i=r;break}}return i}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(t=>{t.column.modules.edit&&typeof t.column.modules.edit.check=="function"&&this.updateCellClass(t)})}initializeColumn(e){var t={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{}};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?t.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":t.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?t.editor=this.editors[e.definition.formatter]:t.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}t.editor&&(e.modules.edit=t)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var t=this.currentCell,i;if(this.invalidEdit=!1,t){for(this.currentCell=!1,i=t.getElement(),this.dispatch("edit-editor-clear",t,e),i.classList.remove("tabulator-editing");i.firstChild;)i.removeChild(i.firstChild);t.row.getElement().classList.remove("tabulator-editing"),t.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,t=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,t),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",t)}}bindEditor(e){if(e.column.modules.edit){var t=this,i=e.getElement(!0);this.updateCellClass(e),i.setAttribute("tabindex",0),i.addEventListener("mousedown",function(n){n.button===2?n.preventDefault():t.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&i.addEventListener("dblclick",function(n){i.classList.contains("tabulator-editing")||(i.focus({preventScroll:!0}),t.edit(e,n,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&i.addEventListener("click",function(n){i.classList.contains("tabulator-editing")||(i.focus({preventScroll:!0}),t.edit(e,n,!1))}),this.options("editTriggerEvent")==="focus"&&i.addEventListener("focus",function(n){t.recursionBlock||t.edit(e,n,!1)})}}focusCellNoEvent(e,t){this.recursionBlock=!0,t&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,t){this.focusCellNoEvent(e),this.edit(e,!1,t)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var t=this.table.rowManager.element.scrollTop,i=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,n=e.row.getElement();n.offsetTop<t?this.table.rowManager.element.scrollTop-=t-n.offsetTop:n.offsetTop+n.offsetHeight>i&&(this.table.rowManager.element.scrollTop+=n.offsetTop+n.offsetHeight-i);var r=this.table.rowManager.element.scrollLeft,o=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,l=e.getElement();this.table.modExists("frozenColumns")&&(r+=parseInt(this.table.modules.frozenColumns.leftMargin||0),o-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(r-=parseInt(this.table.columnManager.renderer.vDomPadLeft),o-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),l.offsetLeft<r?this.table.rowManager.element.scrollLeft-=r-l.offsetLeft:l.offsetLeft+l.offsetWidth>o&&(this.table.rowManager.element.scrollLeft+=l.offsetLeft+l.offsetWidth-o)}}allowEdit(e){var t=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(t=e.column.modules.edit.check(e.getComponent()));break;case"string":t=!!e.row.data[e.column.modules.edit.check];break;case"boolean":t=e.column.modules.edit.check;break}return t}edit(e,t,i){var n=this,r=!0,o=function(){},l=e.getElement(),a,h,c;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function u(g){if(n.currentCell===e){var b=n.chain("edit-success",[e,g],!0,!0);return b===!0||n.table.options.validationMode==="highlight"?(n.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,n.editedCells.indexOf(e)==-1&&n.editedCells.push(e),e.setValue(g,!0),b===!0):(n.invalidEdit=!0,n.focusCellNoEvent(e,!0),o(),!1)}}function d(){n.currentCell===e&&n.cancelEdit()}function f(g){o=g}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(l),!1;if(t&&t.stopPropagation(),r=this.allowEdit(e),r||i){if(n.cancelEdit(),n.currentCell=e,this.focusScrollAdjust(e),h=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,t,h)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,h),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",h),c=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(h):e.column.modules.edit.params,a=e.column.modules.edit.editor.call(n,h,f,u,d,c),this.currentCell&&a!==!1)if(a instanceof Node){for(l.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");l.firstChild;)l.removeChild(l.firstChild);l.appendChild(a),o();for(var p=l.children,m=0;m<p.length;m++)p[m].addEventListener("click",function(g){g.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",a),this.blur(l),!1;else return this.blur(l),!1;return!0}else return this.mouseClick=!1,this.blur(l),!1}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(t=>{e.push(t.getComponent())}),e}clearEdited(e){var t;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),t=this.editedCells.indexOf(e),t>-1&&this.editedCells.splice(t,1)}}wo.moduleName="edit";wo.editors=mD;class Cp{constructor(e,t,i,n){this.type=e,this.columns=t,this.component=i||!1,this.indent=n||0}}class Mh{constructor(e,t,i,n,r){this.value=e,this.component=t||!1,this.width=i,this.height=n,this.depth=r}}class Fv extends se{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,t,i,n){this.cloneTableStyle=t,this.config=e||{},this.colVisProp=n;var r,o;if(i==="range"){var l=this.table.modules.selectRange.selectedColumns();r=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(l)):[],o=this.bodyToExportRows(this.rowLookup(i),this.table.modules.selectRange.selectedColumns(!0))}else r=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders()):[],o=this.bodyToExportRows(this.rowLookup(i));return r.concat(o)}generateTable(e,t,i,n){var r=this.generateExportList(e,t,i,n);return this.generateTableElement(r)}rowLookup(e){var t=[];if(typeof e=="function")e.call(this.table).forEach(i=>{i=this.table.rowManager.findRow(i),i&&t.push(i)});else switch(e){case!0:case"visible":t=this.table.rowManager.getVisibleRows(!1,!0);break;case"all":t=this.table.rowManager.rows;break;case"selected":t=this.table.modules.selectRow.selectedRows;break;case"range":t=this.table.modules.selectRange.selectedRows();break;case"active":default:this.table.options.pagination?t=this.table.rowManager.getDisplayRows(this.table.rowManager.displayRows.length-2):t=this.table.rowManager.getDisplayRows()}return Object.assign([],t)}generateColumnGroupHeaders(e){var t=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(i=>{var n=this.processColumnGroup(i);n&&t.push(n)}),t}processColumnGroup(e){var t=e.columns,i=0,n=e.definition["title"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))]||e.definition.title,r={title:n,column:e,depth:1};if(t.length){if(r.subGroups=[],r.width=0,t.forEach(o=>{var l=this.processColumnGroup(o);l&&(r.width+=l.width,r.subGroups.push(l),l.depth>i&&(i=l.depth))}),r.depth+=i,!r.width)return!1}else if(this.columnVisCheck(e))r.width=1;else return!1;return r}columnVisCheck(e){var t=e.definition[this.colVisProp];return typeof t=="function"&&(t=t.call(this.table,e.getComponent())),t!==!1&&(e.visible||!e.visible&&t)}headersToExportRows(e){var t=[],i=0,n=[];function r(o,l){var a=i-l;if(typeof t[l]>"u"&&(t[l]=[]),o.height=o.subGroups?1:a-o.depth+1,t[l].push(o),o.height>1)for(let h=1;h<o.height;h++)typeof t[l+h]>"u"&&(t[l+h]=[]),t[l+h].push(!1);if(o.width>1)for(let h=1;h<o.width;h++)t[l].push(!1);o.subGroups&&o.subGroups.forEach(function(h){r(h,l+1)})}return e.forEach(function(o){o.depth>i&&(i=o.depth)}),e.forEach(function(o){r(o,0)}),t.forEach(o=>{var l=[];o.forEach(a=>{if(a){let h=typeof a.title>"u"?"":a.title;l.push(new Mh(h,a.column.getComponent(),a.width,a.height,a.depth))}else l.push(null)}),n.push(new Cp("header",l))}),n}bodyToExportRows(e,t=[]){var i=[];return t.length===0&&this.table.columnManager.columnsByIndex.forEach(n=>{this.columnVisCheck(n)&&t.push(n.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(n=>{switch(n.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&n.modules.dataTree.parent)}return!0}),e.forEach((n,r)=>{var o=n.getData(this.colVisProp),l=[],a=0;switch(n.type){case"group":a=n.level,l.push(new Mh(n.key,n.getComponent(),t.length,1));break;case"calc":case"row":t.forEach(h=>{l.push(new Mh(h._column.getFieldValue(o),h,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(a=n.modules.dataTree.index);break}i.push(new Cp(n.type,l,n.getComponent(),a))}),i}generateTableElement(e){var t=document.createElement("table"),i=document.createElement("thead"),n=document.createElement("tbody"),r=this.lookupTableStyles(),o=this.table.options["rowFormatter"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],l={};return l.rowFormatter=o!==null?o:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(l.treeElementField=this.table.modules.dataTree.elementField),l.groupHeader=this.table.options["groupHeader"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],l.groupHeader&&!Array.isArray(l.groupHeader)&&(l.groupHeader=[l.groupHeader]),t.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),i,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((a,h)=>{let c;switch(a.type){case"header":i.appendChild(this.generateHeaderElement(a,l,r));break;case"group":n.appendChild(this.generateGroupElement(a,l,r));break;case"calc":n.appendChild(this.generateCalcElement(a,l,r));break;case"row":c=this.generateRowElement(a,l,r),this.mapElementStyles(h%2&&r.evenRow?r.evenRow:r.oddRow,c,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n.appendChild(c);break}}),i.innerHTML&&t.appendChild(i),t.appendChild(n),this.mapElementStyles(this.table.element,t,["border-top","border-left","border-right","border-bottom"]),t}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,t,i){var n=document.createElement("tr");return e.columns.forEach(r=>{if(r){var o=document.createElement("th"),l=r.component._column.definition.cssClass?r.component._column.definition.cssClass.split(" "):[];o.colSpan=r.width,o.rowSpan=r.height,o.innerHTML=r.value,this.cloneTableStyle&&(o.style.boxSizing="border-box"),l.forEach(function(a){o.classList.add(a)}),this.mapElementStyles(r.component.getElement(),o,["text-align","border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(r.component._column.contentElement,o,["padding-top","padding-left","padding-right","padding-bottom"]),r.component._column.visible?this.mapElementStyles(r.component.getElement(),o,["width"]):r.component._column.definition.width&&(o.style.width=r.component._column.definition.width+"px"),r.component._column.parent&&this.mapElementStyles(r.component._column.parent.groupElement,o,["border-top"]),n.appendChild(o)}}),n}generateGroupElement(e,t,i){var n=document.createElement("tr"),r=document.createElement("td"),o=e.columns[0];return n.classList.add("tabulator-print-table-row"),t.groupHeader&&t.groupHeader[e.indent]?o.value=t.groupHeader[e.indent](o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):t.groupHeader!==!1&&(o.value=e.component._group.generator(o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),r.colSpan=o.width,r.innerHTML=o.value,n.classList.add("tabulator-print-table-group"),n.classList.add("tabulator-group-level-"+e.indent),o.component.isVisible()&&n.classList.add("tabulator-group-visible"),this.mapElementStyles(i.firstGroup,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(i.firstGroup,r,["padding-top","padding-left","padding-right","padding-bottom"]),n.appendChild(r),n}generateCalcElement(e,t,i){var n=this.generateRowElement(e,t,i);return n.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(i.calcRow,n,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),n}generateRowElement(e,t,i){var n=document.createElement("tr");if(n.classList.add("tabulator-print-table-row"),e.columns.forEach((r,o)=>{if(r){var l=document.createElement("td"),a=r.component._column,h=this.table,c=h.columnManager.findColumnIndex(a),u=r.value,d,f={modules:{},getValue:function(){return u},getField:function(){return a.definition.field},getElement:function(){return l},getType:function(){return"cell"},getColumn:function(){return a.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return h},getComponent:function(){return f},column:a},p=a.definition.cssClass?a.definition.cssClass.split(" "):[];if(p.forEach(function(m){l.classList.add(m)}),this.table.modExists("format")&&this.config.formatCells!==!1)u=this.table.modules.format.formatExportValue(f,this.colVisProp);else switch(typeof u){case"object":u=u!==null?JSON.stringify(u):"";break;case"undefined":u="";break}u instanceof Node?l.appendChild(u):l.innerHTML=u,d=i.styleCells&&i.styleCells[c]?i.styleCells[c]:i.firstCell,d&&(this.mapElementStyles(d,l,["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"]),a.definition.align&&(l.style.textAlign=a.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(t.treeElementField&&t.treeElementField==a.field||!t.treeElementField&&o==0)&&(e.component._row.modules.dataTree.controlEl&&l.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),l.firstChild),e.component._row.modules.dataTree.branchEl&&l.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),l.firstChild)),n.appendChild(l),f.modules.format&&f.modules.format.renderedCallback&&f.modules.format.renderedCallback()}}),t.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let r=Object.assign(e.component);r.getElement=function(){return n},t.rowFormatter(e.component)}return n}generateHTMLTable(e){var t=document.createElement("div");return t.appendChild(this.generateTableElement(e)),t.innerHTML}getHtml(e,t,i,n){var r=this.generateExportList(i||this.table.options.htmlOutputConfig,t,e,n||"htmlOutput");return this.generateHTMLTable(r)}mapElementStyles(e,t,i){if(this.cloneTableStyle&&e&&t){var n={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var r=window.getComputedStyle(e);i.forEach(function(o){t.style[n[o]]||(t.style[n[o]]=r.getPropertyValue(o))})}}}}Fv.moduleName="export";var gD={"=":function(s,e,t,i){return e==s},"<":function(s,e,t,i){return e<s},"<=":function(s,e,t,i){return e<=s},">":function(s,e,t,i){return e>s},">=":function(s,e,t,i){return e>=s},"!=":function(s,e,t,i){return e!=s},regex:function(s,e,t,i){return typeof s=="string"&&(s=new RegExp(s)),s.test(e)},like:function(s,e,t,i){return s===null||typeof s>"u"?e===s:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(s.toLowerCase())>-1:!1},keywords:function(s,e,t,i){var n=s.toLowerCase().split(typeof i.separator>"u"?" ":i.separator),r=String(e===null||typeof e>"u"?"":e).toLowerCase(),o=[];return n.forEach(l=>{r.includes(l)&&o.push(!0)}),i.matchAll?o.length===n.length:!!o.length},starts:function(s,e,t,i){return s===null||typeof s>"u"?e===s:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(s.toLowerCase()):!1},ends:function(s,e,t,i){return s===null||typeof s>"u"?e===s:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(s.toLowerCase()):!1},in:function(s,e,t,i){return Array.isArray(s)?s.length?s.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",s),!1)}};class $i extends se{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var t=this.table.columnManager.findColumn(e.field);if(t)this.setHeaderFilterValue(t,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,t,i,n){return n.filter=this.getFilters(!0,!0),n}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,t,i,n){this.setFilter(e,t,i,n),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,t,i,n){this.addFilter(e,t,i,n),this.refreshFilter()}userSetHeaderFilterFocus(e){var t=this.table.columnManager.findColumn(e);if(t)this.setHeaderFilterFocus(t);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var t=this.table.columnManager.findColumn(e);if(t)return this.getHeaderFilterValue(t);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,t){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterValue(i,t);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,t,i){this.removeFilter(e,t,i),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,t,i){return this.search("rows",e,t,i)}searchData(e,t,i){return this.search("data",e,t,i)}initializeColumnHeaderFilter(e){var t=e.definition;t.headerFilter&&this.initializeColumn(e)}initializeColumn(e,t){var i=this,n=e.getField();function r(o){var l=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",a="",h="",c;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==o){if(e.modules.filter.prevSuccess=o,e.modules.filter.emptyFunc(o))delete i.headerFilters[n];else{switch(e.modules.filter.value=o,typeof e.definition.headerFilterFunc){case"string":$i.filters[e.definition.headerFilterFunc]?(a=e.definition.headerFilterFunc,c=function(u){var d=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(u);return d=typeof d=="function"?d(o,f,u):d,$i.filters[e.definition.headerFilterFunc](o,f,u,d)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":c=function(u){var d=e.definition.headerFilterFuncParams||{},f=e.getFieldValue(u);return d=typeof d=="function"?d(o,f,u):d,e.definition.headerFilterFunc(o,f,u,d)},a=c;break}if(!c)switch(l){case"partial":c=function(u){var d=e.getFieldValue(u);return typeof d<"u"&&d!==null?String(d).toLowerCase().indexOf(String(o).toLowerCase())>-1:!1},a="like";break;default:c=function(u){return e.getFieldValue(u)==o},a="="}i.headerFilters[n]={value:o,func:c,type:a}}e.modules.filter.value=o,h=JSON.stringify(i.headerFilters),i.prevHeaderFilterChangeCheck!==h&&(i.prevHeaderFilterChangeCheck=h,i.trackChanges(),i.refreshFilter())}return!0}e.modules.filter={success:r,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,t,i){var n=this,r=e.modules.filter.success,o=e.getField(),l,a,h,c,u,d,f,p;e.modules.filter.value=t;function m(){}function g(b){p=b}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),o){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(b){return!b&&b!==0},l=document.createElement("div"),l.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":n.table.modules.edit.editors[e.definition.headerFilter]?(a=n.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(b){return b!==!0&&b!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":a=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?a=e.modules.edit.editor:e.definition.formatter&&n.table.modules.edit.editors[e.definition.formatter]?(a=n.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(b){return b!==!0&&b!==!1})):a=n.table.modules.edit.editors.input;break}if(a){if(c={getValue:function(){return typeof t<"u"?t:""},getField:function(){return e.definition.field},getElement:function(){return l},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},f=e.definition.headerFilterParams||{},f=typeof f=="function"?f.call(n.table,c):f,h=a.call(this.table.modules.edit,c,g,r,m,f),!h){console.warn("Filter Error - Cannot add filter to "+o+" column, editor returned a value of false");return}if(!(h instanceof Node)){console.warn("Filter Error - Cannot add filter to "+o+" column, editor should return an instance of Node, the editor returned:",h);return}n.langBind("headerFilters|columns|"+e.definition.field,function(b){h.setAttribute("placeholder",typeof b<"u"&&b?b:e.definition.headerFilterPlaceholder||n.langText("headerFilters|default"))}),h.addEventListener("click",function(b){b.stopPropagation(),h.focus()}),h.addEventListener("focus",b=>{var v=this.table.columnManager.contentsElement.scrollLeft,C=this.table.rowManager.element.scrollLeft;v!==C&&(this.table.rowManager.scrollHorizontal(v),this.table.columnManager.scrollHorizontal(v))}),u=!1,d=function(b){u&&clearTimeout(u),u=setTimeout(function(){r(h.value)},n.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=h,e.modules.filter.attrType=h.hasAttribute("type")?h.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=h.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(h.addEventListener("keyup",d),h.addEventListener("search",d),e.modules.filter.attrType=="number"&&h.addEventListener("change",function(b){r(h.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&h.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&h.addEventListener("mousedown",function(b){b.stopPropagation()})),l.appendChild(h),e.contentElement.appendChild(l),i||n.headerFilterColumns.push(e),p&&p()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,t){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,t,!0),e.modules.filter.success(t)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,t,i,n){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:t,value:i,params:n}]),this.addFilter(e)}addFilter(e,t,i,n){var r=!1;Array.isArray(e)||(e=[{field:e,type:t,value:i,params:n}]),e.forEach(o=>{o=this.findFilter(o),o&&(this.filterList.push(o),r=!0)}),r&&this.trackChanges()}findFilter(e){var t;if(Array.isArray(e))return this.findSubFilters(e);var i=!1;return typeof e.field=="function"?i=function(n){return e.field(n,e.type||{})}:$i.filters[e.type]?(t=this.table.columnManager.getColumnByField(e.field),t?i=function(n){return $i.filters[e.type](e.value,t.getFieldValue(n),n,e.params||{})}:i=function(n){return $i.filters[e.type](e.value,n[e.field],n,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=i,e.func?e:!1}findSubFilters(e){var t=[];return e.forEach(i=>{i=this.findFilter(i),i&&t.push(i)}),t.length?t:!1}getFilters(e,t){var i=[];return e&&(i=this.getHeaderFilters()),t&&i.forEach(function(n){typeof n.type=="function"&&(n.type="function")}),i=i.concat(this.filtersToArray(this.filterList,t)),i}filtersToArray(e,t){var i=[];return e.forEach(n=>{var r;Array.isArray(n)?i.push(this.filtersToArray(n,t)):(r={field:n.field,type:n.type,value:n.value},t&&typeof r.type=="function"&&(r.type="function"),i.push(r))}),i}getHeaderFilters(){var e=[];for(var t in this.headerFilters)e.push({field:t,type:this.headerFilters[t].type,value:this.headerFilters[t].value});return e}removeFilter(e,t,i){Array.isArray(e)||(e=[{field:e,type:t,value:i}]),e.forEach(n=>{var r=-1;typeof n.field=="object"?r=this.filterList.findIndex(o=>n===o):r=this.filterList.findIndex(o=>n.field===o.field&&n.type===o.type&&n.value===o.value),r>-1?this.filterList.splice(r,1):console.warn("Filter Error - No matching filter type found, ignoring: ",n.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,t,i,n){var r=[],o=[];return Array.isArray(t)||(t=[{field:t,type:i,value:n}]),t.forEach(l=>{l=this.findFilter(l),l&&o.push(l)}),this.table.rowManager.rows.forEach(l=>{var a=!0;o.forEach(h=>{this.filterRecurse(h,l.getData())||(a=!1)}),a&&r.push(e==="data"?l.getData("data"):l.getComponent())}),r}filter(e,t){var i=[],n=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(r=>{this.filterRow(r)&&i.push(r)}):i=e.slice(0),this.subscribedExternal("dataFiltered")&&(i.forEach(r=>{n.push(r.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),n)),i}filterRow(e,t){var i=!0,n=e.getData();this.filterList.forEach(o=>{this.filterRecurse(o,n)||(i=!1)});for(var r in this.headerFilters)this.headerFilters[r].func(n)||(i=!1);return i}filterRecurse(e,t){var i=!1;return Array.isArray(e)?e.forEach(n=>{this.filterRecurse(n,t)&&(i=!0)}):i=e.func(t),i}}$i.moduleName="filter";$i.filters=gD;function bD(s,e,t){return this.emptyToSpace(this.sanitizeHTML(s.getValue()))}function yD(s,e,t){return s.getValue()}function vD(s,e,t){return s.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(s.getValue()))}function wD(s,e,t){var i=parseFloat(s.getValue()),n="",r,o,l,a,h,c=e.decimal||".",u=e.thousand||",",d=e.negativeSign||"-",f=e.symbol||"",p=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(i))return this.emptyToSpace(this.sanitizeHTML(s.getValue()));if(i<0&&(i=Math.abs(i),n=d),r=m!==!1?i.toFixed(m):i,r=String(r).split("."),o=r[0],l=r.length>1?c+r[1]:"",e.thousand!==!1)for(a=/(\d+)(\d{3})/;a.test(o);)o=o.replace(a,"$1"+u+"$2");return h=o+l,n===!0?(h="("+h+")",p?h+f:f+h):p?n+h+f:n+f+h}function CD(s,e,t){var i=s.getValue(),n=e.urlPrefix||"",r=e.download,o=i,l=document.createElement("a"),a;function h(c,u){var d=c.shift(),f=u[d];return c.length&&typeof f=="object"?h(c,f):f}if(e.labelField&&(a=s.getData(),o=h(e.labelField.split(this.table.options.nestedFieldSeparator),a)),e.label)switch(typeof e.label){case"string":o=e.label;break;case"function":o=e.label(s);break}if(o){if(e.urlField&&(a=s.getData(),i=Te.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,a)),e.url)switch(typeof e.url){case"string":i=e.url;break;case"function":i=e.url(s);break}return l.setAttribute("href",n+i),e.target&&l.setAttribute("target",e.target),e.download&&(typeof r=="function"?r=r(s):r=r===!0?"":r,l.setAttribute("download",r)),l.innerHTML=this.emptyToSpace(this.sanitizeHTML(o)),l}else return"&nbsp;"}function ED(s,e,t){var i=document.createElement("img"),n=s.getValue();switch(e.urlPrefix&&(n=e.urlPrefix+s.getValue()),e.urlSuffix&&(n=n+e.urlSuffix),i.setAttribute("src",n),typeof e.height){case"number":i.style.height=e.height+"px";break;case"string":i.style.height=e.height;break}switch(typeof e.width){case"number":i.style.width=e.width+"px";break;case"string":i.style.width=e.width;break}return i.addEventListener("load",function(){s.getRow().normalizeHeight()}),i}function xD(s,e,t){var i=s.getValue(),n=s.getElement(),r=e.allowEmpty,o=e.allowTruthy,l=Object.keys(e).includes("trueValue"),a=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',h=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return l&&i===e.trueValue||!l&&(o&&i||i===!0||i==="true"||i==="True"||i===1||i==="1")?(n.setAttribute("aria-checked",!0),a||""):r&&(i==="null"||i===""||i===null||typeof i>"u")?(n.setAttribute("aria-checked","mixed"),""):(n.setAttribute("aria-checked",!1),h||"")}function kD(s,e,t){var i=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",r=e.outputFormat||"dd/MM/yyyy HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",l=s.getValue();if(typeof i<"u"){var a;return i.isDateTime(l)?a=l:n==="iso"?a=i.fromISO(String(l)):a=i.fromFormat(String(l),n),a.isValid?(e.timezone&&(a=a.setZone(e.timezone)),a.toFormat(r)):o===!0||!l?l:typeof o=="function"?o(l):o}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function SD(s,e,t){var i=window.DateTime||luxon.DateTime,n=e.inputFormat||"yyyy-MM-dd HH:mm:ss",r=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=typeof e.suffix<"u"?e.suffix:!1,l=typeof e.unit<"u"?e.unit:"days",a=typeof e.humanize<"u"?e.humanize:!1,h=typeof e.date<"u"?e.date:i.now(),c=s.getValue();if(typeof i<"u"){var u;return i.isDateTime(c)?u=c:n==="iso"?u=i.fromISO(String(c)):u=i.fromFormat(String(c),n),u.isValid?a?u.diff(h,l).toHuman()+(o?" "+o:""):parseInt(u.diff(h,l)[l])+(o?" "+o:""):r===!0?c:typeof r=="function"?r(c):r}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function _D(s,e,t){var i=s.getValue();return typeof e[i]>"u"?(console.warn("Missing display value for "+i),i):e[i]}function RD(s,e,t){var i=s.getValue(),n=s.getElement(),r=e&&e.stars?e.stars:5,o=document.createElement("span"),l=document.createElementNS("http://www.w3.org/2000/svg","svg"),a='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',h='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';o.style.verticalAlign="middle",l.setAttribute("width","14"),l.setAttribute("height","14"),l.setAttribute("viewBox","0 0 512 512"),l.setAttribute("xml:space","preserve"),l.style.padding="0 1px",i=i&&!isNaN(i)?parseInt(i):0,i=Math.max(0,Math.min(i,r));for(var c=1;c<=r;c++){var u=l.cloneNode(!0);u.innerHTML=c<=i?a:h,o.appendChild(u)}return n.style.whiteSpace="nowrap",n.style.overflow="hidden",n.style.textOverflow="ellipsis",n.setAttribute("aria-label",i),o}function TD(s,e,t){var i=this.sanitizeHTML(s.getValue())||0,n=document.createElement("span"),r=e&&e.max?e.max:100,o=e&&e.min?e.min:0,l=e&&typeof e.color<"u"?e.color:["red","orange","green"],a="#666666",h,c;if(!(isNaN(i)||typeof s.getValue()>"u")){switch(n.classList.add("tabulator-traffic-light"),c=parseFloat(i)<=r?parseFloat(i):r,c=parseFloat(c)>=o?parseFloat(c):o,h=(r-o)/100,c=Math.round((c-o)/h),typeof l){case"string":a=l;break;case"function":a=l(i);break;case"object":if(Array.isArray(l)){var u=100/l.length,d=Math.floor(c/u);d=Math.min(d,l.length-1),d=Math.max(d,0),a=l[d];break}}return n.style.backgroundColor=a,n}}function MD(s,e={},t){var i=this.sanitizeHTML(s.getValue())||0,n=s.getElement(),r=e.max?e.max:100,o=e.min?e.min:0,l=e.legendAlign?e.legendAlign:"center",a,h,c,u,d;switch(h=parseFloat(i)<=r?parseFloat(i):r,h=parseFloat(h)>=o?parseFloat(h):o,a=(r-o)/100,h=Math.round((h-o)/a),typeof e.color){case"string":c=e.color;break;case"function":c=e.color(i);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,b=Math.floor(h/g);b=Math.min(b,e.color.length-1),b=Math.max(b,0),c=e.color[b];break}default:c="#2DC214"}switch(typeof e.legend){case"string":u=e.legend;break;case"function":u=e.legend(i);break;case"boolean":u=i;break;default:u=!1}switch(typeof e.legendColor){case"string":d=e.legendColor;break;case"function":d=e.legendColor(i);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,b=Math.floor(h/g);b=Math.min(b,e.legendColor.length-1),b=Math.max(b,0),d=e.legendColor[b]}break;default:d="#000"}n.style.minWidth="30px",n.style.position="relative",n.setAttribute("aria-label",h);var f=document.createElement("div");f.style.display="inline-block",f.style.width=h+"%",f.style.backgroundColor=c,f.style.height="100%",f.setAttribute("data-max",r),f.setAttribute("data-min",o);var p=document.createElement("div");if(p.style.position="relative",p.style.width="100%",p.style.height="100%",u){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=l,m.style.width="100%",m.style.color=d,m.innerHTML=u}return t(function(){if(!(s instanceof Ov)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",n.appendChild(g),n=g}n.appendChild(p),p.appendChild(f),u&&p.appendChild(m)}),""}function DD(s,e,t){return s.getElement().style.backgroundColor=this.sanitizeHTML(s.getValue()),""}function AD(s,e,t){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function OD(s,e,t){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function LD(s,e,t){var i=document.createElement("span"),n=s.getRow(),r=s.getTable();return n.watchPosition(o=>{e.relativeToPage&&(o+=r.modules.page.getPageSize()*(r.modules.page.getPage()-1)),i.innerText=o}),i}function ID(s,e,t){return s.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function BD(s,e,t){var i=document.createElement("div"),n=s.getRow()._row.modules.responsiveLayout;i.classList.add("tabulator-responsive-collapse-toggle"),i.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,s.getElement().classList.add("tabulator-row-handle");function r(o){var l=n.element;n.open=o,l&&(n.open?(i.classList.add("open"),l.style.display=""):(i.classList.remove("open"),l.style.display="none"))}return i.addEventListener("click",function(o){o.stopImmediatePropagation(),r(!n.open),s.getTable().rowManager.adjustTableSize()}),r(n.open),i}function FD(s,e,t){var i=document.createElement("input"),n=!1;if(i.type="checkbox",i.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(i.addEventListener("click",o=>{o.stopPropagation()}),typeof s.getRow=="function"){var r=s.getRow();r instanceof Va?(i.addEventListener("change",o=>{this.table.options.selectableRowsRangeMode==="click"&&n?n=!1:r.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&i.addEventListener("click",o=>{n=!0,this.table.modules.selectRow.handleComplexRowClick(r._row,o)}),i.checked=r.isSelected&&r.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(r,i)):i=""}else i.addEventListener("change",o=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(i);return i}var PD={plaintext:bD,html:yD,textarea:vD,money:wD,link:CD,image:ED,tickCross:xD,datetime:kD,datetimediff:SD,lookup:_D,star:RD,traffic:TD,progress:MD,color:DD,buttonTick:AD,buttonCross:OD,rownum:LD,handle:ID,responsiveCollapse:BD,rowSelection:FD};class Ht extends se{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,t){var i={params:e.definition["formatter"+t+"Params"]||{}},n=e.definition["formatter"+t];switch(typeof n){case"string":Ht.formatters[n]?i.formatter=Ht.formatters[n]:(console.warn("Formatter Error - No such formatter found: ",n),i.formatter=Ht.formatters.plaintext);break;case"function":i.formatter=n;break;default:i.formatter=Ht.formatters.plaintext;break}return i}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,t,i){var n,r,o,l;return e.definition.titleFormatter?(n=this.getFormatter(e.definition.titleFormatter),o=a=>{e.titleFormatterRendered=a},l={getValue:function(){return t},getElement:function(){return i},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},r=e.definition.titleFormatterParams||{},r=typeof r=="function"?r():r,n.call(this,l,r,o)):t}formatValue(e){var t=e.getComponent(),i=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(t):e.column.modules.format.params;function n(r){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=r,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,t,i,n)}formatExportValue(e,t){var i=e.column.modules.format[t],n;if(i){let r=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};return n=typeof i.params=="function"?i.params(e.getComponent()):i.params,i.formatter.call(this,e.getComponent(),n,r)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(i){return t[i]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":Ht.formatters[e]?e=Ht.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=Ht.formatters.plaintext);break;case"function":break;default:e=Ht.formatters.plaintext;break}return e}}Ht.moduleName="format";Ht.formatters=PD;class Pv extends se{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var t={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(t.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=t):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(t=>{t.calcs.top&&this.layoutRow(t.calcs.top),t.calcs.bottom&&this.layoutRow(t.calcs.bottom),t.groupList&&t.groupList.length&&this.layoutGroupCalcs(t.groupList)})}layoutColumnPosition(e){var t=[],i=0,n=0;this.leftColumns.forEach((r,o)=>{if(r.modules.frozen.marginValue=i,r.modules.frozen.margin=r.modules.frozen.marginValue+"px",r.visible&&(i+=r.getWidth()),o==this.leftColumns.length-1?r.modules.frozen.edge=!0:r.modules.frozen.edge=!1,r.parent.isGroup){var l=this.getColGroupParentElement(r);t.includes(l)||(this.layoutElement(l,r),t.push(l)),l.classList.toggle("tabulator-frozen-left",r.modules.frozen.edge&&r.modules.frozen.position==="left"),l.classList.toggle("tabulator-frozen-right",r.modules.frozen.edge&&r.modules.frozen.position==="right")}else this.layoutElement(r.getElement(),r);e&&r.cells.forEach(a=>{this.layoutElement(a.getElement(!0),r)})}),this.rightColumns.forEach((r,o)=>{r.modules.frozen.marginValue=n,r.modules.frozen.margin=r.modules.frozen.marginValue+"px",r.visible&&(n+=r.getWidth()),o==this.rightColumns.length-1?r.modules.frozen.edge=!0:r.modules.frozen.edge=!1,r.parent.isGroup?this.layoutElement(this.getColGroupParentElement(r),r):this.layoutElement(r.getElement(),r),e&&r.cells.forEach(l=>{this.layoutElement(l.getElement(!0),r)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),t=this.table.rowManager.getRows().filter(i=>!e.includes(i));t.forEach(i=>{i.deinitialize()}),e.forEach(i=>{i.type==="row"&&this.layoutRow(i)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(t=>{var i=e.getCell(t);i&&this.layoutElement(i.getElement(!0),t)}),this.rightColumns.forEach(t=>{var i=e.getCell(t);i&&this.layoutElement(i.getElement(!0),t)})}layoutElement(e,t){var i;t.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?i=t.modules.frozen.position==="left"?"right":"left":i=t.modules.frozen.position,e.style[i]=t.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",t.modules.frozen.edge&&t.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",t.modules.frozen.edge&&t.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}_calcSpace(e,t){var i=0;for(let n=0;n<t;n++)e[n].visible&&(i+=e[n].getWidth());return i}}Pv.moduleName="frozenColumns";class Nv extends se{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var t=this.table.options.frozenRows,i=typeof t;i==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=t&&this.freezeRow(e):i==="function"?t.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(t)&&t.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var t=this.rows.indexOf(e);return t>-1}isFrozen(){return!!this.rows.length}visibleRows(e,t){return this.rows.forEach(i=>{t.push(i)}),t}getRows(e){var t=e.slice(0);return this.rows.forEach(function(i){var n=t.indexOf(i);n>-1&&t.splice(n,1)}),t}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var t=this.rows.indexOf(e);if(t>-1){var i=e.getElement();i.parentNode&&i.parentNode.removeChild(i),this.rows.splice(t,1)}}styleRows(e){this.rows.forEach((t,i)=>{this.table.rowManager.styleRow(t,i)})}}Nv.moduleName="frozenRows";class ND{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._group.groupManager.table.componentFunctionBinder.handle("group",t._group,i)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,t){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,t)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class Mn{constructor(e,t,i,n,r,o,l){this.groupManager=e,this.parent=t,this.key=n,this.level=i,this.field=r,this.hasSubGroups=i<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=l,this.rows=[],this.groups=[],this.groupList=[],this.generator=o,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=l?l.visible:typeof e.startOpen[i]<"u"?e.startOpen[i]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(t){t.wipe()}):this.rows.forEach(t=>{t.modules&&delete t.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(t=>{this._createGroup(t,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",t=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(t.stopPropagation(),t.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,t){var i=t+"_"+e,n=new Mn(this.groupManager,this,t,e,this.groupManager.groupIDLookups[t].field,this.groupManager.headerGenerator[t]||this.groupManager.headerGenerator[0],this.old?this.old.groups[i]:!1);this.groups[i]=n,this.groupList.push(n)}_addRowToGroup(e){var t=this.level+1;if(this.hasSubGroups){var i=this.groupManager.groupIDLookups[t].func(e.getData()),n=t+"_"+i;this.groupManager.allowedValues&&this.groupManager.allowedValues[t]?this.groups[n]&&this.groups[n].addRow(e):(this.groups[n]||this._createGroup(i,t),this.groups[n].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,t,i){var n=this.conformRowData({});e.updateData(n);var r=this.rows.indexOf(t);r>-1?i?this.rows.splice(r+1,0,e):this.rows.splice(r,0,e):i?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(t){t.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var t=this.rows.indexOf(e),i=e.getElement();t>-1&&this.rows.splice(t,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(i.parentNode&&i.parentNode.removeChild(i),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var t=e.level+"_"+e.key,i;this.groups[t]&&(delete this.groups[t],i=this.groupList.indexOf(e),i>-1&&this.groupList.splice(i,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(t){e=e.concat(t.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,t){var i=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(n=>{i.push(n.getData(t||"data"))}),i}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(t=>{e+=t.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var t=e.getHeadersAndRows();t.forEach(i=>{i.detachElement()})}):this.rows.forEach(e=>{var t=e.getElement();t.parentNode.removeChild(t)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(t=>{var i=t.getHeadersAndRows();i.forEach(n=>{var r=n.getElement();e.parentNode.insertBefore(r,e.nextSibling),n.initialize(),e=r})}):this.rows.forEach(t=>{var i=t.getElement();e.parentNode.insertBefore(i,e.nextSibling),t.initialize(),e=i}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(t){e.push(t.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var t=!1;return this.groupList.length?this.groupList.forEach(function(i){var n=i.getRowGroup(e);n&&(t=n)}):this.rows.find(function(i){return i===e})&&(t=this),t}getSubGroups(e){var t=[];return this.groupList.forEach(function(i){t.push(e?i.getComponent():i)}),t}getRows(e,t){var i=[];return t&&this.groupList.length?this.groupList.forEach(n=>{i=i.concat(n.getRows(e,t))}):this.rows.forEach(function(n){i.push(e?n.getComponent():n)}),i}generateGroupHeaderContents(){var e=[],t=this.getRows(!1,!0);for(t.forEach(function(i){e.push(i.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,Te.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new ND(this)),this.component}}class zv extends se{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,t=this.table.options.groupStartOpen,i=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(i)&&e.length>i.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(r,o)=>{this.headerGenerator[0]=(l,a,h)=>(typeof l>"u"?"":l)+"<span>("+a+" "+(a===1?r:o.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var n=this.table.columnManager.getRealColumns();n.forEach(r=>{r.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),r.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((r,o)=>{var l,a;typeof r=="function"?l=r:(a=this.table.columnManager.getColumnByField(r),a?l=function(h){return a.getFieldValue(h)}:l=function(h){return h[r]}),this.groupIDLookups.push({field:typeof r=="function"?!1:r,func:l,values:this.allowedValues?this.allowedValues[o]:!1})}),t&&(Array.isArray(t)||(t=[t]),t.forEach(r=>{}),this.startOpen=t),i&&(this.headerGenerator=Array.isArray(i)?i:[i])}else this.groupList=[],this.groups={}}rowSample(e,t){if(this.table.options.groupBy){var i=this.getGroups(!1)[0];t.push(i.getRows(!1)[0])}return t}virtualRenderFill(){var e=this.table.rowManager.tableElement,t=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)t=t.filter(i=>i.type!=="group"),e.style.minWidth=t.length?"":this.table.columnManager.getWidth()+"px";else return t}rowAddingIndex(e,t,i){if(this.table.options.groupBy){this.assignRowToGroup(e);var n=e.modules.group.rows;return n.length>1&&(!t||t&&n.indexOf(t)==-1?i?n[0]!==e&&(t=n[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,t,!i)):n[n.length-1]!==e&&(t=n[n.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,t,!i)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,t,!i)),t}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,t,i){if(this.table.options.groupBy){!i&&t instanceof Mn&&(t=this.table.rowManager.prevDisplayRow(e)||t);var n=t instanceof Mn?t:t.modules.group,r=e instanceof Mn?e:e.modules.group;n===r?this.table.rowManager.moveRowInArray(n.rows,e,t,i):(r&&r.removeRow(e),n.insertRow(e,t,i))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var t=[];return this.groupList.forEach(function(i){t.push(e?i.getComponent():i)}),t}getChildGroups(e){var t=[];return e||(e=this),e.groupList.forEach(i=>{i.groupList.length?t=t.concat(this.getChildGroups(i)):t.push(i)}),t}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var t=[];return e.forEach(i=>{var n={};n.level=0,n.rowCount=0,n.headerContent="";var r=[];i.hasSubGroups?(r=this.pullGroupListData(i.groupList),n.level=i.level,n.rowCount=r.length-i.groupList.length,n.headerContent=i.generator(i.key,n.rowCount,i.rows,i),t.push(n),t=t.concat(r)):(n.level=i.level,n.headerContent=i.generator(i.key,i.rows.length,i.rows,i),n.rowCount=i.getRows().length,t.push(n),i.getRows().forEach(o=>{t.push(o.getData("data"))}))}),t}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var t=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(i=>{var n=i.getRowGroup(e);n&&(t=n)}),t}countGroups(){return this.groupList.length}generateGroups(e){var t=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(i=>{this.createGroup(i,0,t)}),e.forEach(i=>{this.assignRowToExistingGroup(i,t)})):e.forEach(i=>{this.assignRowToGroup(i,t)}),Object.values(t).forEach(i=>{i.wipe(!0)})}createGroup(e,t,i){var n=t+"_"+e,r;i=i||[],r=new Mn(this,!1,t,e,this.groupIDLookups[0].field,this.headerGenerator[0],i[n]),this.groups[n]=r,this.groupList.push(r)}assignRowToExistingGroup(e,t){var i=this.groupIDLookups[0].func(e.getData()),n="0_"+i;this.groups[n]&&this.groups[n].addRow(e)}assignRowToGroup(e,t){var i=this.groupIDLookups[0].func(e.getData()),n=!this.groups["0_"+i];return n&&this.createGroup(i,0,t),this.groups["0_"+i].addRow(e),!n}reassignRowToGroup(e){if(e.type==="row"){var t=e.modules.group,i=t.getPath(),n=this.getExpectedPath(e),r;r=i.length==n.length&&i.every((o,l)=>o===n[l]),r||(t.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var t=[],i=e.getData();return this.groupIDLookups.forEach(n=>{t.push(n.func(i))}),t}updateGroupRows(e){var t=[];return this.blockRedraw||(this.groupList.forEach(i=>{t=t.concat(i.getHeadersAndRows())}),e&&this.refreshData(!0)),t}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(t=>{t.scrollHeader(e)}))}removeGroup(e){var t=e.level+"_"+e.key,i;this.groups[t]&&(delete this.groups[t],i=this.groupList.indexOf(e),i>-1&&this.groupList.splice(i,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,t=!0;this.table.rowManager.getDisplayRows().forEach((i,n)=>{this.table.rowManager.styleRow(i,n),e.appendChild(i.getElement()),i.initialize(!0),i.type!=="group"&&(t=!1)}),t?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}zv.moduleName="groupRows";var zD={cellEdit:function(s){s.component.setValueProcessData(s.data.oldValue),s.component.cellRendered()},rowAdd:function(s){s.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(s){var e=this.table.rowManager.addRowActual(s.data.data,s.data.pos,s.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(s.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(s){var e=s.data.posFrom-s.data.posTo>0;this.table.rowManager.moveRowActual(s.component,this.table.rowManager.getRowFromPosition(s.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},HD={cellEdit:function(s){s.component.setValueProcessData(s.data.newValue),s.component.cellRendered()},rowAdd:function(s){var e=this.table.rowManager.addRowActual(s.data.data,s.data.pos,s.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(s.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(s){s.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(s){this.table.rowManager.moveRowActual(s.component,this.table.rowManager.getRowFromPosition(s.data.posTo),s.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}};class cn extends se{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,t,i){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:t.getPosition(),to:t,after:i})}rowAdded(e,t,i,n){this.action("rowAdd",e,{data:t,pos:i,index:n})}rowDeleted(e){var t,i;this.table.options.groupBy?(i=e.getComponent().getGroup()._getSelf().rows,t=i.indexOf(e),t&&(t=i[t-1])):(t=e.table.rowManager.getRowIndex(e),t&&(t=e.table.rowManager.rows[t-1])),this.action("rowDelete",e,{data:e.getData(),pos:!t,index:t})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,t,i){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:t,data:i}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var t=this.history.findIndex(function(i){return i.component===e});t>-1&&(this.history.splice(t,1),t<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return cn.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return cn.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,t){this.history.forEach(function(i){if(i.component instanceof lt)i.component===e&&(i.component=t);else if(i.component instanceof vo&&i.component.row===e){var n=i.component.column.getField();n&&(i.component=t.getCell(n))}})}}cn.moduleName="history";cn.undoers=zD;cn.redoers=HD;class Hv extends se{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,t=this.table.options,i=e.getElementsByTagName("th"),n=e.getElementsByTagName("tbody")[0],r=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),n=n?n.getElementsByTagName("tr"):[],this._extractOptions(e,t),i.length?this._extractHeaders(i,n):this._generateBlankHeaders(i,n);for(var o=0;o<n.length;o++){var l=n[o],a=l.getElementsByTagName("td"),h={};this.hasIndex||(h[t.index]=o);for(var c=0;c<a.length;c++){var u=a[c];typeof this.fieldIndex[c]<"u"&&(h[this.fieldIndex[c]]=u.innerHTML)}r.push(h)}t.data=r,this.dispatchExternal("htmlImported")}_extractOptions(e,t,i){var n=e.attributes,r=Object.keys(i||t),o={};r.forEach(c=>{o[c.toLowerCase()]=c});for(var l in n){var a=n[l],h;a&&typeof a=="object"&&a.name&&a.name.indexOf("tabulator-")===0&&(h=a.name.replace("tabulator-",""),typeof o[h]<"u"&&(t[o[h]]=this._attribValue(a.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var t=this.table.options.columns.find(i=>i.title===e);return t||!1}_extractHeaders(e,t){for(var i=0;i<e.length;i++){var n=e[i],r=!1,o=this._findCol(n.textContent),l;o?r=!0:o={title:n.textContent.trim()},o.field||(o.field=n.textContent.trim().toLowerCase().replaceAll(" ","_")),l=n.getAttribute("width"),l&&!o.width&&(o.width=l),this._extractOptions(n,o,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[i]=o.field,o.field==this.table.options.index&&(this.hasIndex=!0),r||this.table.options.columns.push(o)}}_generateBlankHeaders(e,t){for(var i=0;i<e.length;i++){var n=e[i],r={title:"",field:"col"+i};this.fieldIndex[i]=r.field;var o=n.getAttribute("width");o&&(r.width=o),this.table.options.columns.push(r)}}}Hv.moduleName="htmlTableImport";function VD(s){var e=[],t=0,i=0,n=!1;for(let r=0;r<s.length;r++){let o=s[r],l=s[r+1];if(e[t]||(e[t]=[]),e[t][i]||(e[t][i]=""),o=='"'&&n&&l=='"'){e[t][i]+=o,r++;continue}if(o=='"'){n=!n;continue}if(o==","&&!n){i++;continue}if(o=="\r"&&l==`
`&&!n){i=0,t++,r++;continue}if((o=="\r"||o==`
`)&&!n){i=0,t++;continue}e[t][i]+=o}return e}function WD(s){try{return JSON.parse(s)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function UD(s){return s}var jD={csv:VD,json:WD,array:UD};class Co extends se{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,t,i,n,r){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(o=>(console.error("Import Error:",o||"Unable to import data"),Promise.reject(o)))}lookupImporter(e){var t;return e||(e=this.table.options.importFormat),typeof e=="string"?t=Co.importers[e]:t=e,t||console.error("Import Error - Importer not found:",e),t}importFromFile(e,t){var i=this.lookupImporter(e);if(i)return this.pickFile(t).then(this.importData.bind(this,i)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(n=>(console.error("Import Error:",n||"Unable to import file"),Promise.reject(n)))}pickFile(e){return new Promise((t,i)=>{var n=document.createElement("input");n.type="file",n.accept=e,n.addEventListener("change",r=>{var o=n.files[0],l=new FileReader;switch(this.table.options.importReader){case"buffer":l.readAsArrayBuffer(o);break;case"binary":l.readAsBinaryString(o);break;case"url":l.readAsDataURL(o);break;case"text":default:l.readAsText(o)}l.onload=a=>{t(l.result)},l.onerror=a=>{console.warn("File Load Error - Unable to read file"),i()}}),n.click()})}importData(e,t){var i=e.call(this.table,t);return i instanceof Promise?i:i?Promise.resolve(i):Promise.reject()}structureData(e){var t=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?t=this.structureArrayToObject(e):t=this.structureArrayToColumns(e),t):e}structureArrayToObject(e){var t=e.shift(),i=e.map(n=>{var r={};return t.forEach((o,l)=>{r[o]=n[l]}),r});return i}structureArrayToColumns(e){var t=[],i=this.table.getColumns();return i[0]&&e[0][0]&&i[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(n=>{var r={};n.forEach((o,l)=>{var a=i[l];a&&(r[a.getField()]=o)}),t.push(r)}),t}setData(e){return this.table.setData(e)}}Co.moduleName="import";Co.importers=jD;class Vv extends se{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(t=>{for(let i in t)t[i]=null})}cellContentsSelectionFixer(e,t){var i;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===t)){e.preventDefault();try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(t.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(t.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,t){t?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var t=this.eventMap[e];this.touchSubscribers[t+"-touchstart"]||(this.touchSubscribers[t+"-touchstart"]=this.handleTouch.bind(this,t,"start"),this.touchSubscribers[t+"-touchend"]=this.handleTouch.bind(this,t,"end"),this.subscribe(t+"-touchstart",this.touchSubscribers[t+"-touchstart"]),this.subscribe(t+"-touchend",this.touchSubscribers[t+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var t=!0,i=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let n in this.eventMap)this.eventMap[n]===i&&this.subscribers[n]&&(t=!1);t&&(this.unsubscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.unsubscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"]),delete this.touchSubscribers[i+"-touchstart"],delete this.touchSubscribers[i+"-touchend"])}}initializeColumn(e){var t=e.definition;for(let i in this.eventMap)t[i]&&(this.subscriptionChanged(i,!0),this.columnSubscribers[i]||(this.columnSubscribers[i]=[]),this.columnSubscribers[i].push(e))}handle(e,t,i){this.dispatchEvent(e,t,i)}handleTouch(e,t,i,n){var r=this.touchWatchers[e];switch(e==="column"&&(e="header"),t){case"start":r.tap=!0,clearTimeout(r.tapHold),r.tapHold=setTimeout(()=>{clearTimeout(r.tapHold),r.tapHold=null,r.tap=null,clearTimeout(r.tapDbl),r.tapDbl=null,this.dispatchEvent(e+"TapHold",i,n)},1e3);break;case"end":r.tap&&(r.tap=null,this.dispatchEvent(e+"Tap",i,n)),r.tapDbl?(clearTimeout(r.tapDbl),r.tapDbl=null,this.dispatchEvent(e+"DblTap",i,n)):r.tapDbl=setTimeout(()=>{clearTimeout(r.tapDbl),r.tapDbl=null},300),clearTimeout(r.tapHold),r.tapHold=null;break}}dispatchEvent(e,t,i){var n=i.getComponent(),r;this.columnSubscribers[e]&&(i instanceof vo?r=i.column.definition[e]:i instanceof Ii&&(r=i.definition[e]),r&&r(t,n)),this.dispatchExternal(e,t,n)}}Vv.moduleName="interaction";var GD={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35,undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"],copyToClipboard:["ctrl + 67","meta + 67"],rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},qD={keyBlock:function(s){s.stopPropagation(),s.preventDefault()},scrollPageUp:function(s){var e=this.table.rowManager,t=e.scrollTop-e.element.clientHeight;s.preventDefault(),e.displayRowsCount&&(t>=0?e.element.scrollTop=t:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(s){var e=this.table.rowManager,t=e.scrollTop+e.element.clientHeight,i=e.element.scrollHeight;s.preventDefault(),e.displayRowsCount&&(t<=i?e.element.scrollTop=t:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(s){var e=this.table.rowManager;s.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(s){var e=this.table.rowManager;s.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(s){this.dispatch("keybinding-nav-prev",s)},navNext:function(s){this.dispatch("keybinding-nav-next",s)},navLeft:function(s){this.dispatch("keybinding-nav-left",s)},navRight:function(s){this.dispatch("keybinding-nav-right",s)},navUp:function(s){this.dispatch("keybinding-nav-up",s)},navDown:function(s){this.dispatch("keybinding-nav-down",s)},rangeJumpLeft:function(s){this.dispatch("keybinding-nav-range",s,"left",!0,!1)},rangeJumpRight:function(s){this.dispatch("keybinding-nav-range",s,"right",!0,!1)},rangeJumpUp:function(s){this.dispatch("keybinding-nav-range",s,"up",!0,!1)},rangeJumpDown:function(s){this.dispatch("keybinding-nav-range",s,"down",!0,!1)},rangeExpandLeft:function(s){this.dispatch("keybinding-nav-range",s,"left",!1,!0)},rangeExpandRight:function(s){this.dispatch("keybinding-nav-range",s,"right",!1,!0)},rangeExpandUp:function(s){this.dispatch("keybinding-nav-range",s,"up",!1,!0)},rangeExpandDown:function(s){this.dispatch("keybinding-nav-range",s,"down",!1,!0)},rangeExpandJumpLeft:function(s){this.dispatch("keybinding-nav-range",s,"left",!0,!0)},rangeExpandJumpRight:function(s){this.dispatch("keybinding-nav-range",s,"right",!0,!0)},rangeExpandJumpUp:function(s){this.dispatch("keybinding-nav-range",s,"up",!0,!0)},rangeExpandJumpDown:function(s){this.dispatch("keybinding-nav-range",s,"down",!0,!0)},undo:function(s){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(s.preventDefault(),this.table.modules.history.undo()))},redo:function(s){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(s.preventDefault(),this.table.modules.history.redo()))},copyToClipboard:function(s){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}};class vs extends se{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,t={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(t,vs.bindings),Object.assign(t,e),this.mapBindings(t),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let t in e)vs.actions[t]?e[t]&&(typeof e[t]!="object"&&(e[t]=[e[t]]),e[t].forEach(i=>{var n=Array.isArray(i)?i:[i];n.forEach(r=>{this.mapBinding(t,r)})})):console.warn("Key Binding Error - no such action:",t)}mapBinding(e,t){var i={action:vs.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},n=t.toString().toLowerCase().split(" ").join("").split("+");n.forEach(r=>{switch(r){case"ctrl":i.ctrl=!0;break;case"shift":i.shift=!0;break;case"meta":i.meta=!0;break;default:r=isNaN(r)?r.toUpperCase().charCodeAt(0):parseInt(r),i.keys.push(r),this.watchKeys[r]||(this.watchKeys[r]=[]),this.watchKeys[r].push(i)}})}bindEvents(){var e=this;this.keyupBinding=function(t){var i=t.keyCode,n=e.watchKeys[i];n&&(e.pressedKeys.push(i),n.forEach(function(r){e.checkBinding(t,r)}))},this.keydownBinding=function(t){var i=t.keyCode,n=e.watchKeys[i];if(n){var r=e.pressedKeys.indexOf(i);r>-1&&e.pressedKeys.splice(r,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,t){var i=!0;return e.ctrlKey==t.ctrl&&e.shiftKey==t.shift&&e.metaKey==t.meta?(t.keys.forEach(n=>{var r=this.pressedKeys.indexOf(n);r==-1&&(i=!1)}),i&&t.action.call(this,e),!0):!1}}vs.moduleName="keybindings";vs.bindings=GD;vs.actions=qD;class Wv extends se{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("menuContainer",void 0),this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){this.deprecationCheck("menuContainer","popupContainer")||(this.table.options.popupContainer=this.table.options.menuContainer)}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var t=e.definition;t.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),t.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),t.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),t.headerMenu&&this.initializeColumnHeaderMenu(e),t.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),t.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),t.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var t=e.definition.headerMenuIcon,i;i=document.createElement("span"),i.classList.add("tabulator-header-popup-button"),t?(typeof t=="function"&&(t=t(e.getComponent())),t instanceof HTMLElement?i.appendChild(t):i.innerHTML=t):i.innerHTML="&vellip;",i.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,n,e)}),e.titleElement.insertBefore(i,e.titleElement.firstChild)}loadMenuTableCellEvent(e,t,i){i._cell&&(i=i._cell),i.column.definition[e]&&this.loadMenuEvent(i.column.definition[e],t,i)}loadMenuTableColumnEvent(e,t,i){i._column&&(i=i._column),i.definition[e]&&this.loadMenuEvent(i.definition[e],t,i)}loadMenuEvent(e,t,i){i._group?i=i._group:i._row&&(i=i._row),e=typeof e=="function"?e.call(this.table,t,i.getComponent()):e,this.loadMenu(t,i,e)}loadMenu(e,t,i,n,r){var o=!(e instanceof MouseEvent),l=document.createElement("div"),a;if(l.classList.add("tabulator-menu"),o||e.preventDefault(),!(!i||!i.length)){if(n)a=r.child(l);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=a=this.popup(l)}i.forEach(h=>{var c=document.createElement("div"),u=h.label,d=h.disabled;h.separator?c.classList.add("tabulator-menu-separator"):(c.classList.add("tabulator-menu-item"),typeof u=="function"&&(u=u.call(this.table,t.getComponent())),u instanceof Node?c.appendChild(u):c.innerHTML=u,typeof d=="function"&&(d=d.call(this.table,t.getComponent())),d?(c.classList.add("tabulator-menu-item-disabled"),c.addEventListener("click",f=>{f.stopPropagation()})):h.menu&&h.menu.length?c.addEventListener("click",f=>{f.stopPropagation(),this.loadMenu(f,t,h.menu,c,a)}):h.action&&c.addEventListener("click",f=>{h.action(f,t.getComponent())}),h.menu&&h.menu.length&&c.classList.add("tabulator-menu-item-submenu")),l.appendChild(c)}),l.addEventListener("click",h=>{this.rootPopup&&this.rootPopup.hide()}),a.show(n||e),a===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",i,a),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=t,this.dispatch("menu-opened",i,a),this.dispatchExternal("menuOpened",t.getComponent()))}}}Wv.moduleName="menu";class Uv extends se{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var t=this,i={},n;!e.modules.frozen&&!e.isGroup&&(n=e.getElement(),i.mousemove=(function(r){e.parent===t.moving.parent&&((t.touchMove?r.touches[0].pageX:r.pageX)-Te.elOffset(n).left+t.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(t.toCol!==e||!t.toColAfter)&&(n.parentNode.insertBefore(t.placeholderElement,n.nextSibling),t.moveColumn(e,!0)):(t.toCol!==e||t.toColAfter)&&(n.parentNode.insertBefore(t.placeholderElement,n),t.moveColumn(e,!1)))}).bind(t),n.addEventListener("mousedown",function(r){t.touchMove=!1,r.which===1&&(t.checkTimeout=setTimeout(function(){t.startMove(r,e)},t.checkPeriod))}),n.addEventListener("mouseup",function(r){r.which===1&&t.checkTimeout&&clearTimeout(t.checkTimeout)}),t.bindTouchEvents(e)),e.modules.moveColumn=i}bindTouchEvents(e){var t=e.getElement(),i=!1,n,r,o,l,a,h;t.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextColumn(),o=n?n.getWidth()/2:0,r=e.prevColumn(),l=r?r.getWidth()/2:0,a=0,h=0,i=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),t.addEventListener("touchmove",c=>{var u,d;this.moving&&(this.moveHover(c),i||(i=c.touches[0].pageX),u=c.touches[0].pageX-i,u>0?n&&u-a>o&&(d=n,d!==e&&(i=c.touches[0].pageX,d.getElement().parentNode.insertBefore(this.placeholderElement,d.getElement().nextSibling),this.moveColumn(d,!0))):r&&-u-h>l&&(d=r,d!==e&&(i=c.touches[0].pageX,d.getElement().parentNode.insertBefore(this.placeholderElement,d.getElement()),this.moveColumn(d,!1))),d&&(n=d.nextColumn(),a=o,o=n?n.getWidth()/2:0,r=d.prevColumn(),h=l,l=r?r.getWidth()/2:0))},{passive:!0}),t.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(c)})}startMove(e,t){var i=t.getElement(),n=this.table.columnManager.getContentsElement(),r=this.table.columnManager.getHeadersElement();this.moving=t,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Te.elOffset(i).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=t.getWidth()+"px",this.placeholderElement.style.height=t.getHeight()+"px",i.parentNode.insertBefore(this.placeholderElement,i),i.parentNode.removeChild(i),this.hoverElement=i.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),n.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=n.clientHeight-r.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e)}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,t){var i=this.moving.getCells();this.toCol=e,this.toColAfter=t,t?e.getCells().forEach(function(n,r){var o=n.getElement(!0);o.parentNode&&i[r]&&o.parentNode.insertBefore(i[r].getElement(),o.nextSibling)}):e.getCells().forEach(function(n,r){var o=n.getElement(!0);o.parentNode&&i[r]&&o.parentNode.insertBefore(i[r].getElement(),o)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var t=this.table.columnManager.getContentsElement(),i=t.scrollLeft,n=(this.touchMove?e.touches[0].pageX:e.pageX)-Te.elOffset(t).left+i,r;this.hoverElement.style.left=n-this.startX+"px",n-i<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{r=Math.max(0,i-5),this.table.rowManager.getElement().scrollLeft=r,this.autoScrollTimeout=!1},1))),i+t.clientWidth-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{r=Math.min(t.clientWidth,i+5),this.table.rowManager.getElement().scrollLeft=r,this.autoScrollTimeout=!1},1)))}}Uv.moduleName="moveColumn";class Ua extends se{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var t=this,i={};i.mouseup=(function(n){t.tableRowDrop(n,e)}).bind(t),i.mousemove=(function(n){var r;n.pageY-Te.elOffset(e.element).top+t.table.rowManager.element.scrollTop>e.getHeight()/2?(t.toRow!==e||!t.toRowAfter)&&(r=e.getElement(),r.parentNode.insertBefore(t.placeholderElement,r.nextSibling),t.moveRow(e,!0)):(t.toRow!==e||t.toRowAfter)&&(r=e.getElement(),r.previousSibling&&(r.parentNode.insertBefore(t.placeholderElement,r),t.moveRow(e,!1)))}).bind(t),e.modules.moveRow=i}initializeRow(e){var t=this,i={},n;i.mouseup=(function(r){t.tableRowDrop(r,e)}).bind(t),i.mousemove=(function(r){var o=e.getElement();r.pageY-Te.elOffset(o).top+t.table.rowManager.element.scrollTop>e.getHeight()/2?(t.toRow!==e||!t.toRowAfter)&&(o.parentNode.insertBefore(t.placeholderElement,o.nextSibling),t.moveRow(e,!0)):(t.toRow!==e||t.toRowAfter)&&(o.parentNode.insertBefore(t.placeholderElement,o),t.moveRow(e,!1))}).bind(t),this.hasHandle||(n=e.getElement(),n.addEventListener("mousedown",function(r){r.which===1&&(t.checkTimeout=setTimeout(function(){t.startMove(r,e)},t.checkPeriod))}),n.addEventListener("mouseup",function(r){r.which===1&&t.checkTimeout&&clearTimeout(t.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=i}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var t=this,i=e.getElement(!0);i.addEventListener("mousedown",function(n){n.which===1&&(t.checkTimeout=setTimeout(function(){t.startMove(n,e.row)},t.checkPeriod))}),i.addEventListener("mouseup",function(n){n.which===1&&t.checkTimeout&&clearTimeout(t.checkTimeout)}),this.bindTouchEvents(e.row,i)}}bindTouchEvents(e,t){var i=!1,n,r,o,l,a,h;t.addEventListener("touchstart",c=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,n=e.nextRow(),o=n?n.getHeight()/2:0,r=e.prevRow(),l=r?r.getHeight()/2:0,a=0,h=0,i=!1,this.startMove(c,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,t.addEventListener("touchmove",c=>{var u,d;this.moving&&(c.preventDefault(),this.moveHover(c),i||(i=c.touches[0].pageY),u=c.touches[0].pageY-i,u>0?n&&u-a>o&&(d=n,d!==e&&(i=c.touches[0].pageY,d.getElement().parentNode.insertBefore(this.placeholderElement,d.getElement().nextSibling),this.moveRow(d,!0))):r&&-u-h>l&&(d=r,d!==e&&(i=c.touches[0].pageY,d.getElement().parentNode.insertBefore(this.placeholderElement,d.getElement()),this.moveRow(d,!1))),d&&(n=d.nextRow(),a=o,o=n?n.getHeight()/2:0,r=d.prevRow(),h=l,l=r?r.getHeight()/2:0))}),t.addEventListener("touchend",c=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(c),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,t){var i=t.getElement();this.setStartPosition(e,t),this.moving=t,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=t.getWidth()+"px",this.placeholderElement.style.height=t.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(t)):(i.parentNode.insertBefore(this.placeholderElement,i),i.parentNode.removeChild(i)),this.hoverElement=i.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",t.getComponent()),this.moveHover(e)}setStartPosition(e,t){var i=this.touchMove?e.touches[0].pageX:e.pageX,n=this.touchMove?e.touches[0].pageY:e.pageY,r,o;r=t.getElement(),this.connection?(o=r.getBoundingClientRect(),this.startX=o.left-i+window.pageXOffset,this.startY=o.top-n+window.pageYOffset):this.startY=n-r.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,t){this.toRow=e,this.toRowAfter=t}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var t=this.table.rowManager.getElement(),i=t.scrollTop,n=(this.touchMove?e.touches[0].pageY:e.pageY)-t.getBoundingClientRect().top+i;this.hoverElement.style.top=Math.min(n-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,t,i){this.dispatchExternal("movableRowsElementDrop",e,t,i?i.getComponent():!1)}connectToTables(e){var t;this.connectionSelectorsTables&&(t=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",t),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(i=>{typeof i=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(i))):this.connectionElements.push(i)}),this.connectionElements.forEach(i=>{var n=r=>{this.elementRowDrop(r,i,this.moving)};i.addEventListener("mouseup",n),i.tabulatorElementDropEvent=n,i.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(t=>{t.classList.remove("tabulator-movingrow-receiving"),t.removeEventListener("mouseup",t.tabulatorElementDropEvent),delete t.tabulatorElementDropEvent})}connect(e,t){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=t,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().addEventListener("mouseup",i.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",t,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(t=>{t.type==="row"&&t.modules.moveRow&&t.modules.moveRow.mouseup&&t.getElement().removeEventListener("mouseup",t.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,t,i){var n=!1;if(i){switch(typeof this.table.options.movableRowsSender){case"string":n=this.senders[this.table.options.movableRowsSender];break;case"function":n=this.table.options.movableRowsSender;break}n?n.call(this,this.moving?this.moving.getComponent():void 0,t?t.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),t?t.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),t?t.getComponent():void 0,e);this.endMove()}tableRowDrop(e,t){var i=!1,n=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":i=this.receivers[this.table.options.movableRowsReceiver];break;case"function":i=this.table.options.movableRowsReceiver;break}i?n=i.call(this,this.connectedRow.getComponent(),t?t.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),n?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),t?t.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),t?t.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:t,success:n})}commsReceived(e,t,i){switch(t){case"connect":return this.connect(e,i.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,i.row,i.success)}}}Ua.prototype.receivers={insert:function(s,e,t){return this.table.addRow(s.getData(),void 0,e),!0},add:function(s,e,t){return this.table.addRow(s.getData()),!0},update:function(s,e,t){return e?(e.update(s.getData()),!0):!1},replace:function(s,e,t){return e?(this.table.addRow(s.getData(),void 0,e),e.delete(),!0):!1}};Ua.prototype.senders={delete:function(s,e,t){s.delete()}};Ua.moduleName="moveRow";var $D={};class ir extends se{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,t,i){return this.transformRow(t,"data",i)}initializeColumn(e){var t=!1,i={};this.allowedTypes.forEach(n=>{var r="mutator"+(n.charAt(0).toUpperCase()+n.slice(1)),o;e.definition[r]&&(o=this.lookupMutator(e.definition[r]),o&&(t=!0,i[r]={mutator:o,params:e.definition[r+"Params"]||{}}))}),t&&(e.modules.mutate=i)}lookupMutator(e){var t=!1;switch(typeof e){case"string":ir.mutators[e]?t=ir.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":t=e;break}return t}transformRow(e,t,i){var n="mutator"+(t.charAt(0).toUpperCase()+t.slice(1)),r;return this.enabled&&this.table.columnManager.traverse(o=>{var l,a,h;o.modules.mutate&&(l=o.modules.mutate[n]||o.modules.mutate.mutator||!1,l&&(r=o.getFieldValue(typeof i<"u"?i:e),(t=="data"&&!i||typeof r<"u")&&(h=o.getComponent(),a=typeof l.params=="function"?l.params(r,e,t,h):l.params,o.setFieldValue(e,l.mutator(r,e,t,a,h)))))}),e}transformCell(e,t){if(e.column.modules.mutate){var i=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,n={};if(i)return n=Object.assign(n,e.row.getData()),e.column.setFieldValue(n,t),i.mutator(t,n,"edit",i.params,e.getComponent())}return t}mutateLink(e){var t=e.column.definition.mutateLink;t&&(Array.isArray(t)||(t=[t]),t.forEach(i=>{var n=e.row.getCell(i);n&&n.setValue(n.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}ir.moduleName="mutator";ir.mutators=$D;function KD(s,e,t,i,n){var r=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),a=document.createElement("span"),h=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",u=>{o.innerHTML=u}),this.table.modules.localize.langBind("pagination|counter|of",u=>{a.innerHTML=u}),this.table.modules.localize.langBind("pagination|counter|rows",u=>{c.innerHTML=u}),i?(l.innerHTML=" "+e+"-"+Math.min(e+s-1,i)+" ",h.innerHTML=" "+i+" ",r.appendChild(o),r.appendChild(l),r.appendChild(a),r.appendChild(h),r.appendChild(c)):(l.innerHTML=" 0 ",r.appendChild(o),r.appendChild(l),r.appendChild(c)),r}function YD(s,e,t,i,n){var r=document.createElement("span"),o=document.createElement("span"),l=document.createElement("span"),a=document.createElement("span"),h=document.createElement("span"),c=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",u=>{o.innerHTML=u}),l.innerHTML=" "+t+" ",this.table.modules.localize.langBind("pagination|counter|of",u=>{a.innerHTML=u}),h.innerHTML=" "+n+" ",this.table.modules.localize.langBind("pagination|counter|pages",u=>{c.innerHTML=u}),r.appendChild(o),r.appendChild(l),r.appendChild(a),r.appendChild(h),r.appendChild(c),r}var QD={rows:KD,pages:YD};let ed=class jv extends se{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,t){var i=this.table.rowManager,n=i.getDisplayRows(),r;return t?n.length?r=n[0]:i.activeRows.length&&(r=i.activeRows[i.activeRows.length-1],t=!1):n.length&&(r=n[n.length-1],t=!(n.length<this.size)),{index:r,top:t}}calculatePageSizes(){var e,t;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",t=document.createElement("div"),t.classList.add("tabulator-cell"),t.innerHTML="Page Row Test",e.appendChild(t),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,t,i,n){return this.initialLoad||(this.progressiveLoad&&!i||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),n.page=this.page,this.size&&(n.size=this.size),n}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,t){var i,n,r;!t&&!this.table.dataLoader.loading&&(i=this.table.rowManager.getElement(),n=i.scrollHeight-i.clientHeight-e,r=this.table.options.progressiveLoadScrollMargin||i.clientHeight*2,n<r&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,t){return t||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let t=1;t<5;t++)e.push(this.size*t);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(t=>{var i=document.createElement("option");i.value=t,t===!0?this.langBind("pagination|all",function(n){i.innerHTML=n}):i.innerHTML=t,this.pageSizeSelect.appendChild(i)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,t=null;e&&(typeof e=="function"?t=e:t=jv.pageCounters[e],t?(this.pageCounter=t,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var t,i;e||(this.langBind("pagination|first",n=>{this.firstBut.innerHTML=n}),this.langBind("pagination|first_title",n=>{this.firstBut.setAttribute("aria-label",n),this.firstBut.setAttribute("title",n)}),this.langBind("pagination|prev",n=>{this.prevBut.innerHTML=n}),this.langBind("pagination|prev_title",n=>{this.prevBut.setAttribute("aria-label",n),this.prevBut.setAttribute("title",n)}),this.langBind("pagination|next",n=>{this.nextBut.innerHTML=n}),this.langBind("pagination|next_title",n=>{this.nextBut.setAttribute("aria-label",n),this.nextBut.setAttribute("title",n)}),this.langBind("pagination|last",n=>{this.lastBut.innerHTML=n}),this.langBind("pagination|last_title",n=>{this.lastBut.setAttribute("aria-label",n),this.lastBut.setAttribute("title",n)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(t=document.createElement("label"),this.langBind("pagination|page_size",n=>{this.pageSizeSelect.setAttribute("aria-label",n),this.pageSizeSelect.setAttribute("title",n),t.innerHTML=n}),this.element.appendChild(t),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",n=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(i=document.querySelector(this.table.options.paginationCounterElement),i?i.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var t=this.displayRows(-1),i=t.indexOf(e);if(i>-1){var n=this.size===!0?1:Math.ceil((i+1)/this.size);return this.setPage(n)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,t,i){var n;if(this.pageCounter)switch(this.mode==="remote"&&(t=this.size,i=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),n=this.pageCounter.call(this,t,i,this.page,e,this.max),typeof n){case"object":if(n instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(n)}else this.pageCounterElement.innerHTML="",n!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",n);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=n}}_setPageButtons(){let e=Math.floor((this.count-1)/2),t=Math.ceil((this.count-1)/2),i=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),n=this.page<=t?Math.min(this.count,this.max):Math.min(this.page+t,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let r=i;r<=n;r++)r>0&&r<=this.max&&this.pagesElement.appendChild(this._generatePageButton(r));this.footerRedraw()}_generatePageButton(e){var t=document.createElement("button");return t.classList.add("tabulator-page"),e==this.page&&t.classList.add("active"),t.setAttribute("type","button"),t.setAttribute("role","button"),this.langBind("pagination|page_title",i=>{t.setAttribute("aria-label",i+" "+e),t.setAttribute("title",i+" "+e)}),t.setAttribute("data-page",e),t.textContent=e,t.addEventListener("click",i=>{this.setPage(e)}),t}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var t=0,i,n,r,o,l=e.filter(a=>a.type==="row");if(this.mode=="local"){i=[],this.setMaxRows(e.length),this.size===!0?(n=0,r=e.length):(n=this.size*(this.page-1),r=n+parseInt(this.size)),this._setPageButtons();for(let a=n;a<r;a++){let h=e[a];h&&(i.push(h),h.type==="row"&&(o||(o=h),t++))}return this._setPageCounter(l.length,t,o?l.indexOf(o)+1:0),i}else return this._setPageButtons(),this._setPageCounter(l.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var t;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),t=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+t&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}};ed.moduleName="page";ed.pageCounters=QD;var JD={local:function(s,e){var t=localStorage.getItem(s+"-"+e);return t?JSON.parse(t):!1},cookie:function(s,e){var t=document.cookie,i=s+"-"+e,n=t.indexOf(i+"="),r,o;return n>-1&&(t=t.slice(n),r=t.indexOf(";"),r>-1&&(t=t.slice(0,r)),o=t.replace(i+"=","")),o?JSON.parse(o):!1}},XD={local:function(s,e,t){localStorage.setItem(s+"-"+e,JSON.stringify(t))},cookie:function(s,e,t){var i=new Date;i.setDate(i.getDate()+1e4),document.cookie=s+"-"+e+"="+JSON.stringify(t)+"; expires="+i.toUTCString()}};class yt extends se{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,t=this.table.options.persistenceID,i;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:yt.readers[this.table.options.persistenceReaderFunc]?this.readFunc=yt.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):yt.readers[this.mode]?this.readFunc=yt.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:yt.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=yt.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):yt.writers[this.mode]?this.writeFunc=yt.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(t||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(i=this.retrieveData("page"),i&&(typeof i.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=i.paginationSize),typeof i.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=i.paginationInitialPage))),this.config.group&&(i=this.retrieveData("group"),i&&(typeof i.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=i.groupBy),typeof i.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=i.groupStartOpen),typeof i.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=i.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,t,i;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(t=this.load("filter"),t&&(this.table.options.initialFilter=t)),this.config.headerFilter&&(i=this.load("headerFilter"),i&&(this.table.options.initialHeaderFilter=i))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var t,i;this.config.columns&&(this.defWatcherBlock=!0,t=e.getDefinition(),i=this.config.columns===!0?Object.keys(t):this.config.columns,i.forEach(n=>{var r=Object.getOwnPropertyDescriptor(t,n),o=t[n];r&&Object.defineProperty(t,n,{set:l=>{o=l,this.defWatcherBlock||this.save("columns"),r.set&&r.set(l)},get:()=>(r.get&&r.get(),o)})}),this.defWatcherBlock=!1)}load(e,t){var i=this.retrieveData(e);return t&&(i=i?this.mergeDefinition(t,i):t),i}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,t,i){var n=[];return t=t||[],t.forEach((r,o)=>{var l=this._findColumn(e,r),a;l&&(i?a=Object.keys(r):this.config.columns===!0||this.config.columns==null?(a=Object.keys(l),a.push("width")):a=this.config.columns,a.forEach(h=>{h!=="columns"&&typeof r[h]<"u"&&(l[h]=r[h])}),l.columns&&(l.columns=this.mergeDefinition(l.columns,r.columns)),n.push(l))}),e.forEach((r,o)=>{var l=this._findColumn(t,r);l||(n.length>o?n.splice(o,0,r):n.push(r))}),n}_findColumn(e,t){var i=t.columns?"group":t.field?"field":"object";return e.find(function(n){switch(i){case"group":return n.title===t.title&&n.columns.length===t.columns.length;case"field":return n.field===t.field;case"object":return n===t}})}save(e){var t={};switch(e){case"columns":t=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":t=this.table.modules.filter.getFilters();break;case"headerFilter":t=this.table.modules.filter.getHeaderFilters();break;case"sort":t=this.validateSorters(this.table.modules.sort.getSort());break;case"group":t=this.getGroupConfig();break;case"page":t=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,t)}validateSorters(e){return e.forEach(function(t){t.column=t.field,delete t.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var t=[],i=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(n=>{var r={},o=n.getDefinition(),l;n.isGroup?(r.title=o.title,r.columns=this.parseColumns(n.getColumns())):(r.field=n.getField(),this.config.columns===!0||this.config.columns==null?(l=Object.keys(o),l.push("width"),l.push("visible")):l=this.config.columns,l.forEach(a=>{switch(a){case"width":r.width=n.getWidth();break;case"visible":r.visible=n.visible;break;default:typeof o[a]!="function"&&i.indexOf(a)===-1&&(r[a]=o[a])}})),t.push(r)}),t}}yt.moduleName="persistence";yt.moduleInitOrder=-10;yt.readers=JD;yt.writers=XD;class Gv extends se{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,t,i){this.loadPopupEvent(t,null,e,i)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var t=e.definition;t.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),t.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),t.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),t.headerPopup&&this.initializeColumnHeaderPopup(e),t.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),t.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),t.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var t=e.definition.headerPopupIcon,i;i=document.createElement("span"),i.classList.add("tabulator-header-popup-button"),t?(typeof t=="function"&&(t=t(e.getComponent())),t instanceof HTMLElement?i.appendChild(t):i.innerHTML=t):i.innerHTML="&vellip;",i.addEventListener("click",n=>{n.stopPropagation(),n.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,n,e)}),e.titleElement.insertBefore(i,e.titleElement.firstChild)}loadPopupTableCellEvent(e,t,i){i._cell&&(i=i._cell),i.column.definition[e]&&this.loadPopupEvent(i.column.definition[e],t,i)}loadPopupTableColumnEvent(e,t,i){i._column&&(i=i._column),i.definition[e]&&this.loadPopupEvent(i.definition[e],t,i)}loadPopupEvent(e,t,i,n){var r;function o(l){r=l}i._group?i=i._group:i._row&&(i=i._row),e=typeof e=="function"?e.call(this.table,t,i.getComponent(),o):e,this.loadPopup(t,i,e,r,n)}loadPopup(e,t,i,n,r){var o=!(e instanceof MouseEvent),l,a;i instanceof HTMLElement?l=i:(l=document.createElement("div"),l.innerHTML=i),l.classList.add("tabulator-popup"),l.addEventListener("click",h=>{h.stopPropagation()}),o||e.preventDefault(),a=this.popup(l),typeof n=="function"&&a.renderCallback(n),e?a.show(e):a.show(t.getElement(),r||"center"),a.hideOnBlur(()=>{this.dispatchExternal("popupClosed",t.getComponent())}),this.dispatchExternal("popupOpened",t.getComponent())}}Gv.moduleName="popup";class qv extends se{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,t,i){var n=window.scrollX,r=window.scrollY,o=document.createElement("div"),l=document.createElement("div"),a=this.table.modules.export.generateTable(typeof i<"u"?i:this.table.options.printConfig,typeof t<"u"?t:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),h,c;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(o.classList.add("tabulator-print-header"),h=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof h=="string"?o.innerHTML=h:o.appendChild(h),this.element.appendChild(o)),this.element.appendChild(a),this.table.options.printFooter&&(l.classList.add("tabulator-print-footer"),c=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof c=="string"?l.innerHTML=c:l.appendChild(c),this.element.appendChild(l)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,a),window.print(),this.cleanup(),window.scrollTo(n,r),this.manualBlock=!1}}qv.moduleName="print";class $v extends se{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var t=this,i;this.currentVersion++,i=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),r;return!t.blocked&&i===t.currentVersion&&(t.block("data-push"),n.forEach(o=>{t.table.rowManager.addRowActual(o,!1)}),r=t.origFuncs.push.apply(e,arguments),t.unblock("data-push")),r}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),r;return!t.blocked&&i===t.currentVersion&&(t.block("data-unshift"),n.forEach(o=>{t.table.rowManager.addRowActual(o,!0)}),r=t.origFuncs.unshift.apply(e,arguments),t.unblock("data-unshift")),r}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var n,r;return!t.blocked&&i===t.currentVersion&&(t.block("data-shift"),t.data.length&&(n=t.table.rowManager.getRowFromDataObject(t.data[0]),n&&n.deleteActual()),r=t.origFuncs.shift.call(e),t.unblock("data-shift")),r}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var n,r;return!t.blocked&&i===t.currentVersion&&(t.block("data-pop"),t.data.length&&(n=t.table.rowManager.getRowFromDataObject(t.data[t.data.length-1]),n&&n.deleteActual()),r=t.origFuncs.pop.call(e),t.unblock("data-pop")),r}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var n=Array.from(arguments),r=n[0]<0?e.length+n[0]:n[0],o=n[1],l=n[2]?n.slice(2):!1,a,h;if(!t.blocked&&i===t.currentVersion){if(t.block("data-splice"),l&&(a=e[r]?t.table.rowManager.getRowFromDataObject(e[r]):!1,a?l.forEach(u=>{t.table.rowManager.addRowActual(u,!0,a,!0)}):(l=l.slice().reverse(),l.forEach(u=>{t.table.rowManager.addRowActual(u,!0,!1,!0)}))),o!==0){var c=e.slice(r,typeof n[1]>"u"?n[1]:r+o);c.forEach((u,d)=>{var f=t.table.rowManager.getRowFromDataObject(u);f&&f.deleteActual(d!==c.length-1)})}(l||o!==0)&&t.table.rowManager.reRenderInPosition(),h=t.origFuncs.splice.apply(e,arguments),t.unblock("data-splice")}return h}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var t=e.getData();for(var i in t)this.watchKey(e,t,i);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var t=this,i=e.getData()[this.table.options.dataTreeChildField],n={};i&&(n.push=i.push,Object.defineProperty(i,"push",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-push");var r=n.push.apply(i,arguments);this.rebuildTree(e),t.unblock("tree-push")}return r}}),n.unshift=i.unshift,Object.defineProperty(i,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-unshift");var r=n.unshift.apply(i,arguments);this.rebuildTree(e),t.unblock("tree-unshift")}return r}}),n.shift=i.shift,Object.defineProperty(i,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-shift");var r=n.shift.call(i);this.rebuildTree(e),t.unblock("tree-shift")}return r}}),n.pop=i.pop,Object.defineProperty(i,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-pop");var r=n.pop.call(i);this.rebuildTree(e),t.unblock("tree-pop")}return r}}),n.splice=i.splice,Object.defineProperty(i,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!t.blocked){t.block("tree-splice");var r=n.splice.apply(i,arguments);this.rebuildTree(e),t.unblock("tree-splice")}return r}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,t,i){var n=this,r=Object.getOwnPropertyDescriptor(t,i),o=t[i],l=this.currentVersion;Object.defineProperty(t,i,{set:a=>{if(o=a,!n.blocked&&l===n.currentVersion){n.block("key");var h={};h[i]=a,e.updateData(h),n.unblock("key")}r.set&&r.set(a)},get:()=>(r.get&&r.get(),o)})}unwatchRow(e){var t=e.getData();for(var i in t)Object.defineProperty(t,i,{value:t[i]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}$v.moduleName="reactiveData";class Kv extends se{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var t=e.prevColumn();this.reinitializeColumn(e),t&&this.reinitializeColumn(t)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(t=>{this.reinitializeColumn(t)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(t=>{this.reinitializeColumn(t)}))}frozenColumnOffset(e){var t=!1;return e.modules.frozen&&(t=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?t+=e.getWidth()-3:t&&(t-=3)),t!==!1?t+"px":!1}reinitializeColumn(e){var t=this.frozenColumnOffset(e);e.cells.forEach(i=>{i.modules.resize&&i.modules.resize.handleEl&&(t&&(i.modules.resize.handleEl.style[e.modules.frozen.position]=t,i.modules.resize.handleEl.style["z-index"]=11),i.element.after(i.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(t&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=t),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,t,i,n){var r=this,o=!1,l=i.definition.resizable,a={},h=i.getLastColumn();if(e==="header"&&(o=i.definition.formatter=="textarea"||i.definition.variableHeight,a={variableHeight:o}),(l===!0||l==e)&&this._checkResizability(h)){var c=document.createElement("span");c.className="tabulator-col-resize-handle",c.addEventListener("click",function(d){d.stopPropagation()});var u=function(d){r.startColumn=i,r.initialNextColumn=r.nextColumn=h.nextColumn(),r._mouseDown(d,h,c)};c.addEventListener("mousedown",u),c.addEventListener("touchstart",u,{passive:!0}),c.addEventListener("dblclick",d=>{var f=h.getWidth();d.stopPropagation(),h.reinitializeWidth(!0),f!==h.getWidth()&&(r.dispatch("column-resized",h),r.table.externalEvents.dispatch("columnResized",h.getComponent()))}),i.modules.frozen&&(c.style.position="sticky",c.style[i.modules.frozen.position]=this.frozenColumnOffset(i)),a.handleEl=c,n.parentNode&&i.visible&&n.after(c)}t.modules.resize=a}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(t=>{this.deInitializeComponent(t)})}deInitializeComponent(e){var t;e.modules.resize&&(t=e.modules.resize.handleEl,t&&t.parentElement&&t.parentElement.removeChild(t))}resizeHandle(e,t){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=t)}_checkResizability(e){return e.definition.resizable}_mouseDown(e,t,i){var n=this;n.table.element.classList.add("tabulator-block-select");function r(l){var a=typeof l.screenX>"u"?l.touches[0].screenX:l.screenX,h=a-n.startX,c=a-n.latestX,u,d;if(n.latestX=a,n.table.rtl&&(h=-h,c=-c),u=t.width==t.minWidth||t.width==t.maxWidth,t.setWidth(n.startWidth+h),d=t.width==t.minWidth||t.width==t.maxWidth,c<0&&(n.nextColumn=n.initialNextColumn),n.table.options.resizableColumnFit&&n.nextColumn&&!(u&&d)){let f=n.nextColumn.getWidth();c>0&&f<=n.nextColumn.minWidth&&(n.nextColumn=n.nextColumn.nextColumn()),n.nextColumn&&n.nextColumn.setWidth(n.nextColumn.getWidth()-c)}n.table.columnManager.rerenderColumns(!0),!n.table.browserSlow&&t.modules.resize&&t.modules.resize.variableHeight&&t.checkCellHeights()}function o(l){n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!1),n.table.browserSlow&&t.modules.resize&&t.modules.resize.variableHeight&&t.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",r),i.removeEventListener("touchmove",r),i.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.startWidth!==t.getWidth()&&(n.table.columnManager.verticalAlignHeaders(),n.dispatch("column-resized",t),n.table.externalEvents.dispatch("columnResized",t.getComponent()))}e.stopPropagation(),n.startColumn.modules.edit&&(n.startColumn.modules.edit.blocked=!0),n.startX=typeof e.screenX>"u"?e.touches[0].screenX:e.screenX,n.latestX=n.startX,n.startWidth=t.getWidth(),document.body.addEventListener("mousemove",r),document.body.addEventListener("mouseup",o),i.addEventListener("touchmove",r,{passive:!0}),i.addEventListener("touchend",o)}}Kv.moduleName="resizeColumns";class Yv extends se{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var t=this,i=e.getElement(),n=document.createElement("div");n.className="tabulator-row-resize-handle";var r=document.createElement("div");r.className="tabulator-row-resize-handle prev",n.addEventListener("click",function(a){a.stopPropagation()});var o=function(a){t.startRow=e,t._mouseDown(a,e,n)};n.addEventListener("mousedown",o),n.addEventListener("touchstart",o,{passive:!0}),r.addEventListener("click",function(a){a.stopPropagation()});var l=function(a){var h=t.table.rowManager.prevDisplayRow(e);h&&(t.startRow=h,t._mouseDown(a,h,r))};r.addEventListener("mousedown",l),r.addEventListener("touchstart",l,{passive:!0}),i.appendChild(n),i.appendChild(r)}_mouseDown(e,t,i){var n=this;n.table.element.classList.add("tabulator-block-select");function r(l){t.setHeight(n.startHeight+((typeof l.screenY>"u"?l.touches[0].screenY:l.screenY)-n.startY))}function o(l){document.body.removeEventListener("mouseup",r),document.body.removeEventListener("mousemove",r),i.removeEventListener("touchmove",r),i.removeEventListener("touchend",o),n.table.element.classList.remove("tabulator-block-select"),n.dispatchExternal("rowResized",t.getComponent())}e.stopPropagation(),n.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,n.startHeight=t.getHeight(),document.body.addEventListener("mousemove",r),document.body.addEventListener("mouseup",o),i.addEventListener("touchmove",r,{passive:!0}),i.addEventListener("touchend",o)}}Yv.moduleName="resizeRows";class Qv extends se{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,t;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(i=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(i[0].contentRect.height),r=Math.floor(i[0].contentRect.width);(this.tableHeight!=n||this.tableWidth!=r)&&(this.tableHeight=n,this.tableWidth=r,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),t=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(t.getPropertyValue("max-height")||t.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(i=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var n=Math.floor(i[0].contentRect.height),r=Math.floor(i[0].contentRect.width);(this.containerHeight!=n||this.containerWidth!=r)&&(this.containerHeight=n,this.containerWidth=r,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}Qv.moduleName="resizeTable";class Jv extends se{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.table.columnManager.columnsByIndex.forEach((t,i)=>{t.modules.responsive&&t.modules.responsive.order&&t.modules.responsive.visible&&(t.modules.responsive.index=i,e.push(t),!t.visible&&this.mode==="collapse"&&this.hiddenColumns.push(t))}),e=e.reverse(),e=e.sort((t,i)=>{var n=i.modules.responsive.order-t.modules.responsive.order;return n||i.modules.responsive.index-t.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let t of this.table.columnManager.columnsByIndex)if(t.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=t;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var t=e.getDefinition();e.modules.responsive={order:typeof t.responsive>"u"?1:t.responsive,visible:t.visible!==!1}}initializeRow(e){var t;e.type!=="calc"&&(t=document.createElement("div"),t.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:t,open:this.collapseStartOpen},this.collapseStartOpen||(t.style.display="none"))}layoutRow(e){var t=e.getElement();e.modules.responsiveLayout&&(t.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,t){!t&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var t=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!t&&this.collapseHandleColumn.show())}showColumn(e){var t;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(t=this.hiddenColumns.indexOf(e),t>-1&&this.hiddenColumns.splice(t,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let t=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),i=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-t;if(i<0){let n=this.columns[this.index];n?(this.hideColumn(n),this.index++):e=!1}else{let n=this.columns[this.index-1];n&&i>0&&i>=n.getWidth()?(this.showColumn(n),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(t=>{this.generateCollapsedRowContent(t)})}generateCollapsedRowContent(e){var t,i;if(e.modules.responsiveLayout){for(t=e.modules.responsiveLayout.element;t.firstChild;)t.removeChild(t.firstChild);i=this.collapseFormatter(this.generateCollapsedRowData(e)),i&&t.appendChild(i)}}generateCollapsedRowData(e){var t=e.getData(),i=[],n;return this.hiddenColumns.forEach(r=>{var o=r.getFieldValue(t);if(r.definition.title&&r.field)if(r.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let l=function(a){a()};n={value:!1,data:{},getValue:function(){return o},getData:function(){return t},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return r.getComponent()},getTable:()=>this.table},i.push({field:r.field,title:r.definition.title,value:r.modules.format.formatter.call(this.table.modules.format,n,r.modules.format.params,l)})}else i.push({field:r.field,title:r.definition.title,value:o})}),i}formatCollapsedData(e){var t=document.createElement("table");return e.forEach(function(i){var n=document.createElement("tr"),r=document.createElement("td"),o=document.createElement("td"),l,a=document.createElement("strong");r.appendChild(a),this.langBind("columns|"+i.field,function(h){a.innerHTML=h||i.title}),i.value instanceof Node?(l=document.createElement("div"),l.appendChild(i.value),o.appendChild(l)):o.innerHTML=i.value,n.appendChild(r),n.appendChild(o),t.appendChild(n)},this),Object.keys(e).length?t:""}}Jv.moduleName="responsiveLayout";class Xv extends se{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(t,i){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){this.deprecationCheck("selectable","selectableRows",!0),this.deprecationCheck("selectableRollingSelection","selectableRowsRollingSelection",!0),this.deprecationCheck("selectableRangeMode","selectableRowsRangeMode",!0),this.deprecationCheck("selectablePersistence","selectableRowsPersistence",!0),this.deprecationCheck("selectableCheck","selectableRowsCheck",!0)}rowRetrieve(e,t){return e==="selected"?this.selectedRows:t}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var t=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],t&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var t=this,i=t.checkRowSelectability(e),n=e.getElement(),r=function(){setTimeout(function(){t.selecting=!1},50),document.body.removeEventListener("mouseup",r)};e.modules.select={selected:!1},n.classList.toggle("tabulator-selectable",i),n.classList.toggle("tabulator-unselectable",!i),t.checkRowSelectability(e)&&t.table.options.selectableRows&&t.table.options.selectableRows!="highlight"&&(t.table.options.selectableRowsRangeMode==="click"?n.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(n.addEventListener("click",function(o){(!t.table.modExists("edit")||!t.table.modules.edit.getCurrentCell())&&t.table._clearSelection(),t.selecting||t.toggleRow(e)}),n.addEventListener("mousedown",function(o){if(o.shiftKey)return t.table._clearSelection(),t.selecting=!0,t.selectPrev=[],document.body.addEventListener("mouseup",r),document.body.addEventListener("keyup",r),t.toggleRow(e),!1}),n.addEventListener("mouseenter",function(o){t.selecting&&(t.table._clearSelection(),t.toggleRow(e),t.selectPrev[1]==e&&t.toggleRow(t.selectPrev[0]))}),n.addEventListener("mouseout",function(o){t.selecting&&(t.table._clearSelection(),t.selectPrev.unshift(e))})))}handleComplexRowClick(e,t){if(t.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var i=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),n=this.table.rowManager.getDisplayRowIndex(e),r=i<=n?i:n,o=i>=n?i:n,l=this.table.rowManager.getDisplayRows().slice(0),a=l.splice(r,o-r+1);t.ctrlKey||t.metaKey?(a.forEach(h=>{h!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(h):this.toggleRow(h))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&a.length>this.table.options.selectableRows&&(a=a.slice(0,this.table.options.selectableRows)),this.selectRows(a)),this.table._clearSelection()}else t.ctrlKey||t.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var t=[],i,n;switch(typeof e){case"undefined":i=this.table.rowManager.rows;break;case"number":i=this.table.rowManager.findRow(e);break;case"string":i=this.table.rowManager.findRow(e),i||(i=this.table.rowManager.getRows(e));break;default:i=e;break}Array.isArray(i)?i.length&&(i.forEach(r=>{n=this._selectRow(r,!0,!0),n&&t.push(n)}),this._rowSelectionChanged(!1,t)):i&&this._selectRow(i,!1,!0)}_selectRow(e,t,i){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!i&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var n=this.table.rowManager.findRow(e);if(n){if(this.selectedRows.indexOf(n)==-1)return n.getElement().classList.add("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!0,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!0),this.selectedRows.push(n),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!0),this.dispatchExternal("rowSelected",n.getComponent()),this._rowSelectionChanged(t,n),n}else t||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,t){var i=[],n,r;switch(typeof e){case"undefined":n=Object.assign([],this.selectedRows);break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(o=>{r=this._deselectRow(o,!0,!0),r&&i.push(r)}),this._rowSelectionChanged(t,[],i)):n&&this._deselectRow(n,t,!0)}_deselectRow(e,t){var i=this,n=i.table.rowManager.findRow(e),r,o;if(n){if(r=i.selectedRows.findIndex(function(l){return l==n}),r>-1)return o=n.getElement(),o&&o.classList.remove("tabulator-selected"),n.modules.select||(n.modules.select={}),n.modules.select.selected=!1,n.modules.select.checkboxEl&&(n.modules.select.checkboxEl.checked=!1),i.selectedRows.splice(r,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(n,!1),this.dispatchExternal("rowDeselected",n.getComponent()),i._rowSelectionChanged(t,void 0,n),n}else t||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(t){e.push(t.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(t){e.push(t.getComponent())}),e}_rowSelectionChanged(e,t=[],i=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(t)||(t=[t]),t=t.map(n=>n.getComponent()),Array.isArray(i)||(i=[i]),i=i.map(n=>n.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),t,i))}registerRowSelectCheckbox(e,t){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=t}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,t){var i=this.table.modules.dataTree.getChildren(e,!0);if(t)for(let n of i)this._selectRow(n,!0);else for(let n of i)this._deselectRow(n,!0)}}Xv.moduleName="selectRow";function ZD(s,e,t,i,n,r,o){var l=o.alignEmptyValues,a=o.decimalSeparator,h=o.thousandSeparator,c=0;if(s=String(s),e=String(e),h&&(s=s.split(h).join(""),e=e.split(h).join("")),a&&(s=s.split(a).join("."),e=e.split(a).join(".")),s=parseFloat(s),e=parseFloat(e),isNaN(s))c=isNaN(e)?0:-1;else if(isNaN(e))c=1;else return s-e;return(l==="top"&&r==="desc"||l==="bottom"&&r==="asc")&&(c*=-1),c}function eA(s,e,t,i,n,r,o){var l=o.alignEmptyValues,a=0,h;if(!s)a=e?-1:0;else if(!e)a=1;else{switch(typeof o.locale){case"boolean":o.locale&&(h=this.langLocale());break;case"string":h=o.locale;break}return String(s).toLowerCase().localeCompare(String(e).toLowerCase(),h)}return(l==="top"&&r==="desc"||l==="bottom"&&r==="asc")&&(a*=-1),a}function td(s,e,t,i,n,r,o){var l=window.DateTime||luxon.DateTime,a=o.format||"dd/MM/yyyy HH:mm:ss",h=o.alignEmptyValues,c=0;if(typeof l<"u"){if(l.isDateTime(s)||(a==="iso"?s=l.fromISO(String(s)):s=l.fromFormat(String(s),a)),l.isDateTime(e)||(a==="iso"?e=l.fromISO(String(e)):e=l.fromFormat(String(e),a)),!s.isValid)c=e.isValid?-1:0;else if(!e.isValid)c=1;else return s-e;return(h==="top"&&r==="desc"||h==="bottom"&&r==="asc")&&(c*=-1),c}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function tA(s,e,t,i,n,r,o){return o.format||(o.format="dd/MM/yyyy"),td.call(this,s,e,t,i,n,r,o)}function iA(s,e,t,i,n,r,o){return o.format||(o.format="HH:mm"),td.call(this,s,e,t,i,n,r,o)}function sA(s,e,t,i,n,r,o){var l=s===!0||s==="true"||s==="True"||s===1?1:0,a=e===!0||e==="true"||e==="True"||e===1?1:0;return l-a}function nA(s,e,t,i,n,r,o){var l=o.type||"length",a=o.alignEmptyValues,h=0;function c(u){var d;switch(l){case"length":d=u.length;break;case"sum":d=u.reduce(function(f,p){return f+p});break;case"max":d=Math.max.apply(null,u);break;case"min":d=Math.min.apply(null,u);break;case"avg":d=u.reduce(function(f,p){return f+p})/u.length;break}return d}if(!Array.isArray(s))h=Array.isArray(e)?-1:0;else if(!Array.isArray(e))h=1;else return c(e)-c(s);return(a==="top"&&r==="desc"||a==="bottom"&&r==="asc")&&(h*=-1),h}function rA(s,e,t,i,n,r,o){var l=typeof s>"u"?0:1,a=typeof e>"u"?0:1;return l-a}function oA(s,e,t,i,n,r,o){var l,a,h,c,u=0,d,f=/(\d+)|(\D+)/g,p=/\d/,m=o.alignEmptyValues,g=0;if(!s&&s!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(s)&&isFinite(e))return s-e;if(l=String(s).toLowerCase(),a=String(e).toLowerCase(),l===a)return 0;if(!(p.test(l)&&p.test(a)))return l>a?1:-1;for(l=l.match(f),a=a.match(f),d=l.length>a.length?a.length:l.length;u<d;)if(h=l[u],c=a[u++],h!==c)return isFinite(h)&&isFinite(c)?(h.charAt(0)==="0"&&(h="."+h),c.charAt(0)==="0"&&(c="."+c),h-c):h>c?1:-1;return l.length>a.length}return(m==="top"&&r==="desc"||m==="bottom"&&r==="asc")&&(g*=-1),g}var lA={number:ZD,string:eA,date:tA,time:iA,datetime:td,boolean:sA,array:nA,exists:rA,alphanum:oA};class sn extends se{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,t,i,n){var r=this.getSort();return r.forEach(o=>{delete o.column}),n.sort=r,n}userSetSort(e,t){this.setSort(e,t),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var t=!1,i,n;switch(typeof e.definition.sorter){case"string":sn.sorters[e.definition.sorter]?t=sn.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":t=e.definition.sorter;break}if(e.modules.sort={sorter:t,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(i=e.getElement(),i.classList.add("tabulator-sortable"),n=document.createElement("div"),n.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":n.classList.add("tabulator-col-sorter-element");break;case"header":i.classList.add("tabulator-col-sorter-element");break;default:i.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":n.appendChild(this.table.options.headerSortElement);break;default:n.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(n),e.modules.sort.element=n,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&n.addEventListener("mousedown",r=>{r.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?n:i).addEventListener("click",r=>{var o="",l=[],a=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?o=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?o=e.modules.sort.dir=="asc"?"desc":"asc":o="none";else switch(e.modules.sort.dir){case"asc":o="desc";break;case"desc":o="asc";break;default:o=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(r.shiftKey||r.ctrlKey)?(l=this.getSort(),a=l.findIndex(h=>h.field===e.getField()),a>-1?(l[a].dir=o,a=l.splice(a,1)[0],o!="none"&&l.push(a)):o!="none"&&l.push({column:e,dir:o}),this.setSort(l)):o=="none"?this.clear():this.setSort(e,o),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,t=[];return e.sortList.forEach(function(i){i.column&&t.push({column:i.column.getComponent(),field:i.column.getField(),dir:i.dir})}),t}setSort(e,t){var i=this,n=[];Array.isArray(e)||(e=[{column:e,dir:t}]),e.forEach(function(r){var o;o=i.table.columnManager.findColumn(r.column),o?(r.column=o,n.push(r),i.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",r.column)}),i.sortList=n,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var t=this.table.rowManager.activeRows[0],i="string",n,r;if(t&&(t=t.getData(),n=e.getField(),n))switch(r=e.getFieldValue(t),typeof r){case"undefined":i="string";break;case"boolean":i="boolean";break;default:!isNaN(r)&&r!==""?i="number":r.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(i="alphanum");break}return sn.sorters[i]}sort(e){var t=this,i=this.table.options.sortOrderReverse?t.sortList.slice().reverse():t.sortList,n=[],r=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",t.getSort()),t.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(i.forEach(function(o,l){var a;o.column&&(a=o.column.modules.sort,a&&(a.sorter||(a.sorter=t.findSorter(o.column)),o.params=typeof a.params=="function"?a.params(o.column.getComponent(),o.dir):a.params,n.push(o)),t.setColumnHeader(o.column,o.dir))}),n.length&&t._sortItems(e,n)):i.forEach(function(o,l){t.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{r.push(o.getComponent())}),this.dispatchExternal("dataSorted",t.getSort(),r)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,t){e.modules.sort.dir=t,e.getElement().setAttribute("aria-sort",t==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,t)}setColumnHeaderSortIcon(e,t){var i=e.modules.sort.element,n;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;i.firstChild;)i.removeChild(i.firstChild);n=this.table.options.headerSortElement.call(this.table,e.getComponent(),t),typeof n=="object"?i.appendChild(n):i.innerHTML=n}}_sortItems(e,t){var i=t.length-1;e.sort((n,r)=>{for(var o,l=i;l>=0;l--){let a=t[l];if(o=this._sortRow(n,r,a.column,a.dir,a.params),o!==0)break}return o})}_sortRow(e,t,i,n,r){var o,l,a=n=="asc"?e:t,h=n=="asc"?t:e;return e=i.getFieldValue(a.getData()),t=i.getFieldValue(h.getData()),e=typeof e<"u"?e:"",t=typeof t<"u"?t:"",o=a.getComponent(),l=h.getComponent(),i.modules.sort.sorter.call(this,e,t,o,l,i.getComponent(),n,r)}}sn.moduleName="sort";sn.sorters=lA;class aA{constructor(e){return this._range=e,new Proxy(this,{get:function(t,i,n){return typeof t[i]<"u"?t[i]:t._range.table.componentFunctionBinder.handle("range",t._range,i)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,t){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,t&&t._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class hA extends gt{constructor(e,t,i,n){super(e),this.rangeManager=t,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.initElement(),setTimeout(()=>{this.initBounds(i,n)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,t){this._updateMinMax(),e&&this.setBounds(e,t||e)}setStart(e,t){(this.start.row!==e||this.start.col!==t)&&(this.start.row=e,this.start.col=t,this.initializing.start=!0,this._updateMinMax())}setEnd(e,t){(this.end.row!==e||this.end.col!==t)&&(this.end.row=e,this.end.col=t,this.initializing.end=!0,this._updateMinMax())}setBounds(e,t,i){e&&this.setStartBound(e),this.setEndBound(t||e),this.rangeManager.layoutElement(i)}setStartBound(e){var t,i;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-2):(t=e.row.position-1,i=e.column.getPosition()-2,e.column===this.rangeManager.rowHeader?this.setStart(t,0):this.setStart(t,i))}setEndBound(e){var t=this._getTableRows().length,i,n,r;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(t-1,e.getPosition()-2):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-2)):(i=e.row.position-1,n=e.column.getPosition()-2,r=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(i,this._getTableColumns().length-2):this.rangeManager.selecting!=="row"&&r?this.setEnd(i,0):this.rangeManager.selecting==="column"?this.setEnd(t-1,n):this.setEnd(i,n))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows()}layout(){var e=this.table.rowManager.renderer.vDomTop,t=this.table.rowManager.renderer.vDomBottom,i=this.table.columnManager.renderer.leftCol,n=this.table.columnManager.renderer.rightCol,r,o,l,a,h,c;e==null&&(e=0),t==null&&(t=1/0),i==null&&(i=0),n==null&&(n=1/0),this.overlaps(i,e,n,t)&&(r=Math.max(this.top,e),o=Math.min(this.bottom,t),l=Math.max(this.left,i),a=Math.min(this.right,n),h=this.rangeManager.getCell(r,l),c=this.rangeManager.getCell(o,a),this.element.classList.add("tabulator-range-active"),this.element.style.left=h.row.getElement().offsetLeft+h.getElement().offsetLeft+"px",this.element.style.top=h.row.getElement().offsetTop+"px",this.element.style.width=c.getElement().offsetLeft+c.getElement().offsetWidth-h.getElement().offsetLeft+"px",this.element.style.height=c.row.getElement().offsetTop+c.row.getElement().offsetHeight-h.row.getElement().offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-2===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-2===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-2&&e.getPosition()-2<=this.right}overlaps(e,t,i,n){return!(this.left>i||e>this.right||this.top>n||t>this.bottom)}getData(){var e=[],t=this.getRows(),i=this.getColumns();return t.forEach(n=>{var r=n.getData(),o={};i.forEach(l=>{o[l.field]=r[l.field]}),e.push(o)}),e}getCells(e,t){var i=[],n=this.getRows(),r=this.getColumns();return e?i=n.map(o=>{var l=[];return o.getCells().forEach(a=>{r.includes(a.column)&&l.push(t?a.getComponent():a)}),l}):n.forEach(o=>{o.getCells().forEach(l=>{r.includes(l.column)&&i.push(t?l.getComponent():l)})}),i}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left+1,this.right+2)}clearValues(){var e=this.getCells(),t=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(i=>{i.setValue(t)}),this.table.restoreRedraw()}getBounds(e){var t=this.getCells(!1,e),i={start:null,end:null};return t.length?(i.start=t[0],i.end=t[t.length-1]):console.warn("No bounds defined on range"),i}getComponent(){return this.component||(this.component=new aA(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}class Zv extends se{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior"),e.modules.edit}updateHeaderColumn(){this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior")))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,t){return e=e?e._cell:null,t=t?t._cell:null,this.addRange(e,t)}cellGetRanges(e){var t=[];return e.column===this.rowHeader?t=this.ranges.filter(i=>i.occupiesRow(e.row)):t=this.ranges.filter(i=>i.occupies(e)),t.map(i=>i.getComponent())}rowGetRanges(e){var t=this.ranges.filter(i=>i.occupiesRow(e));return t.map(i=>i.getComponent())}colGetRanges(e){var t=this.ranges.filter(i=>i.occupiesColumn(e));return t.map(i=>i.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var t;try{document.selection?(t=document.body.createTextRange(),t.moveToElementText(e.getElement()),t.select()):window.getSelection&&(t=document.createRange(),t.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(t))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var t;this.selecting!=="column"&&this.selecting!=="all"||(t=this.ranges.some(i=>i.occupiesColumn(e)),t&&this.ranges.forEach(i=>{var n=i.getColumns(!0);n.forEach(r=>{r!==e&&r.setWidth(e.width)})}))}handleColumnMouseDown(e,t){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(t)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,t))}handleColumnMouseMove(e,t){t===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,t,!0)}renderCell(e){var t=e.getElement(),i=this.ranges.findIndex(n=>n.occupies(e));t.classList.toggle("tabulator-range-selected",i!==-1),t.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),t.dataset.range=i}handleCellMouseDown(e,t){e.button===2&&(this.activeRange.occupies(t)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(t.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,t))}handleCellMouseMove(e,t){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,t,!0)}handleCellClick(e,t){this.initializeFocus(t)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,t){this.navigate(!1,!1,e)&&t.preventDefault()}keyNavigateRange(e,t,i,n){this.navigate(i,n,t)&&e.preventDefault()}navigate(e,t,i){var n=!1,r,o,l,a,h,c;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(u=>u===this.activeRange?(u.setEnd(u.start.row,u.start.col),!0):(u.destroy(),!1))),r=this.activeRange,o=t?r.end:r.start,l=o.row,a=o.col,e)switch(i){case"left":a=this.findJumpCellLeft(r.start.row,o.col);break;case"right":a=this.findJumpCellRight(r.start.row,o.col);break;case"up":l=this.findJumpCellUp(o.row,r.start.col);break;case"down":l=this.findJumpCellDown(o.row,r.start.col);break}else{if(t&&(this.selecting==="row"&&(i==="left"||i==="right")||this.selecting==="column"&&(i==="up"||i==="down")))return;switch(i){case"left":a=Math.max(a-1,0);break;case"right":a=Math.min(a+1,this.getTableColumns().length-2);break;case"up":l=Math.max(l-1,0);break;case"down":l=Math.min(l+1,this.getTableRows().length-1);break}}if(n=a!==o.col||l!==o.row,t||r.setStart(l,a),r.setEnd(l,a),t||(this.selecting="cell"),n)return h=this.getRowByRangePos(r.end.row),c=this.getColumnByRangePos(r.end.col),(i==="left"||i==="right")&&c.getElement().parentNode===null?c.getComponent().scrollTo(void 0,!1):(i==="up"||i==="down")&&h.getElement().parentNode===null?h.getComponent().scrollTo(void 0,!1):this.autoScroll(r,h.getElement(),c.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(t=>t!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpCell(e,t,i,n){var r;t&&(e=e.reverse());for(let o of e){let l=o.getValue();if(i){if(r=o,l)break}else if(n){if(r=o,l)break}else if(l)r=o;else break}return r}findJumpCellLeft(e,t){var i=this.getRowByRangePos(e),n=i.cells.filter(h=>h.column.visible),r=!n[t+1].getValue(),o=n[t]?!n[t].getValue():!1,l=t,a=this.findJumpCell(n.slice(0,t),!0,r,o);return a&&(l=a.column.getPosition()-2),l}findJumpCellRight(e,t){var i=this.getRowByRangePos(e),n=i.cells.filter(h=>h.column.visible),r=!n[t+1].getValue(),o=n[t+2]?!n[t+2].getValue():!1,l=t,a=this.findJumpCell(n.slice(t+2,n.length),!1,r,o);return a&&(l=a.column.getPosition()-2),l}findJumpCellUp(e,t){var i=this.getColumnByRangePos(t),n=i.cells.filter(h=>this.table.rowManager.activeRows.includes(h.row)),r=!n[e].getValue(),o=n[e-1]?!n[e-1].getValue():!1,l=e,a=this.findJumpCell(n.slice(0,l),!0,r,o);return a&&(l=a.row.position-1),l}findJumpCellDown(e,t){var i=this.getColumnByRangePos(t),n=i.cells.filter(h=>this.table.rowManager.activeRows.includes(h.row)),r=!n[e].getValue(),o=n[e+1]?!n[e+1].getValue():!1,l=e,a=this.findJumpCell(n.slice(l+1,n.length),!1,r,o);return a&&(l=a.row.position-1),l}newSelection(e,t){var i;if(t.type==="column"){if(!this.columnSelection)return;if(t===this.rowHeader){i=this.resetRanges(),this.selecting="all";const n=this.getCell(0,0),r=this.getCell(-1,-1);i.setBounds(n,r);return}else this.selecting="column"}else t.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,t):e.ctrlKey?this.addRange().setBounds(t):this.resetRanges().setBounds(t)}autoScroll(e,t,i){var n=this.table.rowManager.element,r=this.rowHeader.getElement(),o,l,a,h;typeof t>"u"&&(t=this.getRowByRangePos(e.end.row).getElement()),typeof i>"u"&&(i=this.getColumnByRangePos(e.end.col).getElement()),o={left:i.offsetLeft,right:i.offsetLeft+i.offsetWidth,top:t.offsetTop,bottom:t.offsetTop+t.offsetHeight},l={left:n.scrollLeft+r.offsetWidth,right:Math.ceil(n.scrollLeft+n.clientWidth),top:n.scrollTop,bottom:n.scrollTop+n.offsetHeight-this.table.rowManager.scrollbarWidth},a=l.left<o.left&&o.left<l.right&&l.left<o.right&&o.right<l.right,h=l.top<o.top&&o.top<l.bottom&&l.top<o.bottom&&o.bottom<l.bottom,a||(o.left<l.left?n.scrollLeft=o.left-r.offsetWidth:o.right>l.right&&(n.scrollLeft=o.right-n.clientWidth)),h||(o.top<l.top?n.scrollTop=o.top:o.bottom>l.bottom&&(n.scrollTop=o.bottom-n.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var t;e?t=this.table.rowManager.getVisibleRows(!0):t=this.table.rowManager.getRows(),t.forEach(i=>{i.type==="row"&&(this.layoutRow(i),i.cells.forEach(n=>this.renderCell(n)))}),this.getTableColumns().forEach(i=>{this.layoutColumn(i)}),this.layoutRanges()}layoutRow(e){var t=e.getElement(),i=!1,n=this.ranges.some(r=>r.occupiesRow(e));this.selecting==="row"?i=n:this.selecting==="all"&&(i=!0),t.classList.toggle("tabulator-range-selected",i),t.classList.toggle("tabulator-range-highlight",n)}layoutColumn(e){var t=e.getElement(),i=!1,n=this.ranges.some(r=>r.occupiesColumn(e));this.selecting==="column"?i=n:this.selecting==="all"&&(i=!0),t.classList.toggle("tabulator-range-selected",i),t.classList.toggle("tabulator-range-highlight",n)}layoutRanges(){var e;this.table.initialized&&(e=this.getActiveCell(),e&&(this.activeRangeCellElement.style.left=e.row.getElement().offsetLeft+e.getElement().offsetLeft+"px",this.activeRangeCellElement.style.top=e.row.getElement().offsetTop+"px",this.activeRangeCellElement.style.width=e.getElement().offsetLeft+e.getElement().offsetWidth-e.getElement().offsetLeft+"px",this.activeRangeCellElement.style.height=e.row.getElement().offsetTop+e.row.getElement().offsetHeight-e.row.getElement().offsetTop+"px",this.ranges.forEach(t=>t.layout()),this.overlay.style.visibility="visible"))}getCell(e,t){var i;return t<0&&(t=this.getTableColumns().length+t-1,t<0)?null:(e<0&&(e=this.getTableRows().length+e),i=this.table.rowManager.getRowFromPosition(e+1),i?i.getCells(!1,!0).filter(n=>n.column.visible)[t+1]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e+1]}getTableRows(){return this.table.rowManager.getDisplayRows()}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,t){var i;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),i=new hA(this.table,this,e,t),this.activeRange=i,this.ranges.push(i),this.rangeContainer.appendChild(i.element),i}resetRanges(){var e,t;return this.ranges.forEach(i=>i.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(t=this.table.rowManager.activeRows[0].cells[this.rowHeader?1:0],t&&(e.setBounds(t),this.initializeFocus(t))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(t=>t.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(t=>t.getComponent()):this.activeRange.getColumns()}}Zv.moduleName="selectRange";class ew extends se{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipGenerationMode",void 0),this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){this.deprecationCheckMsg("tooltipGenerationMode","This option is no longer needed as tooltips are always generated on hover now")}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,t,i){var n=e==="tooltip"?i.column.definition.tooltip:i.definition.headerTooltip;n&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,t,i,n),this.table.options.tooltipDelay))}mouseoutCheck(e,t,i){this.popupInstance||this.clearPopup()}clearPopup(e,t,i){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,t,i){var n,r,o;function l(a){r=a}typeof i=="function"&&(i=i(e,t.getComponent(),l)),i instanceof HTMLElement?n=i:(n=document.createElement("div"),i===!0&&(t instanceof vo?i=t.value:t.definition.field?this.langBind("columns|"+t.definition.field,a=>{n.innerHTML=i=a||t.definition.title}):i=t.definition.title),n.innerHTML=i),(i||i===0||i===!1)&&(n.classList.add("tabulator-tooltip"),n.addEventListener("mousemove",a=>a.preventDefault()),this.popupInstance=this.popup(n),typeof r=="function"&&this.popupInstance.renderCallback(r),o=this.popupInstance.containerEventCoords(e),this.popupInstance.show(o.x+15,o.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",t.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",t.getComponent()))}}ew.moduleName="tooltip";var cA={integer:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(s,e,t){if(e===""||e===null||typeof e>"u")return!0;var i=new RegExp(/^[a-z0-9]+$/i);return i.test(e)},max:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=t},min:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=t},starts:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(t).toLowerCase())},ends:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(t).toLowerCase())},minLength:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).length>=t},maxLength:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:String(e).length<=t},in:function(s,e,t){return e===""||e===null||typeof e>"u"?!0:(typeof t=="string"&&(t=t.split("|")),t.indexOf(e)>-1)},regex:function(s,e,t){if(e===""||e===null||typeof e>"u")return!0;var i=new RegExp(t);return i.test(e)},unique:function(s,e,t){if(e===""||e===null||typeof e>"u")return!0;var i=!0,n=s.getData(),r=s.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(o){var l=o.getData();l!==n&&e==r.getFieldValue(l)&&(i=!1)}),i},required:function(s,e,t){return e!==""&&e!==null&&typeof e<"u"}};class Eo extends se{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,t,i){var n=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,t):!0;return n!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),t,n)}),n}editorClear(e,t){t&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var t=[];return e.cells.forEach(i=>{this.cellValidate(i)!==!0&&t.push(i.getComponent())}),t.length?t:!0}rowValidate(e){var t=[];return e.cells.forEach(i=>{this.cellValidate(i)!==!0&&t.push(i.getComponent())}),t.length?t:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(t=>{this.clearValidation(t._getSelf())})}userValidate(e){var t=[];return this.table.rowManager.rows.forEach(i=>{i=i.getComponent();var n=i.validate();n!==!0&&(t=t.concat(n))}),t.length?t:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var t=this,i=[],n;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(r=>{n=t._extractValidator(r),n&&i.push(n)}):(n=this._extractValidator(e.definition.validator),n&&i.push(n)),e.modules.validate=i.length?i:!1)}_extractValidator(e){var t,i,n;switch(typeof e){case"string":return n=e.indexOf(":"),n>-1?(t=e.substring(0,n),i=e.substring(n+1)):t=e,this._buildValidator(t,i);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,t){var i=typeof e=="function"?e:Eo.validators[e];return i?{type:typeof e=="function"?"function":e,func:i,params:t}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,t,i){var n=this,r=[],o=this.invalidCells.indexOf(t);return e&&e.forEach(l=>{l.func.call(n,t.getComponent(),i,l.params)||r.push({type:l.type,parameters:l.params})}),t.modules.validate||(t.modules.validate={}),r.length?(t.modules.validate.invalid=r,this.table.options.validationMode!=="manual"&&t.getElement().classList.add("tabulator-validation-fail"),o==-1&&this.invalidCells.push(t)):(t.modules.validate.invalid=!1,t.getElement().classList.remove("tabulator-validation-fail"),o>-1&&this.invalidCells.splice(o,1)),r.length?r:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(t=>{e.push(t.getComponent())}),e}clearValidation(e){var t;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,t=this.invalidCells.indexOf(e),t>-1&&this.invalidCells.splice(t,1))}}Eo.moduleName="validate";Eo.validators=cA;var uA=Object.freeze({__proto__:null,AccessorModule:er,AjaxModule:ii,ClipboardModule:hn,ColumnCalcsModule:ms,DataTreeModule:Bv,DownloadModule:tr,EditModule:wo,ExportModule:Fv,FilterModule:$i,FormatModule:Ht,FrozenColumnsModule:Pv,FrozenRowsModule:Nv,GroupRowsModule:zv,HistoryModule:cn,HtmlTableImportModule:Hv,ImportModule:Co,InteractionModule:Vv,KeybindingsModule:vs,MenuModule:Wv,MoveColumnsModule:Uv,MoveRowsModule:Ua,MutatorModule:ir,PageModule:ed,PersistenceModule:yt,PopupModule:Gv,PrintModule:qv,ReactiveDataModule:$v,ResizeColumnsModule:Kv,ResizeRowsModule:Yv,ResizeTableModule:Qv,ResponsiveLayoutModule:Jv,SelectRowModule:Xv,SortModule:sn,SelectRangeModule:Zv,TooltipModule:ew,ValidateModule:Eo}),dA={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class tw{constructor(e,t,i={}){this.table=e,this.msgType=t,this.registeredDefaults=Object.assign({},i)}register(e,t){this.registeredDefaults[e]=t}generate(e,t={}){var i=Object.assign({},this.registeredDefaults),n=this.table.options.debugInvalidOptions||t.debugInvalidOptions===!0;Object.assign(i,e);for(let r in t)i.hasOwnProperty(r)||(n&&console.warn("Invalid "+this.msgType+" option:",r),i[r]=t.key);for(let r in i)r in t?i[r]=t[r]:Array.isArray(i[r])?i[r]=Object.assign([],i[r]):typeof i[r]=="object"&&i[r]!==null?i[r]=Object.assign({},i[r]):typeof i[r]>"u"&&delete i[r];return i}}class ja extends gt{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,t){}renderRowCells(e){}rerenderRowCells(e,t){}scrollColumns(e,t){}scrollRows(e,t){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,t){var i=e.getElement();t%2?(i.classList.add("tabulator-row-even"),i.classList.remove("tabulator-row-odd")):(i.classList.add("tabulator-row-odd"),i.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,t,i){var n=this.rows().indexOf(e),r=e.getElement(),o=0;return new Promise((l,a)=>{if(n>-1){if(typeof i>"u"&&(i=this.table.options.scrollToRowIfVisible),!i&&Te.elVisible(r)&&(o=Te.elOffset(r).top-Te.elOffset(this.elementVertical).top,o>0&&o<this.elementVertical.clientHeight-r.offsetHeight))return l(),!1;switch(typeof t>"u"&&(t=this.table.options.scrollToRowPosition),t==="nearest"&&(t=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),t){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(r.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-r.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-r.offsetTop)+r.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+r.offsetHeight;break;case"top":this.elementVertical.scrollTop=r.offsetTop;break}l()}else console.warn("Scroll Error - Row not visible"),a("Scroll Error - Row not visible")})}}class fA extends ja{constructor(e){super(e)}renderRowCells(e,t){const i=document.createDocumentFragment();e.cells.forEach(n=>{i.appendChild(n.getElement())}),e.element.appendChild(i),t||e.cells.forEach(n=>{n.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(t){t.reinitializeWidth()})}}class pA extends ja{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,t){this.dataChange()}scrollColumns(e,t){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(t=>{if(t.visible){var i=t.getWidth();i>e&&(e=i)}}),this.windowBuffer=e*2}rerenderColumns(e,t){var i={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},n=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(r=>{var o={},l;r.visible&&(r.modules.frozen||(l=r.getWidth(),o.leftPos=n,o.rightPos=n+l,o.width=l,this.isFitData&&(o.fitDataCheck=r.modules.vdomHoz?r.modules.vdomHoz.fitDataCheck:!0),n+l>this.vDomScrollPosLeft&&n<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=n),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=l),this.columns.push(r),r.modules.vdomHoz=o,n+=l))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,t||(!e||this.reinitChanged(i))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const t=document.createDocumentFragment();e.cells.forEach(i=>{t.appendChild(i.getElement())}),e.element.appendChild(t),e.cells.forEach(i=>{i.cellRendered()})}}rerenderRowCells(e,t){this.reinitializeRow(e,t)}reinitializeColumnWidths(e){for(let t=this.leftCol;t<=this.rightCol;t++)this.columns[t].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,t,i;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(n=>{!n.definition.width&&n.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,t=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],t)){i=t.getElement(),t.generateCells(),this.tableElement.appendChild(i);for(let n=0;n<t.cells.length;n++){let r=t.cells[n];i.appendChild(r.getElement()),r.column.reinitializeWidth()}i.parentNode.removeChild(i),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var t=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((i,n)=>{i!==this.columns[n]&&(t=!1)}),!t)}reinitializeRows(){var e=this.getVisibleRows(),t=this.table.rowManager.getRows().filter(i=>!e.includes(i));e.forEach(i=>{this.reinitializeRow(i,!0)}),t.forEach(i=>{i.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,t,i){for(let n=e;n<t;n++){let r=this.columns[n];r.modules.vdomHoz.leftPos+=i,r.modules.vdomHoz.rightPos+=i}}addColRight(){for(var e=!1,t=!0;t;){let i=this.columns[this.rightCol+1];i&&i.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var r=n.getCell(i);n.getElement().insertBefore(r.getElement(),n.getCell(this.columns[this.rightCol]).getElement().nextSibling),r.cellRendered()}}),this.fitDataColActualWidthCheck(i),this.rightCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=i.getWidth()):t=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,t=!0;t;){let i=this.columns[this.leftCol-1];if(i)if(i.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var o=r.getCell(i);r.getElement().insertBefore(o.getElement(),r.getCell(this.columns[this.leftCol]).getElement()),o.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=i.getWidth();let n=this.fitDataColActualWidthCheck(i);n&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+n,this.vDomPadRight-=n)}else t=!1;else t=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,t=!0;t;){let i=this.columns[this.rightCol];i&&i.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var r=n.getCell(i);try{n.getElement().removeChild(r.getElement())}catch(o){console.warn("Could not removeColRight",o.message)}}}),this.vDomPadRight+=i.getWidth(),this.rightCol--,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.rightCol=this.rightCol)})):t=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,t=!0;t;){let i=this.columns[this.leftCol];i&&i.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(n=>{if(n.type!=="group"){var r=n.getCell(i);try{n.getElement().removeChild(r.getElement())}catch(o){console.warn("Could not removeColLeft",o.message)}}}),this.vDomPadLeft+=i.getWidth(),this.leftCol++,this.getVisibleRows().forEach(n=>{n.type!=="group"&&(n.modules.vdomHoz.leftCol=this.leftCol)})):t=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var t,i;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),t=e.getWidth(),i=t-e.modules.vdomHoz.width,i&&(e.modules.vdomHoz.rightPos+=i,e.modules.vdomHoz.width=t,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,i)),e.modules.vdomHoz.fitDataCheck=!1),i}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(t=>{this.appendCell(e,t)});for(let t=this.leftCol;t<=this.rightCol;t++)this.appendCell(e,this.columns[t]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(t=>{this.appendCell(e,t)})}}appendCell(e,t){if(t&&t.visible){let i=e.getCell(t);e.getElement().appendChild(i.getElement()),i.cellRendered()}}reinitializeRow(e,t){if(e.type!=="group"&&(t||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var i=e.getElement();i.firstChild;)i.removeChild(i.firstChild);this.initializeRow(e)}}}class mA extends gt{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new tw(this.table,"column definition",Iv),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,t={virtual:pA,basic:fA};typeof this.table.options.renderHorizontal=="string"?e=t[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var t;e.deltaX&&(t=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(t),this.table.columnManager.scrollHorizontal(t))})}generateColumnsFromRowData(e){var t=[],i=this.table.options.autoColumnsDefinitions,n,r;if(e&&e.length){n=e[0];for(var o in n){let l={field:o,title:o},a=n[o];switch(typeof a){case"undefined":r="string";break;case"boolean":r="boolean";break;case"object":Array.isArray(a)?r="array":r="string";break;default:!isNaN(a)&&a!==""?r="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?r="alphanum":r="string";break}l.sorter=r,t.push(l)}if(i)switch(typeof i){case"function":this.table.options.columns=i.call(this.table,t);break;case"object":Array.isArray(i)?t.forEach(l=>{var a=i.find(h=>h.field===l.field);a&&Object.assign(l,a)}):t.forEach(l=>{i[l.field]&&Object.assign(l,i[l.field])}),this.table.options.columns=t;break}else this.table.options.columns=t;this.setColumns(this.table.options.columns)}}setColumns(e,t){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),e.forEach((i,n)=>{this._addColumn(i)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,t,i){var n=new Ii(e,this),r=n.getElement(),o=i&&this.findColumnIndex(i);if(i&&o>-1){var l=i.getTopColumn(),a=this.columns.indexOf(l),h=l.getElement();t?(this.columns.splice(a,0,n),h.parentNode.insertBefore(r,h)):(this.columns.splice(a+1,0,n),h.parentNode.insertBefore(r,h.nextSibling))}else t?(this.columns.unshift(n),this.headersElement.insertBefore(n.getElement(),this.headersElement.firstChild)):(this.columns.push(n),this.headersElement.appendChild(n.getElement()));return n.columnRendered(),n}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(t=>{t.clearVerticalAlign()}),this.columns.forEach(t=>{var i=t.getHeight();i>e&&(e=i)}),this.headersElement.style.height=e+"px",this.columns.forEach(t=>{t.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var t;if(typeof e=="object"){if(e instanceof Ii)return e;if(e instanceof Lv)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return t=[],this.columns.forEach(n=>{t.push(n),t=t.concat(n.getColumns(!0))}),t.find(n=>n.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var t=[];return Object.keys(this.columnsByField).forEach(i=>{var n=this.table.options.nestedFieldSeparator?i.split(this.table.options.nestedFieldSeparator)[0]:i;n===e&&t.push(this.columnsByField[i])}),t}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(t=>t.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(t=>e===t)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((t,i)=>{e(t,i)})}getDefinitions(e){var t=[];return this.columnsByIndex.forEach(i=>{(!e||e&&i.visible)&&t.push(i.getDefinition())}),t}getDefinitionTree(){var e=[];return this.columns.forEach(t=>{e.push(t.getDefinition(!0))}),e}getComponents(e){var t=[],i=e?this.columns:this.columnsByIndex;return i.forEach(n=>{t.push(n.getComponent())}),t}getWidth(){var e=0;return this.columnsByIndex.forEach(t=>{t.visible&&(e+=t.getWidth())}),e}moveColumn(e,t,i){t.element.parentNode.insertBefore(e.element,t.element),i&&t.element.parentNode.insertBefore(t.element,e.element),this.moveColumnActual(e,t,i),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,t,i){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,t,i):this._moveColumnInArray(this.columns,e,t,i),this._moveColumnInArray(this.columnsByIndex,e,t,i,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,t,i),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,t,i,n,r){var o=e.indexOf(t),l,a=[];o>-1&&(e.splice(o,1),l=e.indexOf(i),l>-1?n&&(l=l+1):l=o,e.splice(l,0,t),r&&(a=this.chain("column-moving-rows",[t,i,n],null,[])||[],a=a.concat(this.table.rowManager.rows),a.forEach(function(h){if(h.cells.length){var c=h.cells.splice(o,1)[0];h.cells.splice(l,0,c)}})))}scrollToColumn(e,t,i){var n=0,r=e.getLeftOffset(),o=0,l=e.getElement();return new Promise((a,h)=>{if(typeof t>"u"&&(t=this.table.options.scrollToColumnPosition),typeof i>"u"&&(i=this.table.options.scrollToColumnIfVisible),e.visible){switch(t){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=l.clientWidth-this.headersElement.clientWidth;break}if(!i&&r>0&&r+l.offsetWidth<this.element.clientWidth)return!1;n=r+o,n=Math.max(Math.min(n,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(n),this.scrollHorizontal(n),a()}else console.warn("Scroll Error - Column not visible"),h("Scroll Error - Column not visible")})}generateCells(e){var t=[];return this.columnsByIndex.forEach(i=>{t.push(i.generateCell(e))}),t}getFlexBaseWidth(){var e=this.table.element.clientWidth,t=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(i){var n,r,o;i.visible&&(n=i.definition.width||0,r=parseInt(i.minWidth),typeof n=="string"?n.indexOf("%")>-1?o=e/100*parseInt(n):o=parseInt(n):o=n,t+=o>r?o:r)}),t}addColumn(e,t,i){return new Promise((n,r)=>{var o=this._addColumn(e,t,i);this._reIndexColumns(),this.dispatch("column-add",e,t,i),this.layoutMode()!="fitColumns"&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),n(o)})}deregisterColumn(e){var t=e.getField(),i;t&&delete this.columnsByField[t],i=this.columnsByIndex.indexOf(e),i>-1&&this.columnsByIndex.splice(i,1),i=this.columns.indexOf(e),i>-1&&this.columns.splice(i,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,t){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,t)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){Te.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class gA extends ja{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,t=!0,i=document.createDocumentFragment(),n=this.rows();n.forEach((r,o)=>{this.styleRow(r,o),r.initialize(!1,!0),r.type!=="group"&&(t=!1),i.appendChild(r.getElement())}),e.appendChild(i),n.forEach(r=>{r.rendered(),r.heightInitialized||r.calcHeight(!0)}),n.forEach(r=>{r.heightInitialized||r.setCellHeight()}),t?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var t=Te.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-t)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-t))}scrollToRow(e){var t=e.getElement();this.elementVertical.scrollTop=Te.elOffset(t).top-Te.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class bA extends ja{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var t=this.elementVertical.scrollTop,i=!1,n=!1,r=this.table.rowManager.scrollLeft,o=this.rows(),l=this.vDomTop;l<=this.vDomBottom;l++)if(o[l]){var a=t-o[l].getElement().offsetTop;if(n===!1||Math.abs(a)<n)n=a,i=l;else break}o.forEach(h=>{h.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(i===!1?this.rows.length-1:i,!0,n||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(r)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,t){var i=e-this.vDomScrollPosTop,n=e-this.vDomScrollPosBottom,r=this.vDomWindowBuffer*2,o=this.rows();if(this.scrollTop=e,-i>r||n>r){var l=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(l)}else t?(i<0&&this._addTopRow(o,-i),n<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-n):this.vDomScrollPosBottom=this.scrollTop)):(n>=0&&this._addBottomRow(o,n),i>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,i):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var t=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-t)>Math.abs(this.vDomBottom-t))}scrollToRow(e){var t=this.rows().indexOf(e);t>-1&&this._virtualRenderFill(t,!0)}visibleRows(e){var t=this.elementVertical.scrollTop,i=this.elementVertical.clientHeight+t,n=!1,r=0,o=0,l=this.rows();if(e)r=this.vDomTop,o=this.vDomBottom;else for(var a=this.vDomTop;a<=this.vDomBottom;a++)if(l[a])if(n)if(i-l[a].getElement().offsetTop>=0)o=a;else break;else if(t-l[a].getElement().offsetTop>=0)r=a;else if(n=!0,i-l[a].getElement().offsetTop>=0)o=a;else break;return l.slice(r,o+1)}_virtualRenderFill(e,t,i){var n=this.tableElement,r=this.elementVertical,o=0,l=0,a=0,h=0,c=0,u=0,d=this.rows(),f=d.length,p=0,m,g,b=[],v=0,C=0,x=this.table.rowManager.fixedHeight,w=this.elementVertical.clientHeight,E=this.table.options.rowHeight,k=!0;if(e=e||0,i=i||0,!e)this.clear();else{for(;n.firstChild;)n.removeChild(n.firstChild);h=(f-e+1)*this.vDomRowHeight,h<w&&(e-=Math.ceil((w-h)/this.vDomRowHeight),e<0&&(e=0)),o=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=o}if(f&&Te.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,x||this.table.options.maxHeight?(E&&(C=w/E+this.vDomWindowBuffer/E),C=Math.max(this.vDomWindowMinTotalRows,Math.ceil(C))):C=f;(C==f||l<=w+this.vDomWindowBuffer||v<this.vDomWindowMinTotalRows)&&this.vDomBottom<f-1;){for(b=[],g=document.createDocumentFragment(),u=0;u<C&&this.vDomBottom<f-1;)p=this.vDomBottom+1,m=d[p],this.styleRow(m,p),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),g.appendChild(m.getElement()),b.push(m),this.vDomBottom++,u++;if(!b.length)break;n.appendChild(g),b.forEach(R=>{R.rendered(),R.heightInitialized||R.calcHeight(!0)}),b.forEach(R=>{R.heightInitialized||R.setCellHeight()}),b.forEach(R=>{a=R.getHeight(),v<o?c+=a:l+=a,a>this.vDomWindowBuffer&&(this.vDomWindowBuffer=a*2),v++}),k=this.table.rowManager.adjustTableSize(),w=this.elementVertical.clientHeight,k&&(x||this.table.options.maxHeight)&&(E=l/v,C=Math.max(this.vDomWindowMinTotalRows,Math.ceil(w/E+this.vDomWindowBuffer/E)))}e?(this.vDomTopPad=t?this.vDomRowHeight*this.vDomTop+i:this.scrollTop-c,this.vDomBottomPad=this.vDomBottom==f-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-l-c,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((l+c)/v),this.vDomBottomPad=this.vDomRowHeight*(f-this.vDomBottom-1),this.vDomScrollHeight=c+l+this.vDomBottomPad-w),n.style.paddingTop=this.vDomTopPad+"px",n.style.paddingBottom=this.vDomBottomPad+"px",t&&(this.scrollTop=this.vDomTopPad+c+i-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-w:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-w),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&t&&(this.scrollTop+=this.elementVertical.offsetHeight-w),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,r.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,t){for(var i=this.tableElement,n=[],r=0,o=this.vDomTop-1,l=0,a=!0;a;)if(this.vDomTop){let h=e[o],c,u;h&&l<this.vDomMaxRenderChain?(c=h.getHeight()||this.vDomRowHeight,u=h.initialized,t>=c?(this.styleRow(h,o),i.insertBefore(h.getElement(),i.firstChild),(!h.initialized||!h.heightInitialized)&&n.push(h),h.initialize(),u||(c=h.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),t-=c,r+=c,this.vDomTop--,o--,l++):a=!1):a=!1}else a=!1;for(let h of n)h.clearCellHeight();this._quickNormalizeRowHeight(n),r&&(this.vDomTopPad-=r,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),i.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=r)}_removeTopRow(e,t){for(var i=[],n=0,r=0,o=!0;o;){let l=e[this.vDomTop],a;l&&r<this.vDomMaxRenderChain?(a=l.getHeight()||this.vDomRowHeight,t>=a?(this.vDomTop++,t-=a,n+=a,i.push(l),r++):o=!1):o=!1}for(let l of i){let a=l.getElement();a.parentNode&&a.parentNode.removeChild(a)}n&&(this.vDomTopPad+=n,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?n:n+this.vDomWindowBuffer)}_addBottomRow(e,t){for(var i=this.tableElement,n=[],r=0,o=this.vDomBottom+1,l=0,a=!0;a;){let h=e[o],c,u;h&&l<this.vDomMaxRenderChain?(c=h.getHeight()||this.vDomRowHeight,u=h.initialized,t>=c?(this.styleRow(h,o),i.appendChild(h.getElement()),(!h.initialized||!h.heightInitialized)&&n.push(h),h.initialize(),u||(c=h.getElement().offsetHeight,c>this.vDomWindowBuffer&&(this.vDomWindowBuffer=c*2)),t-=c,r+=c,this.vDomBottom++,o++,l++):a=!1):a=!1}for(let h of n)h.clearCellHeight();this._quickNormalizeRowHeight(n),r&&(this.vDomBottomPad-=r,(this.vDomBottomPad<0||o==e.length-1)&&(this.vDomBottomPad=0),i.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=r)}_removeBottomRow(e,t){for(var i=[],n=0,r=0,o=!0;o;){let l=e[this.vDomBottom],a;l&&r<this.vDomMaxRenderChain?(a=l.getHeight()||this.vDomRowHeight,t>=a?(this.vDomBottom--,t-=a,n+=a,i.push(l),r++):o=!1):o=!1}for(let l of i){let a=l.getElement();a.parentNode&&a.parentNode.removeChild(a)}n&&(this.vDomBottomPad+=n,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=n)}_quickNormalizeRowHeight(e){for(let t of e)t.calcHeight();for(let t of e)t.setCellHeight()}}class yA extends gt{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let t=document.createElement("div");if(t.classList.add("tabulator-placeholder"),typeof e=="string"){let i=document.createElement("div");i.classList.add("tabulator-placeholder-contents"),i.innerHTML=e,t.appendChild(i),this.placeholderContents=i}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(t.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=t}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,t=this.scrollLeft>e,i=this.element.scrollTop,n=this.scrollTop>i;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,t),this.dispatchExternal("scrollHorizontal",e,t),this._positionPlaceholder()),this.scrollTop!=i&&(this.scrollTop=i,this.renderer.scrollRows(i,n),this.dispatch("scroll-vertical",i,n),this.dispatchExternal("scrollVertical",i,n))})}findRow(e){if(typeof e=="object"){if(e instanceof lt)return e;if(e instanceof Va)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(i=>i.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(i=>i.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var t=this.rows.find(i=>i.data===e);return t||!1}getRowFromPosition(e){return this.getDisplayRows().find(t=>t.getPosition()===e&&t.isDisplayed())}scrollToRow(e,t,i){return this.renderer.scrollToRowPosition(e,t,i)}setData(e,t,i){return new Promise((n,r)=>{t&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&i&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),n()})}_setDataActual(e,t){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((i,n)=>{if(i&&typeof i=="object"){var r=new lt(i,this);this.rows.push(r)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",i)}),this.refreshActiveData(!1,!1,t),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,t){var i=this.rows.indexOf(e),n=this.activeRows.indexOf(e);n>-1&&this.activeRows.splice(n,1),i>-1&&this.rows.splice(i,1),this.setActiveRows(this.activeRows),this.displayRowIterator(r=>{var o=r.indexOf(e);o>-1&&r.splice(o,1)}),t||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,t,i,n){var r=this.addRowActual(e,t,i,n);return r}addRows(e,t,i,n){var r=[];return new Promise((o,l)=>{t=this.findAddRowPos(t),Array.isArray(e)||(e=[e]),(typeof i>"u"&&t||typeof i<"u"&&!t)&&e.reverse(),e.forEach((a,h)=>{var c=this.addRow(a,t,i,!0);r.push(c),this.dispatch("row-added",c,a,t,i)}),this.refreshActiveData(n?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(r)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,t,i,n){var r=e instanceof lt?e:new lt(e||{},this),o=this.findAddRowPos(t),l=-1,a,h;return i||(h=this.chain("row-adding-position",[r,o],null,{index:i,top:o}),i=h.index,o=h.top),typeof i<"u"&&(i=this.findRow(i)),i=this.chain("row-adding-index",[r,i,o],null,i),i&&(l=this.rows.indexOf(i)),i&&l>-1?(a=this.activeRows.indexOf(i),this.displayRowIterator(function(c){var u=c.indexOf(i);u>-1&&c.splice(o?u:u+1,0,r)}),a>-1&&this.activeRows.splice(o?a:a+1,0,r),this.rows.splice(o?l:l+1,0,r)):o?(this.displayRowIterator(function(c){c.unshift(r)}),this.activeRows.unshift(r),this.rows.unshift(r)):(this.displayRowIterator(function(c){c.push(r)}),this.activeRows.push(r),this.rows.push(r)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",r.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),n||this.reRenderInPosition(),r}moveRow(e,t,i){this.dispatch("row-move",e,t,i),this.moveRowActual(e,t,i),this.regenerateRowPositions(),this.dispatch("row-moved",e,t,i),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,t,i){this.moveRowInArray(this.rows,e,t,i),this.moveRowInArray(this.activeRows,e,t,i),this.displayRowIterator(n=>{this.moveRowInArray(n,e,t,i)}),this.dispatch("row-moving",e,t,i)}moveRowInArray(e,t,i,n){var r,o,l,a;if(t!==i&&(r=e.indexOf(t),r>-1&&(e.splice(r,1),o=e.indexOf(i),o>-1?n?e.splice(o+1,0,t):e.splice(o,0,t):e.splice(r,0,t)),e===this.getDisplayRows())){l=r<o?r:o,a=o>r?o:r+1;for(let h=l;h<=a;h++)e[h]&&this.styleRow(e[h],h)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var t=this.getDisplayRows().indexOf(e);return t>-1?t:!1}nextDisplayRow(e,t){var i=this.getDisplayRowIndex(e),n=!1;return i!==!1&&i<this.displayRowsCount-1&&(n=this.getDisplayRows()[i+1]),n&&(!(n instanceof lt)||n.type!="row")?this.nextDisplayRow(n,t):n}prevDisplayRow(e,t){var i=this.getDisplayRowIndex(e),n=!1;return i&&(n=this.getDisplayRows()[i-1]),t&&n&&(!(n instanceof lt)||n.type!="row")?this.prevDisplayRow(n,t):n}findRowIndex(e,t){var i;return e=this.findRow(e),e&&(i=t.indexOf(e),i>-1)?i:!1}getData(e,t){var i=[],n=this.getRows(e);return n.forEach(function(r){r.type=="row"&&i.push(r.getData(t||"data"))}),i}getComponents(e){var t=[],i=this.getRows(e);return i.forEach(function(n){t.push(n.getComponent())}),t}getDataCount(e){var t=this.getRows(e);return t.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,t){typeof t<"u"?(this.dataPipeline.push({handler:e,priority:t}),this.dataPipeline.sort((i,n)=>i.priority-n.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,t){typeof t<"u"?(this.displayPipeline.push({handler:e,priority:t}),this.displayPipeline.sort((i,n)=>i.priority-n.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,t,i){var n=this.table,r="",o=0,l=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(o=this.dataPipeline.findIndex(a=>a.handler===e),o>-1)r="dataPipeline",t&&(o==this.dataPipeline.length-1?r="display":o++);else if(o=this.displayPipeline.findIndex(a=>a.handler===e),o>-1)r="displayPipeline",t&&(o==this.displayPipeline.length-1?r="end":o++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else r=e||"all",o=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===r&&o<this.redrawBlockRestoreConfig.index||l.indexOf(r)<l.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:t,renderInPosition:i,stage:r,index:o});return}else Te.elVisible(this.element)?i?this.reRenderInPosition(this.refreshPipelines.bind(this,e,r,o,i)):(this.refreshPipelines(e,r,o,i),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),n.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,r,o,i),this.dispatch("data-refreshed")}}refreshPipelines(e,t,i,n){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),t){case"all":case"dataPipeline":for(let r=i;r<this.dataPipeline.length;r++){let o=this.dataPipeline[r].handler(this.activeRowsPipeline[r].slice(0));this.activeRowsPipeline[r+1]=o||this.activeRowsPipeline[r].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":i=0,this.resetDisplayRows();case"displayPipeline":for(let r=i;r<this.displayPipeline.length;r++){let o=this.displayPipeline[r].handler((r?this.getDisplayRows(r-1):this.activeRows).slice(0),n);this.setDisplayRows(o||this.getDisplayRows(r-1).slice(0),r)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),t=1;e.forEach(i=>{i.type==="row"&&(i.setPosition(t),t++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,t){this.displayRows[t]=e,t==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,t){var i=Object.assign([],this.renderer.visibleRows(!t));return e&&(i=this.chain("rows-visible",[t],i,i)),i}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var t=[];switch(e){case"active":t=this.activeRows;break;case"display":t=this.table.rowManager.getDisplayRows();break;case"visible":t=this.getVisibleRows(!1,!0);break;default:t=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return t}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,t={virtual:bA,basic:gA};typeof this.table.options.renderVertical=="string"?e=t[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,t){var i=e.getElement();t%2?(i.classList.add("tabulator-row-even"),i.classList.remove("tabulator-row-odd")):(i.classList.add("tabulator-row-odd"),i.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,t,i=!1;if(this.renderer.verticalFillMode==="fill"){let n=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){t=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const r="calc(100% - "+n+"px)";this.element.style.minHeight=t||"calc(100% - "+n+"px)",this.element.style.height=r,this.element.style.maxHeight=r}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-n+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(i=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),i}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){const t=this.adjustTableSize();this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(t&&this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class vA extends gt{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class wA extends gt{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(t=>{e[t]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,t,i){this.pseudoTrackers[e].target!==i&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",t,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,t),this.pseudoTrackers[e].target=i,this.dispatch(e+"-mouseenter",t,i))}pseudoMouseLeave(e,t){var i=Object.keys(this.pseudoTrackers),n={row:["cell"],cell:["row"]};i=i.filter(r=>{var o=n[e];return r!==e&&(!o||o&&!o.includes(r))}),i.forEach(r=>{var o=this.pseudoTrackers[r].target;this.pseudoTrackers[r].target&&(this.dispatch(r+"-mouseleave",t,o),this.pseudoTrackers[r].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),t=Object.values(this.componentMap);for(let i of t)for(let n of e){let r=i+"-"+n;this.subscriptionChange(r,this.subscriptionChanged.bind(this,i,n))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,t,i){var n=this.listeners[t].components,r=n.indexOf(e),o=!1;i?r===-1&&(n.push(e),o=!0):this.subscribed(e+"-"+t)||r>-1&&(n.splice(r,1),o=!0),(t==="mouseenter"||t==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let t=this.listeners[e];t.components.length?t.handler||(t.handler=this.track.bind(this,e),this.el.addEventListener(e,t.handler)):t.handler&&(this.el.removeEventListener(e,t.handler),t.handler=null)}}track(e,t){var i=t.composedPath&&t.composedPath()||t.path,n=this.findTargets(i);n=this.bindComponents(e,n),this.triggerEvents(e,t,n),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(n).length&&this.pseudoMouseLeave("none",t)}findTargets(e){var t={};let i=Object.keys(this.componentMap);for(let n of e){let r=n.classList?[...n.classList]:[];if(r.filter(a=>this.abortClasses.includes(a)).length)break;let l=r.filter(a=>i.includes(a));for(let a of l)t[this.componentMap[a]]||(t[this.componentMap[a]]=n)}return t.group&&t.group===t.row&&delete t.row,t}bindComponents(e,t){var i=Object.keys(t).reverse(),n=this.listeners[e],r={},o={};for(let l of i){let a,h=t[l],c=this.previousTargets[l];if(c&&c.target===h)a=c.component;else switch(l){case"row":case"group":(n.components.includes("row")||n.components.includes("cell")||n.components.includes("group"))&&(a=this.table.rowManager.getVisibleRows(!0).find(d=>d.getElement()===h),t.row&&t.row.parentNode&&t.row.parentNode.closest(".tabulator-row")&&(t[l]=!1));break;case"column":n.components.includes("column")&&(a=this.table.columnManager.findColumn(h));break;case"cell":n.components.includes("cell")&&(r.row instanceof lt?a=r.row.findCell(h):t.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}a&&(r[l]=a,o[l]={target:h,component:a})}return this.previousTargets=o,r}triggerEvents(e,t,i){var n=this.listeners[e];for(let r in i)i[r]&&n.components.includes(r)&&this.dispatch(r+"-"+e,t,i[r])}clearWatchers(){for(let e in this.listeners){let t=this.listeners[e];t.handler&&(this.el.removeEventListener(e,t.handler),t.handler=null)}}}class CA{constructor(e){this.table=e,this.bindings={}}bind(e,t,i){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][t]?console.warn("Unable to bind component handler, a matching function name is already bound",e,t,i):this.bindings[e][t]=i}handle(e,t,i){if(this.bindings[e]&&this.bindings[e][i]&&typeof this.bindings[e][i].bind=="function")return this.bindings[e][i].bind(null,t);i!=="then"&&typeof i=="string"&&!i.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+i+" function, have you checked that you have the correct Tabulator module installed?")}}class EA extends gt{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,t,i,n,r,o){var l=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,t,i,r])){this.loading=!0,r||this.alertLoader(),t=this.chain("data-params",[e,i,r],t||{},t||{}),t=this.mapParams(t,this.table.options.dataSendParams);var a=this.chain("data-load",[e,t,i,r],!1,Promise.resolve([]));return a.then(h=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(h)&&typeof h=="object"&&(h=this.mapParams(h,this.objectInvert(this.table.options.dataReceiveParams)));var c=this.chain("data-loaded",h,null,h);l==this.requestOrder?(this.clearAlert(),c!==!1&&(this.dispatchExternal("dataLoaded",c),this.table.rowManager.setData(c,n,typeof o>"u"?!n:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(h=>{console.error("Data Load Error: ",h),this.dispatchExternal("dataLoadError",h),r||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,n,typeof o>"u"?!n:o),Promise.resolve()}mapParams(e,t){var i={};for(let n in e)i[t.hasOwnProperty(n)?t[n]:n]=e[n];return i}objectInvert(e){var t={};for(let i in e)t[e[i]]=i;return t}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class xA{constructor(e,t,i){this.table=e,this.events={},this.optionsList=t||{},this.subscriptionNotifiers={},this.dispatch=i?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=i}subscriptionChange(e,t){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(t),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t),this._notifySubscriptionChange(e,!0)}unsubscribe(e,t){var i;if(this.events[e])if(t)if(i=this.events[e].findIndex(n=>n===t),i>-1)this.events[e].splice(i,1);else{console.warn("Cannot remove event, no matching event found:",e,t);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,t){var i=this.subscriptionNotifiers[e];i&&i.forEach(n=>{n(t)})}_dispatch(){var e=Array.from(arguments),t=e.shift(),i;return this.events[t]&&this.events[t].forEach((n,r)=>{let o=n.apply(this.table,e);r||(i=o)}),i}_debugDispatch(){var e=Array.from(arguments),t=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._dispatch(...arguments)}}class kA{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,t){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(t),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,t,i=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:t,priority:i}),this.events[e].sort((n,r)=>n.priority-r.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,t){var i;if(this.events[e]){if(t)if(i=this.events[e].findIndex(n=>n.callback===t),i>-1)this.events[e].splice(i,1);else{console.warn("Cannot remove event, no matching event found:",e,t);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,t,i,n){var r=i;return Array.isArray(t)||(t=[t]),this.subscribed(e)?(this.events[e].forEach((o,l)=>{r=o.callback.apply(this,t.concat([r]))}),r):typeof n=="function"?n():n}_confirm(e,t){var i=!1;return Array.isArray(t)||(t=[t]),this.subscribed(e)&&this.events[e].forEach((n,r)=>{n.callback.apply(this,t)&&(i=!0)}),i}_notifySubscriptionChange(e,t){var i=this.subscriptionNotifiers[e];i&&i.forEach(n=>{n(t)})}_dispatch(){var e=Array.from(arguments),t=e.shift();this.events[t]&&this.events[t].forEach(i=>{i.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),t=e[0];return e[0]="InternalEvent:"+t,(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),t=e[0];return e[0]="InternalEvent:"+t,(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),t=e[0];return e[0]="InternalEvent:"+t,(this.debug===!0||this.debug.includes(t))&&console.log(...e),this._confirm(...arguments)}}class SA extends gt{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,t,i){var n="";return typeof this.options(e)<"u"?(n="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",t?(n=n+", Please use the %c"+t+"%c option instead",this._warnUser(n,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),i&&(this.table.options[t]=this.table.options[e])):this._warnUser(n,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,t){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+t,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class Ot{static register(e){Ot.tables.push(e)}static deregister(e){var t=Ot.tables.indexOf(e);t>-1&&Ot.tables.splice(t,1)}static lookupTable(e,t){var i=[],n,r;if(typeof e=="string"){if(n=document.querySelectorAll(e),n.length)for(var o=0;o<n.length;o++)r=Ot.matchElement(n[o]),r&&i.push(r)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof un?(r=Ot.matchElement(e),r&&i.push(r)):Array.isArray(e)?e.forEach(function(l){i=i.concat(Ot.lookupTable(l))}):t||console.warn("Table Connection Error - Invalid Selector",e);return i}static matchElement(e){return Ot.tables.find(function(t){return e instanceof un?t===e:t.element===e})}}Ot.tables=[];function _A(s,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(s),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function Ep(s,e){s.forEach(function(t){t.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function RA(s,e){var t=0,i=this.table.rowManager.element.clientWidth,n=0,r=!1;s.forEach((o,l)=>{o.widthFixed||o.reinitializeWidth(),(this.table.options.responsiveLayout?o.modules.responsive.visible:o.visible)&&(r=o),o.visible&&(t+=o.getWidth())}),r?(n=i-t+r.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(r.setWidth(0),this.table.modules.responsiveLayout.update()),n>0?r.setWidth(n):r.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function TA(s,e){var t=this.table.rowManager.element.getBoundingClientRect().width,i=0,n=0,r=0,o=0,l=[],a=[],h=0,c=0,u=0;function d(p){var m;return typeof p=="string"?p.indexOf("%")>-1?m=t/100*parseInt(p):m=parseInt(p):m=p,m}function f(p,m,g,b){var v=[],C=0,x=0,w=0,E=r,k=0,R=0,P=[];function q(D){return g*(D.column.definition.widthGrow||1)}function N(D){return d(D.width)-g*(D.column.definition.widthShrink||0)}return p.forEach(function(D,ce){var X=b?N(D):q(D);D.column.minWidth>=X?v.push(D):D.column.maxWidth&&D.column.maxWidth<X?(D.width=D.column.maxWidth,m-=D.column.maxWidth,E-=b?D.column.definition.widthShrink||1:D.column.definition.widthGrow||1,E&&(g=Math.floor(m/E))):(P.push(D),R+=b?D.column.definition.widthShrink||1:D.column.definition.widthGrow||1)}),v.length?(v.forEach(function(D){C+=b?D.width-D.column.minWidth:D.column.minWidth,D.width=D.column.minWidth}),x=m-C,w=R?Math.floor(x/R):x,k=f(P,x,w,b)):(k=R?m-Math.floor(m/R)*R:m,P.forEach(function(D){D.width=b?N(D):q(D)})),k}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(t-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),s.forEach(function(p){var m,g,b;p.visible&&(m=p.definition.width,g=parseInt(p.minWidth),m?(b=d(m),i+=b>g?b:g,p.definition.widthShrink&&(a.push({column:p,width:b>g?b:g}),h+=p.definition.widthShrink)):(l.push({column:p,width:0}),r+=p.definition.widthGrow||1))}),n=t-i,o=Math.floor(n/r),u=f(l,n,o,!1),l.length&&u>0&&(l[l.length-1].width+=u),l.forEach(function(p){n-=p.width}),c=Math.abs(u)+n,c>0&&h&&(u=f(a,c,Math.floor(c/h),!0)),u&&a.length&&(a[a.length-1].width-=u),l.forEach(function(p){p.column.setWidth(p.width)}),a.forEach(function(p){p.column.setWidth(p.width)})}var MA={fitData:_A,fitDataFill:Ep,fitDataTable:Ep,fitDataStretch:RA,fitColumns:TA};class sr extends se{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;sr.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),sr.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}}sr.moduleName="layout";sr.modes=MA;var DA={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class xo extends se{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Te.deepClone(xo.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,t){this.langList[e]?this._setLangProp(this.langList[e],t):this.langList[e]=t}_setLangProp(e,t){for(let i in t)e[i]&&typeof e[i]=="object"?this._setLangProp(e[i],t[i]):e[i]=t[i]}setLocale(e){e=e||"default";function t(i,n){for(var r in i)typeof i[r]=="object"?(n[r]||(n[r]={}),t(i[r],n[r])):n[r]=i[r]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let i=e.split("-")[0];this.langList[i]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,i),e=i):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=Te.deepClone(this.langList.default||{}),e!="default"&&t(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,t){var i=t?e+"|"+t:e,n=i.split("|"),r=this._getLangElement(n,this.locale);return r||""}_getLangElement(e,t){var i=this.lang;return e.forEach(function(n){var r;i&&(r=i[n],typeof r<"u"?i=r:i=!1)}),i}bind(e,t){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(t),t(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(t=>{t(this.getText(e),this.lang)})}}xo.moduleName="localize";xo.langs=DA;class iw extends se{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var t=[],i;return i=Ot.lookupTable(e),i.forEach(n=>{this.table!==n&&t.push(n)}),t}send(e,t,i,n){var r=this.getConnections(e);r.forEach(o=>{o.tableComms(this.table.element,t,i,n)}),!r.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,t,i,n){if(this.table.modExists(t))return this.table.modules[t].commsReceived(e,i,n);console.warn("Inter-table Comms Error - no such module:",t)}}iw.moduleName="comms";var AA=Object.freeze({__proto__:null,LayoutModule:sr,LocalizeModule:xo,CommsModule:iw});class sw{constructor(e,t){this.bindStaticFunctionality(e),this.bindModules(e,AA,!0),t&&this.bindModules(e,t)}bindStaticFunctionality(e){e.moduleBindings={},e.extendModule=function(t,i,n){if(e.moduleBindings[t]){var r=e.moduleBindings[t][i];if(r)if(typeof n=="object")for(let o in n)r[o]=n[o];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",i)}else console.warn("Module Error - module does not exist:",t)},e.registerModule=function(t){Array.isArray(t)||(t=[t]),t.forEach(i=>{e.registerModuleBinding(i)})},e.registerModuleBinding=function(t){e.moduleBindings[t.moduleName]=t},e.findTable=function(t){var i=Ot.lookupTable(t,!0);return Array.isArray(i)&&!i.length?!1:i},e.prototype.bindModules=function(){var t=[],i=[],n=[];this.modules={};for(var r in e.moduleBindings){let o=e.moduleBindings[r],l=new o(this);this.modules[r]=l,o.prototype.moduleCore?this.modulesCore.push(l):o.moduleInitOrder?o.moduleInitOrder<0?t.push(l):i.push(l):n.push(l)}t.sort((o,l)=>o.moduleInitOrder>l.moduleInitOrder?1:-1),i.sort((o,l)=>o.moduleInitOrder>l.moduleInitOrder?1:-1),this.modulesRegular=t.concat(n.concat(i))}}bindModules(e,t,i){var n=Object.values(t);i&&n.forEach(r=>{r.prototype.moduleCore=!0}),e.registerModule(n)}}class OA extends gt{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,t="msg"){if(e){for(this.clear(),this.dispatch("alert-show",t),this.type=t;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class un{constructor(e,t){this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new CA(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new SA(this),this.optionsList=new tw(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(t),setTimeout(()=>{this._create()})),Ot.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new mA(this),this.rowManager=new yA(this),this.footerManager=new vA(this),this.dataLoader=new EA(this),this.alertManager=new OA(this),this.bindModules(),this.options=this.optionsList.generate(un.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new xA(this,this.options,this.options.debugEventsExternal),this.eventBus=new kA(this.options.debugEventsInternal),this.interactionMonitor=new wA(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this._loadInitialData(),this.initialized=!0,this.externalEvents.dispatch("tableBuilt")}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,t=this.options,i;if(e.tagName==="TABLE"){this.originalElement=this.element,i=document.createElement("div");var n=e.attributes;for(var r in n)typeof n[r]=="object"&&i.setAttribute(n[r].name,n[r].value);e.parentNode.replaceChild(i,e),this.element=e=i}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);t.height&&(t.height=isNaN(t.height)?t.height:t.height+"px",e.style.height=t.height),t.minHeight!==!1&&(t.minHeight=isNaN(t.minHeight)?t.minHeight:t.minHeight+"px",e.style.minHeight=t.minHeight),t.maxHeight!==!1&&(t.maxHeight=isNaN(t.maxHeight)?t.maxHeight:t.maxHeight+"px",e.style.maxHeight=t.maxHeight)}_initializeTable(){var e=this.element,t=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(i=>{i.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),t.footerElement&&this.footerManager.activate(),t.autoColumns&&t.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(i=>{i.initialize()}),this.columnManager.setColumns(t.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){this.dataLoader.load(this.options.data),this.columnManager.verticalAlignHeaders()}destroy(){var e=this.element;for(this.destroyed=!0,Ot.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,t){var i,n;return this.options.debugInitialization&&!this.initialized&&(e||(i=new Error().stack.split(`
`),n=i[0]=="Error"?i[2]:i[1],n[0]==" "?e=n.trim().split(" ")[1].split(".")[1]:e=n.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(t?" "+t:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,t,i){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,t,i,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,t,i){return this.initGuard(),this.dataLoader.load(e,t,i,!0,!0)}updateData(e){var t=0;return this.initGuard(),new Promise((i,n)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(r=>{var o=this.rowManager.findRow(r[this.options.index]);o?(t++,o.updateData(r).then(()=>{t--,t||i()}).catch(l=>{n("Update Error - Unable to update row",r,l)})):n("Update Error - Unable to find row",r)}):(console.warn("Update Error - No data provided"),n("Update Error - No data provided"))})}addData(e,t,i){return this.initGuard(),new Promise((n,r)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,t,i).then(o=>{var l=[];o.forEach(function(a){l.push(a.getComponent())}),n(l)}):(console.warn("Update Error - No data provided"),r("Update Error - No data provided"))})}updateOrAddData(e){var t=[],i=0;return this.initGuard(),new Promise((n,r)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var l=this.rowManager.findRow(o[this.options.index]);i++,l?l.updateData(o).then(()=>{i--,t.push(l.getComponent()),i||n(t)}):this.rowManager.addRows(o).then(a=>{i--,t.push(a[0].getComponent()),i||n(t)})}):(console.warn("Update Error - No data provided"),r("Update Error - No data provided"))})}getRow(e){var t=this.rowManager.findRow(e);return t?t.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var t=this.rowManager.getRowFromPosition(e);return t?t.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var t=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let i of e){let n=this.rowManager.findRow(i,!0);if(n)t.push(n);else return console.error("Delete Error - No matching row found:",i),Promise.reject("Delete Error - No matching row found")}return t.sort((i,n)=>this.rowManager.rows.indexOf(i)>this.rowManager.rows.indexOf(n)?1:-1),t.forEach(i=>{i.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,t,i){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,t,i,!0).then(n=>n[0].getComponent())}updateOrAddRow(e,t){var i=this.rowManager.findRow(e);return this.initGuard(),typeof t=="string"&&(t=JSON.parse(t)),i?i.updateData(t).then(()=>i.getComponent()):this.rowManager.addRows(t).then(n=>n[0].getComponent())}updateRow(e,t){var i=this.rowManager.findRow(e);return this.initGuard(),typeof t=="string"&&(t=JSON.parse(t)),i?i.updateData(t).then(()=>Promise.resolve(i.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,t,i){var n=this.rowManager.findRow(e);return n?this.rowManager.scrollToRow(n,t,i):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,t,i){var n=this.rowManager.findRow(e);this.initGuard(),n?n.moveToRow(t,i):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var t=this.rowManager.findRow(e);return t?t.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var t=this.columnManager.findColumn(e);return t?t.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var t=this.columnManager.findColumn(e);if(this.initGuard(),t)t.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var t=this.columnManager.findColumn(e);if(this.initGuard(),t)t.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var t=this.columnManager.findColumn(e);if(this.initGuard(),t)t.visible?t.hide():t.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,t,i){var n=this.columnManager.findColumn(i);return this.initGuard(),this.columnManager.addColumn(e,t,n).then(r=>r.getComponent())}deleteColumn(e){var t=this.columnManager.findColumn(e);return this.initGuard(),t?t.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,t){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.updateDefinition(t):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,t,i){var n=this.columnManager.findColumn(e),r=this.columnManager.findColumn(t);this.initGuard(),n?r?this.columnManager.moveColumn(n,r,i):console.warn("Move Error - No matching column found:",r):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,t,i){return new Promise((n,r)=>{var o=this.columnManager.findColumn(e);return o?this.columnManager.scrollToColumn(o,t,i):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw()}on(e,t){this.externalEvents.subscribe(e,t)}off(e,t){this.externalEvents.unsubscribe(e,t)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,t){this.initGuard(),this.alertManager.alert(e,t)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,t){return this.modules[e]?!0:(t&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var t=this.modules[e];return t||console.error("Tabulator module not installed: "+e),t}}un.defaultOptions=dA;new sw(un);class nw extends un{}new sw(nw,uA);function LA(s){let e,t,i=s[12].message+"",n;return{c(){e=Ae("div"),t=Ae("p"),n=jc(i),this.h()},l(r){e=Oe(r,"DIV",{class:!0});var o=ze(e);t=Oe(o,"P",{style:!0});var l=ze(t);n=Gc(l,i),l.forEach(ie),o.forEach(ie),this.h()},h(){wr(t,"color","red"),J(e,"class","my-4")},m(r,o){Xe(r,e,o),ve(e,t),ve(t,n)},p(r,o){o&4&&i!==(i=r[12].message+"")&&qc(n,i)},d(r){r&&ie(e)}}}function IA(s){let e,t,i,n,r;return{c(){e=Ae("div"),t=Ae("div"),this.h()},l(o){e=Oe(o,"DIV",{class:!0});var l=ze(e);t=Oe(l,"DIV",{class:!0}),ze(t).forEach(ie),l.forEach(ie),this.h()},h(){J(t,"class","tabulator svelte-1laoiqp"),J(e,"class","my-4")},m(o,l){Xe(o,e,l),ve(e,t),n||(r=dw(i=s[4].call(null,t,{data:s[11].rows,columns:s[11].columns})),n=!0)},p(o,l){s=o,i&&fw(i.update)&&l&4&&i.update.call(null,{data:s[11].rows,columns:s[11].columns})},d(o){o&&ie(e),n=!1,r()}}}function BA(s){return{c:at,l:at,m:at,p:at,d:at}}function FA(s){let e,t,i,n,r,o,l,a="Eksekusi",h,c,u,d,f,p,m,g,b,v;function C(E){s[9](E)}let x={styles:s[5],lang:FM(s[6])};s[0]!==void 0&&(x.value=s[0]),i=new zT({props:x}),Us.push(()=>Cr(i,"value",C));let w={ctx:s,current:null,token:null,hasCatch:!0,pending:BA,then:IA,catch:LA,value:11,error:12};return id(f=s[2],w),{c(){e=Ae("div"),t=Ae("div"),Qs(i.$$.fragment),r=Vt(),o=Ae("div"),l=Ae("button"),l.textContent=a,h=Vt(),c=Ae("span"),u=jc(s[1]),d=Vt(),w.block.c(),p=Vt(),m=Ae("link"),this.h()},l(E){e=Oe(E,"DIV",{class:!0});var k=ze(e);t=Oe(k,"DIV",{class:!0});var R=ze(t);Js(i.$$.fragment,R),R.forEach(ie),r=Wt(k),o=Oe(k,"DIV",{class:!0});var P=ze(o);l=Oe(P,"BUTTON",{title:!0,style:!0,"data-svelte-h":!0}),Hs(l)!=="svelte-1hij4l"&&(l.textContent=a),h=Wt(P),c=Oe(P,"SPAN",{class:!0});var q=ze(c);u=Gc(q,s[1]),q.forEach(ie),P.forEach(ie),d=Wt(k),w.block.l(k),k.forEach(ie),p=Wt(E);const N=uw("svelte-n5sc7l",document.head);m=Oe(N,"LINK",{href:!0,rel:!0}),N.forEach(ie),this.h()},h(){J(t,"class","my-4"),J(l,"title","Execute Query"),J(l,"style",""),J(c,"class","my-2"),J(o,"class","my-4"),J(e,"class","border border-primary-300 rounded-lg py-2 px-4 block my-4"),J(m,"href","/css/tabulator.css"),J(m,"rel","stylesheet")},m(E,k){Xe(E,e,k),ve(e,t),Xs(i,t,null),ve(e,r),ve(e,o),ve(o,l),ve(o,h),ve(o,c),ve(c,u),ve(e,d),w.block.m(e,w.anchor=null),w.mount=()=>e,w.anchor=null,Xe(E,p,k),ve(document.head,m),g=!0,b||(v=Dh(l,"click",s[10]),b=!0)},p(E,[k]){s=E;const R={};!n&&k&1&&(n=!0,R.value=s[0],vr(()=>n=!1)),i.$set(R),(!g||k&2)&&qc(u,s[1]),w.ctx=s,k&4&&f!==(f=s[2])&&id(f,w)||mw(w,s,k)},i(E){g||(Oi(i.$$.fragment,E),g=!0)},o(E){Ai(i.$$.fragment,E),g=!1},d(E){E&&(ie(e),ie(p)),Zs(i),w.block.d(),w.token=null,w=null,ie(m),b=!1,v()}}}function PA(s,e){return e.map(t=>{const i={};return s.forEach(n=>{const r=n.field,o=t[r];if(o==null)i[r]=null;else if(n.type==="Date")i[r]=new Date(o).toISOString().split("T")[0];else if(n.type==="Timestamp"){const l=new Date(o);i[r]=l.toISOString()}else n.type==="Interval"?i[r]=new String(o):i[r]=o}),i})}function NA(s,e,t){async function i(p){t(1,a="Mengeksekusi kueri...");const m=await h,g=/(https?:\/\/[^\s\/$.?#].[^\s]*\.json)/i,b=p.match(g);if(b){const v=b[1];if(!registeredJsonUrls.includes(v)){console.log("JSON URL:",v);try{let x=await(await fetch(v)).json();await(await c).registerFileText(v,JSON.stringify(x)),await m.insertJSONFromPath(v,{schema:"main",name:v}),registeredJsonUrls.push(v)}catch(C){t(2,u=new Promise((x,w)=>w(C))),t(1,a="Galat")}}}try{let v=Date.now();const C=await m.query(p),x=C.toArray().map(k=>Object.fromEntries(k)),w=C.schema.fields.map(k=>({title:k.name,field:k.name,type:k.type.constructor[Symbol.toStringTag]})),E=PA(w,x);if(t(2,u={rows:E,columns:C.schema.fields.map(k=>({title:k.name,field:k.name,headerSort:!1,formatter:"plaintext"}))}),u){let R=Date.now()-v;t(1,a=`Kueri selesai dieksekusi dalam ${R} milidetik.`)}else t(1,a="")}catch(v){t(2,u=new Promise((C,x)=>x(v))),t(1,a="Error")}}function n(p,{data:m,columns:g}){let b=new nw(p,{height:m.length<10?"auto":"30rem",data:m,columns:g,nestedFieldSeparator:!1,clipboard:!0,clipboardCopyStyled:!1,nestedFieldSeparator:!1});return{update:({data:v,columns:C})=>{v.length>10&&b.setHeight("30rem"),b.setColumns(C),b.setData(v)}}}const r={"&":{maxWidth:"100%",marginBottom:"10px"},".cm-scroller":{overflow:"auto"},".cm-content, .cm-gutter":{minHeight:"2rem",fontFamily:"Iosevka Term SS08 Web",fontSize:"0.95em"}};let o={upperCaseKeywords:!0,dialect:zM},{value:l=""}=e,a="",{connProm:h}=e,{dbInit:c}=e,u=new Promise(()=>({}));function d(p){l=p,t(0,l)}const f=()=>{i(l)};return s.$$set=p=>{"value"in p&&t(0,l=p.value),"connProm"in p&&t(7,h=p.connProm),"dbInit"in p&&t(8,c=p.dbInit)},[l,a,u,i,n,r,o,h,c,d,f]}class zA extends fn{constructor(e){super(),pn(this,e,NA,FA,dn,{value:0,connProm:7,dbInit:8})}}function HA(s){let e,t,i,n,r,o="Pengantar",l,a,h,c="Test.sql",u,d,f,p=`<code><span class="line"><span style="color:#1E754F">SELECT</span><span style="color:#AB5959"> *</span><span style="color:#1E754F"> FROM</span><span style="color:#1E754F"> BETWEEN</span><span style="color:#1E754F"> AND</span><span style="color:#1E754F"> WHERE</span><span style="color:#1E754F"> IN</span><span style="color:#1E754F"> ORDER BY</span><span style="color:#1E754F"> OVER</span><span style="color:#1E754F"> PARTITION</span><span style="color:#1E754F"> BY</span></span>
<span class="line"><span style="color:#1E754F">ROWS</span><span style="color:#1E754F"> UNBOUNDED</span><span style="color:#393A34"> PRECEEDING </span><span style="color:#1E754F">TABLE</span><span style="color:#1E754F"> VALUES</span><span style="color:#1E754F"> CREATE</span><span style="color:#1E754F"> OR</span><span style="color:#1E754F"> REPLACE</span><span style="color:#393A34"> MACRO </span><span style="color:#1E754F">TABLE</span></span></code>`,m,g,b=`<code><span class="line"><span style="color:#C792EA">SELECT</span><span style="color:#7FDBCA"> *</span><span style="color:#C792EA"> FROM</span><span style="color:#C792EA"> BETWEEN</span><span style="color:#C792EA"> AND</span><span style="color:#C792EA"> WHERE</span><span style="color:#C792EA"> IN</span><span style="color:#C792EA"> ORDER BY</span><span style="color:#C792EA"> OVER</span><span style="color:#C792EA"> PARTITION</span><span style="color:#C792EA"> BY</span></span>
<span class="line"><span style="color:#C792EA">ROWS</span><span style="color:#C792EA"> UNBOUNDED</span><span style="color:#D6DEEB"> PRECEEDING </span><span style="color:#C792EA">TABLE</span><span style="color:#C792EA"> VALUES</span><span style="color:#C792EA"> CREATE</span><span style="color:#C792EA"> OR</span><span style="color:#C792EA"> REPLACE</span><span style="color:#D6DEEB"> MACRO </span><span style="color:#C792EA">TABLE</span></span></code>`,v,C,x="sql",w,E,k,R,P,q,N;function D(I){s[3](I)}function ce(I){s[4](I)}let X={};s[0]!==void 0&&(X.connProm=s[0]),s[1]!==void 0&&(X.dbInit=s[1]),e=new Y1({props:X}),Us.push(()=>Cr(e,"connProm",D)),Us.push(()=>Cr(e,"dbInit",ce)),E=new kw({});function be(I){s[5](I)}function qe(I){s[6](I)}let Ne={value:"SELECT 1,2,3,4;"};return s[0]!==void 0&&(Ne.connProm=s[0]),s[1]!==void 0&&(Ne.dbInit=s[1]),R=new zA({props:Ne}),Us.push(()=>Cr(R,"connProm",be)),Us.push(()=>Cr(R,"dbInit",qe)),{c(){Qs(e.$$.fragment),n=Vt(),r=Ae("p"),r.textContent=o,l=Vt(),a=Ae("div"),h=Ae("div"),h.textContent=c,u=Vt(),d=Ae("div"),f=Ae("pre"),f.innerHTML=p,m=Vt(),g=Ae("pre"),g.innerHTML=b,v=Vt(),C=Ae("div"),C.textContent=x,w=Vt(),Qs(E.$$.fragment),k=Vt(),Qs(R.$$.fragment),this.h()},l(I){Js(e.$$.fragment,I),n=Wt(I),r=Oe(I,"P",{"data-svelte-h":!0}),Hs(r)!=="svelte-9ajzqu"&&(r.textContent=o),l=Wt(I),a=Oe(I,"DIV",{class:!0});var M=ze(a);h=Oe(M,"DIV",{class:!0,"data-svelte-h":!0}),Hs(h)!=="svelte-14ojqoc"&&(h.textContent=c),u=Wt(M),d=Oe(M,"DIV",{class:!0});var re=ze(d);f=Oe(re,"PRE",{class:!0,style:!0,tabindex:!0,"data-svelte-h":!0}),Hs(f)!=="svelte-yfzd34"&&(f.innerHTML=p),m=Wt(re),g=Oe(re,"PRE",{class:!0,style:!0,tabindex:!0,"data-svelte-h":!0}),Hs(g)!=="svelte-1vr6lbh"&&(g.innerHTML=b),v=Wt(re),C=Oe(re,"DIV",{class:!0,"data-svelte-h":!0}),Hs(C)!=="svelte-1ggdy3o"&&(C.textContent=x),w=Wt(re),Js(E.$$.fragment,re),re.forEach(ie),M.forEach(ie),k=Wt(I),Js(R.$$.fragment,I),this.h()},h(){J(h,"class","svp-code-block--title"),J(f,"class","shiki vitesse-light"),wr(f,"background-color","#ffffff"),wr(f,"color","#393a34"),J(f,"tabindex","0"),J(g,"class","shiki night-owl"),wr(g,"background-color","#011627"),wr(g,"color","#d6deeb"),J(g,"tabindex","0"),J(C,"class","svp-code-block--lang"),J(d,"class","svp-code-block"),J(a,"class","svp-code-block-wrapper")},m(I,M){Xs(e,I,M),Xe(I,n,M),Xe(I,r,M),Xe(I,l,M),Xe(I,a,M),ve(a,h),ve(a,u),ve(a,d),ve(d,f),ve(d,m),ve(d,g),ve(d,v),ve(d,C),ve(d,w),Xs(E,d,null),Xe(I,k,M),Xs(R,I,M),N=!0},p(I,M){const re={};!t&&M&1&&(t=!0,re.connProm=I[0],vr(()=>t=!1)),!i&&M&2&&(i=!0,re.dbInit=I[1],vr(()=>i=!1)),e.$set(re);const Ie={};!P&&M&1&&(P=!0,Ie.connProm=I[0],vr(()=>P=!1)),!q&&M&2&&(q=!0,Ie.dbInit=I[1],vr(()=>q=!1)),R.$set(Ie)},i(I){N||(Oi(e.$$.fragment,I),Oi(E.$$.fragment,I),Oi(R.$$.fragment,I),N=!0)},o(I){Ai(e.$$.fragment,I),Ai(E.$$.fragment,I),Ai(R.$$.fragment,I),N=!1},d(I){I&&(ie(n),ie(r),ie(l),ie(a),ie(k)),Zs(e,I),Zs(E),Zs(R,I)}}}function VA(s){let e,t;return e=new pw({props:{fm:s[2],$$slots:{default:[HA]},$$scope:{ctx:s}}}),{c(){Qs(e.$$.fragment)},l(i){Js(e.$$.fragment,i)},m(i,n){Xs(e,i,n),t=!0},p(i,[n]){const r={};n&131&&(r.$$scope={dirty:n,ctx:i}),e.$set(r)},i(i){t||(Oi(e.$$.fragment,i),t=!0)},o(i){Ai(e.$$.fragment,i),t=!1},d(i){Zs(e,i)}}}function WA(s,e,t){const i={pageType:"md",lastUpdate:"2023-10-12",title:"guide",anchors:[]};let n,r;function o(c){n=c,t(0,n)}function l(c){r=c,t(1,r)}function a(c){n=c,t(0,n)}function h(c){r=c,t(1,r)}return[n,r,i,o,l,a,h]}class lO extends fn{constructor(e){super(),pn(this,e,WA,VA,dn,{})}}export{lO as component};
